/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
/******/ (() => { // webpackBootstrap
/******/ 	"use strict";
/******/ 	var __webpack_modules__ = ({

/***/ "./sources/game-support-models.js":
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AM_InitializationClient: () => (/* binding */ AM_InitializationClient),\n/* harmony export */   GameModelRoot: () => (/* binding */ GameModelRoot),\n/* harmony export */   InitializationManager: () => (/* binding */ InitializationManager)\n/* harmony export */ });\n/* harmony import */ var _croquet_worldcore_kernel__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(\"../node_modules/@croquet/worldcore-kernel/index.js\");\n// Worldcore with Unity\n//\n// Croquet Corporation, 2023\n\n\n\n// InitializationManager is a model service that knows how to instantiate a set of actors from an init chunk\nclass InitializationManager extends _croquet_worldcore_kernel__WEBPACK_IMPORTED_MODULE_0__.ModelService {\n    logWithSyncTag(logType, ...args) {\n        // if the vm is being (re)loaded, add \"[in SYNC]\" prefix.\n        // HIGHLY UNOFFICIAL WAY OF DETECTING LOAD.\n        const { controller } = this.__realm.vm;\n        const isLoading = !controller || !!controller.fastForwardHandler;\n        if (isLoading) args = [\"[in SYNC]\", ...args];\n        console[logType](...args);\n    }\n\n    init() {\n        super.init('InitializationManager');\n        this.activeScene = \"\"; // the scene we're running, or getting ready to run\n        this.activeSceneState = \"\"; // preload, initializing, running\n        this.initializingView = \"\"; // the view that has permission from us to provide the data for the current activeScene\n        this.sceneSupplierView = \"\"; // the latest Unity-editor client to have joined the session.  as long as it sticks around, it will be given the job of defining each scene that the session enters, overriding any pre-stored definitions.\n\n        this.client = null; // needs to handle onPrepareForInitialization, onInitializationStart, onObjectInitialization\n\n        // @@ DON'T TRY THIS AT HOME\n        // workaround for Constants being frozen\n        this.sceneDefinitions = null;\n        if (globalThis.GameConstants?.sceneText) { // ignore undefined, or empty string\n            this.setSceneDefinitions(globalThis.GameConstants.sceneText);\n        }\n\n        this.initBufferCollector = [];\n        this.lastInitString = null; // if activeSceneState is running, this is the string that was used to initialise it.  we can reload the scene instantly by reusing this.\n\n        this.subscribe(this.sessionId, 'registerEditorClient', this.registerEditorClient);\n        this.subscribe(this.sessionId, 'requestToLoadScene', this.handleRequestToLoadScene);\n        this.subscribe(this.sessionId, 'requestToInitScene', this.handleRequestToInitScene);\n        this.subscribe(this.sessionId, 'sceneInitChunk', this.sceneInitChunk);\n        this.subscribe(this.sessionId, 'view-exit', this.handleViewExit);\n    }\n\n    setSceneDefinitions(sceneText) {\n        this.sceneDefinitions = {};\n        const sceneDefArray = sceneText.split('\\x02');\n        // the file contains sceneName1 | definition1 | sceneName2 | definition2 etc\n        for (let i = 0; i < sceneDefArray.length; i += 2) {\n            const sceneName = sceneDefArray[i];\n            const definition = sceneDefArray[i + 1];\n            this.logWithSyncTag('log', `definition of scene ${sceneName}: ${definition.length} chars`);\n            this.sceneDefinitions[sceneName] = definition;\n        }\n    }\n\n    setClient(model) {\n        this.client = model;\n    }\n\n    registerEditorClient(viewId) {\n        // the PreloadingViewRoot on a client with a Unity editor has just\n        // started up.  for as long as it's in the session, it will be given\n        // the responsibility of supplying on the fly a definition for each\n        // scene that the session enters, overriding any pre-stored definitions.\n        this.logWithSyncTag('log', `view ${viewId} registered as scene supplier`);\n        this.sceneSupplierView = viewId;\n    }\n\n    handleRequestToLoadScene({ sceneName, forceReload, forceRebuild }) {\n        // this comes from a view (unity or otherwise), for example when a user presses a button to advance to the next level\n\n        // if sceneName is the same as activeScene:\n        //    if the state is 'preload' or 'loading', ignore.  it's already being dealt with.\n        //    else the state must be 'running', so reject the request unless forceFlag is true.  if accepting, set state to 'preload' iff forceRebuild is true, else 'loading' (since we already have the definition).\n\n        // new scene name: accept as the new activeScene.  state can move to 'loading' (which will synchronously jump through to 'running' here, but sending the intermediate value to Unity might be useful for scene management) if:\n        //   1. we have the scene's definition, and\n        //   2. forceRebuild is not true, and\n        //   3. there is no sceneSupplierView\n        // - else 'preload'\n        const { activeScene, activeSceneState } = this;\n        if (sceneName === activeScene) {\n            if (activeSceneState === 'preload' || activeSceneState === 'loading' || !forceReload) {\n                this.logWithSyncTag('log', `denying request to load ${sceneName}; sceneState is \"${activeSceneState}\"`);\n                return;\n            }\n\n            this.activeSceneState = forceRebuild ? 'preload' : 'loading';\n        } else {\n            this.activeScene = sceneName;\n            this.initializingView = null; // cut off any in-progress load for a previous scene\n            const definition = this.sceneDefinitions?.[sceneName];\n            if (definition && !forceRebuild && !this.sceneSupplierView) {\n                this.logWithSyncTag('log', `found pre-built definition of ${sceneName}`);\n                this.lastInitString = definition;\n                this.activeSceneState = 'loading';\n            } else {\n                this.lastInitString = null;\n                this.activeSceneState = 'preload';\n            }\n        }\n        this.logWithSyncTag('log', `approved request to load ${sceneName}; state now \"${this.activeSceneState}\"`);\n        if (forceRebuild) this.logWithSyncTag('warn', `forced to request fresh definition for ${sceneName}`);\n        if (this.activeSceneState === 'preload' && this.sceneSupplierView) this.logWithSyncTag('warn', `expecting scene-supplier view ${this.sceneSupplierView} to provide definition for ${sceneName}`);\n\n        this.publishSceneState(); // will immediately ditch the main viewRoot\n        this.client?.onPrepareForInitialization(); // clear out any non-persistent state from model\n\n        if (this.activeSceneState === 'loading') this.loadFromString(this.lastInitString);\n    }\n\n    handleRequestToInitScene({ viewId, sceneName }) {\n        // it's possible that this is an out-of-date request to init a scene that we're no longer interested in.\n        // deny the request if:\n        //  - sceneName is not the same as our activeScene, or\n        //  - activeSceneState is anything other than 'preload', or\n        //  - there is already an initializingView, or\n        //  - we have a sceneSupplierView and this request isn't from it\n        const { activeScene, initializingView, sceneSupplierView } = this;\n        let verdict;\n        if (sceneName !== activeScene || this.activeSceneState !== 'preload' || initializingView || (sceneSupplierView && sceneSupplierView !== viewId)) {\n            this.logWithSyncTag('log', `denying ${viewId} permission to init ${sceneName}`);\n            verdict = false;\n        } else {\n            this.logWithSyncTag('log', `granting ${viewId} permission to init ${sceneName}`);\n            this.activeSceneState = 'loading';\n            this.initializingView = viewId;\n            this.publishSceneState();\n            verdict = true;\n        }\n        this.publish(viewId, 'requestToInitVerdict', verdict);\n    }\n\n    sceneInitChunk({ viewId, sceneName, isFirst, isLast, buf }) {\n        // check that we haven't switched to loading something else\n        const { activeScene, initializingView } = this;\n        if (sceneName !== activeScene || viewId !== initializingView) return;\n\n        if (isFirst) this.initBufferCollector = [];\n        this.initBufferCollector.push(buf);\n        if (isLast) {\n            // turn the array of chunks into a single buffer\n            const bufs = this.initBufferCollector;\n            const len = bufs.reduce((acc, cur) => acc + cur.length, 0);\n            const all = new Uint8Array(len);\n            let ind = 0;\n            for (let i = 0; i < bufs.length; i++) {\n                all.set(bufs[i], ind);\n                ind += bufs[i].length;\n            }\n\n            const initString = new TextDecoder(\"utf-8\").decode(all);\n            this.logWithSyncTag('log', `received string of length ${initString.length}`);\n            this.lastInitString = initString;\n            this.initBufferCollector = [];\n            this.initializingView = null;\n            this.loadFromString(initString);\n        }\n    }\n\n    loadFromString(initString) {\n        this.client?.onInitializationStart();\n\n        const abbreviations = [];\n        const [_earlySubscriptionTopics, _assetManifestString, ...entities] = initString.split('\\x01');\n\n        if (entities.length && !this.client) {\n            this.logWithSyncTag('warn', \"Attempt to initialize scene entities without an appointed AM_InitializationClient object\");\n            entities.length = 0; // just ignore them\n        }\n\n        entities.forEach(entityString => {\n            // console.log(entityString);\n            const propertyStrings = entityString.split('|');\n            let cls;\n            const props = {};\n            propertyStrings.forEach(token => {\n                let propAndValue = token; // unless an abbreviation\n                if (token.startsWith('$')) propAndValue = abbreviations[token.slice(1)];\n                else abbreviations.push(token);\n                const [propName, value] = propAndValue.split(':');\n                switch (propName) {\n                    case 'ACTOR':\n                        try { cls = _croquet_worldcore_kernel__WEBPACK_IMPORTED_MODULE_0__.Actor.classFromID(value) }\n                        catch (e) {\n                            this.logWithSyncTag('warn', `Actor class not found for init string: ${entityString}`);\n                            cls = false; // mark that we tried and failed\n                        }\n                        break;\n                    case 'pos':\n                        props.translation = value.split(',').map(Number); // note name change\n                        break;\n                    case 'rot':\n                        props.rotation = (0,_croquet_worldcore_kernel__WEBPACK_IMPORTED_MODULE_0__.q_normalize)(value.split(',').map(Number));\n                        break;\n                    case 'scale':\n                        props.scale = value.split(',').map(Number);\n                        break;\n                    default:\n                        props[propName] = value;\n                }\n            });\n\n            if (!cls) {\n                if (cls !== false) this.logWithSyncTag('warn', `No actor specified in init string: ${entityString}`);\n                return;\n            }\n\n            this.client.onObjectInitialization(cls, props);\n        });\n\n        this.activeSceneState = 'running';\n        this.publishSceneState();\n    }\n\n    handleViewExit(viewId) {\n        // if the view that has left was the scene supplier, remove that\n        // registration\n        if (viewId === this.sceneSupplierView) {\n            this.logWithSyncTag('log', `scene-supplier view ${viewId} has left`);\n            this.sceneSupplierView = null;\n        }\n\n        // if the view that has left was in the middle of sending a scene\n        // initialisation, announce a reset to 'preload' to force clients\n        // to bid again to initialise.\n        if (viewId === this.initializingView) {\n            this.logWithSyncTag('log', `initializing view ${viewId} has left`);\n            this.initializingView = null;\n            this.activeSceneState = 'preload';\n            this.publishSceneState();\n        }\n    }\n\n    publishSceneState() {\n        this.publish(this.sessionId, 'sceneStateUpdated');\n    }\n\n    getSceneConstructionProperties() {\n        if (this.activeSceneState !== 'running') {\n            throw Error(\"attempt to fetch construction properties for non-running scene\");\n        }\n\n        const [earlySubscriptionTopics, assetManifestString] = this.lastInitString.split('\\x01'); // wasteful to split the whole thing, but doesn't happen often\n        return { earlySubscriptionTopics, assetManifestString };\n    }\n\n}\nInitializationManager.register('InitializationManager');\n\nconst AM_InitializationClient = superclass => class extends superclass {\n\n    init(...args) {\n        super.init(...args);\n        this.initializationManager = this.service('InitializationManager');\n        this.initializationManager.setClient(this);\n    }\n\n    onPrepareForInitialization() { }\n\n    onInitializationStart() { }\n\n    onObjectInitialization(_cls, _props) { }\n\n};\n(0,_croquet_worldcore_kernel__WEBPACK_IMPORTED_MODULE_0__.RegisterMixin)(AM_InitializationClient);\n\nclass GameModelRoot extends _croquet_worldcore_kernel__WEBPACK_IMPORTED_MODULE_0__.ModelRoot {\n    static modelServices() {\n        return [InitializationManager];\n    }\n}\nGameModelRoot.register('GameModelRoot');\n\n\n//# sourceURL=webpack:///./sources/game-support-models.js?");

/***/ }),

/***/ "./sources/unity-bridge.js":
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GameInputManager: () => (/* binding */ GameInputManager),\n/* harmony export */   GameViewManager: () => (/* binding */ GameViewManager),\n/* harmony export */   GameViewRoot: () => (/* binding */ GameViewRoot),\n/* harmony export */   PM_GameAvatar: () => (/* binding */ PM_GameAvatar),\n/* harmony export */   PM_GameBallistic2D: () => (/* binding */ PM_GameBallistic2D),\n/* harmony export */   PM_GameInteractable: () => (/* binding */ PM_GameInteractable),\n/* harmony export */   PM_GameMaterial: () => (/* binding */ PM_GameMaterial),\n/* harmony export */   PM_GameRendered: () => (/* binding */ PM_GameRendered),\n/* harmony export */   PM_GameSmoothed: () => (/* binding */ PM_GameSmoothed),\n/* harmony export */   PM_GameSpatial: () => (/* binding */ PM_GameSpatial),\n/* harmony export */   StartSession: () => (/* binding */ StartSession),\n/* harmony export */   theGameEngineBridge: () => (/* binding */ theGameEngineBridge)\n/* harmony export */ });\n/* harmony import */ var _croquet_worldcore_kernel__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(\"../node_modules/@croquet/worldcore-kernel/index.js\");\n// Worldcore with Unity\n//\n// Croquet Corporation, 2023\n\n// note on use of string separators in messages across the bridge\n//   \\x01 is used to separate the command and string arguments in a message\n//   \\x02 to separate entire messages in a bundle\n//   \\x03 to separate the elements in an array-type argument within a message, such as on a property update, say(), or publish()\n//   \\x04 currently unused\n//   \\x05 to mark the start of the data argument in a binary-encoded message, such as updateSpatial.\n\n\n\n\nglobalThis.timedLog = msg => {\n    // timing on the message itself is now added when forwarding\n    const toLog = `${(globalThis.CroquetViewDate || Date).now() % 100000}: ${msg}`;\n    performance.mark(toLog);\n    console.log(msg);\n};\n\n// globalThis.WC_Left = true; // NB: this can affect behaviour of both models and views\nglobalThis.CROQUET_NODE = typeof window === 'undefined';\n\n\nlet theGameInputManager, session, sessionOffsetEstimator;\n\n// theGameEngineBridge is a singleton instance of BridgeToUnity, built immediately\n// on loading of this file.  it is never rebuilt.\nclass BridgeToUnity {\n    get preloadingView() { return session?.view }\n\n    constructor() {\n        this.bridgeIsConnected = false;\n        this.startWS();\n        this.measureIndex = 0;\n    }\n\n    setCommandHandler(handler) {\n        this.commandHandler = handler;\n    }\n\n    resetMessageStats() {\n        this.msgStats = { outMessageCount: 0, outBundleCount: 0, inBundleCount: 0, inMessageCount: 0, inBundleDelayMS: 0, inProcessingTimeMS: 0, lastMessageDiagnostics: Date.now() };\n    }\n\n    startWS() {\n        globalThis.timedLog('starting socket client');\n        const portStr = this.socketPortStr = (!globalThis.CROQUET_NODE\n            ? window.location.port\n            : process.argv[2])\n            || '5555';\nconsole.log(`PORT ${portStr}`);\n        const sock = this.socket = new WebSocket(`ws://127.0.0.1:${portStr}/Bridge`);\n        sock.onopen = _evt => {\n            // until Unity tells us otherwise (with 'setJSLogForwarding'), forward\n            // all JS logs across the bridge\n            if (!console.q_log) {\n                console.q_log = console.log;\n                console.q_warn = console.warn;\n                console.q_error = console.error;\n            }\n            this.resetMessageStats();\n            this.setJSLogForwarding(['log', 'warn', 'error']);\n\n            globalThis.timedLog('opened socket');\n            this.bridgeIsConnected = true;\n            sock.onmessage = event => {\n                const msg = event.data;\n                if (msg !== 'tick') this.handleUnityMessageOrBundle(msg);\n                if (ticker) ticker();\n            };\n        };\n        sock.onclose = _evt => {\n            this.setJSLogForwarding([]); // restore to local logging\n            globalThis.timedLog('bridge websocket closed');\n            this.bridgeIsConnected = false;\n            if (session) session.leave();\n            if (globalThis.CROQUET_NODE) process.exit(); // if on node, bail out\n        };\n        sock.onerror = evt => console.error(\"bridge WebSocket error\", evt);\n    }\n\n    sendCommand(...args) {\n        if (args.findIndex(a => typeof a !== \"string\") >= 0) {\n            console.warn(\"Command and arguments must be strings; not sending\", args);\n            return;\n        }\n        const msg = [...args].join('\\x01');\n        this.sendToUnity(msg);\n\n        this.msgStats.outMessageCount++; // @@ stats don't really expect non-bundled messages\n    }\n\n    sendBundleToUnity(messages) {\n        // prepend the current time\n        messages.unshift(String(Date.now()));\n        const multiMsg = messages.join('\\x02');\n        this.sendToUnity(multiMsg);\n\n        const { msgStats } = this;\n        msgStats.outBundleCount++;\n        msgStats.outMessageCount += messages.length;\n\n        return multiMsg.length;\n    }\n\n    sendToUnity(msg) {\n        if (!this.socket) return; // @@ need to do better than just silently dropping\n        // console.log('sending to Unity', msg);\n        this.socket.send(msg);\n    }\n\n    encodeValueAsString(arg) {\n        // when sending a property value as part of a message over the bridge,\n        // elements of an array are separated with \\x03\n        return Array.isArray(arg)\n            ? arg.join('\\x03')\n            : typeof arg === 'boolean'\n                ? arg ? 'True' : 'False'\n                : String(arg);\n    }\n\n    handleUnityMessageOrBundle(msg) {\n        // handle a single or multiple message from Unity\n        const start = performance.now();\n        const { msgStats } = this;\n        const msgs = msg.split('\\x02');\n        if (msgs.length > 1) {\n            msgStats.inBundleCount++;\n            const sendTime = Number(msgs.shift());\n            const diff = Date.now() - sendTime;\n            msgStats.inBundleDelayMS += diff;\n        }\n        msgs.forEach(m => {\n            const strings = m.split('\\x01');\n            const command = strings[0];\n            const args = strings.slice(1);\n            this.handleUnityCommand(command, args);\n            msgStats.inMessageCount++;\n        });\n        msgStats.inProcessingTimeMS += performance.now() - start;\n    }\n\n    handleUnityCommand(command, args) {\n        // console.log('command from Unity: ', { command, args });\n        switch (command) {\n            case 'setJSLogForwarding': {\n                // args[0] is comma-separated list of log types (log,warn,error)\n                // that are to be sent over to Unity\n                // args[1] is a flag debugUsingExternalSession\n                const toForward = args[0].split(',');\n                const debugUsingExternalSession = args[1] === \"True\";\n                console.log(\"categories of JS log forwarded to Unity:\", toForward);\n                this.setJSLogForwarding(toForward);\n                // disable performance.mark and performance.measure if running in a webview,\n                // or on Node, so we don't accumulate measure objects.\n                if (!debugUsingExternalSession || globalThis.CROQUET_NODE) this.disablePerformanceMeasures();\n                break;\n            }\n            case 'readyForSession': {\n                const { apiKey, appId, appName, packageVersion, sessionName, debugFlags, isEditor } = JSON.parse(args[0]);\n                globalThis.timedLog(`starting session of ${appId} with key ${apiKey}`);\n                this.apiKey = apiKey;\n                this.appId = appId;\n                this.appName = appName;\n                this.packageVersion = packageVersion;\n                this.sessionName = sessionName;\n                this.debugFlags = debugFlags; // comma-separated list\n                this.runOffline = debugFlags.includes('offline');\n                this.isEditor = isEditor;\n                unityDrivenStartSession();\n                break;\n            }\n            case 'requestToLoadScene': {\n                // args are\n                //   scene name - if different from model's existing scene, request will always be accepted\n                //   forceReload - \"True\" or \"False\", determining whether init can override *same* scene in model\n                //   forceRebuild - \"True\" or \"False\", determining whether init can use cached scene details if available\n                if (this.preloadingView) {\n                    const sceneName = args[0];\n                    const forceReload = args[1] === 'True';\n                    const forceRebuild = args[2] === 'True';\n                    this.preloadingView.publishRequestToLoadScene(sceneName, forceReload, forceRebuild);\n                } else console.warn(`requestToLoadScene but no preloadingView!`);\n                break;\n            }\n            case 'defineScene': {\n                // args are\n                //   scene name - if different from model's existing scene, init will always be accepted\n                //   earlySubscriptionTopics\n                //   assetManifestString\n                //   object string 1 (string  prop1:val1|prop2:val2...)\n                //   object string 2\n                //   etc\n                const [sceneName, ...initStrings] = args;\n                // console.log(`defineScene for ${sceneName}`);\n                this.readySceneInUnity = sceneName;\n                const view = this.preloadingView;\n                if (view) {\n                    view.readyToBuildSceneInUnity(sceneName);\n                    view.attemptToPublishInitialization(sceneName, initStrings);\n                } else console.warn(`defineScene but no preloadingView!`);\n                break;\n            }\n            case 'readyToRunScene': {\n                // the unity side has read the prefab assets that are available\n                // for the specified scene, and is thus ready to make pawns for\n                // the scene's actors.\n                // tell the PreloadingViewRoot that we're ready to build the\n                // real root.\n                const sceneName = args[0];\n                // console.log(`readyToRunScene for ${sceneName}`);\n                this.readySceneInUnity = sceneName;\n                const view = this.preloadingView;\n                if (view) view.readyToBuildSceneInUnity(sceneName);\n                else console.warn(`readyToRunScene but no preloadingView!`);\n                break;\n            }\n            case 'event': {\n                // used for all interaction events (keyDown, keyUp, pointerHit etc)\n                if (theGameInputManager) theGameInputManager.handleEvent(args);\n                break;\n            }\n            case 'publish': {\n                // args[0] is scope\n                // args[1] is eventName\n                // args[2] - if supplied - is a string describing the format of the next argument:\n                //      s - single string\n                //      ss - string array\n                //      f - single float\n                //      ff - float array\n                //      b - boolean\n                // args[3] - the encoded arg\n                const [ scope, eventName, argFormat, argString ] = args;\n                // console.log({scope, eventName, argFormat, argString});\n                if (argFormat === undefined) this.preloadingView?.publish(scope, eventName);\n                else {\n                    let eventArgs = argString.split('\\x03');\n                    switch (argFormat) {\n                        case 's': // string\n                            eventArgs = eventArgs[0];\n                            break;\n                        case 'f': // float\n                            eventArgs = Number(eventArgs[0]);\n                            break;\n                        case 'ff': // float array\n                            eventArgs = eventArgs.map(Number);\n                            break;\n                        case 'b': // boolean\n                            eventArgs = eventArgs[0] === \"True\";\n                            break;\n                        case 'ss': // string array; ok as is\n                        default:\n                    }\n                    this.preloadingView?.publish(scope, eventName, eventArgs);\n                }\n                break;\n            }\n            case 'unityPong':\n                // args[0] is Date.now() when sent\n                globalThis.timedLog(`PONG after ${Date.now() - Number(args[0])}ms`);\n                break;\n            case 'log':\n                // args[0] is loggable string\n                globalThis.timedLog(`[Unity] ${args[0]}`);\n                break;\n            case 'measure': {\n                // args are [name, startDateNow, durationMS[, annotation]\n                const [markName, startDateNow, durationMS, annotation] = args;\n                const startPerf = performance.now() - Date.now() + Number(startDateNow);\n                const index = ++this.measureIndex;\n                const measureText = `U:${markName}${index} ${annotation || \"\"}`;\n                performance.measure(measureText, { start: startPerf, end: startPerf + Number(durationMS) });\n                break;\n            }\n            case 'simulateNetworkGlitch':\n                this.simulateNetworkGlitch(Number(args[0]));\n                break;\n            case 'shutdown':\n                // close any running session, but keep the bridge\n                // arg 0 - if present - is a reference (name or buildIndex) to the scene that Unity should switch to after tearing down the session\n                globalThis.timedLog('shutdown event received');\n                this.postShutdownSceneInUnity = args.length ? args[0] : null;\n                shutDownSession();\n                break;\n            default:\n                if (this.commandHandler) this.commandHandler(command, args);\n                else globalThis.timedLog(`unknown Unity command: ${command}`);\n        }\n    }\n\n    setSceneConstructionProperties(data) {\n        const { earlySubscriptionTopics, assetManifestString } = data;\n        this.earlySubscriptionTopics = earlySubscriptionTopics;\n        this.assetManifestString = assetManifestString;\n    }\n\n    tearDownScene() {\n        this.readySceneInUnity = null;\n        if (this.bridgeIsConnected) this.sendCommand('tearDownScene');\n    }\n\n    tearDownSession() {\n        this.readySceneInUnity = null; // can't harm\n        const sceneStr = this.postShutdownSceneInUnity || \"\";\n        this.postShutdownSceneInUnity = null;\n        if (this.bridgeIsConnected) this.sendCommand('tearDownSession', sceneStr);\n    }\n\n    setJSLogForwarding(toForward) {\n        const stringify = obj => { try { return JSON.stringify(obj) } catch (e) { return \"[non-JSONable object]\" }};\n        const timeStamper = logVals => `${(globalThis.CroquetViewDate || Date).now() % 100000}: ` + logVals.map(a => typeof a === 'object' ? stringify(a) : String(a)).join(' ');\n        const forwarder = (logType, logVals) => this.sendCommand('logFromJS', logType, timeStamper(logVals));\n        ['log', 'warn', 'error'].forEach(logType => {\n            const wantsForwarding = toForward.includes(logType);\n            if (wantsForwarding) console[logType] = (...logVals) => {\n                console[`q_${logType}`](...logVals); // log locally\n                forwarder(logType, logVals); // and also forward\n            };\n            else console[logType] = console[`q_${logType}`]; // use system default\n        });\n    }\n\n    disablePerformanceMeasures() {\n        // note: attempting basic reassignment\n        //    performance.mark = performance.measure = () => { };\n        // raises an error on Node.js v18\n        Object.defineProperty(performance, \"mark\", {\n            value: () => { },\n            configurable: true,\n            writable: true\n        });\n        Object.defineProperty(performance, \"measure\", {\n            value: () => { },\n            configurable: true,\n            writable: true\n        });\n    }\n\n    update(_time) {\n        // sent by the gameViewManager on each update()\n        const now = Date.now();\n        if (now - (this.lastTimeAnnouncement || 0) >= 1000) {\n            this.announceSessionTime();\n            this.lastTimeAnnouncement = now;\n        }\n\n        if (now - this.msgStats.lastMessageDiagnostics > 1000) {\n            const { inMessageCount, inBundleCount, inBundleDelayMS, inProcessingTimeMS, _outMessageCount, _outBundleCount } = this.msgStats;\n            if (inMessageCount || inBundleCount) {\n                globalThis.timedLog(`from Unity: ${inMessageCount} messages with ${inBundleCount} bundles (${Math.round(inBundleDelayMS/inBundleCount)}ms avg delay) handled in ${Math.round(inProcessingTimeMS)}ms\");`);\n            }\n            // globalThis.timedLog(`to Unity: ${outMessageCount} messages with ${outBundleCount} bundles`);\n            this.resetMessageStats();\n        }\n    }\n\n    announceSessionTime() {\n        // the sessionOffsetEstimator provides an estimate of how far the reflector's\n        // raw time is ahead of this client's performance.now().\n        // from that, and the current values of performance.now and Date.now, we\n        // calculate an estimate of what our Date.now would have been when the\n        // reflector's raw time was zero.  that gets sent over the bridge.\n\n        // if the Croquet session is running offline, the estimator\n        // will return a constant offset of 1.\n        const offset = sessionOffsetEstimator?.getOffsetEstimate();\n        if (!offset) return;\n\n        const perfNow = performance.now();\n        const reflectorNow = sessionOffsetEstimator.offsetEstimate + perfNow;\n        const dateNowAtReflectorZero = Date.now() - reflectorNow;\n\n        this.sendCommand('croquetTime', String(Math.floor(dateNowAtReflectorZero)));\n    }\n\n    simulateNetworkGlitch(milliseconds) {\n        console.warn(`simulating network glitch of ${milliseconds}ms`);\n        const vm = globalThis.CROQUETVM; // @@ privileged information\n        vm.controller.connection.reconnectDelay = milliseconds;\n        vm.controller.connection.socket.close(4000, 'simulate glitch');\n        timerClient.setTimeout(() => vm.controller.connection.reconnectDelay = 0, 500);\n    }\n\nshowSetupStats() {\n    // pawns keep stats on how long they took to set up.  if this isn't called, the stats will keep building up (but basically harmless).\n    console.log(`build: ${Object.entries(buildStats).map(([k, v]) => `${k}:${v}`).join(' ')} total: ${Object.entries(setupStats).map(([k, v]) => `${k}:${v}`).join(' ')}`);\n    buildStats.length = setupStats.length = 0;\n}\n}\nconst theGameEngineBridge = new BridgeToUnity();\n\n\n// GameViewManager is a new kind of service, created specifically for\n// the bridge to Unity, handling the creation and management of Unity-side\n// gameObjects that track the Croquet pawns.\n// GameViewManager is a ViewService, and is therefore constructed afresh\n// on Session.join().  if there is a network glitch, the manager will be destroyed\n// on disconnection and then rebuilt when the session re-connects.\nconst GameViewManager = class extends _croquet_worldcore_kernel__WEBPACK_IMPORTED_MODULE_0__.ViewService {\n    constructor(name) {\n        super(name || \"GameViewManager\");\n\n        this.lastGameHandle = 0;\n        this.maxGameHandle = 999999; // our current spatial encoding gives us scope for 2^26 handles - around 67M - but 1M (with recycling) should be plenty\n        this.freedGameHandles = []; // handles that can be cleared once the associated destruction messages have definitely been sent to Unity\n        this.pawnsByGameHandle = {}; // integer handle => pawn\n        this.deferredMessagesByGameHandle = new Map(); // handle => [msgs], iterable in the order the handles are mentioned\n        this.deferredGeometriesByGameHandle = {}; // handle => msg; order not important\n        this.deferredOtherMessages = []; // events etc, always sent after gameHandle-specific messages\n\n        this.forwardedEventTopics = {}; // topic (scope:eventName) => handler\n\n        this.unityMessageThrottle = 50; // ms between updates sent to Unity (though if Rapier is running, a Rapier step will always trigger an update)\n        this.lastMessageFlush = 0;\n        this.assetManifests = {};\n\n        theGameEngineBridge.setCommandHandler(this.handleUnityCommand.bind(this));\n\n        const { earlySubscriptionTopics, assetManifestString } = theGameEngineBridge;\n        if (earlySubscriptionTopics) {\n            earlySubscriptionTopics.split(',').forEach(topic => this.registerTopicForForwarding(topic));\n        }\n        if (assetManifestString) {\n            const parseArray = str => str.split(',').filter(Boolean); // remove empties\n            const manifestStrings = assetManifestString.split('\\x03');\n            for (let i = 0; i < manifestStrings.length; i += 4) {\n                const assetName = manifestStrings[i];\n                const mixins = parseArray(manifestStrings[i + 1]);\n                const statics = parseArray(manifestStrings[i + 2]);\n                const watched = parseArray(manifestStrings[i + 3]);\n                this.assetManifests[assetName] = { mixins, statics, watched };\n            }\n        }\n        this.subscribe('__wc', 'say', this.forwardSayToUnity);\n\n        // if Rapier is operating, we use the RapierManager's announcement of\n        // a completed step to set a flag that will trigger a geometry flush as\n        // soon as possible.\n        this.rapierStepped = false;\n        this.subscribe('rapier', { event: 'worldStep', handling: 'immediate' }, () => this.rapierStepped = true);\n    }\n\n    destroy() {\n        globalThis.timedLog(\"GameViewManager destroyed\");\n        theGameEngineBridge.setCommandHandler(null);\n    }\n\n    nextGameHandle() {\n        let handle = this.lastGameHandle;\n        let tries = 1;\n        const max = this.maxGameHandle;\n        const pawns = this.pawnsByGameHandle;\n        while (true) { // eslint-disable-line no-constant-condition\n            handle++;\n            if (handle > max) handle = 1; // loop back\n            if (!pawns[handle]) break; // found one!\n            tries++;\n            if (tries === max) throw Error(\"Failed to find available game handle\");\n        }\n        this.lastGameHandle = handle;\n        return handle;\n    }\n\n    unityId(gameHandle) {\n        // currently redundant.  previously checked for reserved handles.\n        return gameHandle;\n    }\n\n    getPawn(gameHandle) {\n        return this.pawnsByGameHandle[gameHandle] || null;\n    }\n\n    assetManifestForType(type) {\n        return this.assetManifests[type];\n    }\n\n    handleUnityCommand(command, args) {\n        // console.log('command from Unity: ', { command, args });\n        let pawn;\n        switch (command) {\n            case 'registerForEventTopic':\n                // only used for subscribe(), not listen()\n                this.registerTopicForForwarding(args[0]);\n                break;\n            case 'unregisterEventTopic':\n                // only used for subscribe(), not listen()\n                this.unregisterTopicForForwarding(args[0]);\n                break;\n            case 'objectCreated': {\n                // args[0] is gameHandle\n                // args[1] is time when Unity created the pawn\n                const [gameHandle, timeStr] = args;\n                pawn = this.pawnsByGameHandle[gameHandle];\n                if (pawn) pawn.unityViewReady(Number(timeStr));\n                break;\n            }\n            case 'objectMoved': {\n                // args[0] is gameHandle\n                // remaining args are taken in pairs <property, value>\n                // where property is one of \"s\", \"r\", \"p\" for scale, rot, pos\n                // followed by a comma-separated list of values for the property\n                // i.e., 3 or 4 floats\n                pawn = this.pawnsByGameHandle[args[0]];\n                if (pawn && pawn.geometryUpdateFromUnity) {\n                    try {\n                        const update = {};\n                        let pos = 1;\n                        while (pos < args.length) {\n                            const prop = args[pos++];\n                            let geomProp;\n                            switch (prop) {\n                                case 's': geomProp = 'scale'; break;\n                                case 'r': geomProp = 'rotation'; break;\n                                case 'p': geomProp = 'translation'; break;\n                                default:\n                            }\n                            if (geomProp) {\n                                update[geomProp] = args[pos++].split(',').map(Number);\n                            }\n                        }\n                        if (Object.keys(update).length) pawn.geometryUpdateFromUnity(update);\n\n                    } catch (e) {\n                        console.error(e);\n                    }\n                }\n                break;\n            }\n            default:\n                globalThis.timedLog(`unknown Unity command: ${command}`);\n        }\n    }\n\n    registerTopicForForwarding(topic) {\n        if (!this.forwardedEventTopics[topic]) {\n            // console.log(`registering for \"${topic}\" events`);\n            const [scope, eventName] = topic.split(':');\n            const handler = eventArgs => {\n                this.forwardEventToUnity(scope, eventName, eventArgs);\n            };\n            this.subscribe(scope, eventName, handler);\n            this.forwardedEventTopics[topic] = handler;\n        }\n    }\n\n    unregisterTopicForForwarding(topic) {\n        const handler = this.forwardedEventTopics[topic];\n        if (handler) {\n            const [scope, eventName] = topic.split(':');\n            // console.log(`unregistering from \"${scope}:${eventName}\" events`);\n            this.unsubscribe(scope, eventName, handler);\n            delete this.forwardedEventTopics[topic];\n        }\n    }\n\n    forwardEventToUnity(scope, eventName, eventArgs) {\n        // console.log(\"forwarding event\", { scope, eventName, eventArgs });\n        if (eventArgs === undefined) this.sendDeferred(null, 'croquetPub', scope, eventName);\n        else {\n            const stringArg = theGameEngineBridge.encodeValueAsString(eventArgs);\n            this.sendDeferred(null, 'croquetPub', scope, eventName, stringArg);\n        }\n    }\n\n    forwardSayToUnity(data) {\n        const [ actorId, eventName, args ] = data;\n        this.forwardEventToUnity(actorId, eventName, args);\n    }\n\n    makeGameObject(pawn, unityViewSpec) {\n        const gameHandle = unityViewSpec.cH;\n        if (pawn) this.registerPawn(pawn, gameHandle);\n        this.sendDeferred(gameHandle, 'makeObject', JSON.stringify(unityViewSpec));\n        // any time a new object is created, we ensure that there is minimal delay in\n        // servicing the deferred messages and updating objects' geometries.\n        this.expediteMessageFlush();\n        return gameHandle;\n    }\n\n    destroyObject(gameHandle) {\n        this.unregisterPawn(gameHandle); // will also remove any pending messages for the handle\n        this.sendDeferred(gameHandle, 'destroyObject', this.unityId(gameHandle));\n    }\n\n    registerPawn(pawn, gameHandle) {\n        this.pawnsByGameHandle[gameHandle] = pawn;\n    }\n\n    unregisterPawn(gameHandle) {\n        this.freedGameHandles.push(gameHandle);\n        this.deferredMessagesByGameHandle.delete(gameHandle); // if any\n    }\n\n    recycleFreedHandles() {\n        this.freedGameHandles.forEach(handle => delete this.pawnsByGameHandle[handle]);\n        this.freedGameHandles.length = 0;\n    }\n\n    setParent(childHandle, parentHandle) {\n        this.sendDeferred(childHandle, 'setParent', this.unityId(childHandle), this.unityId(parentHandle));\n    }\n\n    unparent(childHandle) {\n        this.sendDeferred(childHandle, 'unparent', this.unityId(childHandle));\n    }\n\n    updatePawnGeometry(gameHandle, updateSpec) {\n        // opportunistic updates to object geometries.\n        // we keep a record of these updates independently from general deferred messages,\n        // gathering and sending them as part of the next geometry flush.\n        const previousSpec = this.deferredGeometriesByGameHandle[gameHandle];\n        if (!previousSpec) this.deferredGeometriesByGameHandle[gameHandle] = updateSpec; // end of story\n        else {\n            // each of prev and latest can have updates to scale, translation,\n            // rotation (or their snap variants).  overwrite previousSpec with any\n            // new updates.\n            const incompatibles = {\n                scale: 'scaleSnap',\n                scaleSnap: 'scale',\n                rotation: 'rotationSnap',\n                rotationSnap: 'rotation',\n                translation: 'translationSnap',\n                translationSnap: 'translation'\n            };\n            for (const [prop, value] of Object.entries(updateSpec)) {\n                previousSpec[prop] = value;\n                delete previousSpec[incompatibles[prop]]; // in case one was there\n            }\n        }\n    }\n\n    ensureDeferredMessages(gameHandle) {\n        let messages = this.deferredMessagesByGameHandle.get(gameHandle);\n        if (!messages) {\n            messages = [];\n            this.deferredMessagesByGameHandle.set(gameHandle, messages);\n        }\n        return messages;\n    }\n\n    sendDeferred(gameHandle, command, ...args) {\n        const deferredForSame = gameHandle == null\n            ? this.deferredOtherMessages\n            : this.ensureDeferredMessages(gameHandle);\n        deferredForSame.push({ command, args });\n    }\n\n    sendDeferredWithOverride(gameHandle, key, command, ...args) {\n        // if an existing entry in the deferred messages for this pawn has the\n        // specified key, replace its command and arguments with the new ones.\n        const deferredForSame = this.ensureDeferredMessages(gameHandle);\n        const previous = deferredForSame.find(spec => spec.overrideKey === key);\n        if (previous) {\n            // console.log(`overriding ${command} on ${gameHandle}`);\n            previous.command = command;\n            previous.args = args;\n        } else {\n            deferredForSame.push({ command, args, overrideKey: key });\n        }\n    }\n\n    sendDeferredFromPawn(gameHandle, command, ...args) {\n        // for every command from a pawn, prepend its croquet handle as the first arg\n        this.sendDeferred(gameHandle, command, this.unityId(gameHandle), ...args);\n    }\n\n    update(time, delta) {\n        super.update(time, delta);\n\n        // tick the bridge, which will periodically announce Croquet time to the\n        // C# side.\n        theGameEngineBridge.update(time);\n\n        const now = Date.now();\n        if (this.rapierStepped || now - (this.lastMessageFlush || 0) >= this.unityMessageThrottle) {\n            this.rapierStepped = false; // reset, if it was set\n            this.lastMessageFlush = now;\n            this.flushDeferredMessages();\n            this.flushGeometries();\n        }\n    }\n\n    expediteMessageFlush() {\n        // guarantee that messages will flush on next update\n        this.lastMessageFlush = null;\n    }\n\n    flushDeferredMessages() {\nconst pNow = performance.now();\n\n        // give each pawn a chance to update watched properties\n        Object.values(this.pawnsByGameHandle).forEach(pawn => pawn.forwardPropertiesIfNeeded?.());\n\n        // now that opportunistic updatePawnGeometry is handled separately, there are\n        // currently no commands that need special treatment.  but we may as\n        // well keep the option available.\n        const transformers = {\n            default: args => {\n                // currently just used to convert arrays to comma-separated strings\n                const strings = [];\n                args.forEach(arg => {\n                    strings.push(Array.isArray(arg)\n                        ? arg.map(String).join(',')\n                        : arg);\n                });\n                return strings;\n            }\n        };\n\n        const messages = [];\n        const addMessage = spec => {\n            const { command } = spec;\n            let { args } = spec;\n            if (args.length) {\n                const transformer = transformers[command] || transformers.default;\n                args = transformer(args);\n            }\n            messages.push([command, ...args].join('\\x01'));\n        };\n        this.deferredMessagesByGameHandle.forEach(msgSpecs => {\n            msgSpecs.forEach(addMessage);\n        });\n        this.deferredMessagesByGameHandle.clear();\n        this.deferredOtherMessages.forEach(addMessage);\n        this.deferredOtherMessages.length = 0;\n\n        const numMessages = messages.length; // before sendBundle messes with it\n        if (numMessages > 1) {\n            const batchLen = theGameEngineBridge.sendBundleToUnity(messages);\nthis.msgBatch = (this.msgBatch || 0) + 1;\nperformance.measure(`to U (batch ${this.msgBatch}): ${numMessages} msgs in ${batchLen} chars`, { start: pNow, end: performance.now() });\n        } else if (numMessages) {\n            theGameEngineBridge.sendToUnity(messages[0]);\n        }\n\n        if (numMessages) this.recycleFreedHandles();\n    }\n\n    flushGeometries() {\n        const toBeMerged = [];\n\n        // it's possible that some pawns will have an explicit deferred update\n        // in addition to some changes since then that they now want to propagate.\n        // in that situation, we send the explicit update first.\n        for (const [gameHandle, update] of Object.entries(this.deferredGeometriesByGameHandle)) {\n            toBeMerged.push([this.unityId(gameHandle), update]);\n        }\n        this.deferredGeometriesByGameHandle = {};\n\n        for (const [gameHandle, pawn] of Object.entries(this.pawnsByGameHandle)) {\n            const update = pawn.geometryUpdateIfNeeded?.(); // pawns aren't guaranteed to be spatial\n            if (update) toBeMerged.push([this.unityId(gameHandle), update]);\n        }\n\n        if (!toBeMerged.length) return;\n\n        const array = new Float32Array(toBeMerged.length * 11); // maximum length needed\n        const intArray = new Uint32Array(array.buffer); // integer view into same data\n\n        let pos = 0;\n        const writeVector = vec => vec.forEach(val => array[pos++] = val);\n        toBeMerged.forEach(([gameHandle, spec]) => {\n            const { scale, scaleSnap, translation, translationSnap, rotation, rotationSnap } = spec;\n            // first number encodes object gameHandle and (in bits 0 to 5) whether there is an\n            // update to each of scale, rotation, translation, and for each one whether\n            // it should be snapped.\n            const idPos = pos++; // once we know the value\n            let encodedId = gameHandle << 6;\n            if (scale || scaleSnap) {\n                writeVector(scale || scaleSnap);\n                encodedId += 32;\n                if (scaleSnap) encodedId += 16;\n            }\n            if (rotation || rotationSnap) {\n                writeVector(rotation || rotationSnap);\n                encodedId += 8;\n                if (rotationSnap) encodedId += 4;\n            }\n            if (translation || translationSnap) {\n                writeVector(translation || translationSnap);\n                encodedId += 2;\n                if (translationSnap) encodedId += 1;\n            }\n            intArray[idPos] = encodedId;\n        });\n\n        // send as a single binary-bodied message\n        const buffer = array.buffer;\n        const filledBytes = pos * 4;\n        const command = 'updateSpatial';\n        const cmdPrefix = `${String(Date.now())}\\x02${command}\\x05`;\n        const message = new Uint8Array(cmdPrefix.length + filledBytes);\n        for (let i = 0; i < cmdPrefix.length; i++) message[i] = cmdPrefix.charCodeAt(i);\n        message.set(new Uint8Array(buffer).subarray(0, filledBytes), cmdPrefix.length);\n        theGameEngineBridge.sendToUnity(message.buffer);\n    }\n};\n\nconst gamePawnMixins = {};\n\nconst buildStats = [], setupStats = [];\n\nconst PM_GameRendered = superclass => class extends superclass {\n    // getters for gameViewManager and gameHandle allow them to be accessed even from super constructor\n    get gameViewManager() { return this._gameViewManager || (this._gameViewManager = (0,_croquet_worldcore_kernel__WEBPACK_IMPORTED_MODULE_0__.GetViewService)('GameViewManager' ))}\n    get gameHandle() { return this._gameHandle || (this._gameHandle = this.gameViewManager.nextGameHandle()) } // integer\n    get componentNames() { return this._componentNames || (this._componentNames = new Set()) }\n    get extraStatics() { return this._extraStatics || (this._extraStatics = new Set()) }\n    get extraWatched() { return this._extraWatched || (this._extraWatched = new Set()) }\n\n    constructor(actor) {\n        super(actor);\n\n        this._throttleFromUnity = 75; // ms between forwarding to the session position updates sent from Unity (e.g., for an avatar).  we expect Unity updates at 25Hz (40ms); for now we aim to forward half of those.\n        this._messagesAwaitingCreation = []; // removed once creation is requested\n        this._geometryAwaitingCreation = null; // can be written by PM_Spatial and its subclasses\n        this._isViewReady = false;\n    }\n\n    initialize(actor) {\n        // construction is complete, through all mixin layers\n\n        const manifest = this.gameViewManager.assetManifestForType(actor.gamePawnType);\n        const statics = new Set(manifest.statics);\n        const watched = new Set(manifest.watched);\n        this.extraStatics.forEach(prop => statics.add(prop));\n        this.extraWatched.forEach(prop => watched.add(prop));\n        // gather any statics into an argument on the initialisation message:\n        // an array with pairs   propName1, propVal1, propName2,...\n        const propertyStrings = [];\n        if (watched.size) this._watchedPropertyValues = {}; // propName => [val, stringyVal]\n        const merged = new Set([...statics, ...watched]);\n        merged.forEach(propName => {\n            let actorPropName = propName;\n            if (propName === \"position\") actorPropName = \"translation\";\n            let value = actor[actorPropName];\n            if (value === undefined) value = this[propName]; // allow pawn to fill in with custom properties\n            if (value === undefined) {\n                console.log(`property ${propName} not found on ${actor.constructor.name} (possible prefab/class mismatch)`);\n                return;\n            }\n            const stringyValue = theGameEngineBridge.encodeValueAsString(value);\n            propertyStrings.push(propName, stringyValue);\n            if (watched.has(propName)) {\n                this._watchedPropertyValues[propName] = [value, stringyValue];\n            }\n        });\n        const initArgs = {\n            type: actor.gamePawnType,\n            propertyValues: propertyStrings,\n            watchers: [...watched]\n        };\n        this.setGameObject(initArgs); // args may be adjusted by mixins\n    }\n\n    setGameObject(viewSpec) {\n        // analogue of setRenderObject in mixins for THREE.js rendering\n\n        // because pawn creation is asynchronous, it's possible that the\n        // actor has already been destroyed by the time we get here.  in\n        // that case, don't bother creating the unity gameobject at all.\n        if (this.actor.doomed) return;\n\n        if (!viewSpec.confirmCreation) this._isViewReady = true; // not going to wait\n\n        let allComponents = [...this.componentNames].join(',');\n        if (viewSpec.extraComponents) allComponents += `,${viewSpec.extraComponents}`;\n\n        this.unityViewP = new Promise(resolve => this.setReady = resolve);\n        const unityViewSpec = {\n            cH: String(this.gameHandle),\n            cN: this.actor.id,\n            cC: !!viewSpec.confirmCreation,\n            wTP: !!viewSpec.waitToPresent,\n            type: viewSpec.type,\n            cs: allComponents,\n            ps: viewSpec.propertyValues,\n            ws: viewSpec.watchers\n        };\n// every pawn tracks the delay between its creation on the Croquet\n// side and receipt of a message from Unity confirming the corresponding\n// gameObject's construction.\nthis.setupTime = Date.now();\n// additionally, every hundredth pawn logs this round trip\nif (this.gameHandle % 100 === 0) {\n    globalThis.timedLog(`pawn ${this.gameHandle} created`);\n}\n\n        this.gameViewManager.makeGameObject(this, unityViewSpec);\n        this._messagesAwaitingCreation.forEach(cmdAndArgs => {\n            this.gameViewManager.sendDeferredFromPawn(...[this.gameHandle, ...cmdAndArgs]);\n        });\n        delete this._messagesAwaitingCreation;\n\n        // PM_GameSpatial introduces _geometryAwaitingCreation\n        if (this._geometryAwaitingCreation) {\n            this.gameViewManager.updatePawnGeometry(this.gameHandle, this._geometryAwaitingCreation);\n            this._geometryAwaitingCreation = null;\n        }\n    }\n\n    forwardPropertiesIfNeeded() {\n        if (!this._watchedPropertyValues || this.doomed) return;\n\n        const { actor } = this;\n        for (const [propName, valueAndString] of Object.entries(this._watchedPropertyValues)) {\n            const [value, stringyValue] = valueAndString;\n\n            let actorPropName = propName;\n            if (propName === \"position\") actorPropName = \"translation\";\n\n            let newValue = actor[actorPropName];\n            if (newValue === undefined) newValue = this[propName];\n            let changed, newStringyValue;\n            if (Array.isArray(value)) {\n                // @@ would be nice if we can find a more efficient approach\n                newStringyValue = theGameEngineBridge.encodeValueAsString(newValue);\n                changed = newStringyValue !== stringyValue;\n            } else {\n                changed = newValue !== value;\n                if (changed) newStringyValue = theGameEngineBridge.encodeValueAsString(newValue);\n            }\n\n            if (changed) {\n                valueAndString[0] = newValue;\n                valueAndString[1] = newStringyValue;\n                const setEventName = propName + 'Set';\n                this.gameViewManager.sendDeferred(this.gameHandle, 'croquetPub', actor.id, setEventName, newStringyValue);\n            }\n        }\n    }\n\n    unityViewReady(estimatedReadyTime) {\n        // unity side has told us that the object is ready for use\n        // console.log(`unityViewReady for ${this.gameHandle}`);\n        this._isViewReady = true;\n        this.setReady();\nif (this.gameHandle % 100 === 0) {\n    globalThis.timedLog(`pawn ${this.gameHandle} ready`);\n}\nconst buildDelay = Date.now() - estimatedReadyTime;\nconst buildBucket = Math.round(buildDelay / 20) * 20;\nbuildStats[buildBucket] = (buildStats[buildBucket] || 0) + 1;\nconst totalDelay = Date.now() - this.setupTime;\nconst bucket = Math.round(totalDelay / 20) * 20;\nsetupStats[bucket] = (setupStats[bucket] || 0) + 1;\n    }\n\n    addChild(pawn) {\n        super.addChild(pawn);\n        this.gameViewManager.setParent(pawn.gameHandle, this.gameHandle);\n    }\n\n    removeChild(pawn) {\n        super.removeChild(pawn);\n        this.gameViewManager.unparent(pawn.gameHandle);\n    }\n\n    sendToUnity(command, ...args) {\n        if (this._messagesAwaitingCreation) {\n            this._messagesAwaitingCreation.push([command, ...args]);\n        } else {\n            this.gameViewManager.sendDeferredFromPawn(this.gameHandle, command, ...args);\n        }\n    }\n\n    destroy() {\n        // console.log(`pawn ${this.gameHandle} destroyed`);\n        this.gameViewManager.destroyObject(this.gameHandle);\n        super.destroy();\n    }\n};\ngamePawnMixins.Base = PM_GameRendered;\n\nconst PM_GameMaterial = superclass => class extends superclass {\n    constructor(actor) {\n        super(actor);\n        this.componentNames.add('CroquetMaterialComponent');\n    }\n};\ngamePawnMixins.Material = PM_GameMaterial;\n\nconst PM_GameSpatial = superclass => class extends superclass {\n\n    constructor(actor) {\n        super(actor);\n        this.componentNames.add('CroquetSpatialComponent');\n        this.resetGeometrySnapState();\n\n        if (this.spatialOptions) this.extraStatics.add('spatialOptions'); // not an actor property, but will be fed from here\n    }\n\n    // these getters all return copies of the property values\n    get scale() { return this.actor.scale }\n    get translation() { return this.actor.translation }\n    get rotation() { return this.actor.rotation }\n    get local() { return this.actor.local }\n    get global() { return this.actor.global }\n    get lookGlobal() { return this.global } // Allows objects to have an offset camera position -- obsolete?\n    get spatialOptions() { return this.actor._spatialOptions }\n\n    // these getters return the actual values\n    get forward() { return this.actor.forward }\n    get up() { return this.actor.up }\n\n    geometryUpdateIfNeeded() {\n        // for an avatar, filter out all updates other than the very first time,\n        // or if some property has been snapped\n        const avatarFiltering = this.driving && this.lastSentTranslation && !this._scaleSnapped && !this._rotationSnapped && !this._translationSnapped;\n        if (avatarFiltering || this.actor.rigidBodyType === 'static' || !this._isViewReady || this.doomed) return null;\n\n        const updates = {};\n        const { scale, rotation, translation } = this; // NB: already copies of the actor's values.\n        // use smallest scale value as a guide to the scale magnitude, triggering on\n        // changes > 1%\n        let updated = false;\n        const scaleMag = Math.min(...scale.map(Math.abs));\n        if (!this.lastSentScale || !(0,_croquet_worldcore_kernel__WEBPACK_IMPORTED_MODULE_0__.v3_equals)(this.lastSentScale, scale, scaleMag * 0.01)) {\n            const doSnap = this._scaleSnapped || !this.lastSentScale;\n            this.lastSentScale = scale;\n            updates[doSnap ? 'scaleSnap' : 'scale'] = scale;\n            updated = true;\n        }\n        if (!this.lastSentRotation || !(0,_croquet_worldcore_kernel__WEBPACK_IMPORTED_MODULE_0__.q_equals)(this.lastSentRotation, rotation, 0.0001)) {\n            const doSnap = this._rotationSnapped || !this.lastSentRotation;\n            this.lastSentRotation = rotation;\n            updates[doSnap ? 'rotationSnap' : 'rotation'] = rotation;\n            updated = true;\n        }\n        if (!this.lastSentTranslation || !(0,_croquet_worldcore_kernel__WEBPACK_IMPORTED_MODULE_0__.v3_equals)(this.lastSentTranslation, translation, 0.01)) {\n            const doSnap = this._translationSnapped || !this.lastSentTranslation;\n            this.lastSentTranslation = translation;\n            updates[doSnap ? 'translationSnap' : 'translation'] = translation;\n            updated = true;\n        }\n\n        this.resetGeometrySnapState();\n\n        return updated ? updates : null;\n    }\n\n    resetGeometrySnapState() {\n        // for Spatial, act as if every update is a snap.  PM_GameSmoothed assumes the opposite.\n        this._scaleSnapped = this._rotationSnapped = this._translationSnapped = true;\n    }\n\n    updateGeometry(updateSpec) {\n        // opportunistic geometry update.\n        // if the game pawn hasn't been created yet, store this update to be\n        // delivered once the creation has been requested.\n        if (this._messagesAwaitingCreation) {\n            // not ready yet.  store it (overwriting any previous value)\n            this._geometryAwaitingCreation = updateSpec;\n        } else {\n            this.gameViewManager.updatePawnGeometry(this.gameHandle, updateSpec);\n        }\n    }\n\n    geometryUpdateFromUnity(update) {\n        this.set(update, this._throttleFromUnity);\n    }\n\n};\ngamePawnMixins.Spatial = PM_GameSpatial;\n\nconst PM_GameSmoothed = superclass => class extends PM_GameSpatial(superclass) {\n\n    constructor(actor) {\n        super(actor);\n        this.throttle = 100; // ms between updates sent from Croquet view (though we're not expecting there to be any)\n\n        this.componentNames.add('PresentOncePositionUpdated');\n\n        this.listenOnce(\"scaleSnap\", this.onScaleSnap);\n        this.listenOnce(\"rotationSnap\", this.onRotationSnap);\n        this.listenOnce(\"translationSnap\", this.onTranslationSnap);\n    }\n\n    setGameObject(viewSpec) {\n        viewSpec.waitToPresent = true;\n        super.setGameObject(viewSpec);\n    }\n\n    scaleTo(v) {\n        this.say(\"setScale\", v, this.throttle);\n    }\n\n    rotateTo(q) {\n        this.say(\"setRotation\", q, this.throttle);\n    }\n\n    translateTo(v) {\n        this.say(\"setTranslation\", v, this.throttle);\n    }\n\n    positionTo(v, q) {\n        this.say(\"setPosition\", [v, q], this.throttle);\n    }\n\n    onScaleSnap() {\n        this._scaleSnapped = true;\n    }\n\n    onRotationSnap() {\n        this._rotationSnapped = true;\n    }\n\n    onTranslationSnap() {\n        this._translationSnapped = true;\n    }\n\n    get local() {\n        console.warn(\"attempt to get .local\");\n        return null;\n    }\n\n    get global() {\n        console.warn(\"attempt to get .global\");\n        return null;\n    }\n\n    resetGeometrySnapState() {\n        this._scaleSnapped = this._rotationSnapped = this._translationSnapped = false;\n    }\n};\ngamePawnMixins.Smoothed = PM_GameSmoothed;\n\nconst PM_GameBallistic2D = superclass => class extends PM_GameSmoothed(superclass) {\n\n    constructor(actor) {\n        super(actor);\n        this.extraStatics.add('position').add('rotation').add('scale');\n        this.extraWatched.add('ballisticVelocity');\n    }\n\n};\ngamePawnMixins.Ballistic2D = PM_GameBallistic2D;\n\nconst PM_GameInteractable = superclass => class extends superclass {\n    get layers() { return (this.actor._layers || []).join(',') }\n\n    constructor(actor) {\n        super(actor);\n        this.componentNames.add('CroquetInteractableComponent');\n        this.extraWatched.add('layers');\n    }\n\n};\ngamePawnMixins.Interactable = PM_GameInteractable;\n\nconst PM_GameAvatar = superclass => class extends superclass {\n\n    constructor(actor) {\n        super(actor);\n        this.componentNames.add('CroquetAvatarComponent');\n        this.extraWatched.add('driver');\n        this.onDriverSet();\n        this.listenOnce(\"driverSet\", this.onDriverSet);\n    }\n\n    get isMyAvatar() {\n        return this.actor.driver === this.viewId;\n    }\n\n    onDriverSet() {\n        if (this.isMyAvatar) {\n            this.driving = true;\n            this.drive();\n        } else {\n            this.driving = false;\n            this.park();\n        }\n    }\n\n    // park and drive are available for override if needed\n    park() { }\n    drive() { }\n\n};\ngamePawnMixins.Avatar = PM_GameAvatar;\n\n// GamePawnManager is a specialisation of the standard\n// Worldcore PawnManager, with pawn-creation logic that removes the need for\n// actor-side declaration of pawn classes.\nclass GamePawnManager extends _croquet_worldcore_kernel__WEBPACK_IMPORTED_MODULE_0__.PawnManager {\n    newPawn(actor) {\n        return actor.gamePawnType !== undefined ? this.newGamePawn(actor) : super.newPawn(actor);\n    }\n\n    newGamePawn(actor) {\n        // for the unity world, pawn classes are built on the fly using\n        // the mixins defined above, based on the pawnMixins list of mixin\n        // names provided by the actor.\n        // if there are any elements in the list, we prepend the obligatory\n        // Base mixin (PM_GameRendered) for a game-rendered pawn.\n        // an actor that doesn't want any game pawn still gets a vanilla Pawn,\n        // e.g. so it can support having children.\n\n        if (!this._gameViewManager) this._gameViewManager = (0,_croquet_worldcore_kernel__WEBPACK_IMPORTED_MODULE_0__.GetViewService)(\"GameViewManager\");\n\n        let p;\n\n        const { gamePawnType } = actor;\n        if (gamePawnType === \"\") {\n            p = new _croquet_worldcore_kernel__WEBPACK_IMPORTED_MODULE_0__.Pawn(actor);\n        } else {\n            const manifest = this._gameViewManager.assetManifestForType(gamePawnType);\n            if (!manifest) {\n                console.warn(`no manifest for gamePawnType \"${gamePawnType}\"`);\n                return null;\n            }\n\n            const mixinNames = manifest.mixins; // can be empty\n            const mixins = ['Base'].concat(mixinNames).map(n => gamePawnMixins[n]);\n            const PawnClass = (0,_croquet_worldcore_kernel__WEBPACK_IMPORTED_MODULE_0__.mix)(_croquet_worldcore_kernel__WEBPACK_IMPORTED_MODULE_0__.Pawn).with(...mixins);\n            p = new PawnClass(actor);\n            p.initialize(actor); // new: 2-phase init, so all constructors run to completion first\n        }\n\n        this.pawns.set(actor.id, p);\n        return p;\n    }\n\n    spawnPawn(actor) {\n        const p = this.newPawn(actor);\n        if (p) p.link();\n    }\n}\n\n// GameViewRoot is the real root view.  The developer can use it as-is or can\n// subclass it and pass the subclass on the StartSession call.  When the session\n// is started, the ViewRoot passed into the session is instead the PreloadingViewRoot\n// defined below.  The instance of PreloadingViewRoot decides when to load the real\n// root, once the Unity side is ready to work with it.\nclass GameViewRoot extends _croquet_worldcore_kernel__WEBPACK_IMPORTED_MODULE_0__.ViewRoot {\n\n    static viewServices() {\n        // $$$ for now, hard-code these three.  figure out later how to\n        // customise (presumably based on presence of System components\n        // on the Unity Croquet bridge)\n        // note that our PawnManager needs to come last, because it'll\n        // immediately get to work on building pawns that might call\n        // on the other managers during their creation.\n        return [GameViewManager, GameInputManager, GamePawnManager];\n    }\n\n    constructor(model) {\n        super(model);\n\n        if (sessionOffsetEstimator) sessionOffsetEstimator.initReflectorOffsets();\n\n        const sceneName = this.wellKnownModel('InitializationManager').activeScene;\n        theGameEngineBridge.sendCommand('sceneRunning', sceneName);\n        this.publish('croquet', 'sceneRunning', sceneName); // so Unity objects can subscribe\n\n        this.lastViewCount = null;\n        this.announceViewCount();\n\n        globalThis.timedLog(\"GameViewRoot built\");\n    }\n\n    destroy() {\n        globalThis.timedLog(\"GameViewRoot destroyed\");\n        super.destroy();\n    }\n\n    announceViewCount() {\n        const { viewCount } = this.model;\n        if (viewCount !== this.lastViewCount) this.publish(\"croquet\", \"viewCount\", viewCount);\n        this.lastViewCount = viewCount;\n    }\n\n    update(time, delta) {\n        super.update(time, delta);\n\n        this.announceViewCount();\n    }\n}\n\n// as described above, PreloadingViewRoot provides a layer between the model and the actual GameViewRoot (or subclass thereof).\nclass PreloadingViewRoot extends _croquet_worldcore_kernel__WEBPACK_IMPORTED_MODULE_0__.View {\n    static viewServices() { return [] }\n\n    constructor(model) {\n        console.log(\"building PreloadingViewRoot\");\n        super(model);\n        this.model = model;\n        this.im = this.wellKnownModel('InitializationManager'); // can't use GetModelService, because this isn't a WorldCore ViewRoot\n\n        this.subscribe(this.sessionId, { event: 'sceneStateUpdated', handling: 'immediate'}, this.handleSceneState);\n        this.subscribe(this.viewId, 'requestToInitVerdict', this.handleRequestToInitVerdict);\n\n        // iff the Unity side is an editor, tell the model.  this view will\n        // be designated the scene supplier for all subsequent scene loads.\n        if (theGameEngineBridge.isEditor) this.publish(this.sessionId, 'registerEditorClient', this.viewId);\n\n        // we treat the construction of this view as a signal that the session\n        // is ready to talk across the bridge.  but without a real viewRoot,\n        // the event mechanism is not yet available.\n        theGameEngineBridge.sendCommand('sessionRunning', this.viewId);\n\n        // examine the InitializationManager to see what state the session is in\n        this.handleSceneState();\n    }\n\n    readyToBuildSceneInUnity(sceneName) {\n        // the bridge is telling us that the unity side is ready to build\n        // the scene (which is the case as soon as it has loaded the scene\n        // and fetched the scene-relevant assets).\n        const { activeScene } = this.im;\n        if (sceneName !== activeScene) {\n            console.log(`bridge is ready for scene ${sceneName}, but we're running ${activeScene}`);\n            return;\n        }\n\n        this.buildRealViewRootIfReady();\n    }\n\n    handleSceneState() {\n        // NB: this is 'immediate', so synchronous with the publishing of the event\n        const { activeScene, activeSceneState } = this.im;\n\n        const announceStateToUnity = () => theGameEngineBridge.sendCommand('sceneStateUpdated', activeScene, activeSceneState);\n\n        if (activeSceneState === 'running') {\n            // fetch from the init manager the manifests and early subs, and pass\n            // those into the bridge for use in starting up the real viewRoot...\n            // though that has to wait until the unity side is ready for (i.e., has\n            // the assets for) the scene in question.\n            announceStateToUnity();\n            const props = this.im.getSceneConstructionProperties();\n            theGameEngineBridge.setSceneConstructionProperties(props);\n            this.buildRealViewRootIfReady();\n        } else {\n            this.destroyRealViewRoot(); // if any\n            announceStateToUnity();\n        }\n    }\n\n    handleRequestToInitVerdict(verdict) {\n        // the InitializationManager has responded to a requestToInit request from this view\n        if (this.onRequestToInitVerdict) {\n            this.onRequestToInitVerdict(verdict);\n            this.onRequestToInitVerdict = null;\n        } else {\n            console.warn(\"unexpected response to requestToInit\");\n        }\n    }\n\n    buildRealViewRootIfReady() {\n        if (this.realViewRoot) return; // already running\n\n        const { activeScene, activeSceneState } = this.im;\n        if (activeSceneState === 'running' && theGameEngineBridge.readySceneInUnity === activeScene) {\n            globalThis.timedLog(`building real ViewRoot for scene ${activeScene}`);\n            this.realViewRoot = new ViewRootClass(this.model);\n        }\n    }\n\n    destroyRealViewRoot() {\n        if (this.realViewRoot) {\n            globalThis.timedLog(\"destroying real ViewRoot\");\n            theGameEngineBridge.tearDownScene();\n            this.realViewRoot.destroy();\n            this.realViewRoot = null;\n        }\n    }\n\n    publishRequestToLoadScene(sceneName, forceReload, forceRebuild) {\n        this.publish(this.sessionId, 'requestToLoadScene', {sceneName, forceReload, forceRebuild});\n    }\n\n    async attemptToPublishInitialization(sceneName, initStrings) {\n        // don't interrupt if we're already sending, or awaiting permission\n        if (this.publishingInitP) await this.publishingInitP;\n\n        this.publishingInitP = new Promise(resolve => {\n            this.onRequestToInitVerdict = verdict => {\n                const finalize = () => {\n                    this.publishingInitP = null;\n                    resolve();\n                };\n\n                if (verdict) {\n                    // granted\n                    this.publishInitializationInChunks(sceneName, initStrings)\n                        .then(finalize);\n                } else {\n                    // denied\n                    finalize();\n                }\n\n                };\n            this.publish(this.sessionId, 'requestToInitScene', { viewId: this.viewId, sceneName });\n        });\n    }\n\n    async publishInitializationInChunks(sceneName, initStrings) {\n        const { viewId } = this;\n        console.log(\"publishing init\", { sceneName, viewId });\n\n        // lifted and slightly adapted from code.js in microverse\n        const sendString = initStrings.join('\\x01');\n        const array = new TextEncoder().encode(sendString);\n        const CHUNK_SIZE = 2500;\n        // we've asked Croquet to let us send up to 50 messages in 1 second.\n        // if we'll be sending more than 45 from here, introduce a throttle\n        // so the controller doesn't complain.\n        const useThrottle = array.length > CHUNK_SIZE * 45;\n        let ind = 0;\n        let isFirst = true;\n        let isLast;\n        while (ind < array.length) {\n            if (this.im.activeScene !== sceneName) {\n                console.log(`abandoning publish of ${sceneName}; ${this.im.activeScene} is now active`);\n                return; // bail out\n            }\n            isLast = ind + CHUNK_SIZE >= array.length;\n            const buf = array.slice(ind, ind + CHUNK_SIZE);\n            this.publish(this.sessionId, 'sceneInitChunk', { viewId, sceneName, isFirst, isLast, buf });\n            ind += CHUNK_SIZE;\n            isFirst = false;\n\n            if (useThrottle) await new Promise(resolve => setTimeout(resolve, 20)); // eslint-disable-line no-await-in-loop\n        }\n    }\n\n    update(time, delta) {\n        super.update(time, delta);\n\n        if (this.realViewRoot) this.realViewRoot.update(time, delta);\n    }\n\n    detach() {\n        // this should only happen on a glitch in the Croquet reflector connection,\n        // or a deliberate session.leave().\n        console.log(\"detaching PreloadingViewRoot\");\n\n        this.destroyRealViewRoot(); // will send tearDownScene; also important here not to have a defunct view hanging around, in case session is restored\n        theGameEngineBridge.tearDownSession();\n\n        super.detach();\n    }\n}\n\n// GameInputManager is a ViewService, and therefore created and destroyed along with\n// the ViewRoot.\nclass GameInputManager extends _croquet_worldcore_kernel__WEBPACK_IMPORTED_MODULE_0__.ViewService {\n    get gameViewManager() { return this._gameViewManager || (this._gameViewManager = (0,_croquet_worldcore_kernel__WEBPACK_IMPORTED_MODULE_0__.GetViewService)('GameViewManager')) }\n\n    constructor(name) {\n        super(name || \"GameInputManager\");\n\n        this.customEventHandlers = {};\n\n        theGameInputManager = this;\n    }\n\n    destroy() {\n        super.destroy();\n        theGameInputManager = null;\n    }\n\n    addEventHandlers(handlers) {\n        Object.assign(this.customEventHandlers, handlers);\n    }\n\n    handleEvent(args) {\n        const event = args[0];\n\n        const custom = this.customEventHandlers[event];\n        if (custom) {\n            custom(args);\n            return;\n        }\n\n        const { viewId } = this;\n        switch (event) {\n            case 'keyDown': {\n                const keyCode = args[1];\n                this.publish('input', `${keyCode.toLowerCase()}Down`, { viewId });\n                this.publish('input', 'keyDown', { viewId, key: keyCode });\n                break;\n            }\n            case 'keyUp': {\n                const keyCode = args[1];\n                this.publish('input', `${keyCode.toLowerCase()}Up`, { viewId });\n                this.publish('input', 'keyUp', { viewId, key: keyCode });\n                break;\n            }\n            case 'pointerDown': {\n                const button = Number(args[1]);\n                this.publish('input', 'pointerDown', { viewId, button });\n                break;\n            }\n            case 'pointerUp': {\n                const button = Number(args[1]);\n                this.publish('input', 'pointerUp', { viewId, button });\n                break;\n            }\n            case 'pointerHit': {\n                // each argument starting at 1 is a comma-separated list defining\n                // a hit on a single Croquet-registered game object.  its fields are:\n                //   gameHandle\n                //   hitPoint x\n                //   hitPoint y\n                //   hitPoint z\n                //   [layer 1]\n                //   [layer 2]\n                //   etc\n                const hitList = [];\n                for (let i = 1; i < args.length; i++) {\n                    const parsedArg = args[i].split(',');\n                    const [gameHandle, x, y, z, ...layers] = parsedArg;\n                    const pawn = this.gameViewManager.getPawn(gameHandle);\n                    if (pawn) {\n                        const { actor } = pawn;\n                        const xyz = [x, y, z].map(Number);\n                        hitList.push({ actor, xyz, layers });\n                    }\n                }\n                if (hitList.length) this.publish('input', 'pointerHit', { viewId, hits: hitList });\n                break;\n            }\n            default:\n        }\n    }\n}\n\n// a linked list for holding timeout records\nclass TimeList {\n    constructor() {\n        this.firstNode = null;\n        this.deferredInsertions = [];\n    }\n\n    insert(delay, id) {\n        // if new timeouts are created by the callbacks we process, hold those\n        // back until the processing pass is finished.\n        if (this.processingList) {\n            this.deferredInsertions.push([delay, id]);\n            return;\n        }\n\n        const now = performance.now();\n        const newNode = { triggerTime: now + delay, id };\n        if (!this.firstNode) {\n            this.firstNode = newNode;\n            // this.walkList();\n            return;\n        }\n\n        let n = this.firstNode;\n        let prev = null;\n        while (n && n.triggerTime <= newNode.triggerTime) {\n            prev = n;\n            n = n.next;\n        }\n        // either n is a node with a time > ours, or\n        // we've reached the end of the list\n        if (prev) prev.next = newNode;\n        else this.firstNode = newNode;\n\n        newNode.next = n; // maybe empty\n\n        // this.walkList();\n    }\n\n    walkList() {\n        // for debug\n        const times = [];\n        let n = this.firstNode;\n        while (n) {\n            times.push(Math.round(n.triggerTime));\n            n = n.next;\n        }\n        console.log(\"times\", times.join(\",\"));\n    }\n\n    processUpTo(timeLimit, processor) {\n        if (!this.firstNode || this.processingList) return; // this is non-re-entrant\n\n        this.processingList = true;\n\n        let n = this.firstNode;\n        while (n && n.triggerTime <= timeLimit) {\n            processor(n.id);\n            n = n.next;\n        }\n        this.firstNode = n; // maybe empty\n\n        this.processingList = false;\n        this.deferredInsertions.forEach(args => this.insert(...args));\n        this.deferredInsertions.length = 0;\n    }\n}\n\nclass TimerClient {\n    constructor() {\n        this.timeouts = {};\n        this.timeList = new TimeList();\n\n        globalThis.setTimeout = (c, d) => this.setTimeout(c, d);\n        globalThis.clearTimeout = id => this.clearTimeout(id);\n\n        globalThis.setInterval = (c, g) => this.setInterval(c, g);\n        globalThis.clearInterval = id => this.clearInterval(id);\n    }\n\n    setTimeout(callback, duration) {\n        // the _setxxx methods are there so we can insert code like the stuff\n        // below, to test the accuracy of our timing\n        return this._setTimeout(callback, duration);\n\n        // const target = Date.now() + duration;\n        // return this._setTimeout(() => {\n        //     console.log(`duration: ${duration} diff: ${Date.now() - target}`);\n        //     callback();\n        // }, duration);\n    }\n    _setTimeout(callback, duration) {\n        const id = Math.random().toString();\n        this.timeouts[id] = { callback };\n        this.timeList.insert(duration, id);\n        return id;\n    }\n\n    setInterval(callback, gap) {\n        return this._setInterval(callback, gap);\n    }\n    _setInterval(callback, gap) {\n        let id;\n        let lastCall = null;\n        const intervalCallback = () => {\n            callback();\n            // if the timeout record for this id has gone, the callback must\n            // have called clearInterval.  we have nothing more to do.\n            if (!this.timeouts[id]) return;\n\n            // if we see that this call was late, adjust the timeout for\n            // the next one as a gesture towards catching up.  we're at\n            // the mercy of the calls that are ticking this timer itself,\n            // but can at least try to avoid falling further behind on\n            // every iteration.\n            const now = Date.now();\n            let nextGap = gap;\n            if (lastCall !== null) {\n                const thisGap = now - lastCall;\n                if (thisGap > gap) nextGap = Math.max(4, gap - (thisGap - gap));\n            }\n            lastCall = now;\n            this.timeouts[id] = { callback: intervalCallback };\n            this.timeList.insert(nextGap, id);\n        };\n        id = this._setTimeout(intervalCallback, gap);\n        return id;\n    }\n\n    clearTimeout(id) {\n        this._clearTimeout(id);\n    }\n    _clearTimeout(id) {\n        delete this.timeouts[id];\n    }\n\n    clearInterval(id) {\n        this._clearTimeout(id); // [sic]\n    }\n\n    serviceTimeouts() {\n        if (!this.timeList.firstNode) return; // nothing to even check\n\n        Promise.resolve().then(() => this.timeList.processUpTo(performance.now(), id => {\n            const record = this.timeouts[id];\n            if (record) {\n                const { callback } = record;\n                if (callback) callback();\n                // if the callback has set up a new timeout record for the same id,\n                // leave it be (this happens in our interval handler).\n                // otherwise, the record has served its purpose and can be removed.\n                if (this.timeouts[id] === record) delete this.timeouts[id];\n            }\n        }));\n    }\n}\n\nlet timerClient, ticker, sessionStepper;\nif (globalThis.CROQUET_NODE) {\n    timerClient = globalThis;\n} else {\n    // install our home-grown timer, and an interim ticker (will be replaced once\n    // the session starts) just to handle timeouts\n    timerClient = new TimerClient();\n    ticker = () => timerClient.serviceTimeouts(); // very cheap if there aren't any\n}\n\n\nlet reflectorJourneyEstimates;\nlet reportedOffsetEstimate = null;\nlet resetTrigger = null;\nlet pingsProcessed;\nclass SessionOffsetEstimator {\n    // maintain a best guess of the minimum offset between the local wall clock and the reflector's raw time as received on PING messages and their PONG responses.  this is used purely to judge when an event has been held up on one or other leg, and hence to adjust the calculation of the estimated offset between local and reflector time.\n    // one problem we have to deal with is network batching of messages, meaning that they often arrive late.  so whenever a reflector event indicates that its raw time is earlier than our current guess, we assume that this is closer to the actual timing.  immediately adjust our estimate.\n    // but then, in case the minimum offset is in fact gradually growing - i.e., the local wall clock is gradually gaining on the reflector's - the estimate is continually nudged forwards using a bias that adds 0.2ms per second (12ms per minute) of elapsed time since the last adjustment.  we expect that bias to be overridden every few seconds by an accurately timed event - but if the actual offset really is drifting by a few ms per minute, the bias should ensure that we capture that.\n\n    // we now also support \"offline\" mode, in which case the offsetEstimate\n    // reports a fixed value (so reflector raw time appears to march exactly\n    // in step with Date.now)\n    constructor(sess, runOffline) {\n        this.session = sess;\n        this.runOffline = runOffline;\n        if (!runOffline) {\n            const controller = this.controller = sess.view.realm.vm.controller;\n\n            this.offsetEstimate = null;\n            this.minRoundtrip = 0;\n\n            controller.connection.pongHook = args => this.handlePong(args);\n            this.initReflectorOffsets();\n            this.sendPing();\n        }\n    }\n\n    getOffsetEstimate() {\n        return this.runOffline ? 1 : this.offsetEstimate;\n    }\n\n    sendPing() {\n        if (!this.session) return;\n\n        if (this.session.view) {\n            // only actually send pings while there is a view\n            const args = { sent: Math.floor(performance.now()) };\n            this.controller.connection.PING(args);\n        }\n\n        // start with a ping every 150ms, until 30 have been processed.\n        // then calm down to one every 300ms.\n        const delayToNext = pingsProcessed < 30 ? 150 : 300;\n        timerClient.setTimeout(() => this.sendPing(), delayToNext);\n    }\n\n    handlePong(args) {\n        if (!this.session) return;\n\n        const { sent, rawTime: reflectorRaw } = args;\n        const now = Math.floor(performance.now());\n        this.estimateReflectorOffset(sent, reflectorRaw, now);\n        const { view } = this.session;\n        if (view && view.sessionOffsetUpdated) view.sessionOffsetUpdated();\n    }\n\n    initReflectorOffsets() {\n        reflectorJourneyEstimates = { outbound: { estimate: null, lastEstimateTime: 0 }, inbound: { estimate: null, lastEstimateTime: 0 } };\n        this.offsetEstimate = null;\n        pingsProcessed = 0;\n    }\n\n    creepAndCorrectEstimate(direction, offset) {\n        const record = reflectorJourneyEstimates[direction];\n        const now = performance.now();\n        const { estimate, lastEstimateTime } = record;\n        const sinceLastEstimate = now - lastEstimateTime;\n        let replace = estimate === null;\n        if (!replace) {\n            const bias = 0.0002; // 12ms/min\n            const estimateWithBias = estimate + sinceLastEstimate * bias;\n            // immediately act on any lower value.\n            replace = offset < estimateWithBias;\n        }\n        if (replace) {\n            // if (!record.estimate || (Math.abs(estimate - offset) > 0 && sinceLastEstimate > 5000)) console.log(`${direction} from ${estimate} to ${offset} after ${Math.round(sinceLastEstimate / 1000)}s`);\n            record.estimate = offset;\n            record.lastEstimateTime = now;\n        }\n        return replace;\n    }\n\n    estimateReflectorOffset(sent, reflectorRaw, now) {\n        const outbound = reflectorRaw - sent;\n        const inbound = now - reflectorRaw;\n        const outboundReplaced = this.creepAndCorrectEstimate('outbound', outbound);\n        const inboundReplaced = this.creepAndCorrectEstimate('inbound', inbound);\n\n        // only recalculate when we have a fresh estimate for one or the other (or both)\n        if (!outboundReplaced && !inboundReplaced) return;\n\n        const excessOutbound = outboundReplaced ? 0 : outbound - reflectorJourneyEstimates.outbound.estimate;\n        const adjustedReflectorReceived = reflectorRaw - excessOutbound;\n\n        const excessInbound = inboundReplaced ? 0 : inbound - reflectorJourneyEstimates.inbound.estimate;\n        const adjustedAudienceReceived = now - excessInbound;\n\n        // sanity check on the calculation: if the theoretical minimum round trip implied by the actual round trip and the excess values is negative, time either here or on the reflector has jumped in a way that our algorithm isn't accounting for.  in that case, clear the outbound and inbound estimates and restart rapid polling to re-establish reasonable values.\n        const impliedMinRoundTrip = now - sent - excessOutbound - excessInbound;\n        if (impliedMinRoundTrip < -2) { // a millisecond or two can happen due to legitimate drift\n            console.log(\"resetting reflector offset\", { roundTrip: now - sent, excessOutbound, excessInbound, impliedMinRoundTrip });\n            resetTrigger = { roundTrip: now - sent, excessOutbound, excessInbound, impliedMinRoundTrip }; // triggers sending of a report\n            this.initReflectorOffsets();\n            return;\n        }\n\n        const reflectorAhead = Math.round((adjustedReflectorReceived + reflectorRaw) / 2 - (sent + adjustedAudienceReceived) / 2);\n\n        const change = this.offsetEstimate === null ? 999 : reflectorAhead - reportedOffsetEstimate;\n        // don't report if it could be just a rounding error\n        if (Math.abs(change) > 1) {\n            console.log(`reflector ahead by ${reflectorAhead}ms`, { excessOutbound, excessInbound });\n            reportedOffsetEstimate = reflectorAhead;\n        }\n\n        this.offsetEstimate = reflectorAhead;\n        pingsProcessed++;\n        this.minRoundtrip = impliedMinRoundTrip;\n    }\n\n    fetchAndClearResetTrigger() {\n        const trigger = resetTrigger;\n        resetTrigger = null;\n        return trigger;\n    }\n\n    shutDown() {\n        this.session = null;\n    }\n}\n\nlet ModelRootClass, ViewRootClass;\nasync function StartSession(model, view) {\n    ModelRootClass = model;\n    ViewRootClass = view;\n}\n\nasync function unityDrivenStartSession() {\n    const { apiKey, appId, appName, packageVersion, sessionName, debugFlags, runOffline, socketPortStr } = theGameEngineBridge;\n\n    const sceneFileName = 'scene-definitions.txt';\n    let sceneText = '';\n    const sceneFile = globalThis.CROQUET_NODE\n        ? `http://127.0.0.1:${socketPortStr}/${appName}/${sceneFileName}`\n        : `./${sceneFileName}`;\n    // our server will respond to HEAD with status 200 if file is found, 204 otherwise\n    const headResponse = await fetch(sceneFile, { method: 'HEAD' });\n    if (headResponse.status === 200) {\n        const contentResponse = await fetch(sceneFile);\n        if (contentResponse.status === 200) {\n            sceneText = await contentResponse.text();\n        }\n    }\n    // @@ workaround until we're able to request that Croquet.Constants not be\n    // frozen.  this value is examined in the model (by the InitializationManager),\n    // but this is a legitimate case of reading a view-defined value into the\n    // model because we're also hashing this value to determine the sessionId.\n    globalThis.GameConstants = { sceneText };\n\n    const name = `${sessionName}`;\n    const password = 'password';\n    // include package version and the scene-definition string as options\n    // just to force sessions with different values to be distinct\n    const options = { c4uPackageVersion: packageVersion, sceneText };\n    session = await (0,_croquet_worldcore_kernel__WEBPACK_IMPORTED_MODULE_0__.StartWorldcore)({\n        appId,\n        apiKey,\n        name,\n        password,\n        options,\n        step: 'manual',\n        tps: 33, // deliberately out of phase with 50Hz ticks from Unity, aiming for decent stepping coverage in WebView sessions\n        autoSleep: false,\n        expectedSimFPS: 0, // 0 => don't attempt to load-balance simulation\n        eventRateLimit: 50, // we need a high rate for distributing scene definitions\n        flags: ['unity', 'rawtime'],\n        debug: debugFlags,\n        model: ModelRootClass,\n        view: PreloadingViewRoot,\n        progressReporter: ratio => {\n            globalThis.timedLog(`join progress: ${ratio}`);\n            theGameEngineBridge.sendCommand('joinProgress', String(ratio));\n        }\n    });\n\n    sessionOffsetEstimator = new SessionOffsetEstimator(session, runOffline);\n\n    const STEP_DELAY = 26; // aiming to ensure that there will be a new 50ms physics update on every other step\n    let stepCount = 0;\n    let lastStep = 0;\n    const stepHandler = () => {\n        if (!session?.view) return; // don't try stepping after leaving session (including during a rejoin)\n\n        const now = performance.now() | 0;\n\n        // don't try to service ticks that have bunched up\n        if (now - lastStep < STEP_DELAY / 2) return;\n\n        lastStep = now;\n        const { reflectorTime } = session.view.realm.vm.controller;\n        performance.mark(`STEP${++stepCount}@reflector=${reflectorTime}`);\n\n        Promise.resolve().then(() => session.step(now));\n    };\n\n    if (globalThis.CROQUET_NODE) {\n        sessionStepper = setInterval(stepHandler, STEP_DELAY); // as simple as that\n    } else {\n        ticker = () => {\n            // NB: this is called from a tickHook and a websocket message handler -\n            // so if there's anything heavy to do, schedule it asynchronously.\n\n            timerClient.serviceTimeouts(); // very cheap if there aren't any\n\n            stepHandler();\n        };\n        const { controller } = session.view.realm.vm;\n        controller.tickHook = ticker;\n    }\n}\n\nfunction shutDownSession() {\n    session.leave();\n    session = null;\n    if (globalThis.CROQUET_NODE) {\n        clearInterval(sessionStepper);\n        sessionStepper = null;\n    } else {\n        ticker = () => timerClient.serviceTimeouts();\n    }\n    sessionOffsetEstimator.shutDown();\n    sessionOffsetEstimator = null;\n}\n\n\n//# sourceURL=webpack:///./sources/unity-bridge.js?");

/***/ }),

/***/ "../node_modules/@croquet/croquet/cjs/croquet-croquet-node.js":
/***/ ((module, exports, __webpack_require__) => {

eval("/* module decorator */ module = __webpack_require__.nmd(module);\n/**\n * Copyright Croquet Corporation 2023\n * Bundle of @croquet/croquet\n * Date: 2023-08-24\n * Version: 1.1.0-38\n */\n\nObject.defineProperty(exports, \"__esModule\", ({value:!0}));var e=__webpack_require__(\"stream\"),t=__webpack_require__(\"zlib\"),r=__webpack_require__(\"net\"),s=__webpack_require__(\"tls\"),n=__webpack_require__(\"crypto\"),i=__webpack_require__(\"events\"),o=__webpack_require__(\"https\"),a=__webpack_require__(\"http\"),l=__webpack_require__(\"url\"),c=__webpack_require__(\"node:http\"),d=__webpack_require__(\"node:https\"),h=__webpack_require__(\"node:zlib\"),u=__webpack_require__(\"node:stream\"),f=__webpack_require__(\"node:buffer\"),p=__webpack_require__(\"node:util\"),m=__webpack_require__(\"node:url\"),b=__webpack_require__(\"node:net\");function y(e){return e&&\"object\"==typeof e&&\"default\"in e?e:{default:e}}__webpack_require__(\"node:fs\"),__webpack_require__(\"node:path\");var g=y(e),w=y(t),S=y(r),v=y(s),_=y(n),Z=y(i),X=y(o),L=y(a),x=y(l),T=y(c),k=y(d),G=y(h),R=y(u);if(void 0===globalThis.TextEncoder){globalThis.TextEncoder=function(){},TextEncoder.prototype.encode=function(e){for(var t=e.length,r=-1,s=\"undefined\"==typeof Uint8Array?new Array(1.5*t):new Uint8Array(3*t),n=0,i=0,o=0;o!==t;){if(n=e.charCodeAt(o),o+=1,n>=55296&&n<=56319){if(o===t){s[r+=1]=239,s[r+=1]=191,s[r+=1]=189;break}if(!((i=e.charCodeAt(o))>=56320&&i<=57343)){s[r+=1]=239,s[r+=1]=191,s[r+=1]=189;continue}if(o+=1,(n=1024*(n-55296)+i-56320+65536)>65535){s[r+=1]=240|n>>>18,s[r+=1]=128|n>>>12&63,s[r+=1]=128|n>>>6&63,s[r+=1]=128|63&n;continue}}n<=127?s[r+=1]=0|n:n<=2047?(s[r+=1]=192|n>>>6,s[r+=1]=128|63&n):(s[r+=1]=224|n>>>12,s[r+=1]=128|n>>>6&63,s[r+=1]=128|63&n)}return\"undefined\"!=typeof Uint8Array?s.subarray(0,r+1):(s.length=r+1,s)},TextEncoder.prototype.toString=function(){return\"[object TextEncoder]\"};try{Object.defineProperty(TextEncoder.prototype,\"encoding\",{get:function(){if(TextEncoder.prototype.isPrototypeOf(this))return\"utf-8\";throw TypeError(\"Illegal invocation\")}})}catch(ad){TextEncoder.prototype.encoding=\"utf-8\"}\"undefined\"!=typeof Symbol&&(TextEncoder.prototype[Symbol.toStringTag]=\"TextEncoder\")}var W=\"undefined\"!=typeof globalThis?globalThis:\"undefined\"!=typeof window?window:\"undefined\"!=typeof global?global:\"undefined\"!=typeof self?self:{};!function(e){var t=function(e){var t,r=Object.prototype,s=r.hasOwnProperty,n=\"function\"==typeof Symbol?Symbol:{},i=n.iterator||\"@@iterator\",o=n.asyncIterator||\"@@asyncIterator\",a=n.toStringTag||\"@@toStringTag\";function l(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},\"\")}catch(e){l=function(e,t,r){return e[t]=r}}function c(e,t,r,s){var n=t&&t.prototype instanceof b?t:b,i=Object.create(n.prototype),o=new k(s||[]);return i._invoke=function(e,t,r){var s=h;return function(n,i){if(s===f)throw new Error(\"Generator is already running\");if(s===p){if(\"throw\"===n)throw i;return R()}for(r.method=n,r.arg=i;;){var o=r.delegate;if(o){var a=L(o,r);if(a){if(a===m)continue;return a}}if(\"next\"===r.method)r.sent=r._sent=r.arg;else if(\"throw\"===r.method){if(s===h)throw s=p,r.arg;r.dispatchException(r.arg)}else\"return\"===r.method&&r.abrupt(\"return\",r.arg);s=f;var l=d(e,t,r);if(\"normal\"===l.type){if(s=r.done?p:u,l.arg===m)continue;return{value:l.arg,done:r.done}}\"throw\"===l.type&&(s=p,r.method=\"throw\",r.arg=l.arg)}}}(e,r,o),i}function d(e,t,r){try{return{type:\"normal\",arg:e.call(t,r)}}catch(e){return{type:\"throw\",arg:e}}}e.wrap=c;var h=\"suspendedStart\",u=\"suspendedYield\",f=\"executing\",p=\"completed\",m={};function b(){}function y(){}function g(){}var w={};l(w,i,(function(){return this}));var S=Object.getPrototypeOf,v=S&&S(S(G([])));v&&v!==r&&s.call(v,i)&&(w=v);var _=g.prototype=b.prototype=Object.create(w);function Z(e){[\"next\",\"throw\",\"return\"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function X(e,t){function r(n,i,o,a){var l=d(e[n],e,i);if(\"throw\"!==l.type){var c=l.arg,h=c.value;return h&&\"object\"==typeof h&&s.call(h,\"__await\")?t.resolve(h.__await).then((function(e){r(\"next\",e,o,a)}),(function(e){r(\"throw\",e,o,a)})):t.resolve(h).then((function(e){c.value=e,o(c)}),(function(e){return r(\"throw\",e,o,a)}))}a(l.arg)}var n;this._invoke=function(e,s){function i(){return new t((function(t,n){r(e,s,t,n)}))}return n=n?n.then(i,i):i()}}function L(e,r){var s=e.iterator[r.method];if(s===t){if(r.delegate=null,\"throw\"===r.method){if(e.iterator.return&&(r.method=\"return\",r.arg=t,L(e,r),\"throw\"===r.method))return m;r.method=\"throw\",r.arg=new TypeError(\"The iterator does not provide a 'throw' method\")}return m}var n=d(s,e.iterator,r.arg);if(\"throw\"===n.type)return r.method=\"throw\",r.arg=n.arg,r.delegate=null,m;var i=n.arg;return i?i.done?(r[e.resultName]=i.value,r.next=e.nextLoc,\"return\"!==r.method&&(r.method=\"next\",r.arg=t),r.delegate=null,m):i:(r.method=\"throw\",r.arg=new TypeError(\"iterator result is not an object\"),r.delegate=null,m)}function x(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type=\"normal\",delete t.arg,e.completion=t}function k(e){this.tryEntries=[{tryLoc:\"root\"}],e.forEach(x,this),this.reset(!0)}function G(e){if(e){var r=e[i];if(r)return r.call(e);if(\"function\"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function r(){for(;++n<e.length;)if(s.call(e,n))return r.value=e[n],r.done=!1,r;return r.value=t,r.done=!0,r};return o.next=o}}return{next:R}}function R(){return{value:t,done:!0}}return y.prototype=g,l(_,\"constructor\",g),l(g,\"constructor\",y),y.displayName=l(g,a,\"GeneratorFunction\"),e.isGeneratorFunction=function(e){var t=\"function\"==typeof e&&e.constructor;return!!t&&(t===y||\"GeneratorFunction\"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,l(e,a,\"GeneratorFunction\")),e.prototype=Object.create(_),e},e.awrap=function(e){return{__await:e}},Z(X.prototype),l(X.prototype,o,(function(){return this})),e.AsyncIterator=X,e.async=function(t,r,s,n,i){void 0===i&&(i=Promise);var o=new X(c(t,r,s,n),i);return e.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},Z(_),l(_,a,\"Generator\"),l(_,i,(function(){return this})),l(_,\"toString\",(function(){return\"[object Generator]\"})),e.keys=function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var s=t.pop();if(s in e)return r.value=s,r.done=!1,r}return r.done=!0,r}},e.values=G,k.prototype={constructor:k,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method=\"next\",this.arg=t,this.tryEntries.forEach(T),!e)for(var r in this)\"t\"===r.charAt(0)&&s.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if(\"throw\"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(s,n){return a.type=\"throw\",a.arg=e,r.next=s,n&&(r.method=\"next\",r.arg=t),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],a=o.completion;if(\"root\"===o.tryLoc)return n(\"end\");if(o.tryLoc<=this.prev){var l=s.call(o,\"catchLoc\"),c=s.call(o,\"finallyLoc\");if(l&&c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(l){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!c)throw new Error(\"try statement without catch or finally\");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&s.call(n,\"finallyLoc\")&&this.prev<n.finallyLoc){var i=n;break}}i&&(\"break\"===e||\"continue\"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method=\"next\",this.next=i.finallyLoc,m):this.complete(o)},complete:function(e,t){if(\"throw\"===e.type)throw e.arg;return\"break\"===e.type||\"continue\"===e.type?this.next=e.arg:\"return\"===e.type?(this.rval=this.arg=e.arg,this.method=\"return\",this.next=\"end\"):\"normal\"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),T(r),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var s=r.completion;if(\"throw\"===s.type){var n=s.arg;T(r)}return n}}throw new Error(\"illegal catch attempt\")},delegateYield:function(e,r,s){return this.delegate={iterator:G(e),resultName:r,nextLoc:s},\"next\"===this.method&&(this.arg=t),m}},e}(e.exports);try{globalThis.regeneratorRuntime=t}catch(e){\"object\"==typeof globalThis?globalThis.regeneratorRuntime=t:Function(\"r\",\"regeneratorRuntime = r\")(t)}}({exports:{}});const C=\"node\",P=\"1.1.0-38\";function I(e){return\"number\"==typeof e||(!!/^0x[0-9a-f]+$/i.test(e)||/^[-+]?(?:\\d+(?:\\.\\d*)?|\\.\\d+)(e[-+]?\\d+)?$/.test(e))}function V(e,t){return\"constructor\"===t&&\"function\"==typeof e[t]||\"__proto__\"===t}const Y=function(e,t){t||(t={});var r={bools:{},strings:{},unknownFn:null};\"function\"==typeof t.unknown&&(r.unknownFn=t.unknown),\"boolean\"==typeof t.boolean&&t.boolean?r.allBools=!0:[].concat(t.boolean).filter(Boolean).forEach((function(e){r.bools[e]=!0}));var s={};Object.keys(t.alias||{}).forEach((function(e){s[e]=[].concat(t.alias[e]),s[e].forEach((function(t){s[t]=[e].concat(s[e].filter((function(e){return t!==e})))}))})),[].concat(t.string).filter(Boolean).forEach((function(e){r.strings[e]=!0,s[e]&&(r.strings[s[e]]=!0)}));var n=t.default||{},i={_:[]};Object.keys(r.bools).forEach((function(e){a(e,void 0!==n[e]&&n[e])}));var o=[];function a(e,t,n){if(!n||!r.unknownFn||function(e,t){return r.allBools&&/^--[^=]+$/.test(t)||r.strings[e]||r.bools[e]||s[e]}(e,n)||!1!==r.unknownFn(n)){var o=!r.strings[e]&&I(t)?Number(t):t;l(i,e.split(\".\"),o),(s[e]||[]).forEach((function(e){l(i,e.split(\".\"),o)}))}}function l(e,t,s){for(var n=e,i=0;i<t.length-1;i++){if(V(n,o=t[i]))return;void 0===n[o]&&(n[o]={}),n[o]!==Object.prototype&&n[o]!==Number.prototype&&n[o]!==String.prototype||(n[o]={}),n[o]===Array.prototype&&(n[o]=[]),n=n[o]}var o;V(n,o=t[t.length-1])||(n!==Object.prototype&&n!==Number.prototype&&n!==String.prototype||(n={}),n===Array.prototype&&(n=[]),void 0===n[o]||r.bools[o]||\"boolean\"==typeof n[o]?n[o]=s:Array.isArray(n[o])?n[o].push(s):n[o]=[n[o],s])}function c(e){return s[e].some((function(e){return r.bools[e]}))}-1!==e.indexOf(\"--\")&&(o=e.slice(e.indexOf(\"--\")+1),e=e.slice(0,e.indexOf(\"--\")));for(var d=0;d<e.length;d++){var h=e[d];if(/^--.+=/.test(h)){var u=h.match(/^--([^=]+)=([\\s\\S]*)$/),f=u[1],p=u[2];r.bools[f]&&(p=\"false\"!==p),a(f,p,h)}else if(/^--no-.+/.test(h)){a(f=h.match(/^--no-(.+)/)[1],!1,h)}else if(/^--.+/.test(h)){f=h.match(/^--(.+)/)[1];void 0===(g=e[d+1])||/^-/.test(g)||r.bools[f]||r.allBools||s[f]&&c(f)?/^(true|false)$/.test(g)?(a(f,\"true\"===g,h),d++):a(f,!r.strings[f]||\"\",h):(a(f,g,h),d++)}else if(/^-[^-]+/.test(h)){for(var m=h.slice(1,-1).split(\"\"),b=!1,y=0;y<m.length;y++){var g;if(\"-\"!==(g=h.slice(y+2))){if(/[A-Za-z]/.test(m[y])&&/=/.test(g)){a(m[y],g.split(\"=\")[1],h),b=!0;break}if(/[A-Za-z]/.test(m[y])&&/-?\\d+(\\.\\d*)?(e-?\\d+)?$/.test(g)){a(m[y],g,h),b=!0;break}if(m[y+1]&&m[y+1].match(/\\W/)){a(m[y],h.slice(y+2),h),b=!0;break}a(m[y],!r.strings[m[y]]||\"\",h)}else a(m[y],g,h)}f=h.slice(-1)[0];b||\"-\"===f||(!e[d+1]||/^(-|--)[^-]/.test(e[d+1])||r.bools[f]||s[f]&&c(f)?e[d+1]&&/^(true|false)$/.test(e[d+1])?(a(f,\"true\"===e[d+1],h),d++):a(f,!r.strings[f]||\"\",h):(a(f,e[d+1],h),d++))}else if(r.unknownFn&&!1===r.unknownFn(h)||i._.push(r.strings._||!I(h)?h:Number(h)),t.stopEarly){i._.push.apply(i._,e.slice(d+1));break}}return Object.keys(n).forEach((function(e){var t,r,o;t=i,r=e.split(\".\"),o=t,r.slice(0,-1).forEach((function(e){o=o[e]||{}})),r[r.length-1]in o||(l(i,e.split(\".\"),n[e]),(s[e]||[]).forEach((function(t){l(i,t.split(\".\"),n[e])})))})),t[\"--\"]?(i[\"--\"]=new Array,o.forEach((function(e){i[\"--\"].push(e)}))):o.forEach((function(e){i._.push(e)})),i}(process.argv.slice(2));const H=new class{constructor(){!function(e){for(const t of Object.keys(Y)){if(\"_\"===t)continue;let r=Y[t];\"string\"==typeof r&&\"[\"===r[0]&&(r=r.slice(1,-1).split(\",\")),e[t]=r}}(this)}has(e,t,r){\"boolean\"!=typeof r&&(r=this.isHost(r));const s=this[e];if(\"string\"!=typeof s)return r;const n=s.split(\",\");return!0===r&&(t=`no${t}`),t.endsWith(\"s\")&&(t=t.slice(0,-1)),n.includes(t)||n.includes(`${t}s`)?!r:r}isHost(e){return\"localhost\"===e}isLocalhost(){return this.isHost(\"localhost\")}};var M,E=function(e,t){t||(t={}),\"function\"==typeof t&&(t={cmp:t});var r=\"boolean\"==typeof t.cycles&&t.cycles,s=t.cmp&&function(e){return function(t){return function(r,s){var n={key:r,value:t[r]},i={key:s,value:t[s]};return e(n,i)}}}(t.cmp),n=[];return function e(t){if(t&&t.toJSON&&\"function\"==typeof t.toJSON&&(t=t.toJSON()),void 0!==t){if(\"number\"==typeof t)return isFinite(t)?\"\"+t:\"null\";if(\"object\"!=typeof t)return JSON.stringify(t);var i,o;if(Array.isArray(t)){for(o=\"[\",i=0;i<t.length;i++)i&&(o+=\",\"),o+=e(t[i])||\"null\";return o+\"]\"}if(null===t)return\"null\";if(-1!==n.indexOf(t)){if(r)return JSON.stringify(\"__cycle__\");throw new TypeError(\"Converting circular structure to JSON\")}var a=n.push(t)-1,l=Object.keys(t).sort(s&&s(t));for(o=\"\",i=0;i<l.length;i++){var c=l[i],d=e(t[c]);d&&(o&&(o+=\",\"),o+=JSON.stringify(c)+\":\"+d)}return n.splice(a,1),\"{\"+o+\"}\"}}(e)},F={exports:{}},K={exports:{}};K.exports=(M=M||function(e,t){var r;if(\"undefined\"!=typeof window&&window.crypto&&(r=window.crypto),\"undefined\"!=typeof self&&self.crypto&&(r=self.crypto),\"undefined\"!=typeof globalThis&&globalThis.crypto&&(r=globalThis.crypto),!r&&\"undefined\"!=typeof window&&window.msCrypto&&(r=window.msCrypto),!r&&void 0!==W&&W.crypto&&(r=W.crypto),!r)try{r=__webpack_require__(\"crypto\")}catch(e){}var s=function(){if(r){if(\"function\"==typeof r.getRandomValues)try{return r.getRandomValues(new Uint32Array(1))[0]}catch(e){}if(\"function\"==typeof r.randomBytes)try{return r.randomBytes(4).readInt32LE()}catch(e){}}throw new Error(\"Native crypto module could not be used to get secure random number.\")},n=Object.create||function(){function e(){}return function(t){var r;return e.prototype=t,r=new e,e.prototype=null,r}}(),i={},o=i.lib={},a=o.Base={extend:function(e){var t=n(this);return e&&t.mixIn(e),t.hasOwnProperty(\"init\")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty(\"toString\")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},l=o.WordArray=a.extend({init:function(e,r){e=this.words=e||[],this.sigBytes=r!=t?r:4*e.length},toString:function(e){return(e||d).stringify(this)},concat:function(e){var t=this.words,r=e.words,s=this.sigBytes,n=e.sigBytes;if(this.clamp(),s%4)for(var i=0;i<n;i++){var o=r[i>>>2]>>>24-i%4*8&255;t[s+i>>>2]|=o<<24-(s+i)%4*8}else for(var a=0;a<n;a+=4)t[s+a>>>2]=r[a>>>2];return this.sigBytes+=n,this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8,t.length=e.ceil(r/4)},clone:function(){var e=a.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],r=0;r<e;r+=4)t.push(s());return new l.init(t,e)}}),c=i.enc={},d=c.Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,s=[],n=0;n<r;n++){var i=t[n>>>2]>>>24-n%4*8&255;s.push((i>>>4).toString(16)),s.push((15&i).toString(16))}return s.join(\"\")},parse:function(e){for(var t=e.length,r=[],s=0;s<t;s+=2)r[s>>>3]|=parseInt(e.substr(s,2),16)<<24-s%8*4;return new l.init(r,t/2)}},h=c.Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,s=[],n=0;n<r;n++){var i=t[n>>>2]>>>24-n%4*8&255;s.push(String.fromCharCode(i))}return s.join(\"\")},parse:function(e){for(var t=e.length,r=[],s=0;s<t;s++)r[s>>>2]|=(255&e.charCodeAt(s))<<24-s%4*8;return new l.init(r,t)}},u=c.Utf8={stringify:function(e){try{return decodeURIComponent(escape(h.stringify(e)))}catch(e){throw new Error(\"Malformed UTF-8 data\")}},parse:function(e){return h.parse(unescape(encodeURIComponent(e)))}},f=o.BufferedBlockAlgorithm=a.extend({reset:function(){this._data=new l.init,this._nDataBytes=0},_append:function(e){\"string\"==typeof e&&(e=u.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var r,s=this._data,n=s.words,i=s.sigBytes,o=this.blockSize,a=i/(4*o),c=(a=t?e.ceil(a):e.max((0|a)-this._minBufferSize,0))*o,d=e.min(4*c,i);if(c){for(var h=0;h<c;h+=o)this._doProcessBlock(n,h);r=n.splice(0,c),s.sigBytes-=d}return new l.init(r,d)},clone:function(){var e=a.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});o.Hasher=f.extend({cfg:a.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){f.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new p.HMAC.init(e,r).finalize(t)}}});var p=i.algo={};return i}(Math),M);var N=F.exports=function(e){return function(){if(\"function\"==typeof ArrayBuffer){var t=e.lib.WordArray,r=t.init,s=t.init=function(e){if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),(e instanceof Int8Array||\"undefined\"!=typeof Uint8ClampedArray&&e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array)&&(e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),e instanceof Uint8Array){for(var t=e.byteLength,s=[],n=0;n<t;n++)s[n>>>2]|=e[n]<<24-n%4*8;r.call(this,s,t)}else r.apply(this,arguments)};s.prototype=t}}(),e.lib.WordArray}(K.exports),z={exports:{}},j=z.exports=function(e){return function(t){var r=e,s=r.lib,n=s.WordArray,i=s.Hasher,o=r.algo,a=[],l=[];!function(){function e(e){for(var r=t.sqrt(e),s=2;s<=r;s++)if(!(e%s))return!1;return!0}function r(e){return 4294967296*(e-(0|e))|0}for(var s=2,n=0;n<64;)e(s)&&(n<8&&(a[n]=r(t.pow(s,.5))),l[n]=r(t.pow(s,1/3)),n++),s++}();var c=[],d=o.SHA256=i.extend({_doReset:function(){this._hash=new n.init(a.slice(0))},_doProcessBlock:function(e,t){for(var r=this._hash.words,s=r[0],n=r[1],i=r[2],o=r[3],a=r[4],d=r[5],h=r[6],u=r[7],f=0;f<64;f++){if(f<16)c[f]=0|e[t+f];else{var p=c[f-15],m=(p<<25|p>>>7)^(p<<14|p>>>18)^p>>>3,b=c[f-2],y=(b<<15|b>>>17)^(b<<13|b>>>19)^b>>>10;c[f]=m+c[f-7]+y+c[f-16]}var g=s&n^s&i^n&i,w=(s<<30|s>>>2)^(s<<19|s>>>13)^(s<<10|s>>>22),S=u+((a<<26|a>>>6)^(a<<21|a>>>11)^(a<<7|a>>>25))+(a&d^~a&h)+l[f]+c[f];u=h,h=d,d=a,a=o+S|0,o=i,i=n,n=s,s=S+(w+g)|0}r[0]=r[0]+s|0,r[1]=r[1]+n|0,r[2]=r[2]+i|0,r[3]=r[3]+o|0,r[4]=r[4]+a|0,r[5]=r[5]+d|0,r[6]=r[6]+h|0,r[7]=r[7]+u|0},_doFinalize:function(){var e=this._data,r=e.words,s=8*this._nDataBytes,n=8*e.sigBytes;return r[n>>>5]|=128<<24-n%32,r[14+(n+64>>>9<<4)]=t.floor(s/4294967296),r[15+(n+64>>>9<<4)]=s,e.sigBytes=4*r.length,this._process(),this._hash},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}});r.SHA256=i._createHelper(d),r.HmacSHA256=i._createHmacHelper(d)}(Math),e.SHA256}(K.exports);let U;function O(e){const t=e.sigBytes,r=e.words,s=new Uint8Array(t);let n=0,i=0;for(;n<t;){const e=r[i++];if(s[n++]=(4278190080&e)>>>24,n===t)break;if(s[n++]=(16711680&e)>>>16,n===t)break;if(s[n++]=(65280&e)>>>8,n===t)break;s[n++]=255&e}return s}function Q(e){function t(e){const t=e.indexOf(\"{\"),r=e.lastIndexOf(\"}\");if(-1===t||-1===r||r<t)return e;const s=e.slice(0,t).replace(/\\s+/g,\" \").replace(/\\s\\(/,\"(\"),n=e.slice(t+1,r);return`${s.trim()}{${n.trim()}}`}let r=t(\"\"+e);if(!r.startsWith(\"class\")){const s=e.prototype;s&&(r+=Object.getOwnPropertyNames(s).map((e=>`${e}:${t(\"\"+s[e])}`)).join(\"\"))}return r}function J(e){return btoa(String.fromCharCode(...new Uint8Array(e))).replace(/=/g,\"\").replace(/\\+/g,\"-\").replace(/\\//g,\"_\")}function D(){return H.has(\"debug\",\"hashing\",!1)}U=globalThis.crypto&&globalThis.crypto.subtle&&\"function\"==typeof globalThis.crypto.subtle.digest?globalThis.crypto.subtle.digest.bind(globalThis.crypto.subtle):(e,t)=>{if(\"SHA-256\"!==e)throw Error(\"Croquet: only SHA-256 available\");const r=N.create(t);return O(j(r)).buffer};let B={};const A=new TextEncoder;async function $(e){const t=A.encode(e),r=await async function(e){return 0===e.length?\"47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU\":J(await U(\"SHA-256\",e))}(t);return B[r]={string:e,buffer:t},r}const q=[],ee={};const te=new Set;function re(e,t={}){return e&&ie.showMessage(e,{...t,level:\"warning\"})}function se(e,t={}){return e&&ie.showMessage(e,{...t,level:\"status\"})}function ne(e,t,r=\"error\"){console.error(`Error during ${e}`,t);const s=(t.stack||\"\").split(\"\\n\").filter((e=>!e.match(/croquet-.*\\.min.js/))).join(\"\\n\");ie.showMessage(`Error during ${e}: ${t.message}\\n\\n${s}`,{level:r,duration:\"error\"===r?1e4:void 0,stopOnFocus:!0})}const ie={sessionURL:null,root:!1,sync:!1,messages:!1,badge:!1,stats:!1,qrcode:!1,makeWidgetDock(){},makeSessionWidgets(){},makeQRCanvas:()=>null,clearSessionMoniker(){},showSyncWait(e){},messageFunction:function(e,t={}){const r=t.level;console.log(`${\"status\"===r?\"\":r+\": \"} ${e}`)},showMessage:(e,t={})=>H.nomessages||!1===ie.root||!1===ie.messages||!ie.messageFunction?(\"warning\"===t.level&&console.warn(e),\"error\"===t.level&&console.error(e),null):ie.messageFunction(e,t),isCroquetHost:e=>e.endsWith(\"croquet.io\")||[\"localhost\",\"127.0.0.1\",\"[::1]\"].includes(e)||e.endsWith(\"ngrok.io\"),referrerURL:()=>\"http://localhost/node.html\",autoSession(e={key:\"q\"}){\"string\"==typeof e&&(e={key:e}),e||(e={});const t=e.key||\"q\";let r=H[t]||\"\";if(r)try{r=decodeURIComponent(r)}catch(e){}else r=Math.floor(Math.random()*36**10).toString(36),console.warn(`no Croquet session name provided, using \"${r}\"`);H.has(\"debug\",\"session\")&&console.log(`Croquet.App.autoSession: \"${r}\"`);const s=Promise.resolve(r);return s[Symbol.toPrimitive]=()=>(console.warn(\"Deprecated: Croquet.App.autoSession() return value used directly. It returns a promise now!\"),r),s},autoPassword(e={key:\"pw\"}){const t=e.key||\"pw\";let r=H[t]||\"\";if(!r){const e=(__webpack_require__(\"crypto\").randomBytes)(16);r=J(e),console.warn(`no Croquet session password provided, using \"${r}\"`)}H.has(\"debug\",\"session\")&&console.log(`Croquet.App.autoPassword: \"${r}\"`);const s=Promise.resolve(r);return s[Symbol.toPrimitive]=()=>(console.warn(\"Deprecated: Croquet.App.autoPassword() return value used directly. It returns a promise now!\"),r),s}};function oe(e,t,r=null){let s=\"none\";for(const n of[\"immediate\",\"queued\",\"oncePerFrame\",\"oncePerFrameWhileSynced\"])for(const i of e[n])i.for===t?null===r||i.unbound===r?e[n].delete(i):s=\"subscriber\":\"none\"===s&&(s=\"others\");return s}const ae=new class{constructor(){this.subscriptions={},this.subscribers=new Map,this.queuedEvents=[],this.perFrameEvents=new Map,this.perSyncedFrameEvents=new Map,this.subscriberIds=0}register(e){return\"V\"+ ++this.subscriberIds}deregister(e){}addSubscription(e,t,r,s,n){if(\"vote\"===n)return void this.addSubscription(e,t+\"#__vote\",r,s,\"immediate\");const i=e+\":\"+t,o=s;o.for=r;let a=this.subscriptions[i];if(a||(a=this.subscriptions[i]={immediate:new Set,queued:new Set,oncePerFrame:new Set,oncePerFrameWhileSynced:new Set}),!a[n])throw Error(`Unknown subscribe() option: handling=\"${n}\"`);a[n].add(o);let l=this.subscribers.get(r);l||this.subscribers.set(r,l=new Set),l.add(i)}removeSubscription(e,t,r,s=null){const n=e+\":\"+t,i=this.subscriptions[n];if(i){const e=oe(i,r,s);if(e||delete this.subscriptions[n],\"subscriber\"!==e){const e=this.subscribers.get(r);e.delete(n),0===e.size&&this.subscribers.delete(r)}}t.endsWith(\"#__vote\")||this.removeSubscription(e,t+\"#__vote\",r)}removeAllSubscriptionsFor(e){const t=this.subscribers.get(e);if(t){for(const r of t){const t=this.subscriptions[r];if(t){\"none\"===oe(t,e)&&delete this.subscriptions[r]}else console.error(`Croquet: topic ${r} not found in subscriptions table for ${e} during removeAllSubscriptionsFor()`)}this.subscribers.delete(e)}}handleEvent(e,t,r=(e=>e())){const s=this.subscriptions[e];s&&(s.queued.size>0&&this.queuedEvents.push({topic:e,data:t}),s.oncePerFrame.size>0&&this.perFrameEvents.set(e,t),s.oncePerFrameWhileSynced.size>0&&this.perSyncedFrameEvents.set(e,t),s.immediate.size>0&&r((()=>{for(const r of s.immediate)try{r(t)}catch(t){console.error(t),console.warn(`Croquet: error \"${t.message}\" in \"immediate\" subscription ${e}`)}})))}processFrameEvents(e,t){let r=0;const s=(e,t,s)=>{const n=this.subscriptions[t];if(n)for(const i of n[e]){try{i(s)}catch(r){console.error(r),console.warn(`Croquet: error \"${r.message}\" in \"${e}\" subscription ${t}`)}r++}};for(const{topic:e,data:t}of this.queuedEvents)s(\"queued\",e,t);if(this.queuedEvents.length=0,e){for(const[e,t]of this.perFrameEvents)s(\"oncePerFrame\",e,t);if(this.perFrameEvents.clear(),t){for(const[e,t]of this.perSyncedFrameEvents)s(\"oncePerFrameWhileSynced\",e,t);this.perSyncedFrameEvents.clear()}for(const{topic:e,data:t}of this.queuedEvents)s(\"queued\",e,t);this.queuedEvents.length=0}return r}};let le={get subscribe(){return le={subscribe:H.has(\"debug\",\"subscribe\",!1)},le.subscribe}};class ce{constructor(e){this.vm=e}register(e){return this.vm.registerModel(e)}deregister(e){this.vm.deregisterModel(e.id)}publish(e,t,r){this.vm.publishFromModel(r,e,t)}subscribe(e,t,r,s){return le.subscribe&&console.log(`Model.subscribe(\"${t}:${r}\", ${e} ${(\"\"+s).replace(/\\([\\s\\S]*/,\"\")})`),this.vm.addSubscription(e,t,r,s)}unsubscribe(e,t,r,s=\"*\"){le.subscribe&&console.log(`Model.unsubscribe(${t}:${r}\", ${e} ${(\"\"+s).replace(/\\([\\s\\S]*/,\"\")})`),this.vm.removeSubscription(e,t,r,s)}unsubscribeAll(e){le.subscribe&&console.log(`Model.unsubscribeAll(${e} ${e.id})`),this.vm.removeAllSubscriptionsFor(e)}future(e,t,r,s){if(he&&he.equal(this))return this.vm.future(e,t,r,s);throw Error(`Model.future() called from outside: ${e}`)}cancelFuture(e,t){if(he&&he.equal(this))return this.vm.cancelFuture(e,t);throw Error(`Model.cancelFuture() called from outside: ${e}`)}random(){return this.vm.random()}now(){return this.vm.time}equal(e){return e instanceof ce&&e.vm===this.vm}isViewRealm(){return!1}}class de{constructor(e){this.vm=e}register(e){return ae.register(e)}deregister(e){ae.deregister(e)}publish(e,t,r){this.vm.publishFromView(r,e,t)}subscribe(e,t,r,s,n=\"queued\"){le.subscribe&&console.log(`View.subscribe(\"${s}:${e}\", ${t} ${r?r.name||(\"\"+r).replace(/\\([\\s\\S]*/,\"\"):\"\"+r} [${n}])`),ae.addSubscription(s,e,t,r,n)}unsubscribe(e,t,r=null,s){le.subscribe&&console.log(`View.unsubscribe(\"${s}:${e}\", ${t} ${r?r.name||(\"\"+r).replace(/\\([\\s\\S]*/,\"\"):\"*\"})`),ae.removeSubscription(s,e,t,r)}unsubscribeAll(e){le.subscribe&&console.log(`View.unsubscribeAll(${e})`),ae.removeAllSubscriptionsFor(e)}future(e,t){const r=this.vm;return new Proxy(e,{get(s,n){if(\"function\"==typeof e[n]){return new Proxy(e[n],{apply(s,i,o){setTimeout((()=>{e.id&&pe(r,(()=>e[n](...o)),!0)}),t)}})}throw Error(\"Tried to call \"+n+\"() on future of \"+Object.getPrototypeOf(e).constructor.name+\" which is not a function\")}})}random(){return Math.random()}now(){return this.vm.time}externalNow(){return this.vm.controller.reflectorTime}extrapolatedNow(){return this.vm.controller.extrapolatedTime}isSynced(){return!!this.vm.controller.synced}equal(e){return e instanceof de&&e.vm===this.vm}isViewRealm(){return!0}}let he=null;function ue(e=\"Tried to execute code that requires realm outside of realm.\"){if(!he&&e)throw Error(e);return he}function fe(e,t){if(null!==he)throw Error(\"Can't switch realms from inside realm\");try{return he=new ce(e),t()}finally{he=null}}function pe(e,t,r=!1){if(null!==he&&!r)throw Error(\"Can't switch realms from inside realm\");const s=he;try{return he=new de(e),t()}finally{he=s}}var me={exports:{}};!function(e){!function(t,r,s){var n,i=256,o=s.pow(i,6),a=s.pow(2,52),l=2*a,c=255;function d(e,c,d){var b=[],y=p(f((c=1==c?{entropy:!0}:c||{}).entropy?[e,m(r)]:null==e?function(){try{var e;return n&&(e=n.randomBytes)?e=e(i):(e=new Uint8Array(i),(t.crypto||t.msCrypto).getRandomValues(e)),m(e)}catch(e){var s=t.navigator,o=s&&s.plugins;return[+new Date,t,o,t.screen,m(r)]}}():e,3),b),g=new h(b),w=function(){for(var e=g.g(6),t=o,r=0;e<a;)e=(e+r)*i,t*=i,r=g.g(1);for(;e>=l;)e/=2,t/=2,r>>>=1;return(e+r)/t};return w.int32=function(){return 0|g.g(4)},w.quick=function(){return g.g(4)/4294967296},w.double=w,p(m(g.S),r),(c.pass||d||function(e,t,r,n){return n&&(n.S&&u(n,g),e.state=function(){return u(g,{})}),r?(s.random=e,t):e})(w,y,\"global\"in c?c.global:this==s,c.state)}function h(e){var t,r=e.length,s=this,n=0,o=s.i=s.j=0,a=s.S=[];for(r||(e=[r++]);n<i;)a[n]=n++;for(n=0;n<i;n++)a[n]=a[o=c&o+e[n%r]+(t=a[n])],a[o]=t;(s.g=function(e){for(var t,r=0,n=s.i,o=s.j,a=s.S;e--;)t=a[n=c&n+1],r=r*i+a[c&(a[n]=a[o=c&o+t])+(a[o]=t)];return s.i=n,s.j=o,r})(i)}function u(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function f(e,t){var r,s=[],n=typeof e;if(t&&\"object\"==n)for(r in e)try{s.push(f(e[r],t-1))}catch(e){}return s.length?s:\"string\"==n?e:e+\"\\0\"}function p(e,t){for(var r,s=e+\"\",n=0;n<s.length;)t[c&n]=c&(r^=19*t[c&n])+s.charCodeAt(n++);return m(t)}function m(e){return String.fromCharCode.apply(0,e)}if(p(s.random(),r),e.exports){e.exports=d;try{n=__webpack_require__(\"crypto\")}catch(e){}}else s.seedrandom=d}(\"undefined\"!=typeof self?self:W,[],Math)}(me);var be=me.exports;var ye=function(e){return e!=e},ge=ye,we=Math.sqrt,Se=.7853981633974483;var ve=function(e){var t,r;return 0===e?.16666666666666713:((e<0?-e:e)<=1?(t=e*(19.562619833175948+e*(e*(5.444622390564711+e*(.004253011369004428*e-.6019598008014124))-16.262479672107002))-8.198089802484825,r=e*(139.51056146574857+e*(e*(70.49610280856842+e*(1*e-14.740913729888538))-147.1791292232726))-49.18853881490881):(t=.004253011369004428+(e=1/e)*(e*(5.444622390564711+e*(e*(19.562619833175948+-8.198089802484825*e)-16.262479672107002))-.6019598008014124),r=1+e*(e*(70.49610280856842+e*(e*(139.51056146574857+-49.18853881490881*e)-147.1791292232726))-14.740913729888538)),t/r)};var _e=function(e){var t,r;return 0===e?.08333333333333809:((e<0?-e:e)<=1?(t=28.536655482610616+e*(e*(6.968710824104713+e*(.002967721961301243*e-.5634242780008963))-25.56901049652825),r=342.43986579130785+e*(e*(147.0656354026815+e*(1*e-21.947795316429207))-383.8770957603691)):(t=.002967721961301243+(e=1/e)*(e*(6.968710824104713+e*(28.536655482610616*e-25.56901049652825))-.5634242780008963),r=1+e*(e*(147.0656354026815+e*(342.43986579130785*e-383.8770957603691))-21.947795316429207)),t/r)};var Ze=function(e){var t,r,s,n,i;if(ge(e))return NaN;if(e>0?s=e:(t=!0,s=-e),s>1)return NaN;if(s>.625)n=(r=1-s)*_e(r),r=we(r+r),i=Se-r,i-=r=r*n-6123233995736766e-32,i+=Se;else{if(s<1e-8)return e;i=s*(i=(r=s*s)*ve(r))+s}return t?-i:i},Xe=Ze;var Le=function(e){var t;return ge(e)||e<-1||e>1?NaN:e>.5?2*Xe(we(.5-.5*e)):(t=Se-Xe(e),t+=6123233995736766e-32,t+=Se)},xe=Le;var Te=function(){return\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol(\"foo\")}();var ke=function(){return Te&&\"symbol\"==typeof Symbol.toStringTag},Ge=Object.prototype.toString;var Re=function(e){return Ge.call(e)},We=Object.prototype.hasOwnProperty;var Ce=function(e,t){return null!=e&&We.call(e,t)},Pe=\"function\"==typeof Symbol?Symbol.toStringTag:\"\";var Ie=function(e){var t,r,s;if(null==e)return Ge.call(e);r=e[Pe],t=Ce(e,Pe);try{e[Pe]=void 0}catch(t){return Ge.call(e)}return s=Ge.call(e),t?e[Pe]=r:delete e[Pe],s},Ve=ke()?Ie:Re,Ye=\"function\"==typeof Uint32Array;var He=function(e){return Ye&&e instanceof Uint32Array||\"[object Uint32Array]\"===Ve(e)},Me=\"function\"==typeof Uint32Array?Uint32Array:null;var Ee=function(){var e,t;if(\"function\"!=typeof Me)return!1;try{t=new Me(t=[1,3.14,-3.14,4294967296,4294967297]),e=He(t)&&1===t[0]&&3===t[1]&&4294967293===t[2]&&0===t[3]&&1===t[4]}catch(t){e=!1}return e},Fe=\"function\"==typeof Uint32Array?Uint32Array:null;var Ke=function(){throw new Error(\"not implemented\")},Ne=Ee()?Fe:Ke,ze=\"function\"==typeof Float64Array;var je=function(e){return ze&&e instanceof Float64Array||\"[object Float64Array]\"===Ve(e)},Ue=\"function\"==typeof Float64Array?Float64Array:null;var Oe=function(){var e,t;if(\"function\"!=typeof Ue)return!1;try{t=new Ue([1,3.14,-3.14,NaN]),e=je(t)&&1===t[0]&&3.14===t[1]&&-3.14===t[2]&&t[3]!=t[3]}catch(t){e=!1}return e},Qe=\"function\"==typeof Float64Array?Float64Array:null;var Je=function(){throw new Error(\"not implemented\")},De=Oe()?Qe:Je,Be=\"function\"==typeof Uint8Array;var Ae=function(e){return Be&&e instanceof Uint8Array||\"[object Uint8Array]\"===Ve(e)},$e=\"function\"==typeof Uint8Array?Uint8Array:null;var qe=function(){var e,t;if(\"function\"!=typeof $e)return!1;try{t=new $e(t=[1,3.14,-3.14,256,257]),e=Ae(t)&&1===t[0]&&3===t[1]&&253===t[2]&&0===t[3]&&1===t[4]}catch(t){e=!1}return e},et=\"function\"==typeof Uint8Array?Uint8Array:null;var tt=function(){throw new Error(\"not implemented\")},rt=qe()?et:tt,st=\"function\"==typeof Uint16Array;var nt=function(e){return st&&e instanceof Uint16Array||\"[object Uint16Array]\"===Ve(e)},it=\"function\"==typeof Uint16Array?Uint16Array:null;var ot=function(){var e,t;if(\"function\"!=typeof it)return!1;try{t=new it(t=[1,3.14,-3.14,65536,65537]),e=nt(t)&&1===t[0]&&3===t[1]&&65533===t[2]&&0===t[3]&&1===t[4]}catch(t){e=!1}return e},at=\"function\"==typeof Uint16Array?Uint16Array:null;var lt,ct=function(){throw new Error(\"not implemented\")},dt={uint16:ot()?at:ct,uint8:rt};(lt=new dt.uint16(1))[0]=4660;var ht=52===new dt.uint8(lt.buffer)[0],ut=!0===ht?1:0,ft=new De(1),pt=new Ne(ft.buffer);var mt=function(e){return ft[0]=e,pt[ut]},bt=mt,yt=!0===ht?1:0,gt=new De(1),wt=new Ne(gt.buffer);var St=function(e,t){return gt[0]=e,wt[yt]=t>>>0,gt[0]},vt=St,_t=Number.POSITIVE_INFINITY,Zt=Number.NEGATIVE_INFINITY;var Xt=function(e){return 0===e?.6666666666666735:.6666666666666735+e*(.3999999999940942+e*(.2857142874366239+e*(.22222198432149784+e*(.1818357216161805+e*(.15313837699209373+.14798198605116586*e)))))},Lt=.6931471803691238,xt=1.9082149292705877e-10;var Tt=function(e){var t,r,s,n,i,o,a,l,c,d;if(e<-1||ge(e))return NaN;if(-1===e)return Zt;if(e===_t)return e;if(0===e)return e;if(d=1,(s=e<0?-e:e)<.41421356237309503){if(s<1.862645149230957e-9)return s<5551115123125783e-32?e:e-e*e*.5;e>-.2928932188134525&&(d=0,n=e,r=1)}return 0!==d&&(s<9007199254740992?(i=(d=((r=bt(c=1+e))>>20)-1023)>0?1-(c-e):e-(c-1),i/=c):(d=((r=bt(c=e))>>20)-1023,i=0),(r&=1048575)<434334?c=vt(c,1072693248|r):(d+=1,c=vt(c,1071644672|r),r=1048576-r>>2),n=c-1),t=.5*n*n,0===r?0===n?d*Lt+(i+=d*xt):d*Lt-((l=t*(1-.6666666666666666*n))-(d*xt+i)-n):(l=(a=(o=n/(2+n))*o)*Xt(a),0===d?n-(t-o*(t+l)):d*Lt-(t-(o*(t+l)+(d*xt+i))-n))},kt=Tt,Gt=.6931471805599453;var Rt=function(e){return 0===e?.3999999999940942:.3999999999940942+e*(.22222198432149784+.15313837699209373*e)};var Wt=function(e){return 0===e?.6666666666666735:.6666666666666735+e*(.2857142874366239+e*(.1818357216161805+.14798198605116586*e))},Ct=.6931471803691238,Pt=1.9082149292705877e-10;var It=function(e){var t,r,s,n,i,o,a,l,c,d,h;return 0===e?Zt:ge(e)||e<0?NaN:(n=0,(r=bt(e))<1048576&&(n-=54,r=bt(e*=0x40000000000000)),r>=2146435072?e+e:(n+=(r>>20)-1023|0,n+=(a=(r&=1048575)+614244&1048576|0)>>20|0,o=(e=vt(e,r|1072693248^a))-1,(1048575&2+r)<3?0===o?0===n?0:n*Ct+n*Pt:(i=o*o*(.5-.3333333333333333*o),0===n?o-i:n*Ct-(i-n*Pt-o)):(a=r-398458|0,l=440401-r|0,s=(d=(h=(c=o/(2+o))*c)*h)*Rt(d),i=h*Wt(d)+s,(a|=l)>0?(t=.5*o*o,0===n?o-(t-c*(t+i)):n*Ct-(t-(c*(t+i)+n*Pt)-o)):0===n?o-c*(o-i):n*Ct-(c*(o-i)-n*Pt-o))))},Vt=It;var Yt=function(e){var t;return ge(e)||e<1?NaN:1===e?0:e>=268435456?Vt(e)+Gt:e>2?Vt(2*e-1/(e+we(e*e-1))):kt((t=e-1)+we(2*t+t*t))},Ht=Yt;var Mt=function(e){return e===_t||e===Zt},Et=Mt;var Ft=function(e){var t,r,s;return ge(e)||Et(e)?e:(e<0&&(e=-e,t=!0),s=e<3.725290298461914e-9?e:e>268435456?Vt(e)+Gt:e>2?Vt(2*e+1/(we(e*e+1)+e)):kt(e+(r=e*e)/(1+we(1+r))),t?-s:s)},Kt=Ft,Nt=1.5707963267948966;var zt=function(e){return 0===e?-64.85021904942025:e*(e*(e*(-.8750608600031904*e-16.157537187333652)-75.00855792314705)-122.88666844901361)-64.85021904942025};var jt=function(e){return 0===e?194.5506571482614:194.5506571482614+e*(485.3903996359137+e*(432.88106049129027+e*(165.02700983169885+e*(24.858464901423062+1*e))))};var Ut=function(e){var t,r,s,n;return ge(e)||0===e?e:e===_t?Nt:e===Zt?-Nt:(e<0&&(r=!0,e=-e),t=0,e>2.414213562373095?(s=Nt,t=1,e=-1/e):e<=.66?s=0:(s=Se,t=2,e=(e-1)/(e+1)),n=e*(n=(n=e*e)*zt(n)/jt(n))+e,2===t?n+=3061616997868383e-32:1===t&&(n+=6123233995736766e-32),s+=n,r?-s:s)},Ot=Ut;var Qt,Jt,Dt=function(e){var t,r;return ge(e)||e<-1||e>1?NaN:1===e?_t:-1===e?Zt:(e<0&&(t=!0,e=-e),e<3.725290298461914e-9?t?-e:e:(r=e<.5?.5*kt((r=e+e)+r*e/(1-e)):.5*kt((e+e)/(1-e)),t?-r:r))},Bt=Dt;!0===ht?(Qt=1,Jt=0):(Qt=0,Jt=1);var At={HIGH:Qt,LOW:Jt},$t=new De(1),qt=new Ne($t.buffer),er=At.HIGH,tr=At.LOW;var rr=function(e,t){return $t[0]=t,e[0]=qt[er],e[1]=qt[tr],e};var sr,nr,ir=function(e,t){return 1===arguments.length?rr([0,0],e):rr(e,t)},or=ir;!0===ht?(sr=1,nr=0):(sr=0,nr=1);var ar={HIGH:sr,LOW:nr},lr=new De(1),cr=new Ne(lr.buffer),dr=ar.HIGH,hr=ar.LOW;var ur=function(e,t){return cr[dr]=e,cr[hr]=t,lr[0]},fr=ur,pr=[0,0];var mr=function(e,t){var r,s;return or(pr,e),r=pr[0],r&=2147483647,s=bt(t),fr(r|=s&=2147483648,pr[1])},br=mr;var yr=function(e){return!!(bt(e)>>>31)},gr=yr,wr=3.141592653589793;var Sr=function(e,t){var r;return ge(t)||ge(e)?NaN:Et(t)?t===_t?Et(e)?br(wr/4,e):br(0,e):Et(e)?br(3*wr/4,e):br(wr,e):Et(e)?br(wr/2,e):0===e?t>=0&&!gr(t)?br(0,e):br(wr,e):0===t?br(wr/2,e):(r=Ot(e/t),t<0?r<=0?r+wr:r-wr:r)},vr=Sr,_r=22250738585072014e-324;var Zr=function(e){return 0===e?1.87595182427177:1.87595182427177+e*(e*(1.6214297201053545+e*(.14599619288661245*e-.758397934778766))-1.8849797954337717)};var Xr=function(e){var t,r,s,n,i;return ge(e)||Et(e)||0===e?e:(r=-2147483648&(s=bt(e)),s&=2147483647,i=0,e<_r?(i=0x40000000000000,t=bt(i*=e),i=fr(r|(t=(2147483647&t)/3+696219795),0)):i=vt(i,r|(t=s/3+715094163)),i*=Zr(n=i*i*(i/e)),t=bt(i),i=fr(t+1,0),i+=i*(n=((n=e/(i*i))-i)/(i+i+n)))},Lr=Xr;var xr=function(e){return 0===e?.0416666666666666:.0416666666666666+e*(2480158728947673e-20*e-.001388888888887411)};var Tr=function(e){return 0===e?-2.7557314351390663e-7:e*(2.087572321298175e-9+-11359647557788195e-27*e)-2.7557314351390663e-7};var kr=function(e,t){var r,s,n,i;return n=(i=e*e)*i,s=i*xr(i),s+=n*n*Tr(i),(n=1-(r=.5*i))+(1-n-r+(i*s-e*t))},Gr=kr,Rr=-.16666666666666632;var Wr=function(e,t){var r,s,n;return r=.00833333333332249+(n=e*e)*(27557313707070068e-22*n-.0001984126982985795)+n*(n*n)*(1.58969099521155e-10*n-2.5050760253406863e-8),s=n*e,0===t?e+s*(Rr+n*r):e-(n*(.5*t-s*r)-t-s*Rr)},Cr=Wr,Pr=!0===ht?0:1,Ir=new De(1),Vr=new Ne(Ir.buffer);var Yr=function(e){return Ir[0]=e,Vr[Pr]},Hr=Yr,Mr=Math.floor;var Er=function(e){return e<0?-e:0===e?0:e},Fr=Er;var Kr=function(e,t){return ge(t)||Et(t)?(e[0]=t,e[1]=0,e):0!==t&&Fr(t)<_r?(e[0]=4503599627370496*t,e[1]=-52,e):(e[0]=t,e[1]=0,e)};var Nr=function(e,t){return 1===arguments.length?Kr([0,0],e):Kr(e,t)},zr=Nr;var jr=function(e){var t=bt(e);return(t=(2146435072&t)>>>20)-1023|0},Ur=jr,Or=[0,0],Qr=[0,0];var Jr=function(e,t){var r,s;return 0===e||ge(e)||Et(e)?e:(zr(Or,e),t+=Or[1],(t+=Ur(e=Or[0]))<-1074?br(0,e):t>1023?e<0?Zt:_t:(t<=-1023?(t+=52,s=2220446049250313e-31):s=1,or(Qr,e),r=Qr[0],r&=2148532223,s*fr(r|=t+1023<<20,Qr[1])))},Dr=Jr,Br=[10680707,7228996,1387004,2578385,16069853,12639074,9804092,4427841,16666979,11263675,12935607,2387514,4345298,14681673,3074569,13734428,16653803,1880361,10960616,8533493,3062596,8710556,7349940,6258241,3772886,3769171,3798172,8675211,12450088,3874808,9961438,366607,15675153,9132554,7151469,3571407,2607881,12013382,4155038,6285869,7677882,13102053,15825725,473591,9065106,15363067,6271263,9264392,5636912,4652155,7056368,13614112,10155062,1944035,9527646,15080200,6658437,6231200,6832269,16767104,5075751,3212806,1398474,7579849,6349435,12618859],Ar=[1.570796251296997,7.549789415861596e-8,5390302529957765e-30,3282003415807913e-37,1270655753080676e-44,12293330898111133e-52,27337005381646456e-60,21674168387780482e-67],$r=5.960464477539063e-8,qr=ss(new Array(20)),es=ss(new Array(20)),ts=ss(new Array(20)),rs=ss(new Array(20));function ss(e){var t,r=e.length;for(t=0;t<r;t++)e[t]=0;return e}function ns(e,t,r,s,n,i,o,a,l){var c,d,h,u,f,p,m,b,y;for(u=i,y=s[r],b=r,f=0;b>0;f++)d=$r*y|0,rs[f]=y-16777216*d|0,y=s[b-1]+d,b-=1;if(y=Dr(y,n),y-=8*Mr(.125*y),y-=m=0|y,h=0,n>0?(m+=f=rs[r-1]>>24-n,rs[r-1]-=f<<24-n,h=rs[r-1]>>23-n):0===n?h=rs[r-1]>>23:y>=.5&&(h=2),h>0){for(m+=1,c=0,f=0;f<r;f++)b=rs[f],0===c?0!==b&&(c=1,rs[f]=16777216-b):rs[f]=16777215-b;if(n>0)switch(n){case 1:rs[r-1]&=8388607;break;case 2:rs[r-1]&=4194303}2===h&&(y=1-y,0!==c&&(y-=Dr(1,n)))}if(0===y){for(b=0,f=r-1;f>=i;f--)b|=rs[f];if(0===b){for(p=1;0===rs[i-p];p++);for(f=r+1;f<=r+p;f++){for(l[a+f]=Br[o+f],d=0,b=0;b<=a;b++)d+=e[b]*l[a+(f-b)];s[f]=d}return ns(e,t,r+=p,s,n,i,o,a,l)}}if(0===y)for(r-=1,n-=24;0===rs[r];)r-=1,n-=24;else(y=Dr(y,-n))>=16777216?(d=$r*y|0,rs[r]=y-16777216*d|0,n+=24,rs[r+=1]=d):rs[r]=0|y;for(d=Dr(1,n),f=r;f>=0;f--)s[f]=d*rs[f],d*=$r;for(f=r;f>=0;f--){for(d=0,p=0;p<=u&&p<=r-f;p++)d+=Ar[p]*s[f+p];ts[r-f]=d}for(d=0,f=r;f>=0;f--)d+=ts[f];for(t[0]=0===h?d:-d,d=ts[0]-d,f=1;f<=r;f++)d+=ts[f];return t[1]=0===h?d:-d,7&m}var is=function(e,t,r,s){var n,i,o,a,l,c,d;for(4,(i=(r-3)/24|0)<0&&(i=0),a=r-24*(i+1),c=i-(o=s-1),d=o+4,l=0;l<=d;l++)qr[l]=c<0?0:Br[c],c+=1;for(l=0;l<=4;l++){for(n=0,c=0;c<=o;c++)n+=e[c]*qr[o+(l-c)];es[l]=n}return 4,ns(e,t,4,es,a,4,i,o,qr)},os=Math.round;var as=function(e,t,r){var s,n,i,o,a;return i=e-1.5707963267341256*(s=os(.6366197723675814*e)),o=6077100506506192e-26*s,a=t>>20|0,r[0]=i-o,a-(bt(r[0])>>20&2047)>16&&(o=20222662487959506e-37*s-((n=i)-(i=n-(o=6077100506303966e-26*s))-o),r[0]=i-o,a-(bt(r[0])>>20&2047)>49&&(o=84784276603689e-45*s-((n=i)-(i=n-(o=20222662487111665e-37*s))-o),r[0]=i-o)),r[1]=i-r[0]-o,s},ls=1.5707963267341256,cs=6077100506506192e-26,ds=2*cs,hs=4*cs,us=new Array(3),fs=new Array(2);var ps=function(e,t){var r,s,n,i,o,a,l;if((n=2147483647&bt(e)|0)<=1072243195)return t[0]=e,t[1]=0,0;if(n<=1074752122)return 598523==(1048575&n)?as(e,n,t):n<=1073928572?e>0?(l=e-ls,t[0]=l-cs,t[1]=l-t[0]-cs,1):(l=e+ls,t[0]=l+cs,t[1]=l-t[0]+cs,-1):e>0?(l=e-2*ls,t[0]=l-ds,t[1]=l-t[0]-ds,2):(l=e+2*ls,t[0]=l+ds,t[1]=l-t[0]+ds,-2);if(n<=1075594811)return n<=1075183036?1074977148===n?as(e,n,t):e>0?(l=e-3*ls,t[0]=l-1.8231301519518578e-10,t[1]=l-t[0]-1.8231301519518578e-10,3):(l=e+3*ls,t[0]=l+1.8231301519518578e-10,t[1]=l-t[0]+1.8231301519518578e-10,-3):1075388923===n?as(e,n,t):e>0?(l=e-4*ls,t[0]=l-hs,t[1]=l-t[0]-hs,4):(l=e+4*ls,t[0]=l+hs,t[1]=l-t[0]+hs,-4);if(n<1094263291)return as(e,n,t);if(n>=2146435072)return t[0]=NaN,t[1]=NaN,0;for(r=Hr(e),l=fr(n-((s=(n>>20)-1046)<<20|0),r),o=0;o<2;o++)us[o]=0|l,l=16777216*(l-us[o]);for(us[2]=l,i=3;0===us[i-1];)i-=1;return a=is(us,fs,s,i),e<0?(t[0]=-fs[0],t[1]=-fs[1],-a):(t[0]=fs[0],t[1]=fs[1],a)},ms=ps,bs=[0,0];var ys=function(e){var t;if(t=bt(e),(t&=2147483647)<=1072243195)return t<1044381696?1:Gr(e,0);if(t>=2146435072)return NaN;switch(3&ms(e,bs)){case 0:return Gr(bs[0],bs[1]);case 1:return-Cr(bs[0],bs[1]);case 2:return-Gr(bs[0],bs[1]);default:return Cr(bs[0],bs[1])}},gs=ys,ws=Math.ceil;var Ss=function(e){return e<0?ws(e):Mr(e)},vs=Ss;var _s=function(e){return 0===e?.16666666666666602:.16666666666666602+e*(e*(6613756321437934e-20+e*(4.1381367970572385e-8*e-16533902205465252e-22))-.0027777777777015593)};var Zs=function(e,t,r){var s,n,i;return i=(s=e-t)-(n=s*s)*_s(n),Dr(1-(t-s*i/(2-i)-e),r)};var Xs=function(e){var t;return ge(e)||e===_t?e:e===Zt?0:e>709.782712893384?_t:e<-745.1332191019411?0:e>-3.725290298461914e-9&&e<3.725290298461914e-9?1+e:(t=vs(e<0?1.4426950408889634*e-.5:1.4426950408889634*e+.5),Zs(e-.6931471803691238*t,1.9082149292705877e-10*t,t))},Ls=Xs;var xs=function(e){return ge(e)?e:(e<0&&(e=-e),e>21?Ls(e)/2:(Ls(e)+Ls(-e))/2)},Ts=xs;var ks=function(e){return 0===e?-.03333333333333313:e*(.0015873015872548146+e*(e*(4008217827329362e-21+-2.0109921818362437e-7*e)-793650757867488e-19))-.03333333333333313},Gs=.6931471803691238,Rs=1.9082149292705877e-10;var Ws=function(e){var t,r,s,n,i,o,a,l,c,d,h,u;if(e===_t||ge(e))return e;if(e===Zt)return-1;if(0===e)return e;if(e<0?(r=!0,a=-e):(r=!1,a=e),a>=38.816242111356935){if(r)return-1;if(a>=709.782712893384)return _t}if(i=0|bt(a),a>.34657359027997264)a<1.0397207708399179?r?(s=e+Gs,n=-Rs,u=-1):(s=e-Gs,n=Rs,u=1):(u=r?1.4426950408889634*e-.5:1.4426950408889634*e+.5,s=e-(d=u|=0)*Gs,n=d*Rs),c=s-(e=s-n)-n;else{if(i<1016070144)return e;u=0}return h=(l=e*(t=.5*e))*(((o=1+l*ks(l))-(d=3-o*t))/(6-e*d)),0===u?e-(e*h-l):(h=e*(h-c)-c,h-=l,-1===u?.5*(e-h)-.5:1===u?e<-.25?-2*(h-(e+.5)):1+2*(e-h):u<=-2||u>56?(s=bt(a=1-(h-e))+(u<<20)|0,(a=vt(a,s))-1):(d=1,u<20?a=(d=vt(d,s=1072693248-(2097152>>u)|0))-(h-e):(a=e-(h+(d=vt(d,s=1023-u<<20|0))),a+=1),s=bt(a)+(u<<20)|0,vt(a,s)))},Cs=Ws,Ps=!0===ht?0:1,Is=new De(1),Vs=new Ne(Is.buffer);var Ys=function(e,t){return Is[0]=e,Vs[Ps]=t>>>0,Is[0]},Hs=Ys;var Ms=function(e){return 0===e?.3999999999940942:.3999999999940942+e*(.22222198432149784+.15313837699209373*e)};var Es=function(e){return 0===e?.6666666666666735:.6666666666666735+e*(.2857142874366239+e*(.1818357216161805+.14798198605116586*e))};var Fs=function(e){var t,r,s,n,i,o,a,l,c,d;return n=e-1,(1048575&2+(s=bt(e)))<3?0===n?0:n*n*(.3333333333333333*n-.5):(c=(s&=1048575)-398458|0,d=440401-s|0,r=(l=(o=(i=n/(2+n))*i)*o)*Ms(l),a=o*Es(l)+r,(c|=d)>0?i*((t=.5*n*n)+a)-t:i*(a-n))};var Ks=function(e){var t,r,s,n,i,o,a;return ge(e)||e<0?NaN:0===e?Zt:(i=0,(r=bt(e))<1048576&&(i-=54,r=bt(e*=0x40000000000000)),r>=2146435072?e+e:(i+=(r>>20)-1023|0,e=vt(e,(r&=1048575)|1072693248^(n=r+614244&1048576|0)),o=i+=n>>20|0,s=Fs(e),a=3694239077158931e-28*o+25082946711645275e-27*((e-=1)+s),(a+=.4342944818781689*(e-(t=Hs(e,0))+s)+.4342944818781689*t)+.30102999566361177*o))},Ns=Ks;var zs=function(e){return 0===e?.3999999999940942:.3999999999940942+e*(.22222198432149784+.15313837699209373*e)};var js=function(e){return 0===e?.6666666666666735:.6666666666666735+e*(.2857142874366239+e*(.1818357216161805+.14798198605116586*e))};var Us=function(e){var t,r,s,n,i,o,a,l,c,d;return n=e-1,(1048575&2+(s=bt(e)))<3?0===n?0:n*n*(.3333333333333333*n-.5):(c=(s&=1048575)-398458|0,d=440401-s|0,r=(l=(o=(i=n/(2+n))*i)*o)*zs(l),a=o*js(l)+r,(c|=d)>0?i*((t=.5*n*n)+a)-t:i*(a-n))},Os=[0,0];var Qs=function(e){var t,r,s,n,i;if(ge(e)||e<0)return NaN;if(or(Os,e),i=0,(r=Os[0])<1048576){if(0==(2147483647&r|Os[1]))return Zt;i-=54,r=bt(e*=0x40000000000000)}return r>=2146435072?e+e:(i+=(r>>20)-1023|0,e=vt(e,(r&=1048575)|1072693248^(n=r+614244&1048576|0)),i+=n>>20|0,s=Us(e),1.6751713164886512e-10*((e-=1)+s)+1.4426950407214463*(e-(t=Hs(e,0))+s)+1.4426950407214463*t+i)},Js=Qs,Ds=[0,0];var Bs=function(e){var t;if(t=bt(e),(t&=2147483647)<=1072243195)return t<1045430272?e:Cr(e,0);if(t>=2146435072)return NaN;switch(3&ms(e,Ds)){case 0:return Cr(Ds[0],Ds[1]);case 1:return Gr(Ds[0],Ds[1]);case 2:return-Cr(Ds[0],Ds[1]);default:return-Gr(Ds[0],Ds[1])}},As=Bs;var $s=function(e){var t,r;return 0===e?.16666666666666666:((e<0?-e:e)<=1?(t=e*(e*(-.789474443963537*e-163.72585752598383)-11561.443576500522)-351754.9648081514,r=e*(36157.827983443196+e*(1*e-277.7110814206028))-2110529.7888489086):(t=(e=1/e)*(e*(-351754.9648081514*e-11561.443576500522)-163.72585752598383)-.789474443963537,r=1+e*(e*(36157.827983443196+-2110529.7888489086*e)-277.7110814206028)),t/r)};var qs=function(e){var t;return 0===e?e:(t=Fr(e),e>710.4758600739439||e<-709.089565712824?e>0?_t:Zt:t>1?t>=709.0895657128241?(t=Ls(.5*t),t*=.5*t,e<0&&(t=-t),t):(t=.5*(t=Ls(t))-.5/t,e<0&&(t=-t),t):e+e*(t*=t)*$s(t))},en=qs;var tn=function(e){return 0===e?.13333333333320124:.13333333333320124+e*(.021869488294859542+e*(.0035920791075913124+e*(.0005880412408202641+e*(7817944429395571e-20+-18558637485527546e-21*e))))};var rn=function(e){return 0===e?.05396825397622605:.05396825397622605+e*(.0088632398235993+e*(.0014562094543252903+e*(.0002464631348184699+e*(7140724913826082e-20+2590730518636337e-20*e))))};var sn=function(e,t,r){var s,n,i,o,a,l,c,d,h;return(n=2147483647&(s=bt(e))|0)>=1072010280&&(e<0&&(e=-e,t=-t),e=(h=.7853981633974483-e)+(d=3061616997868383e-32-t),t=0),o=t+(h=e*e)*((a=h*e)*((o=tn(d=h*h))+(c=h*rn(d)))+t),d=e+(o+=.3333333333333341*a),n>=1072010280?(1-(s>>30&2))*((c=r)-2*(e-(d*d/(d+c)-o))):1===r?d:(Hs(h=d,0),c=o-(h-e),Hs(l=i=-1/d,0),l+i*((a=1+l*h)+l*c))},nn=sn,on=[0,0];var an=function(e){var t,r;return t=bt(e),(t&=2147483647)<=1072243195?t<1044381696?e:nn(e,0,1):t>=2146435072?NaN:(r=ms(e,on),nn(on[0],on[1],1-((1&r)<<1)))},ln=an;var cn=function(e){var t,r;return 0===e?-.3333333333333332:((e<0?-e:e)<=1?(t=e*(e*(0*e-.9643991794250523)-99.28772310019185)-1614.6876844170845,r=4844.063053251255+e*(2235.4883906010045+e*(112.81167849163293+1*e))):(t=0+(e=1/e)*(e*(-1614.6876844170845*e-99.28772310019185)-.9643991794250523),r=1+e*(112.81167849163293+e*(2235.4883906010045+4844.063053251255*e))),t/r)};var dn=function(e){var t,r;if((r=Fr(e))>44.014845965556525)return e<0?-1:1;if(r>=.625)r=1-2/((t=Ls(2*r))+1),e<0&&(r=-r);else{if(0===e)return e;r=e+e*(t=e*e)*cn(t)}return r},hn=dn;void 0===globalThis.CroquetMath&&(globalThis.CroquetMath={}),Object.assign(globalThis.CroquetMath,{acos:xe,acosh:Ht,asin:Xe,asinh:Kt,atan:Ot,atanh:Bt,atan2:vr,cbrt:Lr,cos:gs,cosh:Ts,exp:Ls,expm1:Cs,log:Vt,log1p:kt,log10:Ns,log2:Js,sin:As,sinh:en,tan:ln,tanh:hn});const un=Math.pow;function fn(e){return e===1/0||e===-1/0}globalThis.CroquetMath.pow=(e,t)=>{if(isNaN(e)||isNaN(t))return NaN;if(fn(e)||fn(t))return un(e,t);if(0===e||0===t)return un(e,t);if(e<0&&!function(e){return Number.isInteger(e)}(t))return NaN;if(1===t)return e;if(2===t)return e*e;if(3===t)return e*e*e;if(4===t)return e*e*e*e;let r=1;e<0&&(e*=-1,r=un(-1,t));return globalThis.CroquetMath.exp(globalThis.CroquetMath.log(e)*t)*r};var pn=function(e,t){return e<t};function mn(e){if(!(this instanceof mn))return new mn(e);this.array=[],this.size=0,this.compare=e||pn}mn.prototype.clone=function(){var e=new mn(this.compare);return e.size=this.size,e.array=this.array.slice(0,this.size),e},mn.prototype.add=function(e){var t,r,s=this.size;for(this.array[this.size]=e,this.size+=1;s>0&&(t=s-1>>1,r=this.array[t],this.compare(e,r));)this.array[s]=r,s=t;this.array[s]=e},mn.prototype.heapify=function(e){var t;for(this.array=e,this.size=e.length,t=this.size>>1;t>=0;t--)this._percolateDown(t)},mn.prototype._percolateUp=function(e,t){for(var r,s,n=this.array[e];e>0&&(r=e-1>>1,s=this.array[r],t||this.compare(n,s));)this.array[e]=s,e=r;this.array[e]=n},mn.prototype._percolateDown=function(e){for(var t,r,s,n=this.size,i=this.size>>>1,o=this.array[e];e<i&&(r=(t=1+(e<<1))+1,s=this.array[t],r<n&&this.compare(this.array[r],s)&&(t=r,s=this.array[r]),this.compare(s,o));)this.array[e]=s,e=t;this.array[e]=o},mn.prototype._removeAt=function(e){if(!(e>this.size-1||e<0))return this._percolateUp(e,!0),this.poll()},mn.prototype.remove=function(e){for(var t=0;t<this.size;t++)if(!this.compare(this.array[t],e)&&!this.compare(e,this.array[t]))return this._removeAt(t),!0;return!1},mn.prototype.removeOne=function(e){if(\"function\"==typeof e)for(var t=0;t<this.size;t++)if(e(this.array[t]))return this._removeAt(t)},mn.prototype.removeMany=function(e,t){if(\"function\"!=typeof e||this.size<1)return[];t=t?Math.min(t,this.size):this.size;for(var r=0,s=new Array(t),n=0,i=new Array(this.size);r<t&&!this.isEmpty();){var o=this.poll();e(o)?s[r++]=o:i[n++]=o}s.length=r;for(var a=0;a<n;)this.add(i[a++]);return s},mn.prototype.peek=function(){if(0!=this.size)return this.array[0]},mn.prototype.poll=function(){if(0!=this.size){var e=this.array[0];return this.size>1?(this.array[0]=this.array[--this.size],this._percolateDown(0)):this.size-=1,e}},mn.prototype.replaceTop=function(e){if(0!=this.size){var t=this.array[0];return this.array[0]=e,this._percolateDown(0),t}},mn.prototype.trim=function(){this.array=this.array.slice(0,this.size)},mn.prototype.isEmpty=function(){return 0===this.size},mn.prototype.forEach=function(e){if(!this.isEmpty()&&\"function\"==typeof e)for(var t=0,r=this.clone();!r.isEmpty();)e(r.poll(),t++)},mn.prototype.kSmallest=function(e){if(0==this.size)return[];e=Math.min(this.size,e);var t=new mn(this.compare);const r=Math.min((e>0?Math.pow(2,e-1):0)+1,this.size);t.size=r,t.array=this.array.slice(0,r);for(var s=new Array(e),n=0;n<e;n++)s[n]=t.poll();return s};var bn=mn;class yn extends bn{poll(){const e=super.poll();return this.array[this.size]=null,e}asArray(){const e=[];return this.forEach((t=>e.push(t))),e}asUnsortedArray(){return this.array.slice(0,this.size)}}let gn=!1,wn=vn(0),Sn={};function vn(e){return{start:e,total:0,items:{},users:0,backlog:0,network:0,latency:0,activity:1e3,connected:gn}}const _n=[],Zn={},Xn={animationFrame(e,t={}){!function(e){wn.total=e-wn.start}(e),wn=vn(e);for(const[e,r]of Object.entries(t))this[e](r)},begin(e){const t=performance.now();wn.items[e]=(wn.items[e]||0)-t;const r=_n[_n.length-1];return r&&(wn.items[r]+=t),_n.push(e),t},end(e){const t=performance.now();wn.items[e]+=t;const r=_n.pop();if(r!==e)throw Error(`Unmatched stats calls: expected end(\"${r}\"), got end(\"${e}\")`);const s=_n[_n.length-1];return s&&(wn.items[s]-=t),t},backlog(e){wn.backlog=Math.max(e,wn.backlog)},network(e){wn.network=e},starvation(e){wn.network=e},latency(e){wn.latency=e},activity(e){wn.activity=e},users(e){wn.users=e},connected(e){wn.connected=gn=e},networkTraffic:Zn,addNetworkTraffic(e,t){Zn[e]=(Zn[e]||0)+t},perSecondTally(e={}){if(globalThis.logMessageStats)for(const[t,r]of Object.entries(e))Sn[t]=(Sn[t]||0)+r},stepSession(e,t=!1){const r=Math.floor(Date.now()/1e3);if(!globalThis.logMessageStats)return Sn={second:r},null;let s=null;if(r!==Sn.second){if(Sn.second&&t&&(Sn.requestedMessages||Sn.sentMessagesTotal)){s={...Sn};const e=r-Sn.second;1!==e&&(s.sampleSeconds=e),s.sentBundles&&(s.averageDelay=Math.round(10*s.sendDelay/s.sentMessagesTotal)/10,s.averageBundlePayload=Math.round(s.sentBundlePayload/s.sentBundles)),delete s.second,delete s.sendDelay,delete s.sentBundlePayload}Sn={second:r}}return s}};var Ln={exports:{}},xn=Ln.exports=function(e){return function(){var t=e,r=t.lib.WordArray;function s(e,t,s){for(var n=[],i=0,o=0;o<t;o++)if(o%4){var a=s[e.charCodeAt(o-1)]<<o%4*2|s[e.charCodeAt(o)]>>>6-o%4*2;n[i>>>2]|=a<<24-i%4*8,i++}return r.create(n,i)}t.enc.Base64={stringify:function(e){var t=e.words,r=e.sigBytes,s=this._map;e.clamp();for(var n=[],i=0;i<r;i+=3)for(var o=(t[i>>>2]>>>24-i%4*8&255)<<16|(t[i+1>>>2]>>>24-(i+1)%4*8&255)<<8|t[i+2>>>2]>>>24-(i+2)%4*8&255,a=0;a<4&&i+.75*a<r;a++)n.push(s.charAt(o>>>6*(3-a)&63));var l=s.charAt(64);if(l)for(;n.length%4;)n.push(l);return n.join(\"\")},parse:function(e){var t=e.length,r=this._map,n=this._reverseMap;if(!n){n=this._reverseMap=[];for(var i=0;i<r.length;i++)n[r.charCodeAt(i)]=i}var o=r.charAt(64);if(o){var a=e.indexOf(o);-1!==a&&(t=a)}return s(e,t,n)},_map:\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\"}}(),e.enc.Base64}(K.exports),Tn={exports:{}},kn=Tn.exports=function(e){return e.enc.Utf8}(K.exports),Gn={exports:{}},Rn={exports:{}};Rn.exports=function(e){return function(){var t=e,r=t.lib,s=r.WordArray,n=r.Hasher,i=t.algo,o=[],a=i.SHA1=n.extend({_doReset:function(){this._hash=new s.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var r=this._hash.words,s=r[0],n=r[1],i=r[2],a=r[3],l=r[4],c=0;c<80;c++){if(c<16)o[c]=0|e[t+c];else{var d=o[c-3]^o[c-8]^o[c-14]^o[c-16];o[c]=d<<1|d>>>31}var h=(s<<5|s>>>27)+l+o[c];h+=c<20?1518500249+(n&i|~n&a):c<40?1859775393+(n^i^a):c<60?(n&i|n&a|i&a)-1894007588:(n^i^a)-899497514,l=a,a=i,i=n<<30|n>>>2,n=s,s=h}r[0]=r[0]+s|0,r[1]=r[1]+n|0,r[2]=r[2]+i|0,r[3]=r[3]+a|0,r[4]=r[4]+l|0},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,s=8*e.sigBytes;return t[s>>>5]|=128<<24-s%32,t[14+(s+64>>>9<<4)]=Math.floor(r/4294967296),t[15+(s+64>>>9<<4)]=r,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=n.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA1=n._createHelper(a),t.HmacSHA1=n._createHmacHelper(a)}(),e.SHA1}(K.exports);var Wn={exports:{}};Wn.exports=function(e){!function(){var t=e,r=t.lib.Base,s=t.enc.Utf8;t.algo.HMAC=r.extend({init:function(e,t){e=this._hasher=new e.init,\"string\"==typeof t&&(t=s.parse(t));var r=e.blockSize,n=4*r;t.sigBytes>n&&(t=e.finalize(t)),t.clamp();for(var i=this._oKey=t.clone(),o=this._iKey=t.clone(),a=i.words,l=o.words,c=0;c<r;c++)a[c]^=1549556828,l[c]^=909522486;i.sigBytes=o.sigBytes=n,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,r=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(r))}})}()}(K.exports);var Cn=Gn.exports=function(e){return function(){var t=e,r=t.lib,s=r.Base,n=r.WordArray,i=t.algo,o=i.SHA1,a=i.HMAC,l=i.PBKDF2=s.extend({cfg:s.extend({keySize:4,hasher:o,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var r=this.cfg,s=a.create(r.hasher,e),i=n.create(),o=n.create([1]),l=i.words,c=o.words,d=r.keySize,h=r.iterations;l.length<d;){var u=s.update(t).finalize(o);s.reset();for(var f=u.words,p=f.length,m=u,b=1;b<h;b++){m=s.finalize(m),s.reset();for(var y=m.words,g=0;g<p;g++)f[g]^=y[g]}i.concat(u),c[0]++}return i.sigBytes=4*d,i}});t.PBKDF2=function(e,t,r){return l.create(r).compute(e,t)}}(),e.PBKDF2}(K.exports),Pn={exports:{}},In={exports:{}};In.exports=function(e){return function(t){var r=e,s=r.lib,n=s.WordArray,i=s.Hasher,o=r.algo,a=[];!function(){for(var e=0;e<64;e++)a[e]=4294967296*t.abs(t.sin(e+1))|0}();var l=o.MD5=i.extend({_doReset:function(){this._hash=new n.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var r=0;r<16;r++){var s=t+r,n=e[s];e[s]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8)}var i=this._hash.words,o=e[t+0],l=e[t+1],f=e[t+2],p=e[t+3],m=e[t+4],b=e[t+5],y=e[t+6],g=e[t+7],w=e[t+8],S=e[t+9],v=e[t+10],_=e[t+11],Z=e[t+12],X=e[t+13],L=e[t+14],x=e[t+15],T=i[0],k=i[1],G=i[2],R=i[3];T=c(T,k,G,R,o,7,a[0]),R=c(R,T,k,G,l,12,a[1]),G=c(G,R,T,k,f,17,a[2]),k=c(k,G,R,T,p,22,a[3]),T=c(T,k,G,R,m,7,a[4]),R=c(R,T,k,G,b,12,a[5]),G=c(G,R,T,k,y,17,a[6]),k=c(k,G,R,T,g,22,a[7]),T=c(T,k,G,R,w,7,a[8]),R=c(R,T,k,G,S,12,a[9]),G=c(G,R,T,k,v,17,a[10]),k=c(k,G,R,T,_,22,a[11]),T=c(T,k,G,R,Z,7,a[12]),R=c(R,T,k,G,X,12,a[13]),G=c(G,R,T,k,L,17,a[14]),T=d(T,k=c(k,G,R,T,x,22,a[15]),G,R,l,5,a[16]),R=d(R,T,k,G,y,9,a[17]),G=d(G,R,T,k,_,14,a[18]),k=d(k,G,R,T,o,20,a[19]),T=d(T,k,G,R,b,5,a[20]),R=d(R,T,k,G,v,9,a[21]),G=d(G,R,T,k,x,14,a[22]),k=d(k,G,R,T,m,20,a[23]),T=d(T,k,G,R,S,5,a[24]),R=d(R,T,k,G,L,9,a[25]),G=d(G,R,T,k,p,14,a[26]),k=d(k,G,R,T,w,20,a[27]),T=d(T,k,G,R,X,5,a[28]),R=d(R,T,k,G,f,9,a[29]),G=d(G,R,T,k,g,14,a[30]),T=h(T,k=d(k,G,R,T,Z,20,a[31]),G,R,b,4,a[32]),R=h(R,T,k,G,w,11,a[33]),G=h(G,R,T,k,_,16,a[34]),k=h(k,G,R,T,L,23,a[35]),T=h(T,k,G,R,l,4,a[36]),R=h(R,T,k,G,m,11,a[37]),G=h(G,R,T,k,g,16,a[38]),k=h(k,G,R,T,v,23,a[39]),T=h(T,k,G,R,X,4,a[40]),R=h(R,T,k,G,o,11,a[41]),G=h(G,R,T,k,p,16,a[42]),k=h(k,G,R,T,y,23,a[43]),T=h(T,k,G,R,S,4,a[44]),R=h(R,T,k,G,Z,11,a[45]),G=h(G,R,T,k,x,16,a[46]),T=u(T,k=h(k,G,R,T,f,23,a[47]),G,R,o,6,a[48]),R=u(R,T,k,G,g,10,a[49]),G=u(G,R,T,k,L,15,a[50]),k=u(k,G,R,T,b,21,a[51]),T=u(T,k,G,R,Z,6,a[52]),R=u(R,T,k,G,p,10,a[53]),G=u(G,R,T,k,v,15,a[54]),k=u(k,G,R,T,l,21,a[55]),T=u(T,k,G,R,w,6,a[56]),R=u(R,T,k,G,x,10,a[57]),G=u(G,R,T,k,y,15,a[58]),k=u(k,G,R,T,X,21,a[59]),T=u(T,k,G,R,m,6,a[60]),R=u(R,T,k,G,_,10,a[61]),G=u(G,R,T,k,f,15,a[62]),k=u(k,G,R,T,S,21,a[63]),i[0]=i[0]+T|0,i[1]=i[1]+k|0,i[2]=i[2]+G|0,i[3]=i[3]+R|0},_doFinalize:function(){var e=this._data,r=e.words,s=8*this._nDataBytes,n=8*e.sigBytes;r[n>>>5]|=128<<24-n%32;var i=t.floor(s/4294967296),o=s;r[15+(n+64>>>9<<4)]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8),r[14+(n+64>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),e.sigBytes=4*(r.length+1),this._process();for(var a=this._hash,l=a.words,c=0;c<4;c++){var d=l[c];l[c]=16711935&(d<<8|d>>>24)|4278255360&(d<<24|d>>>8)}return a},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}});function c(e,t,r,s,n,i,o){var a=e+(t&r|~t&s)+n+o;return(a<<i|a>>>32-i)+t}function d(e,t,r,s,n,i,o){var a=e+(t&s|r&~s)+n+o;return(a<<i|a>>>32-i)+t}function h(e,t,r,s,n,i,o){var a=e+(t^r^s)+n+o;return(a<<i|a>>>32-i)+t}function u(e,t,r,s,n,i,o){var a=e+(r^(t|~s))+n+o;return(a<<i|a>>>32-i)+t}r.MD5=i._createHelper(l),r.HmacMD5=i._createHmacHelper(l)}(Math),e.MD5}(K.exports);var Vn={exports:{}};Vn.exports=function(e){return function(){var t=e,r=t.lib,s=r.Base,n=r.WordArray,i=t.algo,o=i.MD5,a=i.EvpKDF=s.extend({cfg:s.extend({keySize:4,hasher:o,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var r,s=this.cfg,i=s.hasher.create(),o=n.create(),a=o.words,l=s.keySize,c=s.iterations;a.length<l;){r&&i.update(r),r=i.update(e).finalize(t),i.reset();for(var d=1;d<c;d++)r=i.finalize(r),i.reset();o.concat(r)}return o.sigBytes=4*l,o}});t.EvpKDF=function(e,t,r){return a.create(r).compute(e,t)}}(),e.EvpKDF}(K.exports);var Yn={exports:{}};Yn.exports=function(e){e.lib.Cipher||function(t){var r=e,s=r.lib,n=s.Base,i=s.WordArray,o=s.BufferedBlockAlgorithm,a=r.enc;a.Utf8;var l=a.Base64,c=r.algo.EvpKDF,d=s.Cipher=o.extend({cfg:n.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,r){this.cfg=this.cfg.extend(r),this._xformMode=e,this._key=t,this.reset()},reset:function(){o.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function e(e){return\"string\"==typeof e?w:y}return function(t){return{encrypt:function(r,s,n){return e(s).encrypt(t,r,s,n)},decrypt:function(r,s,n){return e(s).decrypt(t,r,s,n)}}}}()});s.StreamCipher=d.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var h=r.mode={},u=s.BlockCipherMode=n.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}}),f=h.CBC=function(){var e=u.extend();function r(e,r,s){var n,i=this._iv;i?(n=i,this._iv=t):n=this._prevBlock;for(var o=0;o<s;o++)e[r+o]^=n[o]}return e.Encryptor=e.extend({processBlock:function(e,t){var s=this._cipher,n=s.blockSize;r.call(this,e,t,n),s.encryptBlock(e,t),this._prevBlock=e.slice(t,t+n)}}),e.Decryptor=e.extend({processBlock:function(e,t){var s=this._cipher,n=s.blockSize,i=e.slice(t,t+n);s.decryptBlock(e,t),r.call(this,e,t,n),this._prevBlock=i}}),e}(),p=(r.pad={}).Pkcs7={pad:function(e,t){for(var r=4*t,s=r-e.sigBytes%r,n=s<<24|s<<16|s<<8|s,o=[],a=0;a<s;a+=4)o.push(n);var l=i.create(o,s);e.concat(l)},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}};s.BlockCipher=d.extend({cfg:d.cfg.extend({mode:f,padding:p}),reset:function(){var e;d.reset.call(this);var t=this.cfg,r=t.iv,s=t.mode;this._xformMode==this._ENC_XFORM_MODE?e=s.createEncryptor:(e=s.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==e?this._mode.init(this,r&&r.words):(this._mode=e.call(s,this,r&&r.words),this._mode.__creator=e)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e,t=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(t.pad(this._data,this.blockSize),e=this._process(!0)):(e=this._process(!0),t.unpad(e)),e},blockSize:4});var m=s.CipherParams=n.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),b=(r.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext,r=e.salt;return(r?i.create([1398893684,1701076831]).concat(r).concat(t):t).toString(l)},parse:function(e){var t,r=l.parse(e),s=r.words;return 1398893684==s[0]&&1701076831==s[1]&&(t=i.create(s.slice(2,4)),s.splice(0,4),r.sigBytes-=16),m.create({ciphertext:r,salt:t})}},y=s.SerializableCipher=n.extend({cfg:n.extend({format:b}),encrypt:function(e,t,r,s){s=this.cfg.extend(s);var n=e.createEncryptor(r,s),i=n.finalize(t),o=n.cfg;return m.create({ciphertext:i,key:r,iv:o.iv,algorithm:e,mode:o.mode,padding:o.padding,blockSize:e.blockSize,formatter:s.format})},decrypt:function(e,t,r,s){return s=this.cfg.extend(s),t=this._parse(t,s.format),e.createDecryptor(r,s).finalize(t.ciphertext)},_parse:function(e,t){return\"string\"==typeof e?t.parse(e,this):e}}),g=(r.kdf={}).OpenSSL={execute:function(e,t,r,s){s||(s=i.random(8));var n=c.create({keySize:t+r}).compute(e,s),o=i.create(n.words.slice(t),4*r);return n.sigBytes=4*t,m.create({key:n,iv:o,salt:s})}},w=s.PasswordBasedCipher=y.extend({cfg:y.cfg.extend({kdf:g}),encrypt:function(e,t,r,s){var n=(s=this.cfg.extend(s)).kdf.execute(r,e.keySize,e.ivSize);s.iv=n.iv;var i=y.encrypt.call(this,e,t,n.key,s);return i.mixIn(n),i},decrypt:function(e,t,r,s){s=this.cfg.extend(s),t=this._parse(t,s.format);var n=s.kdf.execute(r,e.keySize,e.ivSize,t.salt);return s.iv=n.iv,y.decrypt.call(this,e,t,n.key,s)}})}()}(K.exports);var Hn=Pn.exports=function(e){return function(){var t=e,r=t.lib.BlockCipher,s=t.algo,n=[],i=[],o=[],a=[],l=[],c=[],d=[],h=[],u=[],f=[];!function(){for(var e=[],t=0;t<256;t++)e[t]=t<128?t<<1:t<<1^283;var r=0,s=0;for(t=0;t<256;t++){var p=s^s<<1^s<<2^s<<3^s<<4;p=p>>>8^255&p^99,n[r]=p,i[p]=r;var m=e[r],b=e[m],y=e[b],g=257*e[p]^16843008*p;o[r]=g<<24|g>>>8,a[r]=g<<16|g>>>16,l[r]=g<<8|g>>>24,c[r]=g,g=16843009*y^65537*b^257*m^16843008*r,d[p]=g<<24|g>>>8,h[p]=g<<16|g>>>16,u[p]=g<<8|g>>>24,f[p]=g,r?(r=m^e[e[e[y^m]]],s^=e[e[s]]):r=s=1}}();var p=[0,1,2,4,8,16,32,64,128,27,54],m=s.AES=r.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var e=this._keyPriorReset=this._key,t=e.words,r=e.sigBytes/4,s=4*((this._nRounds=r+6)+1),i=this._keySchedule=[],o=0;o<s;o++)o<r?i[o]=t[o]:(c=i[o-1],o%r?r>6&&o%r==4&&(c=n[c>>>24]<<24|n[c>>>16&255]<<16|n[c>>>8&255]<<8|n[255&c]):(c=n[(c=c<<8|c>>>24)>>>24]<<24|n[c>>>16&255]<<16|n[c>>>8&255]<<8|n[255&c],c^=p[o/r|0]<<24),i[o]=i[o-r]^c);for(var a=this._invKeySchedule=[],l=0;l<s;l++){if(o=s-l,l%4)var c=i[o];else c=i[o-4];a[l]=l<4||o<=4?c:d[n[c>>>24]]^h[n[c>>>16&255]]^u[n[c>>>8&255]]^f[n[255&c]]}}},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,o,a,l,c,n)},decryptBlock:function(e,t){var r=e[t+1];e[t+1]=e[t+3],e[t+3]=r,this._doCryptBlock(e,t,this._invKeySchedule,d,h,u,f,i),r=e[t+1],e[t+1]=e[t+3],e[t+3]=r},_doCryptBlock:function(e,t,r,s,n,i,o,a){for(var l=this._nRounds,c=e[t]^r[0],d=e[t+1]^r[1],h=e[t+2]^r[2],u=e[t+3]^r[3],f=4,p=1;p<l;p++){var m=s[c>>>24]^n[d>>>16&255]^i[h>>>8&255]^o[255&u]^r[f++],b=s[d>>>24]^n[h>>>16&255]^i[u>>>8&255]^o[255&c]^r[f++],y=s[h>>>24]^n[u>>>16&255]^i[c>>>8&255]^o[255&d]^r[f++],g=s[u>>>24]^n[c>>>16&255]^i[d>>>8&255]^o[255&h]^r[f++];c=m,d=b,h=y,u=g}m=(a[c>>>24]<<24|a[d>>>16&255]<<16|a[h>>>8&255]<<8|a[255&u])^r[f++],b=(a[d>>>24]<<24|a[h>>>16&255]<<16|a[u>>>8&255]<<8|a[255&c])^r[f++],y=(a[h>>>24]<<24|a[u>>>16&255]<<16|a[c>>>8&255]<<8|a[255&d])^r[f++],g=(a[u>>>24]<<24|a[c>>>16&255]<<16|a[d>>>8&255]<<8|a[255&h])^r[f++],e[t]=m,e[t+1]=b,e[t+2]=y,e[t+3]=g},keySize:8});t.AES=r._createHelper(m)}(),e.AES}(K.exports),Mn={exports:{}},En=Mn.exports=function(e){return e.HmacSHA256}(K.exports);function Fn(e){let t=e.length;for(;--t>=0;)e[t]=0}const Kn=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Nn=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),zn=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),jn=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Un=new Array(576);Fn(Un);const On=new Array(60);Fn(On);const Qn=new Array(512);Fn(Qn);const Jn=new Array(256);Fn(Jn);const Dn=new Array(29);Fn(Dn);const Bn=new Array(30);function An(e,t,r,s,n){this.static_tree=e,this.extra_bits=t,this.extra_base=r,this.elems=s,this.max_length=n,this.has_stree=e&&e.length}let $n,qn,ei;function ti(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}Fn(Bn);const ri=e=>e<256?Qn[e]:Qn[256+(e>>>7)],si=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},ni=(e,t,r)=>{e.bi_valid>16-r?(e.bi_buf|=t<<e.bi_valid&65535,si(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=r-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=r)},ii=(e,t,r)=>{ni(e,r[2*t],r[2*t+1])},oi=(e,t)=>{let r=0;do{r|=1&e,e>>>=1,r<<=1}while(--t>0);return r>>>1},ai=(e,t,r)=>{const s=new Array(16);let n,i,o=0;for(n=1;n<=15;n++)s[n]=o=o+r[n-1]<<1;for(i=0;i<=t;i++){let t=e[2*i+1];0!==t&&(e[2*i]=oi(s[t]++,t))}},li=e=>{let t;for(t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0},ci=e=>{e.bi_valid>8?si(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},di=(e,t,r,s)=>{const n=2*t,i=2*r;return e[n]<e[i]||e[n]===e[i]&&s[t]<=s[r]},hi=(e,t,r)=>{const s=e.heap[r];let n=r<<1;for(;n<=e.heap_len&&(n<e.heap_len&&di(t,e.heap[n+1],e.heap[n],e.depth)&&n++,!di(t,s,e.heap[n],e.depth));)e.heap[r]=e.heap[n],r=n,n<<=1;e.heap[r]=s},ui=(e,t,r)=>{let s,n,i,o,a=0;if(0!==e.last_lit)do{s=e.pending_buf[e.d_buf+2*a]<<8|e.pending_buf[e.d_buf+2*a+1],n=e.pending_buf[e.l_buf+a],a++,0===s?ii(e,n,t):(i=Jn[n],ii(e,i+256+1,t),o=Kn[i],0!==o&&(n-=Dn[i],ni(e,n,o)),s--,i=ri(s),ii(e,i,r),o=Nn[i],0!==o&&(s-=Bn[i],ni(e,s,o)))}while(a<e.last_lit);ii(e,256,t)},fi=(e,t)=>{const r=t.dyn_tree,s=t.stat_desc.static_tree,n=t.stat_desc.has_stree,i=t.stat_desc.elems;let o,a,l,c=-1;for(e.heap_len=0,e.heap_max=573,o=0;o<i;o++)0!==r[2*o]?(e.heap[++e.heap_len]=c=o,e.depth[o]=0):r[2*o+1]=0;for(;e.heap_len<2;)l=e.heap[++e.heap_len]=c<2?++c:0,r[2*l]=1,e.depth[l]=0,e.opt_len--,n&&(e.static_len-=s[2*l+1]);for(t.max_code=c,o=e.heap_len>>1;o>=1;o--)hi(e,r,o);l=i;do{o=e.heap[1],e.heap[1]=e.heap[e.heap_len--],hi(e,r,1),a=e.heap[1],e.heap[--e.heap_max]=o,e.heap[--e.heap_max]=a,r[2*l]=r[2*o]+r[2*a],e.depth[l]=(e.depth[o]>=e.depth[a]?e.depth[o]:e.depth[a])+1,r[2*o+1]=r[2*a+1]=l,e.heap[1]=l++,hi(e,r,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const r=t.dyn_tree,s=t.max_code,n=t.stat_desc.static_tree,i=t.stat_desc.has_stree,o=t.stat_desc.extra_bits,a=t.stat_desc.extra_base,l=t.stat_desc.max_length;let c,d,h,u,f,p,m=0;for(u=0;u<=15;u++)e.bl_count[u]=0;for(r[2*e.heap[e.heap_max]+1]=0,c=e.heap_max+1;c<573;c++)d=e.heap[c],u=r[2*r[2*d+1]+1]+1,u>l&&(u=l,m++),r[2*d+1]=u,d>s||(e.bl_count[u]++,f=0,d>=a&&(f=o[d-a]),p=r[2*d],e.opt_len+=p*(u+f),i&&(e.static_len+=p*(n[2*d+1]+f)));if(0!==m){do{for(u=l-1;0===e.bl_count[u];)u--;e.bl_count[u]--,e.bl_count[u+1]+=2,e.bl_count[l]--,m-=2}while(m>0);for(u=l;0!==u;u--)for(d=e.bl_count[u];0!==d;)h=e.heap[--c],h>s||(r[2*h+1]!==u&&(e.opt_len+=(u-r[2*h+1])*r[2*h],r[2*h+1]=u),d--)}})(e,t),ai(r,c,e.bl_count)},pi=(e,t,r)=>{let s,n,i=-1,o=t[1],a=0,l=7,c=4;for(0===o&&(l=138,c=3),t[2*(r+1)+1]=65535,s=0;s<=r;s++)n=o,o=t[2*(s+1)+1],++a<l&&n===o||(a<c?e.bl_tree[2*n]+=a:0!==n?(n!==i&&e.bl_tree[2*n]++,e.bl_tree[32]++):a<=10?e.bl_tree[34]++:e.bl_tree[36]++,a=0,i=n,0===o?(l=138,c=3):n===o?(l=6,c=3):(l=7,c=4))},mi=(e,t,r)=>{let s,n,i=-1,o=t[1],a=0,l=7,c=4;for(0===o&&(l=138,c=3),s=0;s<=r;s++)if(n=o,o=t[2*(s+1)+1],!(++a<l&&n===o)){if(a<c)do{ii(e,n,e.bl_tree)}while(0!=--a);else 0!==n?(n!==i&&(ii(e,n,e.bl_tree),a--),ii(e,16,e.bl_tree),ni(e,a-3,2)):a<=10?(ii(e,17,e.bl_tree),ni(e,a-3,3)):(ii(e,18,e.bl_tree),ni(e,a-11,7));a=0,i=n,0===o?(l=138,c=3):n===o?(l=6,c=3):(l=7,c=4)}};let bi=!1;const yi=(e,t,r,s)=>{ni(e,0+(s?1:0),3),((e,t,r,s)=>{ci(e),s&&(si(e,r),si(e,~r)),e.pending_buf.set(e.window.subarray(t,t+r),e.pending),e.pending+=r})(e,t,r,!0)};var gi=e=>{bi||((()=>{let e,t,r,s,n;const i=new Array(16);for(r=0,s=0;s<28;s++)for(Dn[s]=r,e=0;e<1<<Kn[s];e++)Jn[r++]=s;for(Jn[r-1]=s,n=0,s=0;s<16;s++)for(Bn[s]=n,e=0;e<1<<Nn[s];e++)Qn[n++]=s;for(n>>=7;s<30;s++)for(Bn[s]=n<<7,e=0;e<1<<Nn[s]-7;e++)Qn[256+n++]=s;for(t=0;t<=15;t++)i[t]=0;for(e=0;e<=143;)Un[2*e+1]=8,e++,i[8]++;for(;e<=255;)Un[2*e+1]=9,e++,i[9]++;for(;e<=279;)Un[2*e+1]=7,e++,i[7]++;for(;e<=287;)Un[2*e+1]=8,e++,i[8]++;for(ai(Un,287,i),e=0;e<30;e++)On[2*e+1]=5,On[2*e]=oi(e,5);$n=new An(Un,Kn,257,286,15),qn=new An(On,Nn,0,30,15),ei=new An(new Array(0),zn,0,19,7)})(),bi=!0),e.l_desc=new ti(e.dyn_ltree,$n),e.d_desc=new ti(e.dyn_dtree,qn),e.bl_desc=new ti(e.bl_tree,ei),e.bi_buf=0,e.bi_valid=0,li(e)},wi=(e,t,r,s)=>{let n,i,o=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,r=4093624447;for(t=0;t<=31;t++,r>>>=1)if(1&r&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<256;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),fi(e,e.l_desc),fi(e,e.d_desc),o=(e=>{let t;for(pi(e,e.dyn_ltree,e.l_desc.max_code),pi(e,e.dyn_dtree,e.d_desc.max_code),fi(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*jn[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),n=e.opt_len+3+7>>>3,i=e.static_len+3+7>>>3,i<=n&&(n=i)):n=i=r+5,r+4<=n&&-1!==t?yi(e,t,r,s):4===e.strategy||i===n?(ni(e,2+(s?1:0),3),ui(e,Un,On)):(ni(e,4+(s?1:0),3),((e,t,r,s)=>{let n;for(ni(e,t-257,5),ni(e,r-1,5),ni(e,s-4,4),n=0;n<s;n++)ni(e,e.bl_tree[2*jn[n]+1],3);mi(e,e.dyn_ltree,t-1),mi(e,e.dyn_dtree,r-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),ui(e,e.dyn_ltree,e.dyn_dtree)),li(e),s&&ci(e)},Si=(e,t,r)=>(e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&r,e.last_lit++,0===t?e.dyn_ltree[2*r]++:(e.matches++,t--,e.dyn_ltree[2*(Jn[r]+256+1)]++,e.dyn_dtree[2*ri(t)]++),e.last_lit===e.lit_bufsize-1),vi=e=>{ni(e,2,3),ii(e,256,Un),(e=>{16===e.bi_valid?(si(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)},_i={_tr_init:gi,_tr_stored_block:yi,_tr_flush_block:wi,_tr_tally:Si,_tr_align:vi};var Zi=(e,t,r,s)=>{let n=65535&e|0,i=e>>>16&65535|0,o=0;for(;0!==r;){o=r>2e3?2e3:r,r-=o;do{n=n+t[s++]|0,i=i+n|0}while(--o);n%=65521,i%=65521}return n|i<<16|0};const Xi=new Uint32Array((()=>{let e,t=[];for(var r=0;r<256;r++){e=r;for(var s=0;s<8;s++)e=1&e?3988292384^e>>>1:e>>>1;t[r]=e}return t})());var Li=(e,t,r,s)=>{const n=Xi,i=s+r;e^=-1;for(let r=s;r<i;r++)e=e>>>8^n[255&(e^t[r])];return-1^e},xi={2:\"need dictionary\",1:\"stream end\",0:\"\",\"-1\":\"file error\",\"-2\":\"stream error\",\"-3\":\"data error\",\"-4\":\"insufficient memory\",\"-5\":\"buffer error\",\"-6\":\"incompatible version\"},Ti={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:ki,_tr_stored_block:Gi,_tr_flush_block:Ri,_tr_tally:Wi,_tr_align:Ci}=_i,{Z_NO_FLUSH:Pi,Z_PARTIAL_FLUSH:Ii,Z_FULL_FLUSH:Vi,Z_FINISH:Yi,Z_BLOCK:Hi,Z_OK:Mi,Z_STREAM_END:Ei,Z_STREAM_ERROR:Fi,Z_DATA_ERROR:Ki,Z_BUF_ERROR:Ni,Z_DEFAULT_COMPRESSION:zi,Z_FILTERED:ji,Z_HUFFMAN_ONLY:Ui,Z_RLE:Oi,Z_FIXED:Qi,Z_DEFAULT_STRATEGY:Ji,Z_UNKNOWN:Di,Z_DEFLATED:Bi}=Ti,Ai=(e,t)=>(e.msg=xi[t],t),$i=e=>(e<<1)-(e>4?9:0),qi=e=>{let t=e.length;for(;--t>=0;)e[t]=0};let eo=(e,t,r)=>(t<<e.hash_shift^r)&e.hash_mask;const to=e=>{const t=e.state;let r=t.pending;r>e.avail_out&&(r=e.avail_out),0!==r&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+r),e.next_out),e.next_out+=r,t.pending_out+=r,e.total_out+=r,e.avail_out-=r,t.pending-=r,0===t.pending&&(t.pending_out=0))},ro=(e,t)=>{Ri(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,to(e.strm)},so=(e,t)=>{e.pending_buf[e.pending++]=t},no=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},io=(e,t,r,s)=>{let n=e.avail_in;return n>s&&(n=s),0===n?0:(e.avail_in-=n,t.set(e.input.subarray(e.next_in,e.next_in+n),r),1===e.state.wrap?e.adler=Zi(e.adler,t,n,r):2===e.state.wrap&&(e.adler=Li(e.adler,t,n,r)),e.next_in+=n,e.total_in+=n,n)},oo=(e,t)=>{let r,s,n=e.max_chain_length,i=e.strstart,o=e.prev_length,a=e.nice_match;const l=e.strstart>e.w_size-262?e.strstart-(e.w_size-262):0,c=e.window,d=e.w_mask,h=e.prev,u=e.strstart+258;let f=c[i+o-1],p=c[i+o];e.prev_length>=e.good_match&&(n>>=2),a>e.lookahead&&(a=e.lookahead);do{if(r=t,c[r+o]===p&&c[r+o-1]===f&&c[r]===c[i]&&c[++r]===c[i+1]){i+=2,r++;do{}while(c[++i]===c[++r]&&c[++i]===c[++r]&&c[++i]===c[++r]&&c[++i]===c[++r]&&c[++i]===c[++r]&&c[++i]===c[++r]&&c[++i]===c[++r]&&c[++i]===c[++r]&&i<u);if(s=258-(u-i),i=u-258,s>o){if(e.match_start=t,o=s,s>=a)break;f=c[i+o-1],p=c[i+o]}}}while((t=h[t&d])>l&&0!=--n);return o<=e.lookahead?o:e.lookahead},ao=e=>{const t=e.w_size;let r,s,n,i,o;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-262)){e.window.set(e.window.subarray(t,t+t),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,s=e.hash_size,r=s;do{n=e.head[--r],e.head[r]=n>=t?n-t:0}while(--s);s=t,r=s;do{n=e.prev[--r],e.prev[r]=n>=t?n-t:0}while(--s);i+=t}if(0===e.strm.avail_in)break;if(s=io(e.strm,e.window,e.strstart+e.lookahead,i),e.lookahead+=s,e.lookahead+e.insert>=3)for(o=e.strstart-e.insert,e.ins_h=e.window[o],e.ins_h=eo(e,e.ins_h,e.window[o+1]);e.insert&&(e.ins_h=eo(e,e.ins_h,e.window[o+3-1]),e.prev[o&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=o,o++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<262&&0!==e.strm.avail_in)},lo=(e,t)=>{let r,s;for(;;){if(e.lookahead<262){if(ao(e),e.lookahead<262&&t===Pi)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=3&&(e.ins_h=eo(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==r&&e.strstart-r<=e.w_size-262&&(e.match_length=oo(e,r)),e.match_length>=3)if(s=Wi(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=eo(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=eo(e,e.ins_h,e.window[e.strstart+1]);else s=Wi(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(s&&(ro(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===Yi?(ro(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(ro(e,!1),0===e.strm.avail_out)?1:2},co=(e,t)=>{let r,s,n;for(;;){if(e.lookahead<262){if(ao(e),e.lookahead<262&&t===Pi)return 1;if(0===e.lookahead)break}if(r=0,e.lookahead>=3&&(e.ins_h=eo(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==r&&e.prev_length<e.max_lazy_match&&e.strstart-r<=e.w_size-262&&(e.match_length=oo(e,r),e.match_length<=5&&(e.strategy===ji||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){n=e.strstart+e.lookahead-3,s=Wi(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=n&&(e.ins_h=eo(e,e.ins_h,e.window[e.strstart+3-1]),r=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,s&&(ro(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(s=Wi(e,0,e.window[e.strstart-1]),s&&ro(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(s=Wi(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===Yi?(ro(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(ro(e,!1),0===e.strm.avail_out)?1:2};function ho(e,t,r,s,n){this.good_length=e,this.max_lazy=t,this.nice_length=r,this.max_chain=s,this.func=n}const uo=[new ho(0,0,0,0,((e,t)=>{let r=65535;for(r>e.pending_buf_size-5&&(r=e.pending_buf_size-5);;){if(e.lookahead<=1){if(ao(e),0===e.lookahead&&t===Pi)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;const s=e.block_start+r;if((0===e.strstart||e.strstart>=s)&&(e.lookahead=e.strstart-s,e.strstart=s,ro(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-262&&(ro(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===Yi?(ro(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(ro(e,!1),e.strm.avail_out),1)})),new ho(4,4,8,4,lo),new ho(4,5,16,8,lo),new ho(4,6,32,32,lo),new ho(4,4,16,16,co),new ho(8,16,32,32,co),new ho(8,16,128,128,co),new ho(8,32,128,256,co),new ho(32,128,258,1024,co),new ho(32,258,258,4096,co)];function fo(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Bi,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),qi(this.dyn_ltree),qi(this.dyn_dtree),qi(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),qi(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),qi(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const po=e=>{if(!e||!e.state)return Ai(e,Fi);e.total_in=e.total_out=0,e.data_type=Di;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:113,e.adler=2===t.wrap?0:1,t.last_flush=Pi,ki(t),Mi},mo=e=>{const t=po(e);return t===Mi&&(e=>{e.window_size=2*e.w_size,qi(e.head),e.max_lazy_match=uo[e.level].max_lazy,e.good_match=uo[e.level].good_length,e.nice_match=uo[e.level].nice_length,e.max_chain_length=uo[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=2,e.match_available=0,e.ins_h=0})(e.state),t},bo=(e,t,r,s,n,i)=>{if(!e)return Fi;let o=1;if(t===zi&&(t=6),s<0?(o=0,s=-s):s>15&&(o=2,s-=16),n<1||n>9||r!==Bi||s<8||s>15||t<0||t>9||i<0||i>Qi)return Ai(e,Fi);8===s&&(s=9);const a=new fo;return e.state=a,a.strm=e,a.wrap=o,a.gzhead=null,a.w_bits=s,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=n+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+3-1)/3),a.window=new Uint8Array(2*a.w_size),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<n+6,a.pending_buf_size=4*a.lit_bufsize,a.pending_buf=new Uint8Array(a.pending_buf_size),a.d_buf=1*a.lit_bufsize,a.l_buf=3*a.lit_bufsize,a.level=t,a.strategy=i,a.method=r,mo(e)};var yo=(e,t)=>{let r,s;if(!e||!e.state||t>Hi||t<0)return e?Ai(e,Fi):Fi;const n=e.state;if(!e.output||!e.input&&0!==e.avail_in||666===n.status&&t!==Yi)return Ai(e,0===e.avail_out?Ni:Fi);n.strm=e;const i=n.last_flush;if(n.last_flush=t,42===n.status)if(2===n.wrap)e.adler=0,so(n,31),so(n,139),so(n,8),n.gzhead?(so(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),so(n,255&n.gzhead.time),so(n,n.gzhead.time>>8&255),so(n,n.gzhead.time>>16&255),so(n,n.gzhead.time>>24&255),so(n,9===n.level?2:n.strategy>=Ui||n.level<2?4:0),so(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(so(n,255&n.gzhead.extra.length),so(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=Li(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69):(so(n,0),so(n,0),so(n,0),so(n,0),so(n,0),so(n,9===n.level?2:n.strategy>=Ui||n.level<2?4:0),so(n,3),n.status=113);else{let t=Bi+(n.w_bits-8<<4)<<8,r=-1;r=n.strategy>=Ui||n.level<2?0:n.level<6?1:6===n.level?2:3,t|=r<<6,0!==n.strstart&&(t|=32),t+=31-t%31,n.status=113,no(n,t),0!==n.strstart&&(no(n,e.adler>>>16),no(n,65535&e.adler)),e.adler=1}if(69===n.status)if(n.gzhead.extra){for(r=n.pending;n.gzindex<(65535&n.gzhead.extra.length)&&(n.pending!==n.pending_buf_size||(n.gzhead.hcrc&&n.pending>r&&(e.adler=Li(e.adler,n.pending_buf,n.pending-r,r)),to(e),r=n.pending,n.pending!==n.pending_buf_size));)so(n,255&n.gzhead.extra[n.gzindex]),n.gzindex++;n.gzhead.hcrc&&n.pending>r&&(e.adler=Li(e.adler,n.pending_buf,n.pending-r,r)),n.gzindex===n.gzhead.extra.length&&(n.gzindex=0,n.status=73)}else n.status=73;if(73===n.status)if(n.gzhead.name){r=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>r&&(e.adler=Li(e.adler,n.pending_buf,n.pending-r,r)),to(e),r=n.pending,n.pending===n.pending_buf_size)){s=1;break}s=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,so(n,s)}while(0!==s);n.gzhead.hcrc&&n.pending>r&&(e.adler=Li(e.adler,n.pending_buf,n.pending-r,r)),0===s&&(n.gzindex=0,n.status=91)}else n.status=91;if(91===n.status)if(n.gzhead.comment){r=n.pending;do{if(n.pending===n.pending_buf_size&&(n.gzhead.hcrc&&n.pending>r&&(e.adler=Li(e.adler,n.pending_buf,n.pending-r,r)),to(e),r=n.pending,n.pending===n.pending_buf_size)){s=1;break}s=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,so(n,s)}while(0!==s);n.gzhead.hcrc&&n.pending>r&&(e.adler=Li(e.adler,n.pending_buf,n.pending-r,r)),0===s&&(n.status=103)}else n.status=103;if(103===n.status&&(n.gzhead.hcrc?(n.pending+2>n.pending_buf_size&&to(e),n.pending+2<=n.pending_buf_size&&(so(n,255&e.adler),so(n,e.adler>>8&255),e.adler=0,n.status=113)):n.status=113),0!==n.pending){if(to(e),0===e.avail_out)return n.last_flush=-1,Mi}else if(0===e.avail_in&&$i(t)<=$i(i)&&t!==Yi)return Ai(e,Ni);if(666===n.status&&0!==e.avail_in)return Ai(e,Ni);if(0!==e.avail_in||0!==n.lookahead||t!==Pi&&666!==n.status){let r=n.strategy===Ui?((e,t)=>{let r;for(;;){if(0===e.lookahead&&(ao(e),0===e.lookahead)){if(t===Pi)return 1;break}if(e.match_length=0,r=Wi(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,r&&(ro(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===Yi?(ro(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(ro(e,!1),0===e.strm.avail_out)?1:2})(n,t):n.strategy===Oi?((e,t)=>{let r,s,n,i;const o=e.window;for(;;){if(e.lookahead<=258){if(ao(e),e.lookahead<=258&&t===Pi)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(n=e.strstart-1,s=o[n],s===o[++n]&&s===o[++n]&&s===o[++n])){i=e.strstart+258;do{}while(s===o[++n]&&s===o[++n]&&s===o[++n]&&s===o[++n]&&s===o[++n]&&s===o[++n]&&s===o[++n]&&s===o[++n]&&n<i);e.match_length=258-(i-n),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(r=Wi(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(r=Wi(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),r&&(ro(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===Yi?(ro(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(ro(e,!1),0===e.strm.avail_out)?1:2})(n,t):uo[n.level].func(n,t);if(3!==r&&4!==r||(n.status=666),1===r||3===r)return 0===e.avail_out&&(n.last_flush=-1),Mi;if(2===r&&(t===Ii?Ci(n):t!==Hi&&(Gi(n,0,0,!1),t===Vi&&(qi(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),to(e),0===e.avail_out))return n.last_flush=-1,Mi}return t!==Yi?Mi:n.wrap<=0?Ei:(2===n.wrap?(so(n,255&e.adler),so(n,e.adler>>8&255),so(n,e.adler>>16&255),so(n,e.adler>>24&255),so(n,255&e.total_in),so(n,e.total_in>>8&255),so(n,e.total_in>>16&255),so(n,e.total_in>>24&255)):(no(n,e.adler>>>16),no(n,65535&e.adler)),to(e),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?Mi:Ei)},go=(e,t)=>{let r=t.length;if(!e||!e.state)return Fi;const s=e.state,n=s.wrap;if(2===n||1===n&&42!==s.status||s.lookahead)return Fi;if(1===n&&(e.adler=Zi(e.adler,t,r,0)),s.wrap=0,r>=s.w_size){0===n&&(qi(s.head),s.strstart=0,s.block_start=0,s.insert=0);let e=new Uint8Array(s.w_size);e.set(t.subarray(r-s.w_size,r),0),t=e,r=s.w_size}const i=e.avail_in,o=e.next_in,a=e.input;for(e.avail_in=r,e.next_in=0,e.input=t,ao(s);s.lookahead>=3;){let e=s.strstart,t=s.lookahead-2;do{s.ins_h=eo(s,s.ins_h,s.window[e+3-1]),s.prev[e&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=e,e++}while(--t);s.strstart=e,s.lookahead=2,ao(s)}return s.strstart+=s.lookahead,s.block_start=s.strstart,s.insert=s.lookahead,s.lookahead=0,s.match_length=s.prev_length=2,s.match_available=0,e.next_in=o,e.input=a,e.avail_in=i,s.wrap=n,Mi},wo={deflateInit:(e,t)=>bo(e,t,Bi,15,8,Ji),deflateInit2:bo,deflateReset:mo,deflateResetKeep:po,deflateSetHeader:(e,t)=>e&&e.state?2!==e.state.wrap?Fi:(e.state.gzhead=t,Mi):Fi,deflate:yo,deflateEnd:e=>{if(!e||!e.state)return Fi;const t=e.state.status;return 42!==t&&69!==t&&73!==t&&91!==t&&103!==t&&113!==t&&666!==t?Ai(e,Fi):(e.state=null,113===t?Ai(e,Ki):Mi)},deflateSetDictionary:go,deflateInfo:\"pako deflate (from Nodeca project)\"};const So=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var vo=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const r=t.shift();if(r){if(\"object\"!=typeof r)throw new TypeError(r+\"must be non-object\");for(const t in r)So(r,t)&&(e[t]=r[t])}}return e},_o=e=>{let t=0;for(let r=0,s=e.length;r<s;r++)t+=e[r].length;const r=new Uint8Array(t);for(let t=0,s=0,n=e.length;t<n;t++){let n=e[t];r.set(n,s),s+=n.length}return r};let Zo=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){Zo=!1}const Xo=new Uint8Array(256);for(let e=0;e<256;e++)Xo[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;Xo[254]=Xo[254]=1;var Lo=e=>{if(\"function\"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,r,s,n,i,o=e.length,a=0;for(n=0;n<o;n++)r=e.charCodeAt(n),55296==(64512&r)&&n+1<o&&(s=e.charCodeAt(n+1),56320==(64512&s)&&(r=65536+(r-55296<<10)+(s-56320),n++)),a+=r<128?1:r<2048?2:r<65536?3:4;for(t=new Uint8Array(a),i=0,n=0;i<a;n++)r=e.charCodeAt(n),55296==(64512&r)&&n+1<o&&(s=e.charCodeAt(n+1),56320==(64512&s)&&(r=65536+(r-55296<<10)+(s-56320),n++)),r<128?t[i++]=r:r<2048?(t[i++]=192|r>>>6,t[i++]=128|63&r):r<65536?(t[i++]=224|r>>>12,t[i++]=128|r>>>6&63,t[i++]=128|63&r):(t[i++]=240|r>>>18,t[i++]=128|r>>>12&63,t[i++]=128|r>>>6&63,t[i++]=128|63&r);return t},xo=(e,t)=>{const r=t||e.length;if(\"function\"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let s,n;const i=new Array(2*r);for(n=0,s=0;s<r;){let t=e[s++];if(t<128){i[n++]=t;continue}let o=Xo[t];if(o>4)i[n++]=65533,s+=o-1;else{for(t&=2===o?31:3===o?15:7;o>1&&s<r;)t=t<<6|63&e[s++],o--;o>1?i[n++]=65533:t<65536?i[n++]=t:(t-=65536,i[n++]=55296|t>>10&1023,i[n++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&Zo)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let r=\"\";for(let s=0;s<t;s++)r+=String.fromCharCode(e[s]);return r})(i,n)},To=(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let r=t-1;for(;r>=0&&128==(192&e[r]);)r--;return r<0||0===r?t:r+Xo[e[r]]>t?r:t};var ko=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg=\"\",this.state=null,this.data_type=2,this.adler=0};const Go=Object.prototype.toString,{Z_NO_FLUSH:Ro,Z_SYNC_FLUSH:Wo,Z_FULL_FLUSH:Co,Z_FINISH:Po,Z_OK:Io,Z_STREAM_END:Vo,Z_DEFAULT_COMPRESSION:Yo,Z_DEFAULT_STRATEGY:Ho,Z_DEFLATED:Mo}=Ti;function Eo(e){this.options=vo({level:Yo,method:Mo,chunkSize:16384,windowBits:15,memLevel:8,strategy:Ho},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg=\"\",this.ended=!1,this.chunks=[],this.strm=new ko,this.strm.avail_out=0;let r=wo.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(r!==Io)throw new Error(xi[r]);if(t.header&&wo.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e=\"string\"==typeof t.dictionary?Lo(t.dictionary):\"[object ArrayBuffer]\"===Go.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,r=wo.deflateSetDictionary(this.strm,e),r!==Io)throw new Error(xi[r]);this._dict_set=!0}}function Fo(e,t){const r=new Eo(t);if(r.push(e,!0),r.err)throw r.msg||xi[r.err];return r.result}Eo.prototype.push=function(e,t){const r=this.strm,s=this.options.chunkSize;let n,i;if(this.ended)return!1;for(i=t===~~t?t:!0===t?Po:Ro,\"string\"==typeof e?r.input=Lo(e):\"[object ArrayBuffer]\"===Go.call(e)?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;)if(0===r.avail_out&&(r.output=new Uint8Array(s),r.next_out=0,r.avail_out=s),(i===Wo||i===Co)&&r.avail_out<=6)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else{if(n=wo.deflate(r,i),n===Vo)return r.next_out>0&&this.onData(r.output.subarray(0,r.next_out)),n=wo.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===Io;if(0!==r.avail_out){if(i>0&&r.next_out>0)this.onData(r.output.subarray(0,r.next_out)),r.avail_out=0;else if(0===r.avail_in)break}else this.onData(r.output)}return!0},Eo.prototype.onData=function(e){this.chunks.push(e)},Eo.prototype.onEnd=function(e){e===Io&&(this.result=_o(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Ko={Deflate:Eo,deflate:Fo,deflateRaw:function(e,t){return(t=t||{}).raw=!0,Fo(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,Fo(e,t)},constants:Ti};var No=function(e,t){let r,s,n,i,o,a,l,c,d,h,u,f,p,m,b,y,g,w,S,v,_,Z,X,L;const x=e.state;r=e.next_in,X=e.input,s=r+(e.avail_in-5),n=e.next_out,L=e.output,i=n-(t-e.avail_out),o=n+(e.avail_out-257),a=x.dmax,l=x.wsize,c=x.whave,d=x.wnext,h=x.window,u=x.hold,f=x.bits,p=x.lencode,m=x.distcode,b=(1<<x.lenbits)-1,y=(1<<x.distbits)-1;e:do{f<15&&(u+=X[r++]<<f,f+=8,u+=X[r++]<<f,f+=8),g=p[u&b];t:for(;;){if(w=g>>>24,u>>>=w,f-=w,w=g>>>16&255,0===w)L[n++]=65535&g;else{if(!(16&w)){if(0==(64&w)){g=p[(65535&g)+(u&(1<<w)-1)];continue t}if(32&w){x.mode=12;break e}e.msg=\"invalid literal/length code\",x.mode=30;break e}S=65535&g,w&=15,w&&(f<w&&(u+=X[r++]<<f,f+=8),S+=u&(1<<w)-1,u>>>=w,f-=w),f<15&&(u+=X[r++]<<f,f+=8,u+=X[r++]<<f,f+=8),g=m[u&y];r:for(;;){if(w=g>>>24,u>>>=w,f-=w,w=g>>>16&255,!(16&w)){if(0==(64&w)){g=m[(65535&g)+(u&(1<<w)-1)];continue r}e.msg=\"invalid distance code\",x.mode=30;break e}if(v=65535&g,w&=15,f<w&&(u+=X[r++]<<f,f+=8,f<w&&(u+=X[r++]<<f,f+=8)),v+=u&(1<<w)-1,v>a){e.msg=\"invalid distance too far back\",x.mode=30;break e}if(u>>>=w,f-=w,w=n-i,v>w){if(w=v-w,w>c&&x.sane){e.msg=\"invalid distance too far back\",x.mode=30;break e}if(_=0,Z=h,0===d){if(_+=l-w,w<S){S-=w;do{L[n++]=h[_++]}while(--w);_=n-v,Z=L}}else if(d<w){if(_+=l+d-w,w-=d,w<S){S-=w;do{L[n++]=h[_++]}while(--w);if(_=0,d<S){w=d,S-=w;do{L[n++]=h[_++]}while(--w);_=n-v,Z=L}}}else if(_+=d-w,w<S){S-=w;do{L[n++]=h[_++]}while(--w);_=n-v,Z=L}for(;S>2;)L[n++]=Z[_++],L[n++]=Z[_++],L[n++]=Z[_++],S-=3;S&&(L[n++]=Z[_++],S>1&&(L[n++]=Z[_++]))}else{_=n-v;do{L[n++]=L[_++],L[n++]=L[_++],L[n++]=L[_++],S-=3}while(S>2);S&&(L[n++]=L[_++],S>1&&(L[n++]=L[_++]))}break}}break}}while(r<s&&n<o);S=f>>3,r-=S,f-=S<<3,u&=(1<<f)-1,e.next_in=r,e.next_out=n,e.avail_in=r<s?s-r+5:5-(r-s),e.avail_out=n<o?o-n+257:257-(n-o),x.hold=u,x.bits=f};const zo=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),jo=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Uo=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Oo=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Qo=(e,t,r,s,n,i,o,a)=>{const l=a.bits;let c,d,h,u,f,p,m=0,b=0,y=0,g=0,w=0,S=0,v=0,_=0,Z=0,X=0,L=null,x=0;const T=new Uint16Array(16),k=new Uint16Array(16);let G,R,W,C=null,P=0;for(m=0;m<=15;m++)T[m]=0;for(b=0;b<s;b++)T[t[r+b]]++;for(w=l,g=15;g>=1&&0===T[g];g--);if(w>g&&(w=g),0===g)return n[i++]=20971520,n[i++]=20971520,a.bits=1,0;for(y=1;y<g&&0===T[y];y++);for(w<y&&(w=y),_=1,m=1;m<=15;m++)if(_<<=1,_-=T[m],_<0)return-1;if(_>0&&(0===e||1!==g))return-1;for(k[1]=0,m=1;m<15;m++)k[m+1]=k[m]+T[m];for(b=0;b<s;b++)0!==t[r+b]&&(o[k[t[r+b]]++]=b);if(0===e?(L=C=o,p=19):1===e?(L=zo,x-=257,C=jo,P-=257,p=256):(L=Uo,C=Oo,p=-1),X=0,b=0,m=y,f=i,S=w,v=0,h=-1,Z=1<<w,u=Z-1,1===e&&Z>852||2===e&&Z>592)return 1;for(;;){G=m-v,o[b]<p?(R=0,W=o[b]):o[b]>p?(R=C[P+o[b]],W=L[x+o[b]]):(R=96,W=0),c=1<<m-v,d=1<<S,y=d;do{d-=c,n[f+(X>>v)+d]=G<<24|R<<16|W|0}while(0!==d);for(c=1<<m-1;X&c;)c>>=1;if(0!==c?(X&=c-1,X+=c):X=0,b++,0==--T[m]){if(m===g)break;m=t[r+o[b]]}if(m>w&&(X&u)!==h){for(0===v&&(v=w),f+=y,S=m-v,_=1<<S;S+v<g&&(_-=T[S+v],!(_<=0));)S++,_<<=1;if(Z+=1<<S,1===e&&Z>852||2===e&&Z>592)return 1;h=X&u,n[h]=w<<24|S<<16|f-i|0}}return 0!==X&&(n[f+X]=m-v<<24|64<<16|0),a.bits=w,0};const{Z_FINISH:Jo,Z_BLOCK:Do,Z_TREES:Bo,Z_OK:Ao,Z_STREAM_END:$o,Z_NEED_DICT:qo,Z_STREAM_ERROR:ea,Z_DATA_ERROR:ta,Z_MEM_ERROR:ra,Z_BUF_ERROR:sa,Z_DEFLATED:na}=Ti,ia=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function oa(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const aa=e=>{if(!e||!e.state)return ea;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg=\"\",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,Ao},la=e=>{if(!e||!e.state)return ea;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,aa(e)},ca=(e,t)=>{let r;if(!e||!e.state)return ea;const s=e.state;return t<0?(r=0,t=-t):(r=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?ea:(null!==s.window&&s.wbits!==t&&(s.window=null),s.wrap=r,s.wbits=t,la(e))},da=(e,t)=>{if(!e)return ea;const r=new oa;e.state=r,r.window=null;const s=ca(e,t);return s!==Ao&&(e.state=null),s};let ha,ua,fa=!0;const pa=e=>{if(fa){ha=new Int32Array(512),ua=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(Qo(1,e.lens,0,288,ha,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;Qo(2,e.lens,0,32,ua,0,e.work,{bits:5}),fa=!1}e.lencode=ha,e.lenbits=9,e.distcode=ua,e.distbits=5},ma=(e,t,r,s)=>{let n;const i=e.state;return null===i.window&&(i.wsize=1<<i.wbits,i.wnext=0,i.whave=0,i.window=new Uint8Array(i.wsize)),s>=i.wsize?(i.window.set(t.subarray(r-i.wsize,r),0),i.wnext=0,i.whave=i.wsize):(n=i.wsize-i.wnext,n>s&&(n=s),i.window.set(t.subarray(r-s,r-s+n),i.wnext),(s-=n)?(i.window.set(t.subarray(r-s,r),0),i.wnext=s,i.whave=i.wsize):(i.wnext+=n,i.wnext===i.wsize&&(i.wnext=0),i.whave<i.wsize&&(i.whave+=n))),0};var ba={inflateReset:la,inflateReset2:ca,inflateResetKeep:aa,inflateInit:e=>da(e,15),inflateInit2:da,inflate:(e,t)=>{let r,s,n,i,o,a,l,c,d,h,u,f,p,m,b,y,g,w,S,v,_,Z,X=0;const L=new Uint8Array(4);let x,T;const k=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return ea;r=e.state,12===r.mode&&(r.mode=13),o=e.next_out,n=e.output,l=e.avail_out,i=e.next_in,s=e.input,a=e.avail_in,c=r.hold,d=r.bits,h=a,u=l,Z=Ao;e:for(;;)switch(r.mode){case 1:if(0===r.wrap){r.mode=13;break}for(;d<16;){if(0===a)break e;a--,c+=s[i++]<<d,d+=8}if(2&r.wrap&&35615===c){r.check=0,L[0]=255&c,L[1]=c>>>8&255,r.check=Li(r.check,L,2,0),c=0,d=0,r.mode=2;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&c)<<8)+(c>>8))%31){e.msg=\"incorrect header check\",r.mode=30;break}if((15&c)!==na){e.msg=\"unknown compression method\",r.mode=30;break}if(c>>>=4,d-=4,_=8+(15&c),0===r.wbits)r.wbits=_;else if(_>r.wbits){e.msg=\"invalid window size\",r.mode=30;break}r.dmax=1<<r.wbits,e.adler=r.check=1,r.mode=512&c?10:12,c=0,d=0;break;case 2:for(;d<16;){if(0===a)break e;a--,c+=s[i++]<<d,d+=8}if(r.flags=c,(255&r.flags)!==na){e.msg=\"unknown compression method\",r.mode=30;break}if(57344&r.flags){e.msg=\"unknown header flags set\",r.mode=30;break}r.head&&(r.head.text=c>>8&1),512&r.flags&&(L[0]=255&c,L[1]=c>>>8&255,r.check=Li(r.check,L,2,0)),c=0,d=0,r.mode=3;case 3:for(;d<32;){if(0===a)break e;a--,c+=s[i++]<<d,d+=8}r.head&&(r.head.time=c),512&r.flags&&(L[0]=255&c,L[1]=c>>>8&255,L[2]=c>>>16&255,L[3]=c>>>24&255,r.check=Li(r.check,L,4,0)),c=0,d=0,r.mode=4;case 4:for(;d<16;){if(0===a)break e;a--,c+=s[i++]<<d,d+=8}r.head&&(r.head.xflags=255&c,r.head.os=c>>8),512&r.flags&&(L[0]=255&c,L[1]=c>>>8&255,r.check=Li(r.check,L,2,0)),c=0,d=0,r.mode=5;case 5:if(1024&r.flags){for(;d<16;){if(0===a)break e;a--,c+=s[i++]<<d,d+=8}r.length=c,r.head&&(r.head.extra_len=c),512&r.flags&&(L[0]=255&c,L[1]=c>>>8&255,r.check=Li(r.check,L,2,0)),c=0,d=0}else r.head&&(r.head.extra=null);r.mode=6;case 6:if(1024&r.flags&&(f=r.length,f>a&&(f=a),f&&(r.head&&(_=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Uint8Array(r.head.extra_len)),r.head.extra.set(s.subarray(i,i+f),_)),512&r.flags&&(r.check=Li(r.check,s,f,i)),a-=f,i+=f,r.length-=f),r.length))break e;r.length=0,r.mode=7;case 7:if(2048&r.flags){if(0===a)break e;f=0;do{_=s[i+f++],r.head&&_&&r.length<65536&&(r.head.name+=String.fromCharCode(_))}while(_&&f<a);if(512&r.flags&&(r.check=Li(r.check,s,f,i)),a-=f,i+=f,_)break e}else r.head&&(r.head.name=null);r.length=0,r.mode=8;case 8:if(4096&r.flags){if(0===a)break e;f=0;do{_=s[i+f++],r.head&&_&&r.length<65536&&(r.head.comment+=String.fromCharCode(_))}while(_&&f<a);if(512&r.flags&&(r.check=Li(r.check,s,f,i)),a-=f,i+=f,_)break e}else r.head&&(r.head.comment=null);r.mode=9;case 9:if(512&r.flags){for(;d<16;){if(0===a)break e;a--,c+=s[i++]<<d,d+=8}if(c!==(65535&r.check)){e.msg=\"header crc mismatch\",r.mode=30;break}c=0,d=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),e.adler=r.check=0,r.mode=12;break;case 10:for(;d<32;){if(0===a)break e;a--,c+=s[i++]<<d,d+=8}e.adler=r.check=ia(c),c=0,d=0,r.mode=11;case 11:if(0===r.havedict)return e.next_out=o,e.avail_out=l,e.next_in=i,e.avail_in=a,r.hold=c,r.bits=d,qo;e.adler=r.check=1,r.mode=12;case 12:if(t===Do||t===Bo)break e;case 13:if(r.last){c>>>=7&d,d-=7&d,r.mode=27;break}for(;d<3;){if(0===a)break e;a--,c+=s[i++]<<d,d+=8}switch(r.last=1&c,c>>>=1,d-=1,3&c){case 0:r.mode=14;break;case 1:if(pa(r),r.mode=20,t===Bo){c>>>=2,d-=2;break e}break;case 2:r.mode=17;break;case 3:e.msg=\"invalid block type\",r.mode=30}c>>>=2,d-=2;break;case 14:for(c>>>=7&d,d-=7&d;d<32;){if(0===a)break e;a--,c+=s[i++]<<d,d+=8}if((65535&c)!=(c>>>16^65535)){e.msg=\"invalid stored block lengths\",r.mode=30;break}if(r.length=65535&c,c=0,d=0,r.mode=15,t===Bo)break e;case 15:r.mode=16;case 16:if(f=r.length,f){if(f>a&&(f=a),f>l&&(f=l),0===f)break e;n.set(s.subarray(i,i+f),o),a-=f,i+=f,l-=f,o+=f,r.length-=f;break}r.mode=12;break;case 17:for(;d<14;){if(0===a)break e;a--,c+=s[i++]<<d,d+=8}if(r.nlen=257+(31&c),c>>>=5,d-=5,r.ndist=1+(31&c),c>>>=5,d-=5,r.ncode=4+(15&c),c>>>=4,d-=4,r.nlen>286||r.ndist>30){e.msg=\"too many length or distance symbols\",r.mode=30;break}r.have=0,r.mode=18;case 18:for(;r.have<r.ncode;){for(;d<3;){if(0===a)break e;a--,c+=s[i++]<<d,d+=8}r.lens[k[r.have++]]=7&c,c>>>=3,d-=3}for(;r.have<19;)r.lens[k[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,x={bits:r.lenbits},Z=Qo(0,r.lens,0,19,r.lencode,0,r.work,x),r.lenbits=x.bits,Z){e.msg=\"invalid code lengths set\",r.mode=30;break}r.have=0,r.mode=19;case 19:for(;r.have<r.nlen+r.ndist;){for(;X=r.lencode[c&(1<<r.lenbits)-1],b=X>>>24,y=X>>>16&255,g=65535&X,!(b<=d);){if(0===a)break e;a--,c+=s[i++]<<d,d+=8}if(g<16)c>>>=b,d-=b,r.lens[r.have++]=g;else{if(16===g){for(T=b+2;d<T;){if(0===a)break e;a--,c+=s[i++]<<d,d+=8}if(c>>>=b,d-=b,0===r.have){e.msg=\"invalid bit length repeat\",r.mode=30;break}_=r.lens[r.have-1],f=3+(3&c),c>>>=2,d-=2}else if(17===g){for(T=b+3;d<T;){if(0===a)break e;a--,c+=s[i++]<<d,d+=8}c>>>=b,d-=b,_=0,f=3+(7&c),c>>>=3,d-=3}else{for(T=b+7;d<T;){if(0===a)break e;a--,c+=s[i++]<<d,d+=8}c>>>=b,d-=b,_=0,f=11+(127&c),c>>>=7,d-=7}if(r.have+f>r.nlen+r.ndist){e.msg=\"invalid bit length repeat\",r.mode=30;break}for(;f--;)r.lens[r.have++]=_}}if(30===r.mode)break;if(0===r.lens[256]){e.msg=\"invalid code -- missing end-of-block\",r.mode=30;break}if(r.lenbits=9,x={bits:r.lenbits},Z=Qo(1,r.lens,0,r.nlen,r.lencode,0,r.work,x),r.lenbits=x.bits,Z){e.msg=\"invalid literal/lengths set\",r.mode=30;break}if(r.distbits=6,r.distcode=r.distdyn,x={bits:r.distbits},Z=Qo(2,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,x),r.distbits=x.bits,Z){e.msg=\"invalid distances set\",r.mode=30;break}if(r.mode=20,t===Bo)break e;case 20:r.mode=21;case 21:if(a>=6&&l>=258){e.next_out=o,e.avail_out=l,e.next_in=i,e.avail_in=a,r.hold=c,r.bits=d,No(e,u),o=e.next_out,n=e.output,l=e.avail_out,i=e.next_in,s=e.input,a=e.avail_in,c=r.hold,d=r.bits,12===r.mode&&(r.back=-1);break}for(r.back=0;X=r.lencode[c&(1<<r.lenbits)-1],b=X>>>24,y=X>>>16&255,g=65535&X,!(b<=d);){if(0===a)break e;a--,c+=s[i++]<<d,d+=8}if(y&&0==(240&y)){for(w=b,S=y,v=g;X=r.lencode[v+((c&(1<<w+S)-1)>>w)],b=X>>>24,y=X>>>16&255,g=65535&X,!(w+b<=d);){if(0===a)break e;a--,c+=s[i++]<<d,d+=8}c>>>=w,d-=w,r.back+=w}if(c>>>=b,d-=b,r.back+=b,r.length=g,0===y){r.mode=26;break}if(32&y){r.back=-1,r.mode=12;break}if(64&y){e.msg=\"invalid literal/length code\",r.mode=30;break}r.extra=15&y,r.mode=22;case 22:if(r.extra){for(T=r.extra;d<T;){if(0===a)break e;a--,c+=s[i++]<<d,d+=8}r.length+=c&(1<<r.extra)-1,c>>>=r.extra,d-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=23;case 23:for(;X=r.distcode[c&(1<<r.distbits)-1],b=X>>>24,y=X>>>16&255,g=65535&X,!(b<=d);){if(0===a)break e;a--,c+=s[i++]<<d,d+=8}if(0==(240&y)){for(w=b,S=y,v=g;X=r.distcode[v+((c&(1<<w+S)-1)>>w)],b=X>>>24,y=X>>>16&255,g=65535&X,!(w+b<=d);){if(0===a)break e;a--,c+=s[i++]<<d,d+=8}c>>>=w,d-=w,r.back+=w}if(c>>>=b,d-=b,r.back+=b,64&y){e.msg=\"invalid distance code\",r.mode=30;break}r.offset=g,r.extra=15&y,r.mode=24;case 24:if(r.extra){for(T=r.extra;d<T;){if(0===a)break e;a--,c+=s[i++]<<d,d+=8}r.offset+=c&(1<<r.extra)-1,c>>>=r.extra,d-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){e.msg=\"invalid distance too far back\",r.mode=30;break}r.mode=25;case 25:if(0===l)break e;if(f=u-l,r.offset>f){if(f=r.offset-f,f>r.whave&&r.sane){e.msg=\"invalid distance too far back\",r.mode=30;break}f>r.wnext?(f-=r.wnext,p=r.wsize-f):p=r.wnext-f,f>r.length&&(f=r.length),m=r.window}else m=n,p=o-r.offset,f=r.length;f>l&&(f=l),l-=f,r.length-=f;do{n[o++]=m[p++]}while(--f);0===r.length&&(r.mode=21);break;case 26:if(0===l)break e;n[o++]=r.length,l--,r.mode=21;break;case 27:if(r.wrap){for(;d<32;){if(0===a)break e;a--,c|=s[i++]<<d,d+=8}if(u-=l,e.total_out+=u,r.total+=u,u&&(e.adler=r.check=r.flags?Li(r.check,n,u,o-u):Zi(r.check,n,u,o-u)),u=l,(r.flags?c:ia(c))!==r.check){e.msg=\"incorrect data check\",r.mode=30;break}c=0,d=0}r.mode=28;case 28:if(r.wrap&&r.flags){for(;d<32;){if(0===a)break e;a--,c+=s[i++]<<d,d+=8}if(c!==(4294967295&r.total)){e.msg=\"incorrect length check\",r.mode=30;break}c=0,d=0}r.mode=29;case 29:Z=$o;break e;case 30:Z=ta;break e;case 31:return ra;default:return ea}return e.next_out=o,e.avail_out=l,e.next_in=i,e.avail_in=a,r.hold=c,r.bits=d,(r.wsize||u!==e.avail_out&&r.mode<30&&(r.mode<27||t!==Jo))&&ma(e,e.output,e.next_out,u-e.avail_out),h-=e.avail_in,u-=e.avail_out,e.total_in+=h,e.total_out+=u,r.total+=u,r.wrap&&u&&(e.adler=r.check=r.flags?Li(r.check,n,u,e.next_out-u):Zi(r.check,n,u,e.next_out-u)),e.data_type=r.bits+(r.last?64:0)+(12===r.mode?128:0)+(20===r.mode||15===r.mode?256:0),(0===h&&0===u||t===Jo)&&Z===Ao&&(Z=sa),Z},inflateEnd:e=>{if(!e||!e.state)return ea;let t=e.state;return t.window&&(t.window=null),e.state=null,Ao},inflateGetHeader:(e,t)=>{if(!e||!e.state)return ea;const r=e.state;return 0==(2&r.wrap)?ea:(r.head=t,t.done=!1,Ao)},inflateSetDictionary:(e,t)=>{const r=t.length;let s,n,i;return e&&e.state?(s=e.state,0!==s.wrap&&11!==s.mode?ea:11===s.mode&&(n=1,n=Zi(n,t,r,0),n!==s.check)?ta:(i=ma(e,t,r,r),i?(s.mode=31,ra):(s.havedict=1,Ao))):ea},inflateInfo:\"pako inflate (from Nodeca project)\"};var ya=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name=\"\",this.comment=\"\",this.hcrc=0,this.done=!1};const ga=Object.prototype.toString,{Z_NO_FLUSH:wa,Z_FINISH:Sa,Z_OK:va,Z_STREAM_END:_a,Z_NEED_DICT:Za,Z_STREAM_ERROR:Xa,Z_DATA_ERROR:La,Z_MEM_ERROR:xa}=Ti;function Ta(e){this.options=vo({chunkSize:65536,windowBits:15,to:\"\"},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg=\"\",this.ended=!1,this.chunks=[],this.strm=new ko,this.strm.avail_out=0;let r=ba.inflateInit2(this.strm,t.windowBits);if(r!==va)throw new Error(xi[r]);if(this.header=new ya,ba.inflateGetHeader(this.strm,this.header),t.dictionary&&(\"string\"==typeof t.dictionary?t.dictionary=Lo(t.dictionary):\"[object ArrayBuffer]\"===ga.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(r=ba.inflateSetDictionary(this.strm,t.dictionary),r!==va)))throw new Error(xi[r])}function ka(e,t){const r=new Ta(t);if(r.push(e),r.err)throw r.msg||xi[r.err];return r.result}Ta.prototype.push=function(e,t){const r=this.strm,s=this.options.chunkSize,n=this.options.dictionary;let i,o,a;if(this.ended)return!1;for(o=t===~~t?t:!0===t?Sa:wa,\"[object ArrayBuffer]\"===ga.call(e)?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;;){for(0===r.avail_out&&(r.output=new Uint8Array(s),r.next_out=0,r.avail_out=s),i=ba.inflate(r,o),i===Za&&n&&(i=ba.inflateSetDictionary(r,n),i===va?i=ba.inflate(r,o):i===La&&(i=Za));r.avail_in>0&&i===_a&&r.state.wrap>0&&0!==e[r.next_in];)ba.inflateReset(r),i=ba.inflate(r,o);switch(i){case Xa:case La:case Za:case xa:return this.onEnd(i),this.ended=!0,!1}if(a=r.avail_out,r.next_out&&(0===r.avail_out||i===_a))if(\"string\"===this.options.to){let e=To(r.output,r.next_out),t=r.next_out-e,n=xo(r.output,e);r.next_out=t,r.avail_out=s-t,t&&r.output.set(r.output.subarray(e,e+t),0),this.onData(n)}else this.onData(r.output.length===r.next_out?r.output:r.output.subarray(0,r.next_out));if(i!==va||0!==a){if(i===_a)return i=ba.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,!0;if(0===r.avail_in)break}}return!0},Ta.prototype.onData=function(e){this.chunks.push(e)},Ta.prototype.onEnd=function(e){e===va&&(\"string\"===this.options.to?this.result=this.chunks.join(\"\"):this.result=_o(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Ga={Inflate:Ta,inflate:ka,inflateRaw:function(e,t){return(t=t||{}).raw=!0,ka(e,t)},ungzip:ka,constants:Ti};const{Deflate:Ra,deflate:Wa,deflateRaw:Ca,gzip:Pa}=Ko,{Inflate:Ia,inflate:Va,inflateRaw:Ya,ungzip:Ha}=Ga;var Ma={Deflate:Ra,deflate:Wa,deflateRaw:Ca,gzip:Pa,Inflate:Ia,inflate:Va,inflateRaw:Ya,ungzip:Ha,constants:Ti};class Ea{constructor(){this.url=\"(offline)\",this.readyState=WebSocket.CONNECTING,this.bufferedAmount=0,setTimeout((()=>{this.readyState=WebSocket.OPEN,this.onopen&&this.onopen()}),50),this.start=Date.now()}send(e){const{id:t,action:r,args:s}=JSON.parse(e);switch(r){case\"JOIN\":return this.id=t,this.ticks=s.ticks.tick,this.seq=-16>>>0,this.reply(\"SYNC\",{messages:[],time:this.time,seq:this.seq,tove:s.tove,reflector:\"offline\"}),this.reply(\"RECV\",[this.time,++this.seq,{what:\"users\",joined:[s.user],active:1,total:1}]),void this.tick();case\"SEND\":{const e=[...s];return e[0]=this.time,e[1]=++this.seq,void this.reply(\"RECV\",e)}case\"PULSE\":return;default:throw Error(\"Offline unhandled \"+r)}}close(e,t){this.readyState=WebSocket.CLOSING,setTimeout((()=>{this.readyState=WebSocket.CLOSED,this.onclose&&this.onclose({code:e,reason:t})}),50)}get time(){return Date.now()-this.start}tick(){clearInterval(this.ticker),this.ticker=setInterval((()=>{this.reply(\"TICK\",{time:this.time})}),this.ticks)}reply(e,t){setTimeout((()=>{this.onmessage&&this.onmessage({data:JSON.stringify({id:this.id,action:e,args:t})})}),50)}}var Fa={exports:{}},Ka={BINARY_TYPES:[\"nodebuffer\",\"arraybuffer\",\"fragments\"],EMPTY_BUFFER:Buffer.alloc(0),GUID:\"258EAFA5-E914-47DA-95CA-C5AB0DC85B11\",kForOnEventAttribute:Symbol(\"kIsForOnEventAttribute\"),kListener:Symbol(\"kListener\"),kStatusCode:Symbol(\"status-code\"),kWebSocket:Symbol(\"websocket\"),NOOP:()=>{}};const{EMPTY_BUFFER:Na}=Ka;function za(e,t){if(0===e.length)return Na;if(1===e.length)return e[0];const r=Buffer.allocUnsafe(t);let s=0;for(let t=0;t<e.length;t++){const n=e[t];r.set(n,s),s+=n.length}return s<t?r.slice(0,s):r}function ja(e,t,r,s,n){for(let i=0;i<n;i++)r[s+i]=e[i]^t[3&i]}function Ua(e,t){for(let r=0;r<e.length;r++)e[r]^=t[3&r]}function Oa(e){return e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}function Qa(e){if(Qa.readOnly=!0,Buffer.isBuffer(e))return e;let t;return e instanceof ArrayBuffer?t=Buffer.from(e):ArrayBuffer.isView(e)?t=Buffer.from(e.buffer,e.byteOffset,e.byteLength):(t=Buffer.from(e),Qa.readOnly=!1),t}try{const e=__webpack_require__(\"bufferutil\");Fa.exports={concat:za,mask(t,r,s,n,i){i<48?ja(t,r,s,n,i):e.mask(t,r,s,n,i)},toArrayBuffer:Oa,toBuffer:Qa,unmask(t,r){t.length<32?Ua(t,r):e.unmask(t,r)}}}catch(ad){Fa.exports={concat:za,mask:ja,toArrayBuffer:Oa,toBuffer:Qa,unmask:Ua}}const Ja=Symbol(\"kDone\"),Da=Symbol(\"kRun\");var Ba=class{constructor(e){this[Ja]=()=>{this.pending--,this[Da]()},this.concurrency=e||1/0,this.jobs=[],this.pending=0}add(e){this.jobs.push(e),this[Da]()}[Da](){if(this.pending!==this.concurrency&&this.jobs.length){const e=this.jobs.shift();this.pending++,e(this[Ja])}}};const Aa=w.default,$a=Fa.exports,qa=Ba,{kStatusCode:el}=Ka,tl=Buffer.from([0,0,255,255]),rl=Symbol(\"permessage-deflate\"),sl=Symbol(\"total-length\"),nl=Symbol(\"callback\"),il=Symbol(\"buffers\"),ol=Symbol(\"error\");let al;var ll=class{constructor(e,t,r){if(this._maxPayload=0|r,this._options=e||{},this._threshold=void 0!==this._options.threshold?this._options.threshold:1024,this._isServer=!!t,this._deflate=null,this._inflate=null,this.params=null,!al){const e=void 0!==this._options.concurrencyLimit?this._options.concurrencyLimit:10;al=new qa(e)}}static get extensionName(){return\"permessage-deflate\"}offer(){const e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:null==this._options.clientMaxWindowBits&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){const e=this._deflate[nl];this._deflate.close(),this._deflate=null,e&&e(new Error(\"The deflate stream was closed while data was being processed\"))}}acceptAsServer(e){const t=this._options,r=e.find((e=>!(!1===t.serverNoContextTakeover&&e.server_no_context_takeover||e.server_max_window_bits&&(!1===t.serverMaxWindowBits||\"number\"==typeof t.serverMaxWindowBits&&t.serverMaxWindowBits>e.server_max_window_bits)||\"number\"==typeof t.clientMaxWindowBits&&!e.client_max_window_bits)));if(!r)throw new Error(\"None of the extension offers can be accepted\");return t.serverNoContextTakeover&&(r.server_no_context_takeover=!0),t.clientNoContextTakeover&&(r.client_no_context_takeover=!0),\"number\"==typeof t.serverMaxWindowBits&&(r.server_max_window_bits=t.serverMaxWindowBits),\"number\"==typeof t.clientMaxWindowBits?r.client_max_window_bits=t.clientMaxWindowBits:!0!==r.client_max_window_bits&&!1!==t.clientMaxWindowBits||delete r.client_max_window_bits,r}acceptAsClient(e){const t=e[0];if(!1===this._options.clientNoContextTakeover&&t.client_no_context_takeover)throw new Error('Unexpected parameter \"client_no_context_takeover\"');if(t.client_max_window_bits){if(!1===this._options.clientMaxWindowBits||\"number\"==typeof this._options.clientMaxWindowBits&&t.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter \"client_max_window_bits\"')}else\"number\"==typeof this._options.clientMaxWindowBits&&(t.client_max_window_bits=this._options.clientMaxWindowBits);return t}normalizeParams(e){return e.forEach((e=>{Object.keys(e).forEach((t=>{let r=e[t];if(r.length>1)throw new Error(`Parameter \"${t}\" must have only a single value`);if(r=r[0],\"client_max_window_bits\"===t){if(!0!==r){const e=+r;if(!Number.isInteger(e)||e<8||e>15)throw new TypeError(`Invalid value for parameter \"${t}\": ${r}`);r=e}else if(!this._isServer)throw new TypeError(`Invalid value for parameter \"${t}\": ${r}`)}else if(\"server_max_window_bits\"===t){const e=+r;if(!Number.isInteger(e)||e<8||e>15)throw new TypeError(`Invalid value for parameter \"${t}\": ${r}`);r=e}else{if(\"client_no_context_takeover\"!==t&&\"server_no_context_takeover\"!==t)throw new Error(`Unknown parameter \"${t}\"`);if(!0!==r)throw new TypeError(`Invalid value for parameter \"${t}\": ${r}`)}e[t]=r}))})),e}decompress(e,t,r){al.add((s=>{this._decompress(e,t,((e,t)=>{s(),r(e,t)}))}))}compress(e,t,r){al.add((s=>{this._compress(e,t,((e,t)=>{s(),r(e,t)}))}))}_decompress(e,t,r){const s=this._isServer?\"client\":\"server\";if(!this._inflate){const e=`${s}_max_window_bits`,t=\"number\"!=typeof this.params[e]?Aa.Z_DEFAULT_WINDOWBITS:this.params[e];this._inflate=Aa.createInflateRaw({...this._options.zlibInflateOptions,windowBits:t}),this._inflate[rl]=this,this._inflate[sl]=0,this._inflate[il]=[],this._inflate.on(\"error\",hl),this._inflate.on(\"data\",dl)}this._inflate[nl]=r,this._inflate.write(e),t&&this._inflate.write(tl),this._inflate.flush((()=>{const e=this._inflate[ol];if(e)return this._inflate.close(),this._inflate=null,void r(e);const n=$a.concat(this._inflate[il],this._inflate[sl]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[sl]=0,this._inflate[il]=[],t&&this.params[`${s}_no_context_takeover`]&&this._inflate.reset()),r(null,n)}))}_compress(e,t,r){const s=this._isServer?\"server\":\"client\";if(!this._deflate){const e=`${s}_max_window_bits`,t=\"number\"!=typeof this.params[e]?Aa.Z_DEFAULT_WINDOWBITS:this.params[e];this._deflate=Aa.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:t}),this._deflate[sl]=0,this._deflate[il]=[],this._deflate.on(\"data\",cl)}this._deflate[nl]=r,this._deflate.write(e),this._deflate.flush(Aa.Z_SYNC_FLUSH,(()=>{if(!this._deflate)return;let e=$a.concat(this._deflate[il],this._deflate[sl]);t&&(e=e.slice(0,e.length-4)),this._deflate[nl]=null,this._deflate[sl]=0,this._deflate[il]=[],t&&this.params[`${s}_no_context_takeover`]&&this._deflate.reset(),r(null,e)}))}};function cl(e){this[il].push(e),this[sl]+=e.length}function dl(e){this[sl]+=e.length,this[rl]._maxPayload<1||this[sl]<=this[rl]._maxPayload?this[il].push(e):(this[ol]=new RangeError(\"Max payload size exceeded\"),this[ol].code=\"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH\",this[ol][el]=1009,this.removeListener(\"data\",dl),this.reset())}function hl(e){this[rl]._inflate=null,e[el]=1007,this[nl](e)}var ul={exports:{}};const fl=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0];function pl(e){return e>=1e3&&e<=1014&&1004!==e&&1005!==e&&1006!==e||e>=3e3&&e<=4999}function ml(e){const t=e.length;let r=0;for(;r<t;)if(0==(128&e[r]))r++;else if(192==(224&e[r])){if(r+1===t||128!=(192&e[r+1])||192==(254&e[r]))return!1;r+=2}else if(224==(240&e[r])){if(r+2>=t||128!=(192&e[r+1])||128!=(192&e[r+2])||224===e[r]&&128==(224&e[r+1])||237===e[r]&&160==(224&e[r+1]))return!1;r+=3}else{if(240!=(248&e[r]))return!1;if(r+3>=t||128!=(192&e[r+1])||128!=(192&e[r+2])||128!=(192&e[r+3])||240===e[r]&&128==(240&e[r+1])||244===e[r]&&e[r+1]>143||e[r]>244)return!1;r+=4}return!0}try{const e=__webpack_require__(\"utf-8-validate\");ul.exports={isValidStatusCode:pl,isValidUTF8:t=>t.length<150?ml(t):e(t),tokenChars:fl}}catch(ad){ul.exports={isValidStatusCode:pl,isValidUTF8:ml,tokenChars:fl}}const{Writable:bl}=g.default,yl=ll,{BINARY_TYPES:gl,EMPTY_BUFFER:wl,kStatusCode:Sl,kWebSocket:vl}=Ka,{concat:_l,toArrayBuffer:Zl,unmask:Xl}=Fa.exports,{isValidStatusCode:Ll,isValidUTF8:xl}=ul.exports;var Tl=class extends bl{constructor(e={}){super(),this._binaryType=e.binaryType||gl[0],this._extensions=e.extensions||{},this._isServer=!!e.isServer,this._maxPayload=0|e.maxPayload,this._skipUTF8Validation=!!e.skipUTF8Validation,this[vl]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._state=0,this._loop=!1}_write(e,t,r){if(8===this._opcode&&0==this._state)return r();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(r)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){const t=this._buffers[0];return this._buffers[0]=t.slice(e),t.slice(0,e)}const t=Buffer.allocUnsafe(e);do{const r=this._buffers[0],s=t.length-e;e>=r.length?t.set(this._buffers.shift(),s):(t.set(new Uint8Array(r.buffer,r.byteOffset,e),s),this._buffers[0]=r.slice(e)),e-=r.length}while(e>0);return t}startLoop(e){let t;this._loop=!0;do{switch(this._state){case 0:t=this.getInfo();break;case 1:t=this.getPayloadLength16();break;case 2:t=this.getPayloadLength64();break;case 3:this.getMask();break;case 4:t=this.getData(e);break;default:return void(this._loop=!1)}}while(this._loop);e(t)}getInfo(){if(this._bufferedBytes<2)return void(this._loop=!1);const e=this.consume(2);if(0!=(48&e[0]))return this._loop=!1,kl(RangeError,\"RSV2 and RSV3 must be clear\",!0,1002,\"WS_ERR_UNEXPECTED_RSV_2_3\");const t=64==(64&e[0]);if(t&&!this._extensions[yl.extensionName])return this._loop=!1,kl(RangeError,\"RSV1 must be clear\",!0,1002,\"WS_ERR_UNEXPECTED_RSV_1\");if(this._fin=128==(128&e[0]),this._opcode=15&e[0],this._payloadLength=127&e[1],0===this._opcode){if(t)return this._loop=!1,kl(RangeError,\"RSV1 must be clear\",!0,1002,\"WS_ERR_UNEXPECTED_RSV_1\");if(!this._fragmented)return this._loop=!1,kl(RangeError,\"invalid opcode 0\",!0,1002,\"WS_ERR_INVALID_OPCODE\");this._opcode=this._fragmented}else if(1===this._opcode||2===this._opcode){if(this._fragmented)return this._loop=!1,kl(RangeError,`invalid opcode ${this._opcode}`,!0,1002,\"WS_ERR_INVALID_OPCODE\");this._compressed=t}else{if(!(this._opcode>7&&this._opcode<11))return this._loop=!1,kl(RangeError,`invalid opcode ${this._opcode}`,!0,1002,\"WS_ERR_INVALID_OPCODE\");if(!this._fin)return this._loop=!1,kl(RangeError,\"FIN must be set\",!0,1002,\"WS_ERR_EXPECTED_FIN\");if(t)return this._loop=!1,kl(RangeError,\"RSV1 must be clear\",!0,1002,\"WS_ERR_UNEXPECTED_RSV_1\");if(this._payloadLength>125)return this._loop=!1,kl(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,\"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH\")}if(this._fin||this._fragmented||(this._fragmented=this._opcode),this._masked=128==(128&e[1]),this._isServer){if(!this._masked)return this._loop=!1,kl(RangeError,\"MASK must be set\",!0,1002,\"WS_ERR_EXPECTED_MASK\")}else if(this._masked)return this._loop=!1,kl(RangeError,\"MASK must be clear\",!0,1002,\"WS_ERR_UNEXPECTED_MASK\");if(126===this._payloadLength)this._state=1;else{if(127!==this._payloadLength)return this.haveLength();this._state=2}}getPayloadLength16(){if(!(this._bufferedBytes<2))return this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength();this._loop=!1}getPayloadLength64(){if(this._bufferedBytes<8)return void(this._loop=!1);const e=this.consume(8),t=e.readUInt32BE(0);return t>Math.pow(2,21)-1?(this._loop=!1,kl(RangeError,\"Unsupported WebSocket frame: payload length > 2^53 - 1\",!1,1009,\"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH\")):(this._payloadLength=t*Math.pow(2,32)+e.readUInt32BE(4),this.haveLength())}haveLength(){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0))return this._loop=!1,kl(RangeError,\"Max payload size exceeded\",!1,1009,\"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH\");this._masked?this._state=3:this._state=4}getMask(){this._bufferedBytes<4?this._loop=!1:(this._mask=this.consume(4),this._state=4)}getData(e){let t=wl;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength)return void(this._loop=!1);t=this.consume(this._payloadLength),this._masked&&0!=(this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3])&&Xl(t,this._mask)}return this._opcode>7?this.controlMessage(t):this._compressed?(this._state=5,void this.decompress(t,e)):(t.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(t)),this.dataMessage())}decompress(e,t){this._extensions[yl.extensionName].decompress(e,this._fin,((e,r)=>{if(e)return t(e);if(r.length){if(this._messageLength+=r.length,this._messageLength>this._maxPayload&&this._maxPayload>0)return t(kl(RangeError,\"Max payload size exceeded\",!1,1009,\"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH\"));this._fragments.push(r)}const s=this.dataMessage();if(s)return t(s);this.startLoop(t)}))}dataMessage(){if(this._fin){const e=this._messageLength,t=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],2===this._opcode){let r;r=\"nodebuffer\"===this._binaryType?_l(t,e):\"arraybuffer\"===this._binaryType?Zl(_l(t,e)):t,this.emit(\"message\",r,!0)}else{const r=_l(t,e);if(!this._skipUTF8Validation&&!xl(r))return this._loop=!1,kl(Error,\"invalid UTF-8 sequence\",!0,1007,\"WS_ERR_INVALID_UTF8\");this.emit(\"message\",r,!1)}}this._state=0}controlMessage(e){if(8===this._opcode)if(this._loop=!1,0===e.length)this.emit(\"conclude\",1005,wl),this.end();else{if(1===e.length)return kl(RangeError,\"invalid payload length 1\",!0,1002,\"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH\");{const t=e.readUInt16BE(0);if(!Ll(t))return kl(RangeError,`invalid status code ${t}`,!0,1002,\"WS_ERR_INVALID_CLOSE_CODE\");const r=e.slice(2);if(!this._skipUTF8Validation&&!xl(r))return kl(Error,\"invalid UTF-8 sequence\",!0,1007,\"WS_ERR_INVALID_UTF8\");this.emit(\"conclude\",t,r),this.end()}}else 9===this._opcode?this.emit(\"ping\",e):this.emit(\"pong\",e);this._state=0}};function kl(e,t,r,s,n){const i=new e(r?`Invalid WebSocket frame: ${t}`:t);return Error.captureStackTrace(i,kl),i.code=n,i[Sl]=s,i}const{randomFillSync:Gl}=_.default,Rl=ll,{EMPTY_BUFFER:Wl}=Ka,{isValidStatusCode:Cl}=ul.exports,{mask:Pl,toBuffer:Il}=Fa.exports,Vl=Buffer.alloc(4);class Yl{constructor(e,t,r){this._extensions=t||{},r&&(this._generateMask=r,this._maskBuffer=Buffer.alloc(4)),this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._deflating=!1,this._queue=[]}static frame(e,t){let r,s=!1,n=2,i=!1;t.mask&&(r=t.maskBuffer||Vl,t.generateMask?t.generateMask(r):Gl(r,0,4),i=0==(r[0]|r[1]|r[2]|r[3]),t.readOnly&&!i&&(s=!0),n=6);let o=e.length;e.length>=65536?(n+=8,o=127):e.length>125&&(n+=2,o=126);const a=Buffer.allocUnsafe(s?e.length+n:n);return a[0]=t.fin?128|t.opcode:t.opcode,t.rsv1&&(a[0]|=64),a[1]=o,126===o?a.writeUInt16BE(e.length,2):127===o&&(a[2]=a[3]=0,a.writeUIntBE(e.length,4,6)),t.mask?(a[1]|=128,a[n-4]=r[0],a[n-3]=r[1],a[n-2]=r[2],a[n-1]=r[3],i?[a,e]:s?(Pl(e,r,a,n,e.length),[a]):(Pl(e,r,e,0,e.length),[a,e])):[a,e]}close(e,t,r,s){let n;if(void 0===e)n=Wl;else{if(\"number\"!=typeof e||!Cl(e))throw new TypeError(\"First argument must be a valid error code number\");if(void 0!==t&&t.length){const r=Buffer.byteLength(t);if(r>123)throw new RangeError(\"The message must not be greater than 123 bytes\");n=Buffer.allocUnsafe(2+r),n.writeUInt16BE(e,0),\"string\"==typeof t?n.write(t,2):n.set(t,2)}else n=Buffer.allocUnsafe(2),n.writeUInt16BE(e,0)}this._deflating?this.enqueue([this.doClose,n,r,s]):this.doClose(n,r,s)}doClose(e,t,r){this.sendFrame(Yl.frame(e,{fin:!0,rsv1:!1,opcode:8,mask:t,maskBuffer:this._maskBuffer,generateMask:this._generateMask,readOnly:!1}),r)}ping(e,t,r){const s=Il(e);if(s.length>125)throw new RangeError(\"The data size must not be greater than 125 bytes\");this._deflating?this.enqueue([this.doPing,s,t,Il.readOnly,r]):this.doPing(s,t,Il.readOnly,r)}doPing(e,t,r,s){this.sendFrame(Yl.frame(e,{fin:!0,rsv1:!1,opcode:9,mask:t,maskBuffer:this._maskBuffer,generateMask:this._generateMask,readOnly:r}),s)}pong(e,t,r){const s=Il(e);if(s.length>125)throw new RangeError(\"The data size must not be greater than 125 bytes\");this._deflating?this.enqueue([this.doPong,s,t,Il.readOnly,r]):this.doPong(s,t,Il.readOnly,r)}doPong(e,t,r,s){this.sendFrame(Yl.frame(e,{fin:!0,rsv1:!1,opcode:10,mask:t,maskBuffer:this._maskBuffer,generateMask:this._generateMask,readOnly:r}),s)}send(e,t,r){const s=Il(e),n=this._extensions[Rl.extensionName];let i=t.binary?2:1,o=t.compress;if(this._firstFragment?(this._firstFragment=!1,o&&n&&n.params[n._isServer?\"server_no_context_takeover\":\"client_no_context_takeover\"]&&(o=s.length>=n._threshold),this._compress=o):(o=!1,i=0),t.fin&&(this._firstFragment=!0),n){const e={fin:t.fin,rsv1:o,opcode:i,mask:t.mask,maskBuffer:this._maskBuffer,generateMask:this._generateMask,readOnly:Il.readOnly};this._deflating?this.enqueue([this.dispatch,s,this._compress,e,r]):this.dispatch(s,this._compress,e,r)}else this.sendFrame(Yl.frame(s,{fin:t.fin,rsv1:!1,opcode:i,mask:t.mask,maskBuffer:this._maskBuffer,generateMask:this._generateMask,readOnly:Il.readOnly}),r)}dispatch(e,t,r,s){if(!t)return void this.sendFrame(Yl.frame(e,r),s);const n=this._extensions[Rl.extensionName];this._bufferedBytes+=e.length,this._deflating=!0,n.compress(e,r.fin,((t,n)=>{if(this._socket.destroyed){const e=new Error(\"The socket was closed while data was being compressed\");\"function\"==typeof s&&s(e);for(let t=0;t<this._queue.length;t++){const r=this._queue[t][4];\"function\"==typeof r&&r(e)}}else this._bufferedBytes-=e.length,this._deflating=!1,r.readOnly=!1,this.sendFrame(Yl.frame(n,r),s),this.dequeue()}))}dequeue(){for(;!this._deflating&&this._queue.length;){const e=this._queue.shift();this._bufferedBytes-=e[1].length,Reflect.apply(e[0],this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[1].length,this._queue.push(e)}sendFrame(e,t){2===e.length?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],t),this._socket.uncork()):this._socket.write(e[0],t)}}var Hl=Yl;const{kForOnEventAttribute:Ml,kListener:El}=Ka,Fl=Symbol(\"kCode\"),Kl=Symbol(\"kData\"),Nl=Symbol(\"kError\"),zl=Symbol(\"kMessage\"),jl=Symbol(\"kReason\"),Ul=Symbol(\"kTarget\"),Ol=Symbol(\"kType\"),Ql=Symbol(\"kWasClean\");class Jl{constructor(e){this[Ul]=null,this[Ol]=e}get target(){return this[Ul]}get type(){return this[Ol]}}Object.defineProperty(Jl.prototype,\"target\",{enumerable:!0}),Object.defineProperty(Jl.prototype,\"type\",{enumerable:!0});class Dl extends Jl{constructor(e,t={}){super(e),this[Fl]=void 0===t.code?0:t.code,this[jl]=void 0===t.reason?\"\":t.reason,this[Ql]=void 0!==t.wasClean&&t.wasClean}get code(){return this[Fl]}get reason(){return this[jl]}get wasClean(){return this[Ql]}}Object.defineProperty(Dl.prototype,\"code\",{enumerable:!0}),Object.defineProperty(Dl.prototype,\"reason\",{enumerable:!0}),Object.defineProperty(Dl.prototype,\"wasClean\",{enumerable:!0});class Bl extends Jl{constructor(e,t={}){super(e),this[Nl]=void 0===t.error?null:t.error,this[zl]=void 0===t.message?\"\":t.message}get error(){return this[Nl]}get message(){return this[zl]}}Object.defineProperty(Bl.prototype,\"error\",{enumerable:!0}),Object.defineProperty(Bl.prototype,\"message\",{enumerable:!0});class Al extends Jl{constructor(e,t={}){super(e),this[Kl]=void 0===t.data?null:t.data}get data(){return this[Kl]}}Object.defineProperty(Al.prototype,\"data\",{enumerable:!0});const $l={addEventListener(e,t,r={}){let s;if(\"message\"===e)s=function(e,r){const s=new Al(\"message\",{data:r?e:e.toString()});s[Ul]=this,t.call(this,s)};else if(\"close\"===e)s=function(e,r){const s=new Dl(\"close\",{code:e,reason:r.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});s[Ul]=this,t.call(this,s)};else if(\"error\"===e)s=function(e){const r=new Bl(\"error\",{error:e,message:e.message});r[Ul]=this,t.call(this,r)};else{if(\"open\"!==e)return;s=function(){const e=new Jl(\"open\");e[Ul]=this,t.call(this,e)}}s[Ml]=!!r[Ml],s[El]=t,r.once?this.once(e,s):this.on(e,s)},removeEventListener(e,t){for(const r of this.listeners(e))if(r[El]===t&&!r[Ml]){this.removeListener(e,r);break}}};var ql={CloseEvent:Dl,ErrorEvent:Bl,Event:Jl,EventTarget:$l,MessageEvent:Al};const{tokenChars:ec}=ul.exports;function tc(e,t,r){void 0===e[t]?e[t]=[r]:e[t].push(r)}var rc={format:function(e){return Object.keys(e).map((t=>{let r=e[t];return Array.isArray(r)||(r=[r]),r.map((e=>[t].concat(Object.keys(e).map((t=>{let r=e[t];return Array.isArray(r)||(r=[r]),r.map((e=>!0===e?t:`${t}=${e}`)).join(\"; \")}))).join(\"; \"))).join(\", \")})).join(\", \")},parse:function(e){const t=Object.create(null);let r,s,n=Object.create(null),i=!1,o=!1,a=!1,l=-1,c=-1,d=-1,h=0;for(;h<e.length;h++)if(c=e.charCodeAt(h),void 0===r)if(-1===d&&1===ec[c])-1===l&&(l=h);else if(0===h||32!==c&&9!==c){if(59!==c&&44!==c)throw new SyntaxError(`Unexpected character at index ${h}`);{if(-1===l)throw new SyntaxError(`Unexpected character at index ${h}`);-1===d&&(d=h);const s=e.slice(l,d);44===c?(tc(t,s,n),n=Object.create(null)):r=s,l=d=-1}}else-1===d&&-1!==l&&(d=h);else if(void 0===s)if(-1===d&&1===ec[c])-1===l&&(l=h);else if(32===c||9===c)-1===d&&-1!==l&&(d=h);else if(59===c||44===c){if(-1===l)throw new SyntaxError(`Unexpected character at index ${h}`);-1===d&&(d=h),tc(n,e.slice(l,d),!0),44===c&&(tc(t,r,n),n=Object.create(null),r=void 0),l=d=-1}else{if(61!==c||-1===l||-1!==d)throw new SyntaxError(`Unexpected character at index ${h}`);s=e.slice(l,h),l=d=-1}else if(o){if(1!==ec[c])throw new SyntaxError(`Unexpected character at index ${h}`);-1===l?l=h:i||(i=!0),o=!1}else if(a)if(1===ec[c])-1===l&&(l=h);else if(34===c&&-1!==l)a=!1,d=h;else{if(92!==c)throw new SyntaxError(`Unexpected character at index ${h}`);o=!0}else if(34===c&&61===e.charCodeAt(h-1))a=!0;else if(-1===d&&1===ec[c])-1===l&&(l=h);else if(-1===l||32!==c&&9!==c){if(59!==c&&44!==c)throw new SyntaxError(`Unexpected character at index ${h}`);{if(-1===l)throw new SyntaxError(`Unexpected character at index ${h}`);-1===d&&(d=h);let o=e.slice(l,d);i&&(o=o.replace(/\\\\/g,\"\"),i=!1),tc(n,s,o),44===c&&(tc(t,r,n),n=Object.create(null),r=void 0),s=void 0,l=d=-1}}else-1===d&&(d=h);if(-1===l||a||32===c||9===c)throw new SyntaxError(\"Unexpected end of input\");-1===d&&(d=h);const u=e.slice(l,d);return void 0===r?tc(t,u,n):(void 0===s?tc(n,u,!0):tc(n,s,i?u.replace(/\\\\/g,\"\"):u),tc(t,r,n)),t}};const sc=Z.default,nc=X.default,ic=L.default,oc=S.default,ac=v.default,{randomBytes:lc,createHash:cc}=_.default,{URL:dc}=x.default,hc=ll,uc=Tl,fc=Hl,{BINARY_TYPES:pc,EMPTY_BUFFER:mc,GUID:bc,kForOnEventAttribute:yc,kListener:gc,kStatusCode:wc,kWebSocket:Sc,NOOP:vc}=Ka,{EventTarget:{addEventListener:_c,removeEventListener:Zc}}=ql,{format:Xc,parse:Lc}=rc,{toBuffer:xc}=Fa.exports,Tc=[\"CONNECTING\",\"OPEN\",\"CLOSING\",\"CLOSED\"],kc=/^[!#$%&'*+\\-.0-9A-Z^_`|a-z~]+$/,Gc=[8,13];class Rc extends sc{constructor(e,t,r){super(),this._binaryType=pc[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=mc,this._closeTimer=null,this._extensions={},this._paused=!1,this._protocol=\"\",this._readyState=Rc.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,null!==e?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,void 0===t?t=[]:Array.isArray(t)||(\"object\"==typeof t&&null!==t?(r=t,t=[]):t=[t]),Cc(this,e,t,r)):this._isServer=!0}get binaryType(){return this._binaryType}set binaryType(e){pc.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(e,t,r){const s=new uc({binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:r.maxPayload,skipUTF8Validation:r.skipUTF8Validation});this._sender=new fc(e,this._extensions,r.generateMask),this._receiver=s,this._socket=e,s[Sc]=this,e[Sc]=this,s.on(\"conclude\",Mc),s.on(\"drain\",Ec),s.on(\"error\",Fc),s.on(\"message\",Nc),s.on(\"ping\",zc),s.on(\"pong\",jc),e.setTimeout(0),e.setNoDelay(),t.length>0&&e.unshift(t),e.on(\"close\",Oc),e.on(\"data\",Qc),e.on(\"end\",Jc),e.on(\"error\",Dc),this._readyState=Rc.OPEN,this.emit(\"open\")}emitClose(){if(!this._socket)return this._readyState=Rc.CLOSED,void this.emit(\"close\",this._closeCode,this._closeMessage);this._extensions[hc.extensionName]&&this._extensions[hc.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=Rc.CLOSED,this.emit(\"close\",this._closeCode,this._closeMessage)}close(e,t){if(this.readyState!==Rc.CLOSED){if(this.readyState===Rc.CONNECTING){const e=\"WebSocket was closed before the connection was established\";return Yc(this,this._req,e)}this.readyState!==Rc.CLOSING?(this._readyState=Rc.CLOSING,this._sender.close(e,t,!this._isServer,(e=>{e||(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())})),this._closeTimer=setTimeout(this._socket.destroy.bind(this._socket),3e4)):this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end()}}pause(){this.readyState!==Rc.CONNECTING&&this.readyState!==Rc.CLOSED&&(this._paused=!0,this._socket.pause())}ping(e,t,r){if(this.readyState===Rc.CONNECTING)throw new Error(\"WebSocket is not open: readyState 0 (CONNECTING)\");\"function\"==typeof e?(r=e,e=t=void 0):\"function\"==typeof t&&(r=t,t=void 0),\"number\"==typeof e&&(e=e.toString()),this.readyState===Rc.OPEN?(void 0===t&&(t=!this._isServer),this._sender.ping(e||mc,t,r)):Hc(this,e,r)}pong(e,t,r){if(this.readyState===Rc.CONNECTING)throw new Error(\"WebSocket is not open: readyState 0 (CONNECTING)\");\"function\"==typeof e?(r=e,e=t=void 0):\"function\"==typeof t&&(r=t,t=void 0),\"number\"==typeof e&&(e=e.toString()),this.readyState===Rc.OPEN?(void 0===t&&(t=!this._isServer),this._sender.pong(e||mc,t,r)):Hc(this,e,r)}resume(){this.readyState!==Rc.CONNECTING&&this.readyState!==Rc.CLOSED&&(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(e,t,r){if(this.readyState===Rc.CONNECTING)throw new Error(\"WebSocket is not open: readyState 0 (CONNECTING)\");if(\"function\"==typeof t&&(r=t,t={}),\"number\"==typeof e&&(e=e.toString()),this.readyState!==Rc.OPEN)return void Hc(this,e,r);const s={binary:\"string\"!=typeof e,mask:!this._isServer,compress:!0,fin:!0,...t};this._extensions[hc.extensionName]||(s.compress=!1),this._sender.send(e||mc,s,r)}terminate(){if(this.readyState!==Rc.CLOSED){if(this.readyState===Rc.CONNECTING){const e=\"WebSocket was closed before the connection was established\";return Yc(this,this._req,e)}this._socket&&(this._readyState=Rc.CLOSING,this._socket.destroy())}}}Object.defineProperty(Rc,\"CONNECTING\",{enumerable:!0,value:Tc.indexOf(\"CONNECTING\")}),Object.defineProperty(Rc.prototype,\"CONNECTING\",{enumerable:!0,value:Tc.indexOf(\"CONNECTING\")}),Object.defineProperty(Rc,\"OPEN\",{enumerable:!0,value:Tc.indexOf(\"OPEN\")}),Object.defineProperty(Rc.prototype,\"OPEN\",{enumerable:!0,value:Tc.indexOf(\"OPEN\")}),Object.defineProperty(Rc,\"CLOSING\",{enumerable:!0,value:Tc.indexOf(\"CLOSING\")}),Object.defineProperty(Rc.prototype,\"CLOSING\",{enumerable:!0,value:Tc.indexOf(\"CLOSING\")}),Object.defineProperty(Rc,\"CLOSED\",{enumerable:!0,value:Tc.indexOf(\"CLOSED\")}),Object.defineProperty(Rc.prototype,\"CLOSED\",{enumerable:!0,value:Tc.indexOf(\"CLOSED\")}),[\"binaryType\",\"bufferedAmount\",\"extensions\",\"isPaused\",\"protocol\",\"readyState\",\"url\"].forEach((e=>{Object.defineProperty(Rc.prototype,e,{enumerable:!0})})),[\"open\",\"error\",\"close\",\"message\"].forEach((e=>{Object.defineProperty(Rc.prototype,`on${e}`,{enumerable:!0,get(){for(const t of this.listeners(e))if(t[yc])return t[gc];return null},set(t){for(const t of this.listeners(e))if(t[yc]){this.removeListener(e,t);break}\"function\"==typeof t&&this.addEventListener(e,t,{[yc]:!0})}})})),Rc.prototype.addEventListener=_c,Rc.prototype.removeEventListener=Zc;var Wc=Rc;function Cc(e,t,r,s){const n={protocolVersion:Gc[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...s,createConnection:void 0,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:void 0,host:void 0,path:void 0,port:void 0};if(!Gc.includes(n.protocolVersion))throw new RangeError(`Unsupported protocol version: ${n.protocolVersion} (supported versions: ${Gc.join(\", \")})`);let i;if(t instanceof dc)i=t,e._url=t.href;else{try{i=new dc(t)}catch(e){throw new SyntaxError(`Invalid URL: ${t}`)}e._url=t}const o=\"wss:\"===i.protocol,a=\"ws+unix:\"===i.protocol;let l;if(\"ws:\"===i.protocol||o||a?a&&!i.pathname?l=\"The URL's pathname is empty\":i.hash&&(l=\"The URL contains a fragment identifier\"):l='The URL\\'s protocol must be one of \"ws:\", \"wss:\", or \"ws+unix:\"',l){const t=new SyntaxError(l);if(0===e._redirects)throw t;return void Pc(e,t)}const c=o?443:80,d=lc(16).toString(\"base64\"),h=o?nc.get:ic.get,u=new Set;let f;if(n.createConnection=o?Vc:Ic,n.defaultPort=n.defaultPort||c,n.port=i.port||c,n.host=i.hostname.startsWith(\"[\")?i.hostname.slice(1,-1):i.hostname,n.headers={\"Sec-WebSocket-Version\":n.protocolVersion,\"Sec-WebSocket-Key\":d,Connection:\"Upgrade\",Upgrade:\"websocket\",...n.headers},n.path=i.pathname+i.search,n.timeout=n.handshakeTimeout,n.perMessageDeflate&&(f=new hc(!0!==n.perMessageDeflate?n.perMessageDeflate:{},!1,n.maxPayload),n.headers[\"Sec-WebSocket-Extensions\"]=Xc({[hc.extensionName]:f.offer()})),r.length){for(const e of r){if(\"string\"!=typeof e||!kc.test(e)||u.has(e))throw new SyntaxError(\"An invalid or duplicated subprotocol was specified\");u.add(e)}n.headers[\"Sec-WebSocket-Protocol\"]=r.join(\",\")}if(n.origin&&(n.protocolVersion<13?n.headers[\"Sec-WebSocket-Origin\"]=n.origin:n.headers.Origin=n.origin),(i.username||i.password)&&(n.auth=`${i.username}:${i.password}`),a){const e=n.path.split(\":\");n.socketPath=e[0],n.path=e[1]}let p=e._req=h(n);n.timeout&&p.on(\"timeout\",(()=>{Yc(e,p,\"Opening handshake has timed out\")})),p.on(\"error\",(t=>{null===p||p.aborted||(p=e._req=null,Pc(e,t))})),p.on(\"response\",(i=>{const o=i.headers.location,a=i.statusCode;if(o&&n.followRedirects&&a>=300&&a<400){if(++e._redirects>n.maxRedirects)return void Yc(e,p,\"Maximum redirects exceeded\");let i;p.abort();try{i=new dc(o,t)}catch(t){const r=new SyntaxError(`Invalid URL: ${o}`);return void Pc(e,r)}Cc(e,i,r,s)}else e.emit(\"unexpected-response\",p,i)||Yc(e,p,`Unexpected server response: ${i.statusCode}`)})),p.on(\"upgrade\",((t,r,s)=>{if(e.emit(\"upgrade\",t),e.readyState!==Rc.CONNECTING)return;p=e._req=null;const i=cc(\"sha1\").update(d+bc).digest(\"base64\");if(t.headers[\"sec-websocket-accept\"]!==i)return void Yc(e,r,\"Invalid Sec-WebSocket-Accept header\");const o=t.headers[\"sec-websocket-protocol\"];let a;if(void 0!==o?u.size?u.has(o)||(a=\"Server sent an invalid subprotocol\"):a=\"Server sent a subprotocol but none was requested\":u.size&&(a=\"Server sent no subprotocol\"),a)return void Yc(e,r,a);o&&(e._protocol=o);const l=t.headers[\"sec-websocket-extensions\"];if(void 0!==l){if(!f){return void Yc(e,r,\"Server sent a Sec-WebSocket-Extensions header but no extension was requested\")}let t;try{t=Lc(l)}catch(t){return void Yc(e,r,\"Invalid Sec-WebSocket-Extensions header\")}const s=Object.keys(t);if(1!==s.length||s[0]!==hc.extensionName){return void Yc(e,r,\"Server indicated an extension that was not requested\")}try{f.accept(t[hc.extensionName])}catch(t){return void Yc(e,r,\"Invalid Sec-WebSocket-Extensions header\")}e._extensions[hc.extensionName]=f}e.setSocket(r,s,{generateMask:n.generateMask,maxPayload:n.maxPayload,skipUTF8Validation:n.skipUTF8Validation})}))}function Pc(e,t){e._readyState=Rc.CLOSING,e.emit(\"error\",t),e.emitClose()}function Ic(e){return e.path=e.socketPath,oc.connect(e)}function Vc(e){return e.path=void 0,e.servername||\"\"===e.servername||(e.servername=oc.isIP(e.host)?\"\":e.host),ac.connect(e)}function Yc(e,t,r){e._readyState=Rc.CLOSING;const s=new Error(r);Error.captureStackTrace(s,Yc),t.setHeader?(t.abort(),t.socket&&!t.socket.destroyed&&t.socket.destroy(),t.once(\"abort\",e.emitClose.bind(e)),e.emit(\"error\",s)):(t.destroy(s),t.once(\"error\",e.emit.bind(e,\"error\")),t.once(\"close\",e.emitClose.bind(e)))}function Hc(e,t,r){if(t){const r=xc(t).length;e._socket?e._sender._bufferedBytes+=r:e._bufferedAmount+=r}if(r){r(new Error(`WebSocket is not open: readyState ${e.readyState} (${Tc[e.readyState]})`))}}function Mc(e,t){const r=this[Sc];r._closeFrameReceived=!0,r._closeMessage=t,r._closeCode=e,void 0!==r._socket[Sc]&&(r._socket.removeListener(\"data\",Qc),process.nextTick(Uc,r._socket),1005===e?r.close():r.close(e,t))}function Ec(){const e=this[Sc];e.isPaused||e._socket.resume()}function Fc(e){const t=this[Sc];void 0!==t._socket[Sc]&&(t._socket.removeListener(\"data\",Qc),process.nextTick(Uc,t._socket),t.close(e[wc])),t.emit(\"error\",e)}function Kc(){this[Sc].emitClose()}function Nc(e,t){this[Sc].emit(\"message\",e,t)}function zc(e){const t=this[Sc];t.pong(e,!t._isServer,vc),t.emit(\"ping\",e)}function jc(e){this[Sc].emit(\"pong\",e)}function Uc(e){e.resume()}function Oc(){const e=this[Sc];let t;this.removeListener(\"close\",Oc),this.removeListener(\"data\",Qc),this.removeListener(\"end\",Jc),e._readyState=Rc.CLOSING,this._readableState.endEmitted||e._closeFrameReceived||e._receiver._writableState.errorEmitted||null===(t=e._socket.read())||e._receiver.write(t),e._receiver.end(),this[Sc]=void 0,clearTimeout(e._closeTimer),e._receiver._writableState.finished||e._receiver._writableState.errorEmitted?e.emitClose():(e._receiver.on(\"error\",Kc),e._receiver.on(\"finish\",Kc))}function Qc(e){this[Sc]._receiver.write(e)||this.pause()}function Jc(){const e=this[Sc];e._readyState=Rc.CLOSING,e._receiver.end(),this.end()}function Dc(){const e=this[Sc];this.removeListener(\"error\",Dc),this.on(\"error\",vc),e&&(e._readyState=Rc.CLOSING,this.destroy())}var Bc={exports:{}};!function(e){const t=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?Symbol:e=>`Symbol(${e})`;function r(){}function s(){return\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:void 0!==W?W:void 0}const n=s();function i(e){return\"object\"==typeof e&&null!==e||\"function\"==typeof e}const o=r,a=Promise,l=Promise.prototype.then,c=Promise.resolve.bind(a),d=Promise.reject.bind(a);function h(e){return new a(e)}function u(e){return c(e)}function f(e){return d(e)}function p(e,t,r){return l.call(e,t,r)}function m(e,t,r){p(p(e,t,r),void 0,o)}function b(e,t){m(e,t)}function y(e,t){m(e,void 0,t)}function g(e,t,r){return p(e,t,r)}function w(e){p(e,void 0,o)}const S=(()=>{const e=n&&n.queueMicrotask;if(\"function\"==typeof e)return e;const t=u(void 0);return e=>p(t,e)})();function v(e,t,r){if(\"function\"!=typeof e)throw new TypeError(\"Argument is not a function\");return Function.prototype.apply.call(e,t,r)}function _(e,t,r){try{return u(v(e,t,r))}catch(e){return f(e)}}const Z=16384;class X{constructor(){this._cursor=0,this._size=0,this._front={_elements:[],_next:void 0},this._back=this._front,this._cursor=0,this._size=0}get length(){return this._size}push(e){const t=this._back;let r=t;t._elements.length===Z-1&&(r={_elements:[],_next:void 0}),t._elements.push(e),r!==t&&(this._back=r,t._next=r),++this._size}shift(){const e=this._front;let t=e;const r=this._cursor;let s=r+1;const n=e._elements,i=n[r];return s===Z&&(t=e._next,s=0),--this._size,this._cursor=s,e!==t&&(this._front=t),n[r]=void 0,i}forEach(e){let t=this._cursor,r=this._front,s=r._elements;for(;!(t===s.length&&void 0===r._next||t===s.length&&(r=r._next,s=r._elements,t=0,0===s.length));)e(s[t]),++t}peek(){const e=this._front,t=this._cursor;return e._elements[t]}}function L(e,t){e._ownerReadableStream=t,t._reader=e,\"readable\"===t._state?G(e):\"closed\"===t._state?C(e):R(e,t._storedError)}function x(e,t){return Xs(e._ownerReadableStream,t)}function T(e){\"readable\"===e._ownerReadableStream._state?P(e,new TypeError(\"Reader was released and can no longer be used to monitor the stream's closedness\")):I(e,new TypeError(\"Reader was released and can no longer be used to monitor the stream's closedness\")),e._ownerReadableStream._reader=void 0,e._ownerReadableStream=void 0}function k(e){return new TypeError(\"Cannot \"+e+\" a stream using a released reader\")}function G(e){e._closedPromise=h(((t,r)=>{e._closedPromise_resolve=t,e._closedPromise_reject=r}))}function R(e,t){G(e),P(e,t)}function C(e){G(e),V(e)}function P(e,t){void 0!==e._closedPromise_reject&&(w(e._closedPromise),e._closedPromise_reject(t),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0)}function I(e,t){R(e,t)}function V(e){void 0!==e._closedPromise_resolve&&(e._closedPromise_resolve(void 0),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0)}const Y=t(\"[[AbortSteps]]\"),H=t(\"[[ErrorSteps]]\"),M=t(\"[[CancelSteps]]\"),E=t(\"[[PullSteps]]\"),F=Number.isFinite||function(e){return\"number\"==typeof e&&isFinite(e)},K=Math.trunc||function(e){return e<0?Math.ceil(e):Math.floor(e)};function N(e){return\"object\"==typeof e||\"function\"==typeof e}function z(e,t){if(void 0!==e&&!N(e))throw new TypeError(`${t} is not an object.`)}function j(e,t){if(\"function\"!=typeof e)throw new TypeError(`${t} is not a function.`)}function U(e){return\"object\"==typeof e&&null!==e||\"function\"==typeof e}function O(e,t){if(!U(e))throw new TypeError(`${t} is not an object.`)}function Q(e,t,r){if(void 0===e)throw new TypeError(`Parameter ${t} is required in '${r}'.`)}function J(e,t,r){if(void 0===e)throw new TypeError(`${t} is required in '${r}'.`)}function D(e){return Number(e)}function B(e){return 0===e?0:e}function A(e){return B(K(e))}function $(e,t){const r=0,s=Number.MAX_SAFE_INTEGER;let n=Number(e);if(n=B(n),!F(n))throw new TypeError(`${t} is not a finite number`);if(n=A(n),n<r||n>s)throw new TypeError(`${t} is outside the accepted range of ${r} to ${s}, inclusive`);return F(n)&&0!==n?n:0}function q(e,t){if(!_s(e))throw new TypeError(`${t} is not a ReadableStream.`)}function ee(e){return new ie(e)}function te(e,t){e._reader._readRequests.push(t)}function re(e,t,r){const s=e._reader._readRequests.shift();r?s._closeSteps():s._chunkSteps(t)}function se(e){return e._reader._readRequests.length}function ne(e){const t=e._reader;return void 0!==t&&!!oe(t)}class ie{constructor(e){if(Q(e,1,\"ReadableStreamDefaultReader\"),q(e,\"First parameter\"),Zs(e))throw new TypeError(\"This stream has already been locked for exclusive reading by another reader\");L(this,e),this._readRequests=new X}get closed(){return oe(this)?this._closedPromise:f(le(\"closed\"))}cancel(e){return oe(this)?void 0===this._ownerReadableStream?f(k(\"cancel\")):x(this,e):f(le(\"cancel\"))}read(){if(!oe(this))return f(le(\"read\"));if(void 0===this._ownerReadableStream)return f(k(\"read from\"));let e,t;const r=h(((r,s)=>{e=r,t=s})),s={_chunkSteps:t=>e({value:t,done:!1}),_closeSteps:()=>e({value:void 0,done:!0}),_errorSteps:e=>t(e)};return ae(this,s),r}releaseLock(){if(!oe(this))throw le(\"releaseLock\");if(void 0!==this._ownerReadableStream){if(this._readRequests.length>0)throw new TypeError(\"Tried to release a reader lock when that reader has pending read() calls un-settled\");T(this)}}}function oe(e){return!!i(e)&&!!Object.prototype.hasOwnProperty.call(e,\"_readRequests\")&&e instanceof ie}function ae(e,t){const r=e._ownerReadableStream;r._disturbed=!0,\"closed\"===r._state?t._closeSteps():\"errored\"===r._state?t._errorSteps(r._storedError):r._readableStreamController[E](t)}function le(e){return new TypeError(`ReadableStreamDefaultReader.prototype.${e} can only be used on a ReadableStreamDefaultReader`)}Object.defineProperties(ie.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),\"symbol\"==typeof t.toStringTag&&Object.defineProperty(ie.prototype,t.toStringTag,{value:\"ReadableStreamDefaultReader\",configurable:!0});const ce=Object.getPrototypeOf(Object.getPrototypeOf((async function*(){})).prototype);class de{constructor(e,t){this._ongoingPromise=void 0,this._isFinished=!1,this._reader=e,this._preventCancel=t}next(){const e=()=>this._nextSteps();return this._ongoingPromise=this._ongoingPromise?g(this._ongoingPromise,e,e):e(),this._ongoingPromise}return(e){const t=()=>this._returnSteps(e);return this._ongoingPromise?g(this._ongoingPromise,t,t):t()}_nextSteps(){if(this._isFinished)return Promise.resolve({value:void 0,done:!0});const e=this._reader;if(void 0===e._ownerReadableStream)return f(k(\"iterate\"));let t,r;const s=h(((e,s)=>{t=e,r=s}));return ae(e,{_chunkSteps:e=>{this._ongoingPromise=void 0,S((()=>t({value:e,done:!1})))},_closeSteps:()=>{this._ongoingPromise=void 0,this._isFinished=!0,T(e),t({value:void 0,done:!0})},_errorSteps:t=>{this._ongoingPromise=void 0,this._isFinished=!0,T(e),r(t)}}),s}_returnSteps(e){if(this._isFinished)return Promise.resolve({value:e,done:!0});this._isFinished=!0;const t=this._reader;if(void 0===t._ownerReadableStream)return f(k(\"finish iterating\"));if(!this._preventCancel){const r=x(t,e);return T(t),g(r,(()=>({value:e,done:!0})))}return T(t),u({value:e,done:!0})}}const he={next(){return fe(this)?this._asyncIteratorImpl.next():f(pe(\"next\"))},return(e){return fe(this)?this._asyncIteratorImpl.return(e):f(pe(\"return\"))}};function ue(e,t){const r=ee(e),s=new de(r,t),n=Object.create(he);return n._asyncIteratorImpl=s,n}function fe(e){if(!i(e))return!1;if(!Object.prototype.hasOwnProperty.call(e,\"_asyncIteratorImpl\"))return!1;try{return e._asyncIteratorImpl instanceof de}catch(e){return!1}}function pe(e){return new TypeError(`ReadableStreamAsyncIterator.${e} can only be used on a ReadableSteamAsyncIterator`)}void 0!==ce&&Object.setPrototypeOf(he,ce);const me=Number.isNaN||function(e){return e!=e};function be(e){return e.slice()}function ye(e,t,r,s,n){new Uint8Array(e).set(new Uint8Array(r,s,n),t)}function ge(e){return e}function we(e){return!1}function Se(e,t,r){if(e.slice)return e.slice(t,r);const s=r-t,n=new ArrayBuffer(s);return ye(n,0,e,t,s),n}function ve(e){return!(\"number\"!=typeof e||me(e)||e<0)}function _e(e){const t=Se(e.buffer,e.byteOffset,e.byteOffset+e.byteLength);return new Uint8Array(t)}function Ze(e){const t=e._queue.shift();return e._queueTotalSize-=t.size,e._queueTotalSize<0&&(e._queueTotalSize=0),t.value}function Xe(e,t,r){if(!ve(r)||r===1/0)throw new RangeError(\"Size must be a finite, non-NaN, non-negative number.\");e._queue.push({value:t,size:r}),e._queueTotalSize+=r}function Le(e){return e._queue.peek().value}function xe(e){e._queue=new X,e._queueTotalSize=0}class Te{constructor(){throw new TypeError(\"Illegal constructor\")}get view(){if(!Re(this))throw nt(\"view\");return this._view}respond(e){if(!Re(this))throw nt(\"respond\");if(Q(e,1,\"respond\"),e=$(e,\"First parameter\"),void 0===this._associatedReadableByteStreamController)throw new TypeError(\"This BYOB request has been invalidated\");we(this._view.buffer),qe(this._associatedReadableByteStreamController,e)}respondWithNewView(e){if(!Re(this))throw nt(\"respondWithNewView\");if(Q(e,1,\"respondWithNewView\"),!ArrayBuffer.isView(e))throw new TypeError(\"You can only respond with array buffer views\");if(void 0===this._associatedReadableByteStreamController)throw new TypeError(\"This BYOB request has been invalidated\");we(e.buffer),et(this._associatedReadableByteStreamController,e)}}Object.defineProperties(Te.prototype,{respond:{enumerable:!0},respondWithNewView:{enumerable:!0},view:{enumerable:!0}}),\"symbol\"==typeof t.toStringTag&&Object.defineProperty(Te.prototype,t.toStringTag,{value:\"ReadableStreamBYOBRequest\",configurable:!0});class ke{constructor(){throw new TypeError(\"Illegal constructor\")}get byobRequest(){if(!Ge(this))throw it(\"byobRequest\");return Ae(this)}get desiredSize(){if(!Ge(this))throw it(\"desiredSize\");return $e(this)}close(){if(!Ge(this))throw it(\"close\");if(this._closeRequested)throw new TypeError(\"The stream has already been closed; do not close it again!\");const e=this._controlledReadableByteStream._state;if(\"readable\"!==e)throw new TypeError(`The stream (in ${e} state) is not in the readable state and cannot be closed`);Je(this)}enqueue(e){if(!Ge(this))throw it(\"enqueue\");if(Q(e,1,\"enqueue\"),!ArrayBuffer.isView(e))throw new TypeError(\"chunk must be an array buffer view\");if(0===e.byteLength)throw new TypeError(\"chunk must have non-zero byteLength\");if(0===e.buffer.byteLength)throw new TypeError(\"chunk's buffer must have non-zero byteLength\");if(this._closeRequested)throw new TypeError(\"stream is closed or draining\");const t=this._controlledReadableByteStream._state;if(\"readable\"!==t)throw new TypeError(`The stream (in ${t} state) is not in the readable state and cannot be enqueued to`);De(this,e)}error(e){if(!Ge(this))throw it(\"error\");Be(this,e)}[M](e){Ce(this),xe(this);const t=this._cancelAlgorithm(e);return Qe(this),t}[E](e){const t=this._controlledReadableByteStream;if(this._queueTotalSize>0){const t=this._queue.shift();this._queueTotalSize-=t.byteLength,Me(this);const r=new Uint8Array(t.buffer,t.byteOffset,t.byteLength);return void e._chunkSteps(r)}const r=this._autoAllocateChunkSize;if(void 0!==r){let t;try{t=new ArrayBuffer(r)}catch(t){return void e._errorSteps(t)}const s={buffer:t,bufferByteLength:r,byteOffset:0,byteLength:r,bytesFilled:0,elementSize:1,viewConstructor:Uint8Array,readerType:\"default\"};this._pendingPullIntos.push(s)}te(t,e),We(this)}}function Ge(e){return!!i(e)&&!!Object.prototype.hasOwnProperty.call(e,\"_controlledReadableByteStream\")&&e instanceof ke}function Re(e){return!!i(e)&&!!Object.prototype.hasOwnProperty.call(e,\"_associatedReadableByteStreamController\")&&e instanceof Te}function We(e){Oe(e)&&(e._pulling?e._pullAgain=!0:(e._pulling=!0,m(e._pullAlgorithm(),(()=>{e._pulling=!1,e._pullAgain&&(e._pullAgain=!1,We(e))}),(t=>{Be(e,t)}))))}function Ce(e){Ee(e),e._pendingPullIntos=new X}function Pe(e,t){let r=!1;\"closed\"===e._state&&(r=!0);const s=Ie(t);\"default\"===t.readerType?re(e,s,r):lt(e,s,r)}function Ie(e){const t=e.bytesFilled,r=e.elementSize;return new e.viewConstructor(e.buffer,e.byteOffset,t/r)}function Ve(e,t,r,s){e._queue.push({buffer:t,byteOffset:r,byteLength:s}),e._queueTotalSize+=s}function Ye(e,t){const r=t.elementSize,s=t.bytesFilled-t.bytesFilled%r,n=Math.min(e._queueTotalSize,t.byteLength-t.bytesFilled),i=t.bytesFilled+n,o=i-i%r;let a=n,l=!1;o>s&&(a=o-t.bytesFilled,l=!0);const c=e._queue;for(;a>0;){const r=c.peek(),s=Math.min(a,r.byteLength),n=t.byteOffset+t.bytesFilled;ye(t.buffer,n,r.buffer,r.byteOffset,s),r.byteLength===s?c.shift():(r.byteOffset+=s,r.byteLength-=s),e._queueTotalSize-=s,He(e,s,t),a-=s}return l}function He(e,t,r){r.bytesFilled+=t}function Me(e){0===e._queueTotalSize&&e._closeRequested?(Qe(e),Ls(e._controlledReadableByteStream)):We(e)}function Ee(e){null!==e._byobRequest&&(e._byobRequest._associatedReadableByteStreamController=void 0,e._byobRequest._view=null,e._byobRequest=null)}function Fe(e){for(;e._pendingPullIntos.length>0;){if(0===e._queueTotalSize)return;const t=e._pendingPullIntos.peek();Ye(e,t)&&(Ue(e),Pe(e._controlledReadableByteStream,t))}}function Ke(e,t,r){const s=e._controlledReadableByteStream;let n=1;t.constructor!==DataView&&(n=t.constructor.BYTES_PER_ELEMENT);const i=t.constructor,o=ge(t.buffer),a={buffer:o,bufferByteLength:o.byteLength,byteOffset:t.byteOffset,byteLength:t.byteLength,bytesFilled:0,elementSize:n,viewConstructor:i,readerType:\"byob\"};if(e._pendingPullIntos.length>0)return e._pendingPullIntos.push(a),void at(s,r);if(\"closed\"!==s._state){if(e._queueTotalSize>0){if(Ye(e,a)){const t=Ie(a);return Me(e),void r._chunkSteps(t)}if(e._closeRequested){const t=new TypeError(\"Insufficient bytes to fill elements in the given buffer\");return Be(e,t),void r._errorSteps(t)}}e._pendingPullIntos.push(a),at(s,r),We(e)}else{const e=new i(a.buffer,a.byteOffset,0);r._closeSteps(e)}}function Ne(e,t){const r=e._controlledReadableByteStream;if(dt(r))for(;ct(r)>0;)Pe(r,Ue(e))}function ze(e,t,r){if(He(e,t,r),r.bytesFilled<r.elementSize)return;Ue(e);const s=r.bytesFilled%r.elementSize;if(s>0){const t=r.byteOffset+r.bytesFilled,n=Se(r.buffer,t-s,t);Ve(e,n,0,n.byteLength)}r.bytesFilled-=s,Pe(e._controlledReadableByteStream,r),Fe(e)}function je(e,t){const r=e._pendingPullIntos.peek();Ee(e),\"closed\"===e._controlledReadableByteStream._state?Ne(e):ze(e,t,r),We(e)}function Ue(e){return e._pendingPullIntos.shift()}function Oe(e){const t=e._controlledReadableByteStream;return\"readable\"===t._state&&!e._closeRequested&&!!e._started&&(!!(ne(t)&&se(t)>0)||!!(dt(t)&&ct(t)>0)||$e(e)>0)}function Qe(e){e._pullAlgorithm=void 0,e._cancelAlgorithm=void 0}function Je(e){const t=e._controlledReadableByteStream;if(!e._closeRequested&&\"readable\"===t._state)if(e._queueTotalSize>0)e._closeRequested=!0;else{if(e._pendingPullIntos.length>0&&e._pendingPullIntos.peek().bytesFilled>0){const t=new TypeError(\"Insufficient bytes to fill elements in the given buffer\");throw Be(e,t),t}Qe(e),Ls(t)}}function De(e,t){const r=e._controlledReadableByteStream;if(e._closeRequested||\"readable\"!==r._state)return;const s=t.buffer,n=t.byteOffset,i=t.byteLength,o=ge(s);if(e._pendingPullIntos.length>0){const t=e._pendingPullIntos.peek();we(t.buffer),t.buffer=ge(t.buffer)}Ee(e),ne(r)?0===se(r)?Ve(e,o,n,i):(e._pendingPullIntos.length>0&&Ue(e),re(r,new Uint8Array(o,n,i),!1)):dt(r)?(Ve(e,o,n,i),Fe(e)):Ve(e,o,n,i),We(e)}function Be(e,t){const r=e._controlledReadableByteStream;\"readable\"===r._state&&(Ce(e),xe(e),Qe(e),xs(r,t))}function Ae(e){if(null===e._byobRequest&&e._pendingPullIntos.length>0){const t=e._pendingPullIntos.peek(),r=new Uint8Array(t.buffer,t.byteOffset+t.bytesFilled,t.byteLength-t.bytesFilled),s=Object.create(Te.prototype);st(s,e,r),e._byobRequest=s}return e._byobRequest}function $e(e){const t=e._controlledReadableByteStream._state;return\"errored\"===t?null:\"closed\"===t?0:e._strategyHWM-e._queueTotalSize}function qe(e,t){const r=e._pendingPullIntos.peek();if(\"closed\"===e._controlledReadableByteStream._state){if(0!==t)throw new TypeError(\"bytesWritten must be 0 when calling respond() on a closed stream\")}else{if(0===t)throw new TypeError(\"bytesWritten must be greater than 0 when calling respond() on a readable stream\");if(r.bytesFilled+t>r.byteLength)throw new RangeError(\"bytesWritten out of range\")}r.buffer=ge(r.buffer),je(e,t)}function et(e,t){const r=e._pendingPullIntos.peek();if(\"closed\"===e._controlledReadableByteStream._state){if(0!==t.byteLength)throw new TypeError(\"The view's length must be 0 when calling respondWithNewView() on a closed stream\")}else if(0===t.byteLength)throw new TypeError(\"The view's length must be greater than 0 when calling respondWithNewView() on a readable stream\");if(r.byteOffset+r.bytesFilled!==t.byteOffset)throw new RangeError(\"The region specified by view does not match byobRequest\");if(r.bufferByteLength!==t.buffer.byteLength)throw new RangeError(\"The buffer of view has different capacity than byobRequest\");if(r.bytesFilled+t.byteLength>r.byteLength)throw new RangeError(\"The region specified by view is larger than byobRequest\");const s=t.byteLength;r.buffer=ge(t.buffer),je(e,s)}function tt(e,t,r,s,n,i,o){t._controlledReadableByteStream=e,t._pullAgain=!1,t._pulling=!1,t._byobRequest=null,t._queue=t._queueTotalSize=void 0,xe(t),t._closeRequested=!1,t._started=!1,t._strategyHWM=i,t._pullAlgorithm=s,t._cancelAlgorithm=n,t._autoAllocateChunkSize=o,t._pendingPullIntos=new X,e._readableStreamController=t,m(u(r()),(()=>{t._started=!0,We(t)}),(e=>{Be(t,e)}))}function rt(e,t,r){const s=Object.create(ke.prototype);let n=()=>{},i=()=>u(void 0),o=()=>u(void 0);void 0!==t.start&&(n=()=>t.start(s)),void 0!==t.pull&&(i=()=>t.pull(s)),void 0!==t.cancel&&(o=e=>t.cancel(e));const a=t.autoAllocateChunkSize;if(0===a)throw new TypeError(\"autoAllocateChunkSize must be greater than 0\");tt(e,s,n,i,o,r,a)}function st(e,t,r){e._associatedReadableByteStreamController=t,e._view=r}function nt(e){return new TypeError(`ReadableStreamBYOBRequest.prototype.${e} can only be used on a ReadableStreamBYOBRequest`)}function it(e){return new TypeError(`ReadableByteStreamController.prototype.${e} can only be used on a ReadableByteStreamController`)}function ot(e){return new ht(e)}function at(e,t){e._reader._readIntoRequests.push(t)}function lt(e,t,r){const s=e._reader._readIntoRequests.shift();r?s._closeSteps(t):s._chunkSteps(t)}function ct(e){return e._reader._readIntoRequests.length}function dt(e){const t=e._reader;return void 0!==t&&!!ut(t)}Object.defineProperties(ke.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},byobRequest:{enumerable:!0},desiredSize:{enumerable:!0}}),\"symbol\"==typeof t.toStringTag&&Object.defineProperty(ke.prototype,t.toStringTag,{value:\"ReadableByteStreamController\",configurable:!0});class ht{constructor(e){if(Q(e,1,\"ReadableStreamBYOBReader\"),q(e,\"First parameter\"),Zs(e))throw new TypeError(\"This stream has already been locked for exclusive reading by another reader\");if(!Ge(e._readableStreamController))throw new TypeError(\"Cannot construct a ReadableStreamBYOBReader for a stream not constructed with a byte source\");L(this,e),this._readIntoRequests=new X}get closed(){return ut(this)?this._closedPromise:f(pt(\"closed\"))}cancel(e){return ut(this)?void 0===this._ownerReadableStream?f(k(\"cancel\")):x(this,e):f(pt(\"cancel\"))}read(e){if(!ut(this))return f(pt(\"read\"));if(!ArrayBuffer.isView(e))return f(new TypeError(\"view must be an array buffer view\"));if(0===e.byteLength)return f(new TypeError(\"view must have non-zero byteLength\"));if(0===e.buffer.byteLength)return f(new TypeError(\"view's buffer must have non-zero byteLength\"));if(we(e.buffer),void 0===this._ownerReadableStream)return f(k(\"read from\"));let t,r;const s=h(((e,s)=>{t=e,r=s})),n={_chunkSteps:e=>t({value:e,done:!1}),_closeSteps:e=>t({value:e,done:!0}),_errorSteps:e=>r(e)};return ft(this,e,n),s}releaseLock(){if(!ut(this))throw pt(\"releaseLock\");if(void 0!==this._ownerReadableStream){if(this._readIntoRequests.length>0)throw new TypeError(\"Tried to release a reader lock when that reader has pending read() calls un-settled\");T(this)}}}function ut(e){return!!i(e)&&!!Object.prototype.hasOwnProperty.call(e,\"_readIntoRequests\")&&e instanceof ht}function ft(e,t,r){const s=e._ownerReadableStream;s._disturbed=!0,\"errored\"===s._state?r._errorSteps(s._storedError):Ke(s._readableStreamController,t,r)}function pt(e){return new TypeError(`ReadableStreamBYOBReader.prototype.${e} can only be used on a ReadableStreamBYOBReader`)}function mt(e,t){const{highWaterMark:r}=e;if(void 0===r)return t;if(me(r)||r<0)throw new RangeError(\"Invalid highWaterMark\");return r}function bt(e){const{size:t}=e;return t||(()=>1)}function yt(e,t){z(e,t);const r=null==e?void 0:e.highWaterMark,s=null==e?void 0:e.size;return{highWaterMark:void 0===r?void 0:D(r),size:void 0===s?void 0:gt(s,`${t} has member 'size' that`)}}function gt(e,t){return j(e,t),t=>D(e(t))}function wt(e,t){z(e,t);const r=null==e?void 0:e.abort,s=null==e?void 0:e.close,n=null==e?void 0:e.start,i=null==e?void 0:e.type,o=null==e?void 0:e.write;return{abort:void 0===r?void 0:St(r,e,`${t} has member 'abort' that`),close:void 0===s?void 0:vt(s,e,`${t} has member 'close' that`),start:void 0===n?void 0:_t(n,e,`${t} has member 'start' that`),write:void 0===o?void 0:Zt(o,e,`${t} has member 'write' that`),type:i}}function St(e,t,r){return j(e,r),r=>_(e,t,[r])}function vt(e,t,r){return j(e,r),()=>_(e,t,[])}function _t(e,t,r){return j(e,r),r=>v(e,t,[r])}function Zt(e,t,r){return j(e,r),(r,s)=>_(e,t,[r,s])}function Xt(e,t){if(!Ct(e))throw new TypeError(`${t} is not a WritableStream.`)}function Lt(e){if(\"object\"!=typeof e||null===e)return!1;try{return\"boolean\"==typeof e.aborted}catch(e){return!1}}Object.defineProperties(ht.prototype,{cancel:{enumerable:!0},read:{enumerable:!0},releaseLock:{enumerable:!0},closed:{enumerable:!0}}),\"symbol\"==typeof t.toStringTag&&Object.defineProperty(ht.prototype,t.toStringTag,{value:\"ReadableStreamBYOBReader\",configurable:!0});const xt=\"function\"==typeof AbortController;function Tt(){if(xt)return new AbortController}class kt{constructor(e={},t={}){void 0===e?e=null:O(e,\"First parameter\");const r=yt(t,\"Second parameter\"),s=wt(e,\"First parameter\");if(Wt(this),void 0!==s.type)throw new RangeError(\"Invalid type is specified\");const n=bt(r);dr(this,s,mt(r,1),n)}get locked(){if(!Ct(this))throw _r(\"locked\");return Pt(this)}abort(e){return Ct(this)?Pt(this)?f(new TypeError(\"Cannot abort a stream that already has a writer\")):It(this,e):f(_r(\"abort\"))}close(){return Ct(this)?Pt(this)?f(new TypeError(\"Cannot close a stream that already has a writer\")):jt(this)?f(new TypeError(\"Cannot close an already-closing stream\")):Vt(this):f(_r(\"close\"))}getWriter(){if(!Ct(this))throw _r(\"getWriter\");return Gt(this)}}function Gt(e){return new Bt(e)}function Rt(e,t,r,s,n=1,i=(()=>1)){const o=Object.create(kt.prototype);return Wt(o),cr(o,Object.create(ar.prototype),e,t,r,s,n,i),o}function Wt(e){e._state=\"writable\",e._storedError=void 0,e._writer=void 0,e._writableStreamController=void 0,e._writeRequests=new X,e._inFlightWriteRequest=void 0,e._closeRequest=void 0,e._inFlightCloseRequest=void 0,e._pendingAbortRequest=void 0,e._backpressure=!1}function Ct(e){return!!i(e)&&!!Object.prototype.hasOwnProperty.call(e,\"_writableStreamController\")&&e instanceof kt}function Pt(e){return void 0!==e._writer}function It(e,t){var r;if(\"closed\"===e._state||\"errored\"===e._state)return u(void 0);e._writableStreamController._abortReason=t,null===(r=e._writableStreamController._abortController)||void 0===r||r.abort();const s=e._state;if(\"closed\"===s||\"errored\"===s)return u(void 0);if(void 0!==e._pendingAbortRequest)return e._pendingAbortRequest._promise;let n=!1;\"erroring\"===s&&(n=!0,t=void 0);const i=h(((r,s)=>{e._pendingAbortRequest={_promise:void 0,_resolve:r,_reject:s,_reason:t,_wasAlreadyErroring:n}}));return e._pendingAbortRequest._promise=i,n||Mt(e,t),i}function Vt(e){const t=e._state;if(\"closed\"===t||\"errored\"===t)return f(new TypeError(`The stream (in ${t} state) is not in the writable state and cannot be closed`));const r=h(((t,r)=>{const s={_resolve:t,_reject:r};e._closeRequest=s})),s=e._writer;return void 0!==s&&e._backpressure&&\"writable\"===t&&Mr(s),ur(e._writableStreamController),r}function Yt(e){return h(((t,r)=>{const s={_resolve:t,_reject:r};e._writeRequests.push(s)}))}function Ht(e,t){\"writable\"!==e._state?Et(e):Mt(e,t)}function Mt(e,t){const r=e._writableStreamController;e._state=\"erroring\",e._storedError=t;const s=e._writer;void 0!==s&&rr(s,t),!Ut(e)&&r._started&&Et(e)}function Et(e){e._state=\"errored\",e._writableStreamController[H]();const t=e._storedError;if(e._writeRequests.forEach((e=>{e._reject(t)})),e._writeRequests=new X,void 0===e._pendingAbortRequest)return void Jt(e);const r=e._pendingAbortRequest;if(e._pendingAbortRequest=void 0,r._wasAlreadyErroring)return r._reject(t),void Jt(e);m(e._writableStreamController[Y](r._reason),(()=>{r._resolve(),Jt(e)}),(t=>{r._reject(t),Jt(e)}))}function Ft(e){e._inFlightWriteRequest._resolve(void 0),e._inFlightWriteRequest=void 0}function Kt(e,t){e._inFlightWriteRequest._reject(t),e._inFlightWriteRequest=void 0,Ht(e,t)}function Nt(e){e._inFlightCloseRequest._resolve(void 0),e._inFlightCloseRequest=void 0,\"erroring\"===e._state&&(e._storedError=void 0,void 0!==e._pendingAbortRequest&&(e._pendingAbortRequest._resolve(),e._pendingAbortRequest=void 0)),e._state=\"closed\";const t=e._writer;void 0!==t&&Wr(t)}function zt(e,t){e._inFlightCloseRequest._reject(t),e._inFlightCloseRequest=void 0,void 0!==e._pendingAbortRequest&&(e._pendingAbortRequest._reject(t),e._pendingAbortRequest=void 0),Ht(e,t)}function jt(e){return void 0!==e._closeRequest||void 0!==e._inFlightCloseRequest}function Ut(e){return void 0!==e._inFlightWriteRequest||void 0!==e._inFlightCloseRequest}function Ot(e){e._inFlightCloseRequest=e._closeRequest,e._closeRequest=void 0}function Qt(e){e._inFlightWriteRequest=e._writeRequests.shift()}function Jt(e){void 0!==e._closeRequest&&(e._closeRequest._reject(e._storedError),e._closeRequest=void 0);const t=e._writer;void 0!==t&&Gr(t,e._storedError)}function Dt(e,t){const r=e._writer;void 0!==r&&t!==e._backpressure&&(t?Yr(r):Mr(r)),e._backpressure=t}Object.defineProperties(kt.prototype,{abort:{enumerable:!0},close:{enumerable:!0},getWriter:{enumerable:!0},locked:{enumerable:!0}}),\"symbol\"==typeof t.toStringTag&&Object.defineProperty(kt.prototype,t.toStringTag,{value:\"WritableStream\",configurable:!0});class Bt{constructor(e){if(Q(e,1,\"WritableStreamDefaultWriter\"),Xt(e,\"First parameter\"),Pt(e))throw new TypeError(\"This stream has already been locked for exclusive writing by another writer\");this._ownerWritableStream=e,e._writer=this;const t=e._state;if(\"writable\"===t)!jt(e)&&e._backpressure?Cr(this):Ir(this),xr(this);else if(\"erroring\"===t)Pr(this,e._storedError),xr(this);else if(\"closed\"===t)Ir(this),kr(this);else{const t=e._storedError;Pr(this,t),Tr(this,t)}}get closed(){return At(this)?this._closedPromise:f(Xr(\"closed\"))}get desiredSize(){if(!At(this))throw Xr(\"desiredSize\");if(void 0===this._ownerWritableStream)throw Lr(\"desiredSize\");return sr(this)}get ready(){return At(this)?this._readyPromise:f(Xr(\"ready\"))}abort(e){return At(this)?void 0===this._ownerWritableStream?f(Lr(\"abort\")):$t(this,e):f(Xr(\"abort\"))}close(){if(!At(this))return f(Xr(\"close\"));const e=this._ownerWritableStream;return void 0===e?f(Lr(\"close\")):jt(e)?f(new TypeError(\"Cannot close an already-closing stream\")):qt(this)}releaseLock(){if(!At(this))throw Xr(\"releaseLock\");void 0!==this._ownerWritableStream&&nr(this)}write(e){return At(this)?void 0===this._ownerWritableStream?f(Lr(\"write to\")):ir(this,e):f(Xr(\"write\"))}}function At(e){return!!i(e)&&!!Object.prototype.hasOwnProperty.call(e,\"_ownerWritableStream\")&&e instanceof Bt}function $t(e,t){return It(e._ownerWritableStream,t)}function qt(e){return Vt(e._ownerWritableStream)}function er(e){const t=e._ownerWritableStream,r=t._state;return jt(t)||\"closed\"===r?u(void 0):\"errored\"===r?f(t._storedError):qt(e)}function tr(e,t){\"pending\"===e._closedPromiseState?Gr(e,t):Rr(e,t)}function rr(e,t){\"pending\"===e._readyPromiseState?Vr(e,t):Hr(e,t)}function sr(e){const t=e._ownerWritableStream,r=t._state;return\"errored\"===r||\"erroring\"===r?null:\"closed\"===r?0:pr(t._writableStreamController)}function nr(e){const t=e._ownerWritableStream,r=new TypeError(\"Writer was released and can no longer be used to monitor the stream's closedness\");rr(e,r),tr(e,r),t._writer=void 0,e._ownerWritableStream=void 0}function ir(e,t){const r=e._ownerWritableStream,s=r._writableStreamController,n=fr(s,t);if(r!==e._ownerWritableStream)return f(Lr(\"write to\"));const i=r._state;if(\"errored\"===i)return f(r._storedError);if(jt(r)||\"closed\"===i)return f(new TypeError(\"The stream is closing or closed and cannot be written to\"));if(\"erroring\"===i)return f(r._storedError);const o=Yt(r);return mr(s,t,n),o}Object.defineProperties(Bt.prototype,{abort:{enumerable:!0},close:{enumerable:!0},releaseLock:{enumerable:!0},write:{enumerable:!0},closed:{enumerable:!0},desiredSize:{enumerable:!0},ready:{enumerable:!0}}),\"symbol\"==typeof t.toStringTag&&Object.defineProperty(Bt.prototype,t.toStringTag,{value:\"WritableStreamDefaultWriter\",configurable:!0});const or={};class ar{constructor(){throw new TypeError(\"Illegal constructor\")}get abortReason(){if(!lr(this))throw Zr(\"abortReason\");return this._abortReason}get signal(){if(!lr(this))throw Zr(\"signal\");if(void 0===this._abortController)throw new TypeError(\"WritableStreamDefaultController.prototype.signal is not supported\");return this._abortController.signal}error(e){if(!lr(this))throw Zr(\"error\");\"writable\"===this._controlledWritableStream._state&&vr(this,e)}[Y](e){const t=this._abortAlgorithm(e);return hr(this),t}[H](){xe(this)}}function lr(e){return!!i(e)&&!!Object.prototype.hasOwnProperty.call(e,\"_controlledWritableStream\")&&e instanceof ar}function cr(e,t,r,s,n,i,o,a){t._controlledWritableStream=e,e._writableStreamController=t,t._queue=void 0,t._queueTotalSize=void 0,xe(t),t._abortReason=void 0,t._abortController=Tt(),t._started=!1,t._strategySizeAlgorithm=a,t._strategyHWM=o,t._writeAlgorithm=s,t._closeAlgorithm=n,t._abortAlgorithm=i;const l=Sr(t);Dt(e,l),m(u(r()),(()=>{t._started=!0,br(t)}),(r=>{t._started=!0,Ht(e,r)}))}function dr(e,t,r,s){const n=Object.create(ar.prototype);let i=()=>{},o=()=>u(void 0),a=()=>u(void 0),l=()=>u(void 0);void 0!==t.start&&(i=()=>t.start(n)),void 0!==t.write&&(o=e=>t.write(e,n)),void 0!==t.close&&(a=()=>t.close()),void 0!==t.abort&&(l=e=>t.abort(e)),cr(e,n,i,o,a,l,r,s)}function hr(e){e._writeAlgorithm=void 0,e._closeAlgorithm=void 0,e._abortAlgorithm=void 0,e._strategySizeAlgorithm=void 0}function ur(e){Xe(e,or,0),br(e)}function fr(e,t){try{return e._strategySizeAlgorithm(t)}catch(t){return yr(e,t),1}}function pr(e){return e._strategyHWM-e._queueTotalSize}function mr(e,t,r){try{Xe(e,t,r)}catch(t){return void yr(e,t)}const s=e._controlledWritableStream;jt(s)||\"writable\"!==s._state||Dt(s,Sr(e)),br(e)}function br(e){const t=e._controlledWritableStream;if(!e._started)return;if(void 0!==t._inFlightWriteRequest)return;if(\"erroring\"===t._state)return void Et(t);if(0===e._queue.length)return;const r=Le(e);r===or?gr(e):wr(e,r)}function yr(e,t){\"writable\"===e._controlledWritableStream._state&&vr(e,t)}function gr(e){const t=e._controlledWritableStream;Ot(t),Ze(e);const r=e._closeAlgorithm();hr(e),m(r,(()=>{Nt(t)}),(e=>{zt(t,e)}))}function wr(e,t){const r=e._controlledWritableStream;Qt(r),m(e._writeAlgorithm(t),(()=>{Ft(r);const t=r._state;if(Ze(e),!jt(r)&&\"writable\"===t){const t=Sr(e);Dt(r,t)}br(e)}),(t=>{\"writable\"===r._state&&hr(e),Kt(r,t)}))}function Sr(e){return pr(e)<=0}function vr(e,t){const r=e._controlledWritableStream;hr(e),Mt(r,t)}function _r(e){return new TypeError(`WritableStream.prototype.${e} can only be used on a WritableStream`)}function Zr(e){return new TypeError(`WritableStreamDefaultController.prototype.${e} can only be used on a WritableStreamDefaultController`)}function Xr(e){return new TypeError(`WritableStreamDefaultWriter.prototype.${e} can only be used on a WritableStreamDefaultWriter`)}function Lr(e){return new TypeError(\"Cannot \"+e+\" a stream using a released writer\")}function xr(e){e._closedPromise=h(((t,r)=>{e._closedPromise_resolve=t,e._closedPromise_reject=r,e._closedPromiseState=\"pending\"}))}function Tr(e,t){xr(e),Gr(e,t)}function kr(e){xr(e),Wr(e)}function Gr(e,t){void 0!==e._closedPromise_reject&&(w(e._closedPromise),e._closedPromise_reject(t),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0,e._closedPromiseState=\"rejected\")}function Rr(e,t){Tr(e,t)}function Wr(e){void 0!==e._closedPromise_resolve&&(e._closedPromise_resolve(void 0),e._closedPromise_resolve=void 0,e._closedPromise_reject=void 0,e._closedPromiseState=\"resolved\")}function Cr(e){e._readyPromise=h(((t,r)=>{e._readyPromise_resolve=t,e._readyPromise_reject=r})),e._readyPromiseState=\"pending\"}function Pr(e,t){Cr(e),Vr(e,t)}function Ir(e){Cr(e),Mr(e)}function Vr(e,t){void 0!==e._readyPromise_reject&&(w(e._readyPromise),e._readyPromise_reject(t),e._readyPromise_resolve=void 0,e._readyPromise_reject=void 0,e._readyPromiseState=\"rejected\")}function Yr(e){Cr(e)}function Hr(e,t){Pr(e,t)}function Mr(e){void 0!==e._readyPromise_resolve&&(e._readyPromise_resolve(void 0),e._readyPromise_resolve=void 0,e._readyPromise_reject=void 0,e._readyPromiseState=\"fulfilled\")}Object.defineProperties(ar.prototype,{abortReason:{enumerable:!0},signal:{enumerable:!0},error:{enumerable:!0}}),\"symbol\"==typeof t.toStringTag&&Object.defineProperty(ar.prototype,t.toStringTag,{value:\"WritableStreamDefaultController\",configurable:!0});const Er=\"undefined\"!=typeof DOMException?DOMException:void 0;function Fr(e){if(\"function\"!=typeof e&&\"object\"!=typeof e)return!1;try{return new e,!0}catch(e){return!1}}function Kr(){const e=function(e,t){this.message=e||\"\",this.name=t||\"Error\",Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)};return e.prototype=Object.create(Error.prototype),Object.defineProperty(e.prototype,\"constructor\",{value:e,writable:!0,configurable:!0}),e}const Nr=Fr(Er)?Er:Kr();function zr(e,t,s,n,i,o){const a=ee(e),l=Gt(t);e._disturbed=!0;let c=!1,d=u(void 0);return h(((f,g)=>{let S;if(void 0!==o){if(S=()=>{const r=new Nr(\"Aborted\",\"AbortError\"),s=[];n||s.push((()=>\"writable\"===t._state?It(t,r):u(void 0))),i||s.push((()=>\"readable\"===e._state?Xs(e,r):u(void 0))),x((()=>Promise.all(s.map((e=>e())))),!0,r)},o.aborted)return void S();o.addEventListener(\"abort\",S)}function v(){return h(((e,t)=>{function r(s){s?e():p(_(),r,t)}r(!1)}))}function _(){return c?u(!0):p(l._readyPromise,(()=>h(((e,t)=>{ae(a,{_chunkSteps:t=>{d=p(ir(l,t),void 0,r),e(!1)},_closeSteps:()=>e(!0),_errorSteps:t})}))))}if(X(e,a._closedPromise,(e=>{n?k(!0,e):x((()=>It(t,e)),!0,e)})),X(t,l._closedPromise,(t=>{i?k(!0,t):x((()=>Xs(e,t)),!0,t)})),L(e,a._closedPromise,(()=>{s?k():x((()=>er(l)))})),jt(t)||\"closed\"===t._state){const t=new TypeError(\"the destination writable stream closed before all data could be piped to it\");i?k(!0,t):x((()=>Xs(e,t)),!0,t)}function Z(){const e=d;return p(d,(()=>e!==d?Z():void 0))}function X(e,t,r){\"errored\"===e._state?r(e._storedError):y(t,r)}function L(e,t,r){\"closed\"===e._state?r():b(t,r)}function x(e,r,s){function n(){m(e(),(()=>G(r,s)),(e=>G(!0,e)))}c||(c=!0,\"writable\"!==t._state||jt(t)?n():b(Z(),n))}function k(e,r){c||(c=!0,\"writable\"!==t._state||jt(t)?G(e,r):b(Z(),(()=>G(e,r))))}function G(e,t){nr(l),T(a),void 0!==o&&o.removeEventListener(\"abort\",S),e?g(t):f(void 0)}w(v())}))}class jr{constructor(){throw new TypeError(\"Illegal constructor\")}get desiredSize(){if(!Ur(this))throw ss(\"desiredSize\");return $r(this)}close(){if(!Ur(this))throw ss(\"close\");if(!es(this))throw new TypeError(\"The stream is not in a state that permits close\");Dr(this)}enqueue(e){if(!Ur(this))throw ss(\"enqueue\");if(!es(this))throw new TypeError(\"The stream is not in a state that permits enqueue\");return Br(this,e)}error(e){if(!Ur(this))throw ss(\"error\");Ar(this,e)}[M](e){xe(this);const t=this._cancelAlgorithm(e);return Jr(this),t}[E](e){const t=this._controlledReadableStream;if(this._queue.length>0){const r=Ze(this);this._closeRequested&&0===this._queue.length?(Jr(this),Ls(t)):Or(this),e._chunkSteps(r)}else te(t,e),Or(this)}}function Ur(e){return!!i(e)&&!!Object.prototype.hasOwnProperty.call(e,\"_controlledReadableStream\")&&e instanceof jr}function Or(e){Qr(e)&&(e._pulling?e._pullAgain=!0:(e._pulling=!0,m(e._pullAlgorithm(),(()=>{e._pulling=!1,e._pullAgain&&(e._pullAgain=!1,Or(e))}),(t=>{Ar(e,t)}))))}function Qr(e){const t=e._controlledReadableStream;return!!es(e)&&!!e._started&&(!!(Zs(t)&&se(t)>0)||$r(e)>0)}function Jr(e){e._pullAlgorithm=void 0,e._cancelAlgorithm=void 0,e._strategySizeAlgorithm=void 0}function Dr(e){if(!es(e))return;const t=e._controlledReadableStream;e._closeRequested=!0,0===e._queue.length&&(Jr(e),Ls(t))}function Br(e,t){if(!es(e))return;const r=e._controlledReadableStream;if(Zs(r)&&se(r)>0)re(r,t,!1);else{let r;try{r=e._strategySizeAlgorithm(t)}catch(t){throw Ar(e,t),t}try{Xe(e,t,r)}catch(t){throw Ar(e,t),t}}Or(e)}function Ar(e,t){const r=e._controlledReadableStream;\"readable\"===r._state&&(xe(e),Jr(e),xs(r,t))}function $r(e){const t=e._controlledReadableStream._state;return\"errored\"===t?null:\"closed\"===t?0:e._strategyHWM-e._queueTotalSize}function qr(e){return!Qr(e)}function es(e){const t=e._controlledReadableStream._state;return!e._closeRequested&&\"readable\"===t}function ts(e,t,r,s,n,i,o){t._controlledReadableStream=e,t._queue=void 0,t._queueTotalSize=void 0,xe(t),t._started=!1,t._closeRequested=!1,t._pullAgain=!1,t._pulling=!1,t._strategySizeAlgorithm=o,t._strategyHWM=i,t._pullAlgorithm=s,t._cancelAlgorithm=n,e._readableStreamController=t,m(u(r()),(()=>{t._started=!0,Or(t)}),(e=>{Ar(t,e)}))}function rs(e,t,r,s){const n=Object.create(jr.prototype);let i=()=>{},o=()=>u(void 0),a=()=>u(void 0);void 0!==t.start&&(i=()=>t.start(n)),void 0!==t.pull&&(o=()=>t.pull(n)),void 0!==t.cancel&&(a=e=>t.cancel(e)),ts(e,n,i,o,a,r,s)}function ss(e){return new TypeError(`ReadableStreamDefaultController.prototype.${e} can only be used on a ReadableStreamDefaultController`)}function ns(e,t){return Ge(e._readableStreamController)?os(e):is(e)}function is(e,t){const r=ee(e);let s,n,i,o,a,l=!1,c=!1,d=!1,f=!1;const p=h((e=>{a=e}));function m(){return l?(c=!0,u(void 0)):(l=!0,ae(r,{_chunkSteps:e=>{S((()=>{c=!1;const t=e,r=e;d||Br(i._readableStreamController,t),f||Br(o._readableStreamController,r),l=!1,c&&m()}))},_closeSteps:()=>{l=!1,d||Dr(i._readableStreamController),f||Dr(o._readableStreamController),d&&f||a(void 0)},_errorSteps:()=>{l=!1}}),u(void 0))}function b(t){if(d=!0,s=t,f){const t=be([s,n]),r=Xs(e,t);a(r)}return p}function g(t){if(f=!0,n=t,d){const t=be([s,n]),r=Xs(e,t);a(r)}return p}function w(){}return i=ws(w,m,b),o=ws(w,m,g),y(r._closedPromise,(e=>{Ar(i._readableStreamController,e),Ar(o._readableStreamController,e),d&&f||a(void 0)})),[i,o]}function os(e){let t,r,s,n,i,o=ee(e),a=!1,l=!1,c=!1,d=!1,f=!1;const p=h((e=>{i=e}));function m(e){y(e._closedPromise,(t=>{e===o&&(Be(s._readableStreamController,t),Be(n._readableStreamController,t),d&&f||i(void 0))}))}function b(){ut(o)&&(T(o),o=ee(e),m(o)),ae(o,{_chunkSteps:t=>{S((()=>{l=!1,c=!1;const r=t;let o=t;if(!d&&!f)try{o=_e(t)}catch(t){return Be(s._readableStreamController,t),Be(n._readableStreamController,t),void i(Xs(e,t))}d||De(s._readableStreamController,r),f||De(n._readableStreamController,o),a=!1,l?w():c&&v()}))},_closeSteps:()=>{a=!1,d||Je(s._readableStreamController),f||Je(n._readableStreamController),s._readableStreamController._pendingPullIntos.length>0&&qe(s._readableStreamController,0),n._readableStreamController._pendingPullIntos.length>0&&qe(n._readableStreamController,0),d&&f||i(void 0)},_errorSteps:()=>{a=!1}})}function g(t,r){oe(o)&&(T(o),o=ot(e),m(o));const h=r?n:s,u=r?s:n;ft(o,t,{_chunkSteps:t=>{S((()=>{l=!1,c=!1;const s=r?f:d;if(r?d:f)s||et(h._readableStreamController,t);else{let r;try{r=_e(t)}catch(t){return Be(h._readableStreamController,t),Be(u._readableStreamController,t),void i(Xs(e,t))}s||et(h._readableStreamController,t),De(u._readableStreamController,r)}a=!1,l?w():c&&v()}))},_closeSteps:e=>{a=!1;const t=r?f:d,s=r?d:f;t||Je(h._readableStreamController),s||Je(u._readableStreamController),void 0!==e&&(t||et(h._readableStreamController,e),!s&&u._readableStreamController._pendingPullIntos.length>0&&qe(u._readableStreamController,0)),t&&s||i(void 0)},_errorSteps:()=>{a=!1}})}function w(){if(a)return l=!0,u(void 0);a=!0;const e=Ae(s._readableStreamController);return null===e?b():g(e._view,!1),u(void 0)}function v(){if(a)return c=!0,u(void 0);a=!0;const e=Ae(n._readableStreamController);return null===e?b():g(e._view,!0),u(void 0)}function _(s){if(d=!0,t=s,f){const s=be([t,r]),n=Xs(e,s);i(n)}return p}function Z(s){if(f=!0,r=s,d){const s=be([t,r]),n=Xs(e,s);i(n)}return p}function X(){}return s=Ss(X,w,_),n=Ss(X,v,Z),m(o),[s,n]}function as(e,t){z(e,t);const r=e,s=null==r?void 0:r.autoAllocateChunkSize,n=null==r?void 0:r.cancel,i=null==r?void 0:r.pull,o=null==r?void 0:r.start,a=null==r?void 0:r.type;return{autoAllocateChunkSize:void 0===s?void 0:$(s,`${t} has member 'autoAllocateChunkSize' that`),cancel:void 0===n?void 0:ls(n,r,`${t} has member 'cancel' that`),pull:void 0===i?void 0:cs(i,r,`${t} has member 'pull' that`),start:void 0===o?void 0:ds(o,r,`${t} has member 'start' that`),type:void 0===a?void 0:hs(a,`${t} has member 'type' that`)}}function ls(e,t,r){return j(e,r),r=>_(e,t,[r])}function cs(e,t,r){return j(e,r),r=>_(e,t,[r])}function ds(e,t,r){return j(e,r),r=>v(e,t,[r])}function hs(e,t){if(\"bytes\"!=(e=`${e}`))throw new TypeError(`${t} '${e}' is not a valid enumeration value for ReadableStreamType`);return e}function us(e,t){z(e,t);const r=null==e?void 0:e.mode;return{mode:void 0===r?void 0:fs(r,`${t} has member 'mode' that`)}}function fs(e,t){if(\"byob\"!=(e=`${e}`))throw new TypeError(`${t} '${e}' is not a valid enumeration value for ReadableStreamReaderMode`);return e}function ps(e,t){z(e,t);const r=null==e?void 0:e.preventCancel;return{preventCancel:Boolean(r)}}function ms(e,t){z(e,t);const r=null==e?void 0:e.preventAbort,s=null==e?void 0:e.preventCancel,n=null==e?void 0:e.preventClose,i=null==e?void 0:e.signal;return void 0!==i&&bs(i,`${t} has member 'signal' that`),{preventAbort:Boolean(r),preventCancel:Boolean(s),preventClose:Boolean(n),signal:i}}function bs(e,t){if(!Lt(e))throw new TypeError(`${t} is not an AbortSignal.`)}function ys(e,t){z(e,t);const r=null==e?void 0:e.readable;J(r,\"readable\",\"ReadableWritablePair\"),q(r,`${t} has member 'readable' that`);const s=null==e?void 0:e.writable;return J(s,\"writable\",\"ReadableWritablePair\"),Xt(s,`${t} has member 'writable' that`),{readable:r,writable:s}}Object.defineProperties(jr.prototype,{close:{enumerable:!0},enqueue:{enumerable:!0},error:{enumerable:!0},desiredSize:{enumerable:!0}}),\"symbol\"==typeof t.toStringTag&&Object.defineProperty(jr.prototype,t.toStringTag,{value:\"ReadableStreamDefaultController\",configurable:!0});class gs{constructor(e={},t={}){void 0===e?e=null:O(e,\"First parameter\");const r=yt(t,\"Second parameter\"),s=as(e,\"First parameter\");if(vs(this),\"bytes\"===s.type){if(void 0!==r.size)throw new RangeError(\"The strategy for a byte stream cannot have a size function\");rt(this,s,mt(r,0))}else{const e=bt(r);rs(this,s,mt(r,1),e)}}get locked(){if(!_s(this))throw Ts(\"locked\");return Zs(this)}cancel(e){return _s(this)?Zs(this)?f(new TypeError(\"Cannot cancel a stream that already has a reader\")):Xs(this,e):f(Ts(\"cancel\"))}getReader(e){if(!_s(this))throw Ts(\"getReader\");return void 0===us(e,\"First parameter\").mode?ee(this):ot(this)}pipeThrough(e,t={}){if(!_s(this))throw Ts(\"pipeThrough\");Q(e,1,\"pipeThrough\");const r=ys(e,\"First parameter\"),s=ms(t,\"Second parameter\");if(Zs(this))throw new TypeError(\"ReadableStream.prototype.pipeThrough cannot be used on a locked ReadableStream\");if(Pt(r.writable))throw new TypeError(\"ReadableStream.prototype.pipeThrough cannot be used on a locked WritableStream\");return w(zr(this,r.writable,s.preventClose,s.preventAbort,s.preventCancel,s.signal)),r.readable}pipeTo(e,t={}){if(!_s(this))return f(Ts(\"pipeTo\"));if(void 0===e)return f(\"Parameter 1 is required in 'pipeTo'.\");if(!Ct(e))return f(new TypeError(\"ReadableStream.prototype.pipeTo's first argument must be a WritableStream\"));let r;try{r=ms(t,\"Second parameter\")}catch(e){return f(e)}return Zs(this)?f(new TypeError(\"ReadableStream.prototype.pipeTo cannot be used on a locked ReadableStream\")):Pt(e)?f(new TypeError(\"ReadableStream.prototype.pipeTo cannot be used on a locked WritableStream\")):zr(this,e,r.preventClose,r.preventAbort,r.preventCancel,r.signal)}tee(){if(!_s(this))throw Ts(\"tee\");return be(ns(this))}values(e){if(!_s(this))throw Ts(\"values\");return ue(this,ps(e,\"First parameter\").preventCancel)}}function ws(e,t,r,s=1,n=(()=>1)){const i=Object.create(gs.prototype);return vs(i),ts(i,Object.create(jr.prototype),e,t,r,s,n),i}function Ss(e,t,r){const s=Object.create(gs.prototype);return vs(s),tt(s,Object.create(ke.prototype),e,t,r,0,void 0),s}function vs(e){e._state=\"readable\",e._reader=void 0,e._storedError=void 0,e._disturbed=!1}function _s(e){return!!i(e)&&!!Object.prototype.hasOwnProperty.call(e,\"_readableStreamController\")&&e instanceof gs}function Zs(e){return void 0!==e._reader}function Xs(e,t){if(e._disturbed=!0,\"closed\"===e._state)return u(void 0);if(\"errored\"===e._state)return f(e._storedError);Ls(e);const s=e._reader;return void 0!==s&&ut(s)&&(s._readIntoRequests.forEach((e=>{e._closeSteps(void 0)})),s._readIntoRequests=new X),g(e._readableStreamController[M](t),r)}function Ls(e){e._state=\"closed\";const t=e._reader;void 0!==t&&(V(t),oe(t)&&(t._readRequests.forEach((e=>{e._closeSteps()})),t._readRequests=new X))}function xs(e,t){e._state=\"errored\",e._storedError=t;const r=e._reader;void 0!==r&&(P(r,t),oe(r)?(r._readRequests.forEach((e=>{e._errorSteps(t)})),r._readRequests=new X):(r._readIntoRequests.forEach((e=>{e._errorSteps(t)})),r._readIntoRequests=new X))}function Ts(e){return new TypeError(`ReadableStream.prototype.${e} can only be used on a ReadableStream`)}function ks(e,t){z(e,t);const r=null==e?void 0:e.highWaterMark;return J(r,\"highWaterMark\",\"QueuingStrategyInit\"),{highWaterMark:D(r)}}Object.defineProperties(gs.prototype,{cancel:{enumerable:!0},getReader:{enumerable:!0},pipeThrough:{enumerable:!0},pipeTo:{enumerable:!0},tee:{enumerable:!0},values:{enumerable:!0},locked:{enumerable:!0}}),\"symbol\"==typeof t.toStringTag&&Object.defineProperty(gs.prototype,t.toStringTag,{value:\"ReadableStream\",configurable:!0}),\"symbol\"==typeof t.asyncIterator&&Object.defineProperty(gs.prototype,t.asyncIterator,{value:gs.prototype.values,writable:!0,configurable:!0});const Gs=e=>e.byteLength;Object.defineProperty(Gs,\"name\",{value:\"size\",configurable:!0});class Rs{constructor(e){Q(e,1,\"ByteLengthQueuingStrategy\"),e=ks(e,\"First parameter\"),this._byteLengthQueuingStrategyHighWaterMark=e.highWaterMark}get highWaterMark(){if(!Cs(this))throw Ws(\"highWaterMark\");return this._byteLengthQueuingStrategyHighWaterMark}get size(){if(!Cs(this))throw Ws(\"size\");return Gs}}function Ws(e){return new TypeError(`ByteLengthQueuingStrategy.prototype.${e} can only be used on a ByteLengthQueuingStrategy`)}function Cs(e){return!!i(e)&&!!Object.prototype.hasOwnProperty.call(e,\"_byteLengthQueuingStrategyHighWaterMark\")&&e instanceof Rs}Object.defineProperties(Rs.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),\"symbol\"==typeof t.toStringTag&&Object.defineProperty(Rs.prototype,t.toStringTag,{value:\"ByteLengthQueuingStrategy\",configurable:!0});const Ps=()=>1;Object.defineProperty(Ps,\"name\",{value:\"size\",configurable:!0});class Is{constructor(e){Q(e,1,\"CountQueuingStrategy\"),e=ks(e,\"First parameter\"),this._countQueuingStrategyHighWaterMark=e.highWaterMark}get highWaterMark(){if(!Ys(this))throw Vs(\"highWaterMark\");return this._countQueuingStrategyHighWaterMark}get size(){if(!Ys(this))throw Vs(\"size\");return Ps}}function Vs(e){return new TypeError(`CountQueuingStrategy.prototype.${e} can only be used on a CountQueuingStrategy`)}function Ys(e){return!!i(e)&&!!Object.prototype.hasOwnProperty.call(e,\"_countQueuingStrategyHighWaterMark\")&&e instanceof Is}function Hs(e,t){z(e,t);const r=null==e?void 0:e.flush,s=null==e?void 0:e.readableType,n=null==e?void 0:e.start,i=null==e?void 0:e.transform,o=null==e?void 0:e.writableType;return{flush:void 0===r?void 0:Ms(r,e,`${t} has member 'flush' that`),readableType:s,start:void 0===n?void 0:Es(n,e,`${t} has member 'start' that`),transform:void 0===i?void 0:Fs(i,e,`${t} has member 'transform' that`),writableType:o}}function Ms(e,t,r){return j(e,r),r=>_(e,t,[r])}function Es(e,t,r){return j(e,r),r=>v(e,t,[r])}function Fs(e,t,r){return j(e,r),(r,s)=>_(e,t,[r,s])}Object.defineProperties(Is.prototype,{highWaterMark:{enumerable:!0},size:{enumerable:!0}}),\"symbol\"==typeof t.toStringTag&&Object.defineProperty(Is.prototype,t.toStringTag,{value:\"CountQueuingStrategy\",configurable:!0});class Ks{constructor(e={},t={},r={}){void 0===e&&(e=null);const s=yt(t,\"Second parameter\"),n=yt(r,\"Third parameter\"),i=Hs(e,\"First parameter\");if(void 0!==i.readableType)throw new RangeError(\"Invalid readableType specified\");if(void 0!==i.writableType)throw new RangeError(\"Invalid writableType specified\");const o=mt(n,0),a=bt(n),l=mt(s,1),c=bt(s);let d;Ns(this,h((e=>{d=e})),l,c,o,a),Bs(this,i),void 0!==i.start?d(i.start(this._transformStreamController)):d(void 0)}get readable(){if(!zs(this))throw ln(\"readable\");return this._readable}get writable(){if(!zs(this))throw ln(\"writable\");return this._writable}}function Ns(e,t,r,s,n,i){function o(){return t}function a(t){return rn(e,t)}function l(t){return sn(e,t)}function c(){return nn(e)}function d(){return on(e)}function h(t){return Us(e,t),u(void 0)}e._writable=Rt(o,a,c,l,r,s),e._readable=ws(o,d,h,n,i),e._backpressure=void 0,e._backpressureChangePromise=void 0,e._backpressureChangePromise_resolve=void 0,Os(e,!0),e._transformStreamController=void 0}function zs(e){return!!i(e)&&!!Object.prototype.hasOwnProperty.call(e,\"_transformStreamController\")&&e instanceof Ks}function js(e,t){Ar(e._readable._readableStreamController,t),Us(e,t)}function Us(e,t){As(e._transformStreamController),yr(e._writable._writableStreamController,t),e._backpressure&&Os(e,!1)}function Os(e,t){void 0!==e._backpressureChangePromise&&e._backpressureChangePromise_resolve(),e._backpressureChangePromise=h((t=>{e._backpressureChangePromise_resolve=t})),e._backpressure=t}Object.defineProperties(Ks.prototype,{readable:{enumerable:!0},writable:{enumerable:!0}}),\"symbol\"==typeof t.toStringTag&&Object.defineProperty(Ks.prototype,t.toStringTag,{value:\"TransformStream\",configurable:!0});class Qs{constructor(){throw new TypeError(\"Illegal constructor\")}get desiredSize(){if(!Js(this))throw an(\"desiredSize\");return $r(this._controlledTransformStream._readable._readableStreamController)}enqueue(e){if(!Js(this))throw an(\"enqueue\");$s(this,e)}error(e){if(!Js(this))throw an(\"error\");qs(this,e)}terminate(){if(!Js(this))throw an(\"terminate\");tn(this)}}function Js(e){return!!i(e)&&!!Object.prototype.hasOwnProperty.call(e,\"_controlledTransformStream\")&&e instanceof Qs}function Ds(e,t,r,s){t._controlledTransformStream=e,e._transformStreamController=t,t._transformAlgorithm=r,t._flushAlgorithm=s}function Bs(e,t){const r=Object.create(Qs.prototype);let s=e=>{try{return $s(r,e),u(void 0)}catch(e){return f(e)}},n=()=>u(void 0);void 0!==t.transform&&(s=e=>t.transform(e,r)),void 0!==t.flush&&(n=()=>t.flush(r)),Ds(e,r,s,n)}function As(e){e._transformAlgorithm=void 0,e._flushAlgorithm=void 0}function $s(e,t){const r=e._controlledTransformStream,s=r._readable._readableStreamController;if(!es(s))throw new TypeError(\"Readable side is not in a state that permits enqueue\");try{Br(s,t)}catch(e){throw Us(r,e),r._readable._storedError}qr(s)!==r._backpressure&&Os(r,!0)}function qs(e,t){js(e._controlledTransformStream,t)}function en(e,t){return g(e._transformAlgorithm(t),void 0,(t=>{throw js(e._controlledTransformStream,t),t}))}function tn(e){const t=e._controlledTransformStream;Dr(t._readable._readableStreamController),Us(t,new TypeError(\"TransformStream terminated\"))}function rn(e,t){const r=e._transformStreamController;return e._backpressure?g(e._backpressureChangePromise,(()=>{const s=e._writable;if(\"erroring\"===s._state)throw s._storedError;return en(r,t)})):en(r,t)}function sn(e,t){return js(e,t),u(void 0)}function nn(e){const t=e._readable,r=e._transformStreamController,s=r._flushAlgorithm();return As(r),g(s,(()=>{if(\"errored\"===t._state)throw t._storedError;Dr(t._readableStreamController)}),(r=>{throw js(e,r),t._storedError}))}function on(e){return Os(e,!1),e._backpressureChangePromise}function an(e){return new TypeError(`TransformStreamDefaultController.prototype.${e} can only be used on a TransformStreamDefaultController`)}function ln(e){return new TypeError(`TransformStream.prototype.${e} can only be used on a TransformStream`)}Object.defineProperties(Qs.prototype,{enqueue:{enumerable:!0},error:{enumerable:!0},terminate:{enumerable:!0},desiredSize:{enumerable:!0}}),\"symbol\"==typeof t.toStringTag&&Object.defineProperty(Qs.prototype,t.toStringTag,{value:\"TransformStreamDefaultController\",configurable:!0}),e.ByteLengthQueuingStrategy=Rs,e.CountQueuingStrategy=Is,e.ReadableByteStreamController=ke,e.ReadableStream=gs,e.ReadableStreamBYOBReader=ht,e.ReadableStreamBYOBRequest=Te,e.ReadableStreamDefaultController=jr,e.ReadableStreamDefaultReader=ie,e.TransformStream=Ks,e.TransformStreamDefaultController=Qs,e.WritableStream=kt,e.WritableStreamDefaultController=ar,e.WritableStreamDefaultWriter=Bt,Object.defineProperty(e,\"__esModule\",{value:!0})}(Bc.exports);if(!globalThis.ReadableStream)try{const e=__webpack_require__(\"node:process\"),{emitWarning:t}=e;try{e.emitWarning=()=>{},Object.assign(globalThis,__webpack_require__(\"node:stream/web\")),e.emitWarning=t}catch(kl){throw e.emitWarning=t,kl}}catch(kl){Object.assign(globalThis,Bc.exports)}try{const{Blob:e}=__webpack_require__(\"buffer\");e&&!e.prototype.stream&&(e.prototype.stream=function(e){let t=0;const r=this;return new ReadableStream({type:\"bytes\",async pull(e){const s=r.slice(t,Math.min(r.size,t+65536)),n=await s.arrayBuffer();t+=n.byteLength,e.enqueue(new Uint8Array(n)),t===r.size&&e.close()}})})}catch(kl){}async function*Ac(e,t=!0){for(const r of e)if(\"stream\"in r)yield*r.stream();else if(ArrayBuffer.isView(r))if(t){let e=r.byteOffset;const t=r.byteOffset+r.byteLength;for(;e!==t;){const s=Math.min(t-e,65536),n=r.buffer.slice(e,e+s);e+=n.byteLength,yield new Uint8Array(n)}}else yield r;else{let e=0,t=r;for(;e!==t.size;){const r=t.slice(e,Math.min(t.size,e+65536)),s=await r.arrayBuffer();e+=s.byteLength,yield new Uint8Array(s)}}}const $c=class e{#e=[];#t=\"\";#r=0;#s=\"transparent\";constructor(t=[],r={}){if(\"object\"!=typeof t||null===t)throw new TypeError(\"Failed to construct 'Blob': The provided value cannot be converted to a sequence.\");if(\"function\"!=typeof t[Symbol.iterator])throw new TypeError(\"Failed to construct 'Blob': The object must have a callable @@iterator property.\");if(\"object\"!=typeof r&&\"function\"!=typeof r)throw new TypeError(\"Failed to construct 'Blob': parameter 2 cannot convert to dictionary.\");null===r&&(r={});const s=new TextEncoder;for(const r of t){let t;t=ArrayBuffer.isView(r)?new Uint8Array(r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength)):r instanceof ArrayBuffer?new Uint8Array(r.slice(0)):r instanceof e?r:s.encode(`${r}`),this.#r+=ArrayBuffer.isView(t)?t.byteLength:t.size,this.#e.push(t)}this.#s=`${void 0===r.endings?\"transparent\":r.endings}`;const n=void 0===r.type?\"\":String(r.type);this.#t=/^[\\x20-\\x7E]*$/.test(n)?n:\"\"}get size(){return this.#r}get type(){return this.#t}async text(){const e=new TextDecoder;let t=\"\";for await(const r of Ac(this.#e,!1))t+=e.decode(r,{stream:!0});return t+=e.decode(),t}async arrayBuffer(){const e=new Uint8Array(this.size);let t=0;for await(const r of Ac(this.#e,!1))e.set(r,t),t+=r.length;return e.buffer}stream(){const e=Ac(this.#e,!0);return new globalThis.ReadableStream({type:\"bytes\",async pull(t){const r=await e.next();r.done?t.close():t.enqueue(r.value)},async cancel(){await e.return()}})}slice(t=0,r=this.size,s=\"\"){const{size:n}=this;let i=t<0?Math.max(n+t,0):Math.min(t,n),o=r<0?Math.max(n+r,0):Math.min(r,n);const a=Math.max(o-i,0),l=this.#e,c=[];let d=0;for(const e of l){if(d>=a)break;const t=ArrayBuffer.isView(e)?e.byteLength:e.size;if(i&&t<=i)i-=t,o-=t;else{let r;ArrayBuffer.isView(e)?(r=e.subarray(i,Math.min(t,o)),d+=r.byteLength):(r=e.slice(i,Math.min(t,o)),d+=r.size),o-=t,c.push(r),i=0}}const h=new e([],{type:String(s).toLowerCase()});return h.#r=a,h.#e=c,h}get[Symbol.toStringTag](){return\"Blob\"}static[Symbol.hasInstance](e){return e&&\"object\"==typeof e&&\"function\"==typeof e.constructor&&(\"function\"==typeof e.stream||\"function\"==typeof e.arrayBuffer)&&/^(Blob|File)$/.test(e[Symbol.toStringTag])}};Object.defineProperties($c.prototype,{size:{enumerable:!0},type:{enumerable:!0},slice:{enumerable:!0}});var qc=$c;const ed=class extends qc{#n=0;#i=\"\";constructor(e,t,r={}){if(arguments.length<2)throw new TypeError(`Failed to construct 'File': 2 arguments required, but only ${arguments.length} present.`);super(e,r),null===r&&(r={});const s=void 0===r.lastModified?Date.now():Number(r.lastModified);Number.isNaN(s)||(this.#n=s),this.#i=String(t)}get name(){return this.#i}get lastModified(){return this.#n}get[Symbol.toStringTag](){return\"File\"}static[Symbol.hasInstance](e){return!!e&&e instanceof qc&&/^(File)$/.test(e[Symbol.toStringTag])}};var{toStringTag:td,iterator:rd,hasInstance:sd}=Symbol,nd=Math.random,id=\"append,set,get,getAll,delete,keys,values,entries,forEach,constructor\".split(\",\"),od=(e,t,r)=>(e+=\"\",/^(Blob|File)$/.test(t&&t[td])?[(r=void 0!==r?r+\"\":\"File\"==t[td]?t.name:\"blob\",e),t.name!==r||\"blob\"==t[td]?new ed([t],r,t):t]:[e,t+\"\"]),ad=(e,t)=>(t?e:e.replace(/\\r?\\n|\\r/g,\"\\r\\n\")).replace(/\\n/g,\"%0A\").replace(/\\r/g,\"%0D\").replace(/\"/g,\"%22\"),ld=(e,t,r)=>{if(t.length<r)throw new TypeError(`Failed to execute '${e}' on 'FormData': ${r} arguments required, but only ${t.length} present.`)};const cd=class{#o=[];constructor(...e){if(e.length)throw new TypeError(\"Failed to construct 'FormData': parameter 1 is not of type 'HTMLFormElement'.\")}get[td](){return\"FormData\"}[rd](){return this.entries()}static[sd](e){return e&&\"object\"==typeof e&&\"FormData\"===e[td]&&!id.some((t=>\"function\"!=typeof e[t]))}append(...e){ld(\"append\",arguments,2),this.#o.push(od(...e))}delete(e){ld(\"delete\",arguments,1),e+=\"\",this.#o=this.#o.filter((([t])=>t!==e))}get(e){ld(\"get\",arguments,1),e+=\"\";for(var t=this.#o,r=t.length,s=0;s<r;s++)if(t[s][0]===e)return t[s][1];return null}getAll(e,t){return ld(\"getAll\",arguments,1),t=[],e+=\"\",this.#o.forEach((r=>r[0]===e&&t.push(r[1]))),t}has(e){return ld(\"has\",arguments,1),e+=\"\",this.#o.some((t=>t[0]===e))}forEach(e,t){for(var[r,s]of(ld(\"forEach\",arguments,1),this))e.call(t,s,r,this)}set(...e){ld(\"set\",arguments,2);var t=[],r=!0;e=od(...e),this.#o.forEach((s=>{s[0]===e[0]?r&&(r=!t.push(e)):t.push(s)})),r&&t.push(e),this.#o=t}*entries(){yield*this.#o}*keys(){for(var[e]of this)yield e}*values(){for(var[,e]of this)yield e}};class dd extends Error{constructor(e,t){super(e),Error.captureStackTrace(this,this.constructor),this.type=t}get name(){return this.constructor.name}get[Symbol.toStringTag](){return this.constructor.name}}class hd extends dd{constructor(e,t,r){super(e,t),r&&(this.code=this.errno=r.code,this.erroredSysCall=r.syscall)}}const ud=Symbol.toStringTag,fd=e=>\"object\"==typeof e&&\"function\"==typeof e.append&&\"function\"==typeof e.delete&&\"function\"==typeof e.get&&\"function\"==typeof e.getAll&&\"function\"==typeof e.has&&\"function\"==typeof e.set&&\"function\"==typeof e.sort&&\"URLSearchParams\"===e[ud],pd=e=>e&&\"object\"==typeof e&&\"function\"==typeof e.arrayBuffer&&\"string\"==typeof e.type&&\"function\"==typeof e.stream&&\"function\"==typeof e.constructor&&/^(Blob|File)$/.test(e[ud]),md=p.promisify(R.default.pipeline),bd=Symbol(\"Body internals\");class yd{constructor(e,{size:t=0}={}){let r=null;null===e?e=null:fd(e)?e=f.Buffer.from(e.toString()):pd(e)||f.Buffer.isBuffer(e)||(p.types.isAnyArrayBuffer(e)?e=f.Buffer.from(e):ArrayBuffer.isView(e)?e=f.Buffer.from(e.buffer,e.byteOffset,e.byteLength):e instanceof R.default||(e instanceof cd?(e=function(e,t=qc){var r=`${nd()}${nd()}`.replace(/\\./g,\"\").slice(-28).padStart(32,\"-\"),s=[],n=`--${r}\\r\\nContent-Disposition: form-data; name=\"`;return e.forEach(((e,t)=>\"string\"==typeof e?s.push(n+ad(t)+`\"\\r\\n\\r\\n${e.replace(/\\r(?!\\n)|(?<!\\r)\\n/g,\"\\r\\n\")}\\r\\n`):s.push(n+ad(t)+`\"; filename=\"${ad(e.name,1)}\"\\r\\nContent-Type: ${e.type||\"application/octet-stream\"}\\r\\n\\r\\n`,e,\"\\r\\n\"))),s.push(`--${r}--`),new t(s,{type:\"multipart/form-data; boundary=\"+r})}(e),r=e.type.split(\"=\")[1]):e=f.Buffer.from(String(e))));let s=e;f.Buffer.isBuffer(e)?s=R.default.Readable.from(e):pd(e)&&(s=R.default.Readable.from(e.stream())),this[bd]={body:e,stream:s,boundary:r,disturbed:!1,error:null},this.size=t,e instanceof R.default&&e.on(\"error\",(e=>{const t=e instanceof dd?e:new hd(`Invalid response body while trying to fetch ${this.url}: ${e.message}`,\"system\",e);this[bd].error=t}))}get body(){return this[bd].stream}get bodyUsed(){return this[bd].disturbed}async arrayBuffer(){const{buffer:e,byteOffset:t,byteLength:r}=await gd(this);return e.slice(t,t+r)}async formData(){const e=this.headers.get(\"content-type\");if(e.startsWith(\"application/x-www-form-urlencoded\")){const e=new cd,t=new URLSearchParams(await this.text());for(const[r,s]of t)e.append(r,s);return e}const{toFormData:t}=await Promise.resolve().then((function(){return mu}));return t(this.body,e)}async blob(){const e=this.headers&&this.headers.get(\"content-type\")||this[bd].body&&this[bd].body.type||\"\",t=await this.arrayBuffer();return new qc([t],{type:e})}async json(){const e=await this.text();return JSON.parse(e)}async text(){const e=await gd(this);return(new TextDecoder).decode(e)}buffer(){return gd(this)}}async function gd(e){if(e[bd].disturbed)throw new TypeError(`body used already for: ${e.url}`);if(e[bd].disturbed=!0,e[bd].error)throw e[bd].error;const{body:t}=e;if(null===t)return f.Buffer.alloc(0);if(!(t instanceof R.default))return f.Buffer.alloc(0);const r=[];let s=0;try{for await(const n of t){if(e.size>0&&s+n.length>e.size){const r=new hd(`content size at ${e.url} over limit: ${e.size}`,\"max-size\");throw t.destroy(r),r}s+=n.length,r.push(n)}}catch(t){throw t instanceof dd?t:new hd(`Invalid response body while trying to fetch ${e.url}: ${t.message}`,\"system\",t)}if(!0!==t.readableEnded&&!0!==t._readableState.ended)throw new hd(`Premature close of server response while trying to fetch ${e.url}`);try{return r.every((e=>\"string\"==typeof e))?f.Buffer.from(r.join(\"\")):f.Buffer.concat(r,s)}catch(t){throw new hd(`Could not create Buffer from response body for ${e.url}: ${t.message}`,\"system\",t)}}yd.prototype.buffer=p.deprecate(yd.prototype.buffer,\"Please use 'response.arrayBuffer()' instead of 'response.buffer()'\",\"node-fetch#buffer\"),Object.defineProperties(yd.prototype,{body:{enumerable:!0},bodyUsed:{enumerable:!0},arrayBuffer:{enumerable:!0},blob:{enumerable:!0},json:{enumerable:!0},text:{enumerable:!0},data:{get:p.deprecate((()=>{}),\"data doesn't exist, use json(), text(), arrayBuffer(), or body instead\",\"https://github.com/node-fetch/node-fetch/issues/1000 (response)\")}});const wd=(e,t)=>{let r,s,{body:n}=e[bd];if(e.bodyUsed)throw new Error(\"cannot clone body after it is used\");return n instanceof R.default&&\"function\"!=typeof n.getBoundary&&(r=new u.PassThrough({highWaterMark:t}),s=new u.PassThrough({highWaterMark:t}),n.pipe(r),n.pipe(s),e[bd].stream=r,n=s),n},Sd=p.deprecate((e=>e.getBoundary()),\"form-data doesn't follow the spec and requires special treatment. Use alternative package\",\"https://github.com/node-fetch/node-fetch/issues/1167\"),vd=(e,t)=>null===e?null:\"string\"==typeof e?\"text/plain;charset=UTF-8\":fd(e)?\"application/x-www-form-urlencoded;charset=UTF-8\":pd(e)?e.type||null:f.Buffer.isBuffer(e)||p.types.isAnyArrayBuffer(e)||ArrayBuffer.isView(e)?null:e instanceof cd?`multipart/form-data; boundary=${t[bd].boundary}`:e&&\"function\"==typeof e.getBoundary?`multipart/form-data;boundary=${Sd(e)}`:e instanceof R.default?null:\"text/plain;charset=UTF-8\",_d=\"function\"==typeof T.default.validateHeaderName?T.default.validateHeaderName:e=>{if(!/^[\\^`\\-\\w!#$%&'*+.|~]+$/.test(e)){const t=new TypeError(`Header name must be a valid HTTP token [${e}]`);throw Object.defineProperty(t,\"code\",{value:\"ERR_INVALID_HTTP_TOKEN\"}),t}},Zd=\"function\"==typeof T.default.validateHeaderValue?T.default.validateHeaderValue:(e,t)=>{if(/[^\\t\\u0020-\\u007E\\u0080-\\u00FF]/.test(t)){const t=new TypeError(`Invalid character in header content [\"${e}\"]`);throw Object.defineProperty(t,\"code\",{value:\"ERR_INVALID_CHAR\"}),t}};class Xd extends URLSearchParams{constructor(e){let t=[];if(e instanceof Xd){const r=e.raw();for(const[e,s]of Object.entries(r))t.push(...s.map((t=>[e,t])))}else if(null==e);else{if(\"object\"!=typeof e||p.types.isBoxedPrimitive(e))throw new TypeError(\"Failed to construct 'Headers': The provided value is not of type '(sequence<sequence<ByteString>> or record<ByteString, ByteString>)\");{const r=e[Symbol.iterator];if(null==r)t.push(...Object.entries(e));else{if(\"function\"!=typeof r)throw new TypeError(\"Header pairs must be iterable\");t=[...e].map((e=>{if(\"object\"!=typeof e||p.types.isBoxedPrimitive(e))throw new TypeError(\"Each header pair must be an iterable object\");return[...e]})).map((e=>{if(2!==e.length)throw new TypeError(\"Each header pair must be a name/value tuple\");return[...e]}))}}}return t=t.length>0?t.map((([e,t])=>(_d(e),Zd(e,String(t)),[String(e).toLowerCase(),String(t)]))):void 0,super(t),new Proxy(this,{get(e,t,r){switch(t){case\"append\":case\"set\":return(r,s)=>(_d(r),Zd(r,String(s)),URLSearchParams.prototype[t].call(e,String(r).toLowerCase(),String(s)));case\"delete\":case\"has\":case\"getAll\":return r=>(_d(r),URLSearchParams.prototype[t].call(e,String(r).toLowerCase()));case\"keys\":return()=>(e.sort(),new Set(URLSearchParams.prototype.keys.call(e)).keys());default:return Reflect.get(e,t,r)}}})}get[Symbol.toStringTag](){return this.constructor.name}toString(){return Object.prototype.toString.call(this)}get(e){const t=this.getAll(e);if(0===t.length)return null;let r=t.join(\", \");return/^content-encoding$/i.test(e)&&(r=r.toLowerCase()),r}forEach(e,t){for(const r of this.keys())Reflect.apply(e,t,[this.get(r),r,this])}*values(){for(const e of this.keys())yield this.get(e)}*entries(){for(const e of this.keys())yield[e,this.get(e)]}[Symbol.iterator](){return this.entries()}raw(){return[...this.keys()].reduce(((e,t)=>(e[t]=this.getAll(t),e)),{})}[Symbol.for(\"nodejs.util.inspect.custom\")](){return[...this.keys()].reduce(((e,t)=>{const r=this.getAll(t);return e[t]=\"host\"===t?r[0]:r.length>1?r:r[0],e}),{})}}Object.defineProperties(Xd.prototype,[\"get\",\"entries\",\"forEach\",\"values\"].reduce(((e,t)=>(e[t]={enumerable:!0},e)),{}));const Ld=new Set([301,302,303,307,308]),xd=e=>Ld.has(e),Td=Symbol(\"Response internals\");class kd extends yd{constructor(e=null,t={}){super(e,t);const r=null!=t.status?t.status:200,s=new Xd(t.headers);if(null!==e&&!s.has(\"Content-Type\")){const t=vd(e,this);t&&s.append(\"Content-Type\",t)}this[Td]={type:\"default\",url:t.url,status:r,statusText:t.statusText||\"\",headers:s,counter:t.counter,highWaterMark:t.highWaterMark}}get type(){return this[Td].type}get url(){return this[Td].url||\"\"}get status(){return this[Td].status}get ok(){return this[Td].status>=200&&this[Td].status<300}get redirected(){return this[Td].counter>0}get statusText(){return this[Td].statusText}get headers(){return this[Td].headers}get highWaterMark(){return this[Td].highWaterMark}clone(){return new kd(wd(this,this.highWaterMark),{type:this.type,url:this.url,status:this.status,statusText:this.statusText,headers:this.headers,ok:this.ok,redirected:this.redirected,size:this.size,highWaterMark:this.highWaterMark})}static redirect(e,t=302){if(!xd(t))throw new RangeError('Failed to execute \"redirect\" on \"response\": Invalid status code');return new kd(null,{headers:{location:new URL(e).toString()},status:t})}static error(){const e=new kd(null,{status:0,statusText:\"\"});return e[Td].type=\"error\",e}static json(e,t={}){const r=JSON.stringify(e);if(void 0===r)throw new TypeError(\"data is not JSON serializable\");const s=new Xd(t&&t.headers);return s.has(\"content-type\")||s.set(\"content-type\",\"application/json\"),new kd(r,{...t,headers:s})}get[Symbol.toStringTag](){return\"Response\"}}Object.defineProperties(kd.prototype,{type:{enumerable:!0},url:{enumerable:!0},status:{enumerable:!0},ok:{enumerable:!0},redirected:{enumerable:!0},statusText:{enumerable:!0},headers:{enumerable:!0},clone:{enumerable:!0}});function Gd(e,t=!1){return null==e?\"no-referrer\":(e=new URL(e),/^(about|blob|data):$/.test(e.protocol)?\"no-referrer\":(e.username=\"\",e.password=\"\",e.hash=\"\",t&&(e.pathname=\"\",e.search=\"\"),e))}const Rd=new Set([\"\",\"no-referrer\",\"no-referrer-when-downgrade\",\"same-origin\",\"origin\",\"strict-origin\",\"origin-when-cross-origin\",\"strict-origin-when-cross-origin\",\"unsafe-url\"]);function Wd(e){return!!/^about:(blank|srcdoc)$/.test(e)||(\"data:\"===e.protocol||(!!/^(blob|filesystem):$/.test(e.protocol)||function(e){if(/^(http|ws)s:$/.test(e.protocol))return!0;const t=e.host.replace(/(^\\[)|(]$)/g,\"\"),r=b.isIP(t);return!(4!==r||!/^127\\./.test(t))||!(6!==r||!/^(((0+:){7})|(::(0+:){0,6}))0*1$/.test(t))||\"localhost\"!==e.host&&!e.host.endsWith(\".localhost\")&&\"file:\"===e.protocol}(e)))}const Cd=Symbol(\"Request internals\"),Pd=e=>\"object\"==typeof e&&\"object\"==typeof e[Cd],Id=p.deprecate((()=>{}),\".data is not a valid RequestInit property, use .body instead\",\"https://github.com/node-fetch/node-fetch/issues/1000 (request)\");class Vd extends yd{constructor(e,t={}){let r;if(Pd(e)?r=new URL(e.url):(r=new URL(e),e={}),\"\"!==r.username||\"\"!==r.password)throw new TypeError(`${r} is an url with embedded credentials.`);let s=t.method||e.method||\"GET\";if(/^(delete|get|head|options|post|put)$/i.test(s)&&(s=s.toUpperCase()),!Pd(t)&&\"data\"in t&&Id(),(null!=t.body||Pd(e)&&null!==e.body)&&(\"GET\"===s||\"HEAD\"===s))throw new TypeError(\"Request with GET/HEAD method cannot have body\");const n=t.body?t.body:Pd(e)&&null!==e.body?wd(e):null;super(n,{size:t.size||e.size||0});const i=new Xd(t.headers||e.headers||{});if(null!==n&&!i.has(\"Content-Type\")){const e=vd(n,this);e&&i.set(\"Content-Type\",e)}let o=Pd(e)?e.signal:null;if(\"signal\"in t&&(o=t.signal),null!=o&&(\"object\"!=typeof(a=o)||\"AbortSignal\"!==a[ud]&&\"EventTarget\"!==a[ud]))throw new TypeError(\"Expected signal to be an instanceof AbortSignal or EventTarget\");var a;let l=null==t.referrer?e.referrer:t.referrer;if(\"\"===l)l=\"no-referrer\";else if(l){const e=new URL(l);l=/^about:(\\/\\/)?client$/.test(e)?\"client\":e}else l=void 0;this[Cd]={method:s,redirect:t.redirect||e.redirect||\"follow\",headers:i,parsedURL:r,signal:o,referrer:l},this.follow=void 0===t.follow?void 0===e.follow?20:e.follow:t.follow,this.compress=void 0===t.compress?void 0===e.compress||e.compress:t.compress,this.counter=t.counter||e.counter||0,this.agent=t.agent||e.agent,this.highWaterMark=t.highWaterMark||e.highWaterMark||16384,this.insecureHTTPParser=t.insecureHTTPParser||e.insecureHTTPParser||!1,this.referrerPolicy=t.referrerPolicy||e.referrerPolicy||\"\"}get method(){return this[Cd].method}get url(){return m.format(this[Cd].parsedURL)}get headers(){return this[Cd].headers}get redirect(){return this[Cd].redirect}get signal(){return this[Cd].signal}get referrer(){return\"no-referrer\"===this[Cd].referrer?\"\":\"client\"===this[Cd].referrer?\"about:client\":this[Cd].referrer?this[Cd].referrer.toString():void 0}get referrerPolicy(){return this[Cd].referrerPolicy}set referrerPolicy(e){this[Cd].referrerPolicy=function(e){if(!Rd.has(e))throw new TypeError(`Invalid referrerPolicy: ${e}`);return e}(e)}clone(){return new Vd(this)}get[Symbol.toStringTag](){return\"Request\"}}Object.defineProperties(Vd.prototype,{method:{enumerable:!0},url:{enumerable:!0},headers:{enumerable:!0},redirect:{enumerable:!0},clone:{enumerable:!0},signal:{enumerable:!0},referrer:{enumerable:!0},referrerPolicy:{enumerable:!0}});const Yd=e=>{const{parsedURL:t}=e[Cd],r=new Xd(e[Cd].headers);r.has(\"Accept\")||r.set(\"Accept\",\"*/*\");let s=null;if(null===e.body&&/^(post|put)$/i.test(e.method)&&(s=\"0\"),null!==e.body){const t=(e=>{const{body:t}=e[bd];return null===t?0:pd(t)?t.size:f.Buffer.isBuffer(t)?t.length:t&&\"function\"==typeof t.getLengthSync&&t.hasKnownLength&&t.hasKnownLength()?t.getLengthSync():null})(e);\"number\"!=typeof t||Number.isNaN(t)||(s=String(t))}s&&r.set(\"Content-Length\",s),\"\"===e.referrerPolicy&&(e.referrerPolicy=\"strict-origin-when-cross-origin\"),e.referrer&&\"no-referrer\"!==e.referrer?e[Cd].referrer=function(e,{referrerURLCallback:t,referrerOriginCallback:r}={}){if(\"no-referrer\"===e.referrer||\"\"===e.referrerPolicy)return null;const s=e.referrerPolicy;if(\"about:client\"===e.referrer)return\"no-referrer\";const n=e.referrer;let i=Gd(n),o=Gd(n,!0);i.toString().length>4096&&(i=o),t&&(i=t(i)),r&&(o=r(o));const a=new URL(e.url);switch(s){case\"no-referrer\":return\"no-referrer\";case\"origin\":return o;case\"unsafe-url\":return i;case\"strict-origin\":return Wd(i)&&!Wd(a)?\"no-referrer\":o.toString();case\"strict-origin-when-cross-origin\":return i.origin===a.origin?i:Wd(i)&&!Wd(a)?\"no-referrer\":o;case\"same-origin\":return i.origin===a.origin?i:\"no-referrer\";case\"origin-when-cross-origin\":return i.origin===a.origin?i:o;case\"no-referrer-when-downgrade\":return Wd(i)&&!Wd(a)?\"no-referrer\":i;default:throw new TypeError(`Invalid referrerPolicy: ${s}`)}}(e):e[Cd].referrer=\"no-referrer\",e[Cd].referrer instanceof URL&&r.set(\"Referer\",e.referrer),r.has(\"User-Agent\")||r.set(\"User-Agent\",\"node-fetch\"),e.compress&&!r.has(\"Accept-Encoding\")&&r.set(\"Accept-Encoding\",\"gzip, deflate, br\");let{agent:n}=e;\"function\"==typeof n&&(n=n(t)),r.has(\"Connection\")||n||r.set(\"Connection\",\"close\");const i=(e=>{if(e.search)return e.search;const t=e.href.length-1,r=e.hash||(\"#\"===e.href[t]?\"#\":\"\");return\"?\"===e.href[t-r.length]?\"?\":\"\"})(t);return{parsedURL:t,options:{path:t.pathname+i,method:e.method,headers:r[Symbol.for(\"nodejs.util.inspect.custom\")](),insecureHTTPParser:e.insecureHTTPParser,agent:n}}};class Hd extends dd{constructor(e,t=\"aborted\"){super(e,t)}}if(!globalThis.DOMException)try{const{MessageChannel:e}=__webpack_require__(\"worker_threads\"),t=(new e).port1,r=new ArrayBuffer;t.postMessage(r,[r,r])}catch(Ai){\"DOMException\"===Ai.constructor.name&&(globalThis.DOMException=Ai.constructor)}const Md=new Set([\"data:\",\"http:\",\"https:\"]);async function Ed(e,t){return new Promise(((r,s)=>{const n=new Vd(e,t),{parsedURL:i,options:o}=Yd(n);if(!Md.has(i.protocol))throw new TypeError(`node-fetch cannot load ${e}. URL scheme \"${i.protocol.replace(/:$/,\"\")}\" is not supported.`);if(\"data:\"===i.protocol){const e=function(e){if(!/^data:/i.test(e))throw new TypeError('`uri` does not appear to be a Data URI (must begin with \"data:\")');const t=(e=e.replace(/\\r?\\n/g,\"\")).indexOf(\",\");if(-1===t||t<=4)throw new TypeError(\"malformed data: URI\");const r=e.substring(5,t).split(\";\");let s=\"\",n=!1;const i=r[0]||\"text/plain\";let o=i;for(let e=1;e<r.length;e++)\"base64\"===r[e]?n=!0:(o+=`;${r[e]}`,0===r[e].indexOf(\"charset=\")&&(s=r[e].substring(8)));r[0]||s.length||(o+=\";charset=US-ASCII\",s=\"US-ASCII\");const a=n?\"base64\":\"ascii\",l=unescape(e.substring(t+1)),c=Buffer.from(l,a);return c.type=i,c.typeFull=o,c.charset=s,c}(n.url),t=new kd(e,{headers:{\"Content-Type\":e.typeFull}});return void r(t)}const a=(\"https:\"===i.protocol?k.default:T.default).request,{signal:l}=n;let c=null;const d=()=>{const e=new Hd(\"The operation was aborted.\");s(e),n.body&&n.body instanceof R.default.Readable&&n.body.destroy(e),c&&c.body&&c.body.emit(\"error\",e)};if(l&&l.aborted)return void d();const h=()=>{d(),m()},p=a(i.toString(),o);l&&l.addEventListener(\"abort\",h);const m=()=>{p.abort(),l&&l.removeEventListener(\"abort\",h)};p.on(\"error\",(e=>{s(new hd(`request to ${n.url} failed, reason: ${e.message}`,\"system\",e)),m()})),function(e,t){const r=f.Buffer.from(\"0\\r\\n\\r\\n\");let s,n=!1,i=!1;e.on(\"response\",(e=>{const{headers:t}=e;n=\"chunked\"===t[\"transfer-encoding\"]&&!t[\"content-length\"]})),e.on(\"socket\",(o=>{const a=()=>{if(n&&!i){const e=new Error(\"Premature close\");e.code=\"ERR_STREAM_PREMATURE_CLOSE\",t(e)}},l=e=>{i=0===f.Buffer.compare(e.slice(-5),r),!i&&s&&(i=0===f.Buffer.compare(s.slice(-3),r.slice(0,3))&&0===f.Buffer.compare(e.slice(-2),r.slice(3))),s=e};o.prependListener(\"close\",a),o.on(\"data\",l),e.on(\"close\",(()=>{o.removeListener(\"close\",a),o.removeListener(\"data\",l)}))}))}(p,(e=>{c&&c.body&&c.body.destroy(e)})),process.version<\"v14\"&&p.on(\"socket\",(e=>{let t;e.prependListener(\"end\",(()=>{t=e._eventsCount})),e.prependListener(\"close\",(r=>{if(c&&t<e._eventsCount&&!r){const e=new Error(\"Premature close\");e.code=\"ERR_STREAM_PREMATURE_CLOSE\",c.body.emit(\"error\",e)}}))})),p.on(\"response\",(e=>{p.setTimeout(0);const i=function(e=[]){return new Xd(e.reduce(((e,t,r,s)=>(r%2==0&&e.push(s.slice(r,r+2)),e)),[]).filter((([e,t])=>{try{return _d(e),Zd(e,String(t)),!0}catch{return!1}})))}(e.rawHeaders);if(xd(e.statusCode)){const a=i.get(\"Location\");let l=null;try{l=null===a?null:new URL(a,n.url)}catch{if(\"manual\"!==n.redirect)return s(new hd(`uri requested responds with an invalid redirect URL: ${a}`,\"invalid-redirect\")),void m()}switch(n.redirect){case\"error\":return s(new hd(`uri requested responds with a redirect, redirect mode is set to error: ${n.url}`,\"no-redirect\")),void m();case\"manual\":break;case\"follow\":{if(null===l)break;if(n.counter>=n.follow)return s(new hd(`maximum redirect reached at: ${n.url}`,\"max-redirect\")),void m();const a={headers:new Xd(n.headers),follow:n.follow,counter:n.counter+1,agent:n.agent,compress:n.compress,method:n.method,body:wd(n),signal:n.signal,size:n.size,referrer:n.referrer,referrerPolicy:n.referrerPolicy};if(!((e,t)=>{const r=new URL(t).hostname,s=new URL(e).hostname;return r===s||r.endsWith(`.${s}`)})(n.url,l)||(o=n.url,new URL(l).protocol!==new URL(o).protocol))for(const e of[\"authorization\",\"www-authenticate\",\"cookie\",\"cookie2\"])a.headers.delete(e);if(303!==e.statusCode&&n.body&&t.body instanceof R.default.Readable)return s(new hd(\"Cannot follow redirect with body being a readable stream\",\"unsupported-redirect\")),void m();303!==e.statusCode&&(301!==e.statusCode&&302!==e.statusCode||\"POST\"!==n.method)||(a.method=\"GET\",a.body=void 0,a.headers.delete(\"content-length\"));const c=function(e){const t=(e.get(\"referrer-policy\")||\"\").split(/[,\\s]+/);let r=\"\";for(const e of t)e&&Rd.has(e)&&(r=e);return r}(i);return c&&(a.referrerPolicy=c),r(Ed(new Vd(l,a))),void m()}default:return s(new TypeError(`Redirect option '${n.redirect}' is not a valid value of RequestRedirect`))}}var o;l&&e.once(\"end\",(()=>{l.removeEventListener(\"abort\",h)}));let a=u.pipeline(e,new u.PassThrough,(e=>{e&&s(e)}));process.version<\"v12.10\"&&e.on(\"aborted\",h);const d={url:n.url,status:e.statusCode,statusText:e.statusMessage,headers:i,size:n.size,counter:n.counter,highWaterMark:n.highWaterMark},f=i.get(\"Content-Encoding\");if(!n.compress||\"HEAD\"===n.method||null===f||204===e.statusCode||304===e.statusCode)return c=new kd(a,d),void r(c);const b={flush:G.default.Z_SYNC_FLUSH,finishFlush:G.default.Z_SYNC_FLUSH};if(\"gzip\"===f||\"x-gzip\"===f)return a=u.pipeline(a,G.default.createGunzip(b),(e=>{e&&s(e)})),c=new kd(a,d),void r(c);if(\"deflate\"===f||\"x-deflate\"===f){const t=u.pipeline(e,new u.PassThrough,(e=>{e&&s(e)}));return t.once(\"data\",(e=>{a=8==(15&e[0])?u.pipeline(a,G.default.createInflate(),(e=>{e&&s(e)})):u.pipeline(a,G.default.createInflateRaw(),(e=>{e&&s(e)})),c=new kd(a,d),r(c)})),void t.once(\"end\",(()=>{c||(c=new kd(a,d),r(c))}))}if(\"br\"===f)return a=u.pipeline(a,G.default.createBrotliDecompress(),(e=>{e&&s(e)})),c=new kd(a,d),void r(c);c=new kd(a,d),r(c)})),(async(e,{body:t})=>{null===t?e.end():await md(t,e)})(p,n).catch(s)}))}var Fd=null;try{var Kd= true&&\"function\"==typeof module.require&&__webpack_require__(\"worker_threads\")||\"function\"==typeof require&&require(\"worker_threads\")|| true&&__webpack_require__(\"worker_threads\");Fd=Kd.Worker}catch(ad){}var Nd,zd,jd,Ud,Od,Qd,Jd=(jd=void 0===(Nd=null)?null:Nd,Ud=function(e,t){return Buffer.from(e,\"base64\").toString(t?\"utf16\":\"utf8\")}(\"Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwovKioKICogQ29weXJpZ2h0IENyb3F1ZXQgQ29ycG9yYXRpb24gMjAyMwogKiBCdW5kbGUgb2YgQGNyb3F1ZXQvY3JvcXVldAogKiBEYXRlOiAyMDIzLTA4LTI0CiAqIFZlcnNpb246IDEuMS4wLTM4CiAqLwoKIWZ1bmN0aW9uKCl7InVzZSBzdHJpY3QiO3ZhciB0PSJ1bmRlZmluZWQiIT10eXBlb2YgZ2xvYmFsVGhpcz9nbG9iYWxUaGlzOiJ1bmRlZmluZWQiIT10eXBlb2Ygd2luZG93P3dpbmRvdzoidW5kZWZpbmVkIiE9dHlwZW9mIGdsb2JhbD9nbG9iYWw6InVuZGVmaW5lZCIhPXR5cGVvZiBzZWxmP3NlbGY6e307IWZ1bmN0aW9uKHQpe3ZhciBlPWZ1bmN0aW9uKHQpe3ZhciBlLHI9T2JqZWN0LnByb3RvdHlwZSxuPXIuaGFzT3duUHJvcGVydHksaT0iZnVuY3Rpb24iPT10eXBlb2YgU3ltYm9sP1N5bWJvbDp7fSxhPWkuaXRlcmF0b3J8fCJAQGl0ZXJhdG9yIixvPWkuYXN5bmNJdGVyYXRvcnx8IkBAYXN5bmNJdGVyYXRvciIscz1pLnRvU3RyaW5nVGFnfHwiQEB0b1N0cmluZ1RhZyI7ZnVuY3Rpb24gaCh0LGUscil7cmV0dXJuIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0LGUse3ZhbHVlOnIsZW51bWVyYWJsZTohMCxjb25maWd1cmFibGU6ITAsd3JpdGFibGU6ITB9KSx0W2VdfXRyeXtoKHt9LCIiKX1jYXRjaCh0KXtoPWZ1bmN0aW9uKHQsZSxyKXtyZXR1cm4gdFtlXT1yfX1mdW5jdGlvbiBsKHQsZSxyLG4pe3ZhciBpPWUmJmUucHJvdG90eXBlIGluc3RhbmNlb2YgZz9lOmcsYT1PYmplY3QuY3JlYXRlKGkucHJvdG90eXBlKSxvPW5ldyBCKG58fFtdKTtyZXR1cm4gYS5faW52b2tlPWZ1bmN0aW9uKHQsZSxyKXt2YXIgbj11O3JldHVybiBmdW5jdGlvbihpLGEpe2lmKG49PT1fKXRocm93IG5ldyBFcnJvcigiR2VuZXJhdG9yIGlzIGFscmVhZHkgcnVubmluZyIpO2lmKG49PT1mKXtpZigidGhyb3ciPT09aSl0aHJvdyBhO3JldHVybiBEKCl9Zm9yKHIubWV0aG9kPWksci5hcmc9YTs7KXt2YXIgbz1yLmRlbGVnYXRlO2lmKG8pe3ZhciBzPUEobyxyKTtpZihzKXtpZihzPT09cCljb250aW51ZTtyZXR1cm4gc319aWYoIm5leHQiPT09ci5tZXRob2Qpci5zZW50PXIuX3NlbnQ9ci5hcmc7ZWxzZSBpZigidGhyb3ciPT09ci5tZXRob2Qpe2lmKG49PT11KXRocm93IG49ZixyLmFyZztyLmRpc3BhdGNoRXhjZXB0aW9uKHIuYXJnKX1lbHNlInJldHVybiI9PT1yLm1ldGhvZCYmci5hYnJ1cHQoInJldHVybiIsci5hcmcpO249Xzt2YXIgaD1jKHQsZSxyKTtpZigibm9ybWFsIj09PWgudHlwZSl7aWYobj1yLmRvbmU/ZjpkLGguYXJnPT09cCljb250aW51ZTtyZXR1cm57dmFsdWU6aC5hcmcsZG9uZTpyLmRvbmV9fSJ0aHJvdyI9PT1oLnR5cGUmJihuPWYsci5tZXRob2Q9InRocm93IixyLmFyZz1oLmFyZyl9fX0odCxyLG8pLGF9ZnVuY3Rpb24gYyh0LGUscil7dHJ5e3JldHVybnt0eXBlOiJub3JtYWwiLGFyZzp0LmNhbGwoZSxyKX19Y2F0Y2godCl7cmV0dXJue3R5cGU6InRocm93Iixhcmc6dH19fXQud3JhcD1sO3ZhciB1PSJzdXNwZW5kZWRTdGFydCIsZD0ic3VzcGVuZGVkWWllbGQiLF89ImV4ZWN1dGluZyIsZj0iY29tcGxldGVkIixwPXt9O2Z1bmN0aW9uIGcoKXt9ZnVuY3Rpb24geSgpe31mdW5jdGlvbiB2KCl7fXZhciB3PXt9O2godyxhLChmdW5jdGlvbigpe3JldHVybiB0aGlzfSkpO3ZhciBtPU9iamVjdC5nZXRQcm90b3R5cGVPZixiPW0mJm0obShSKFtdKSkpO2ImJmIhPT1yJiZuLmNhbGwoYixhKSYmKHc9Yik7dmFyIHg9di5wcm90b3R5cGU9Zy5wcm90b3R5cGU9T2JqZWN0LmNyZWF0ZSh3KTtmdW5jdGlvbiBrKHQpe1sibmV4dCIsInRocm93IiwicmV0dXJuIl0uZm9yRWFjaCgoZnVuY3Rpb24oZSl7aCh0LGUsKGZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLl9pbnZva2UoZSx0KX0pKX0pKX1mdW5jdGlvbiB6KHQsZSl7ZnVuY3Rpb24gcihpLGEsbyxzKXt2YXIgaD1jKHRbaV0sdCxhKTtpZigidGhyb3ciIT09aC50eXBlKXt2YXIgbD1oLmFyZyx1PWwudmFsdWU7cmV0dXJuIHUmJiJvYmplY3QiPT10eXBlb2YgdSYmbi5jYWxsKHUsIl9fYXdhaXQiKT9lLnJlc29sdmUodS5fX2F3YWl0KS50aGVuKChmdW5jdGlvbih0KXtyKCJuZXh0Iix0LG8scyl9KSwoZnVuY3Rpb24odCl7cigidGhyb3ciLHQsbyxzKX0pKTplLnJlc29sdmUodSkudGhlbigoZnVuY3Rpb24odCl7bC52YWx1ZT10LG8obCl9KSwoZnVuY3Rpb24odCl7cmV0dXJuIHIoInRocm93Iix0LG8scyl9KSl9cyhoLmFyZyl9dmFyIGk7dGhpcy5faW52b2tlPWZ1bmN0aW9uKHQsbil7ZnVuY3Rpb24gYSgpe3JldHVybiBuZXcgZSgoZnVuY3Rpb24oZSxpKXtyKHQsbixlLGkpfSkpfXJldHVybiBpPWk/aS50aGVuKGEsYSk6YSgpfX1mdW5jdGlvbiBBKHQscil7dmFyIG49dC5pdGVyYXRvcltyLm1ldGhvZF07aWYobj09PWUpe2lmKHIuZGVsZWdhdGU9bnVsbCwidGhyb3ciPT09ci5tZXRob2Qpe2lmKHQuaXRlcmF0b3IucmV0dXJuJiYoci5tZXRob2Q9InJldHVybiIsci5hcmc9ZSxBKHQsciksInRocm93Ij09PXIubWV0aG9kKSlyZXR1cm4gcDtyLm1ldGhvZD0idGhyb3ciLHIuYXJnPW5ldyBUeXBlRXJyb3IoIlRoZSBpdGVyYXRvciBkb2VzIG5vdCBwcm92aWRlIGEgJ3Rocm93JyBtZXRob2QiKX1yZXR1cm4gcH12YXIgaT1jKG4sdC5pdGVyYXRvcixyLmFyZyk7aWYoInRocm93Ij09PWkudHlwZSlyZXR1cm4gci5tZXRob2Q9InRocm93IixyLmFyZz1pLmFyZyxyLmRlbGVnYXRlPW51bGwscDt2YXIgYT1pLmFyZztyZXR1cm4gYT9hLmRvbmU/KHJbdC5yZXN1bHROYW1lXT1hLnZhbHVlLHIubmV4dD10Lm5leHRMb2MsInJldHVybiIhPT1yLm1ldGhvZCYmKHIubWV0aG9kPSJuZXh0IixyLmFyZz1lKSxyLmRlbGVnYXRlPW51bGwscCk6YTooci5tZXRob2Q9InRocm93IixyLmFyZz1uZXcgVHlwZUVycm9yKCJpdGVyYXRvciByZXN1bHQgaXMgbm90IGFuIG9iamVjdCIpLHIuZGVsZWdhdGU9bnVsbCxwKX1mdW5jdGlvbiBFKHQpe3ZhciBlPXt0cnlMb2M6dFswXX07MSBpbiB0JiYoZS5jYXRjaExvYz10WzFdKSwyIGluIHQmJihlLmZpbmFsbHlMb2M9dFsyXSxlLmFmdGVyTG9jPXRbM10pLHRoaXMudHJ5RW50cmllcy5wdXNoKGUpfWZ1bmN0aW9uIFModCl7dmFyIGU9dC5jb21wbGV0aW9ufHx7fTtlLnR5cGU9Im5vcm1hbCIsZGVsZXRlIGUuYXJnLHQuY29tcGxldGlvbj1lfWZ1bmN0aW9uIEIodCl7dGhpcy50cnlFbnRyaWVzPVt7dHJ5TG9jOiJyb290In1dLHQuZm9yRWFjaChFLHRoaXMpLHRoaXMucmVzZXQoITApfWZ1bmN0aW9uIFIodCl7aWYodCl7dmFyIHI9dFthXTtpZihyKXJldHVybiByLmNhbGwodCk7aWYoImZ1bmN0aW9uIj09dHlwZW9mIHQubmV4dClyZXR1cm4gdDtpZighaXNOYU4odC5sZW5ndGgpKXt2YXIgaT0tMSxvPWZ1bmN0aW9uIHIoKXtmb3IoOysraTx0Lmxlbmd0aDspaWYobi5jYWxsKHQsaSkpcmV0dXJuIHIudmFsdWU9dFtpXSxyLmRvbmU9ITEscjtyZXR1cm4gci52YWx1ZT1lLHIuZG9uZT0hMCxyfTtyZXR1cm4gby5uZXh0PW99fXJldHVybntuZXh0OkR9fWZ1bmN0aW9uIEQoKXtyZXR1cm57dmFsdWU6ZSxkb25lOiEwfX1yZXR1cm4geS5wcm90b3R5cGU9dixoKHgsImNvbnN0cnVjdG9yIix2KSxoKHYsImNvbnN0cnVjdG9yIix5KSx5LmRpc3BsYXlOYW1lPWgodixzLCJHZW5lcmF0b3JGdW5jdGlvbiIpLHQuaXNHZW5lcmF0b3JGdW5jdGlvbj1mdW5jdGlvbih0KXt2YXIgZT0iZnVuY3Rpb24iPT10eXBlb2YgdCYmdC5jb25zdHJ1Y3RvcjtyZXR1cm4hIWUmJihlPT09eXx8IkdlbmVyYXRvckZ1bmN0aW9uIj09PShlLmRpc3BsYXlOYW1lfHxlLm5hbWUpKX0sdC5tYXJrPWZ1bmN0aW9uKHQpe3JldHVybiBPYmplY3Quc2V0UHJvdG90eXBlT2Y/T2JqZWN0LnNldFByb3RvdHlwZU9mKHQsdik6KHQuX19wcm90b19fPXYsaCh0LHMsIkdlbmVyYXRvckZ1bmN0aW9uIikpLHQucHJvdG90eXBlPU9iamVjdC5jcmVhdGUoeCksdH0sdC5hd3JhcD1mdW5jdGlvbih0KXtyZXR1cm57X19hd2FpdDp0fX0sayh6LnByb3RvdHlwZSksaCh6LnByb3RvdHlwZSxvLChmdW5jdGlvbigpe3JldHVybiB0aGlzfSkpLHQuQXN5bmNJdGVyYXRvcj16LHQuYXN5bmM9ZnVuY3Rpb24oZSxyLG4saSxhKXt2b2lkIDA9PT1hJiYoYT1Qcm9taXNlKTt2YXIgbz1uZXcgeihsKGUscixuLGkpLGEpO3JldHVybiB0LmlzR2VuZXJhdG9yRnVuY3Rpb24ocik/bzpvLm5leHQoKS50aGVuKChmdW5jdGlvbih0KXtyZXR1cm4gdC5kb25lP3QudmFsdWU6by5uZXh0KCl9KSl9LGsoeCksaCh4LHMsIkdlbmVyYXRvciIpLGgoeCxhLChmdW5jdGlvbigpe3JldHVybiB0aGlzfSkpLGgoeCwidG9TdHJpbmciLChmdW5jdGlvbigpe3JldHVybiJbb2JqZWN0IEdlbmVyYXRvcl0ifSkpLHQua2V5cz1mdW5jdGlvbih0KXt2YXIgZT1bXTtmb3IodmFyIHIgaW4gdCllLnB1c2gocik7cmV0dXJuIGUucmV2ZXJzZSgpLGZ1bmN0aW9uIHIoKXtmb3IoO2UubGVuZ3RoOyl7dmFyIG49ZS5wb3AoKTtpZihuIGluIHQpcmV0dXJuIHIudmFsdWU9bixyLmRvbmU9ITEscn1yZXR1cm4gci5kb25lPSEwLHJ9fSx0LnZhbHVlcz1SLEIucHJvdG90eXBlPXtjb25zdHJ1Y3RvcjpCLHJlc2V0OmZ1bmN0aW9uKHQpe2lmKHRoaXMucHJldj0wLHRoaXMubmV4dD0wLHRoaXMuc2VudD10aGlzLl9zZW50PWUsdGhpcy5kb25lPSExLHRoaXMuZGVsZWdhdGU9bnVsbCx0aGlzLm1ldGhvZD0ibmV4dCIsdGhpcy5hcmc9ZSx0aGlzLnRyeUVudHJpZXMuZm9yRWFjaChTKSwhdClmb3IodmFyIHIgaW4gdGhpcykidCI9PT1yLmNoYXJBdCgwKSYmbi5jYWxsKHRoaXMscikmJiFpc05hTigrci5zbGljZSgxKSkmJih0aGlzW3JdPWUpfSxzdG9wOmZ1bmN0aW9uKCl7dGhpcy5kb25lPSEwO3ZhciB0PXRoaXMudHJ5RW50cmllc1swXS5jb21wbGV0aW9uO2lmKCJ0aHJvdyI9PT10LnR5cGUpdGhyb3cgdC5hcmc7cmV0dXJuIHRoaXMucnZhbH0sZGlzcGF0Y2hFeGNlcHRpb246ZnVuY3Rpb24odCl7aWYodGhpcy5kb25lKXRocm93IHQ7dmFyIHI9dGhpcztmdW5jdGlvbiBpKG4saSl7cmV0dXJuIHMudHlwZT0idGhyb3ciLHMuYXJnPXQsci5uZXh0PW4saSYmKHIubWV0aG9kPSJuZXh0IixyLmFyZz1lKSwhIWl9Zm9yKHZhciBhPXRoaXMudHJ5RW50cmllcy5sZW5ndGgtMTthPj0wOy0tYSl7dmFyIG89dGhpcy50cnlFbnRyaWVzW2FdLHM9by5jb21wbGV0aW9uO2lmKCJyb290Ij09PW8udHJ5TG9jKXJldHVybiBpKCJlbmQiKTtpZihvLnRyeUxvYzw9dGhpcy5wcmV2KXt2YXIgaD1uLmNhbGwobywiY2F0Y2hMb2MiKSxsPW4uY2FsbChvLCJmaW5hbGx5TG9jIik7aWYoaCYmbCl7aWYodGhpcy5wcmV2PG8uY2F0Y2hMb2MpcmV0dXJuIGkoby5jYXRjaExvYywhMCk7aWYodGhpcy5wcmV2PG8uZmluYWxseUxvYylyZXR1cm4gaShvLmZpbmFsbHlMb2MpfWVsc2UgaWYoaCl7aWYodGhpcy5wcmV2PG8uY2F0Y2hMb2MpcmV0dXJuIGkoby5jYXRjaExvYywhMCl9ZWxzZXtpZighbCl0aHJvdyBuZXcgRXJyb3IoInRyeSBzdGF0ZW1lbnQgd2l0aG91dCBjYXRjaCBvciBmaW5hbGx5Iik7aWYodGhpcy5wcmV2PG8uZmluYWxseUxvYylyZXR1cm4gaShvLmZpbmFsbHlMb2MpfX19fSxhYnJ1cHQ6ZnVuY3Rpb24odCxlKXtmb3IodmFyIHI9dGhpcy50cnlFbnRyaWVzLmxlbmd0aC0xO3I+PTA7LS1yKXt2YXIgaT10aGlzLnRyeUVudHJpZXNbcl07aWYoaS50cnlMb2M8PXRoaXMucHJldiYmbi5jYWxsKGksImZpbmFsbHlMb2MiKSYmdGhpcy5wcmV2PGkuZmluYWxseUxvYyl7dmFyIGE9aTticmVha319YSYmKCJicmVhayI9PT10fHwiY29udGludWUiPT09dCkmJmEudHJ5TG9jPD1lJiZlPD1hLmZpbmFsbHlMb2MmJihhPW51bGwpO3ZhciBvPWE/YS5jb21wbGV0aW9uOnt9O3JldHVybiBvLnR5cGU9dCxvLmFyZz1lLGE/KHRoaXMubWV0aG9kPSJuZXh0Iix0aGlzLm5leHQ9YS5maW5hbGx5TG9jLHApOnRoaXMuY29tcGxldGUobyl9LGNvbXBsZXRlOmZ1bmN0aW9uKHQsZSl7aWYoInRocm93Ij09PXQudHlwZSl0aHJvdyB0LmFyZztyZXR1cm4iYnJlYWsiPT09dC50eXBlfHwiY29udGludWUiPT09dC50eXBlP3RoaXMubmV4dD10LmFyZzoicmV0dXJuIj09PXQudHlwZT8odGhpcy5ydmFsPXRoaXMuYXJnPXQuYXJnLHRoaXMubWV0aG9kPSJyZXR1cm4iLHRoaXMubmV4dD0iZW5kIik6Im5vcm1hbCI9PT10LnR5cGUmJmUmJih0aGlzLm5leHQ9ZSkscH0sZmluaXNoOmZ1bmN0aW9uKHQpe2Zvcih2YXIgZT10aGlzLnRyeUVudHJpZXMubGVuZ3RoLTE7ZT49MDstLWUpe3ZhciByPXRoaXMudHJ5RW50cmllc1tlXTtpZihyLmZpbmFsbHlMb2M9PT10KXJldHVybiB0aGlzLmNvbXBsZXRlKHIuY29tcGxldGlvbixyLmFmdGVyTG9jKSxTKHIpLHB9fSxjYXRjaDpmdW5jdGlvbih0KXtmb3IodmFyIGU9dGhpcy50cnlFbnRyaWVzLmxlbmd0aC0xO2U+PTA7LS1lKXt2YXIgcj10aGlzLnRyeUVudHJpZXNbZV07aWYoci50cnlMb2M9PT10KXt2YXIgbj1yLmNvbXBsZXRpb247aWYoInRocm93Ij09PW4udHlwZSl7dmFyIGk9bi5hcmc7UyhyKX1yZXR1cm4gaX19dGhyb3cgbmV3IEVycm9yKCJpbGxlZ2FsIGNhdGNoIGF0dGVtcHQiKX0sZGVsZWdhdGVZaWVsZDpmdW5jdGlvbih0LHIsbil7cmV0dXJuIHRoaXMuZGVsZWdhdGU9e2l0ZXJhdG9yOlIodCkscmVzdWx0TmFtZTpyLG5leHRMb2M6bn0sIm5leHQiPT09dGhpcy5tZXRob2QmJih0aGlzLmFyZz1lKSxwfX0sdH0odC5leHBvcnRzKTt0cnl7Z2xvYmFsVGhpcy5yZWdlbmVyYXRvclJ1bnRpbWU9ZX1jYXRjaCh0KXsib2JqZWN0Ij09dHlwZW9mIGdsb2JhbFRoaXM/Z2xvYmFsVGhpcy5yZWdlbmVyYXRvclJ1bnRpbWU9ZTpGdW5jdGlvbigiciIsInJlZ2VuZXJhdG9yUnVudGltZSA9IHIiKShlKX19KHtleHBvcnRzOnt9fSk7dmFyIGU9e2V4cG9ydHM6e319OyhmdW5jdGlvbih0KXtjb25zdCBlPTQscj0wLG49MSxpPTI7ZnVuY3Rpb24gYSh0KXtsZXQgZT10Lmxlbmd0aDtmb3IoOy0tZT49MDspdFtlXT0wfWNvbnN0IG89MCxzPTEsaD0yLGw9MyxjPTI1OCx1PTI5LGQ9MjU2LF89ZCsxK3UsZj0zMCxwPTE5LGc9MipfKzEseT0xNSx2PTE2LHc9NyxtPTI1NixiPTE2LHg9MTcsaz0xOCx6PW5ldyBVaW50OEFycmF5KFswLDAsMCwwLDAsMCwwLDAsMSwxLDEsMSwyLDIsMiwyLDMsMywzLDMsNCw0LDQsNCw1LDUsNSw1LDBdKSxBPW5ldyBVaW50OEFycmF5KFswLDAsMCwwLDEsMSwyLDIsMywzLDQsNCw1LDUsNiw2LDcsNyw4LDgsOSw5LDEwLDEwLDExLDExLDEyLDEyLDEzLDEzXSksRT1uZXcgVWludDhBcnJheShbMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwwLDAsMCwyLDMsN10pLFM9bmV3IFVpbnQ4QXJyYXkoWzE2LDE3LDE4LDAsOCw3LDksNiwxMCw1LDExLDQsMTIsMywxMywyLDE0LDEsMTVdKSxCPTUxMixSPW5ldyBBcnJheSgyKihfKzIpKTthKFIpO2NvbnN0IEQ9bmV3IEFycmF5KDIqZik7YShEKTtjb25zdCBMPW5ldyBBcnJheShCKTthKEwpO2NvbnN0IFU9bmV3IEFycmF5KGMtbCsxKTthKFUpO2NvbnN0IE89bmV3IEFycmF5KHUpO2EoTyk7Y29uc3QgQz1uZXcgQXJyYXkoZik7ZnVuY3Rpb24gVCh0LGUscixuLGkpe3RoaXMuc3RhdGljX3RyZWU9dCx0aGlzLmV4dHJhX2JpdHM9ZSx0aGlzLmV4dHJhX2Jhc2U9cix0aGlzLmVsZW1zPW4sdGhpcy5tYXhfbGVuZ3RoPWksdGhpcy5oYXNfc3RyZWU9dCYmdC5sZW5ndGh9bGV0IEYsSCxaO2Z1bmN0aW9uIE0odCxlKXt0aGlzLmR5bl90cmVlPXQsdGhpcy5tYXhfY29kZT0wLHRoaXMuc3RhdF9kZXNjPWV9YShDKTtjb25zdCBOPXQ9PnQ8MjU2P0xbdF06TFsyNTYrKHQ+Pj43KV0sST0odCxlKT0+e3QucGVuZGluZ19idWZbdC5wZW5kaW5nKytdPTI1NSZlLHQucGVuZGluZ19idWZbdC5wZW5kaW5nKytdPWU+Pj44JjI1NX0sJD0odCxlLHIpPT57dC5iaV92YWxpZD52LXI/KHQuYmlfYnVmfD1lPDx0LmJpX3ZhbGlkJjY1NTM1LEkodCx0LmJpX2J1ZiksdC5iaV9idWY9ZT4+di10LmJpX3ZhbGlkLHQuYmlfdmFsaWQrPXItdik6KHQuYmlfYnVmfD1lPDx0LmJpX3ZhbGlkJjY1NTM1LHQuYmlfdmFsaWQrPXIpfSxQPSh0LGUscik9PnskKHQsclsyKmVdLHJbMiplKzFdKX0saj0odCxlKT0+e2xldCByPTA7ZG97cnw9MSZ0LHQ+Pj49MSxyPDw9MX13aGlsZSgtLWU+MCk7cmV0dXJuIHI+Pj4xfSxLPXQ9PnsxNj09PXQuYmlfdmFsaWQ/KEkodCx0LmJpX2J1ZiksdC5iaV9idWY9MCx0LmJpX3ZhbGlkPTApOnQuYmlfdmFsaWQ+PTgmJih0LnBlbmRpbmdfYnVmW3QucGVuZGluZysrXT0yNTUmdC5iaV9idWYsdC5iaV9idWY+Pj04LHQuYmlfdmFsaWQtPTgpfSxYPSh0LGUpPT57Y29uc3Qgcj1lLmR5bl90cmVlLG49ZS5tYXhfY29kZSxpPWUuc3RhdF9kZXNjLnN0YXRpY190cmVlLGE9ZS5zdGF0X2Rlc2MuaGFzX3N0cmVlLG89ZS5zdGF0X2Rlc2MuZXh0cmFfYml0cyxzPWUuc3RhdF9kZXNjLmV4dHJhX2Jhc2UsaD1lLnN0YXRfZGVzYy5tYXhfbGVuZ3RoO2xldCBsLGMsdSxkLF8sZixwPTA7Zm9yKGQ9MDtkPD15O2QrKyl0LmJsX2NvdW50W2RdPTA7Zm9yKHJbMip0LmhlYXBbdC5oZWFwX21heF0rMV09MCxsPXQuaGVhcF9tYXgrMTtsPGc7bCsrKWM9dC5oZWFwW2xdLGQ9clsyKnJbMipjKzFdKzFdKzEsZD5oJiYoZD1oLHArKyksclsyKmMrMV09ZCxjPm58fCh0LmJsX2NvdW50W2RdKyssXz0wLGM+PXMmJihfPW9bYy1zXSksZj1yWzIqY10sdC5vcHRfbGVuKz1mKihkK18pLGEmJih0LnN0YXRpY19sZW4rPWYqKGlbMipjKzFdK18pKSk7aWYoMCE9PXApe2Rve2ZvcihkPWgtMTswPT09dC5ibF9jb3VudFtkXTspZC0tO3QuYmxfY291bnRbZF0tLSx0LmJsX2NvdW50W2QrMV0rPTIsdC5ibF9jb3VudFtoXS0tLHAtPTJ9d2hpbGUocD4wKTtmb3IoZD1oOzAhPT1kO2QtLSlmb3IoYz10LmJsX2NvdW50W2RdOzAhPT1jOyl1PXQuaGVhcFstLWxdLHU+bnx8KHJbMip1KzFdIT09ZCYmKHQub3B0X2xlbis9KGQtclsyKnUrMV0pKnJbMip1XSxyWzIqdSsxXT1kKSxjLS0pfX0scT0odCxlLHIpPT57Y29uc3Qgbj1uZXcgQXJyYXkoeSsxKTtsZXQgaSxhLG89MDtmb3IoaT0xO2k8PXk7aSsrKW5baV09bz1vK3JbaS0xXTw8MTtmb3IoYT0wO2E8PWU7YSsrKXtsZXQgZT10WzIqYSsxXTswIT09ZSYmKHRbMiphXT1qKG5bZV0rKyxlKSl9fSxHPSgpPT57bGV0IHQsZSxyLG4saTtjb25zdCBhPW5ldyBBcnJheSh5KzEpO2ZvcihyPTAsbj0wO248dS0xO24rKylmb3IoT1tuXT1yLHQ9MDt0PDE8PHpbbl07dCsrKVVbcisrXT1uO2ZvcihVW3ItMV09bixpPTAsbj0wO248MTY7bisrKWZvcihDW25dPWksdD0wO3Q8MTw8QVtuXTt0KyspTFtpKytdPW47Zm9yKGk+Pj03O248ZjtuKyspZm9yKENbbl09aTw8Nyx0PTA7dDwxPDxBW25dLTc7dCsrKUxbMjU2K2krK109bjtmb3IoZT0wO2U8PXk7ZSsrKWFbZV09MDtmb3IodD0wO3Q8PTE0MzspUlsyKnQrMV09OCx0KyssYVs4XSsrO2Zvcig7dDw9MjU1OylSWzIqdCsxXT05LHQrKyxhWzldKys7Zm9yKDt0PD0yNzk7KVJbMip0KzFdPTcsdCsrLGFbN10rKztmb3IoO3Q8PTI4NzspUlsyKnQrMV09OCx0KyssYVs4XSsrO2ZvcihxKFIsXysxLGEpLHQ9MDt0PGY7dCsrKURbMip0KzFdPTUsRFsyKnRdPWoodCw1KTtGPW5ldyBUKFIseixkKzEsXyx5KSxIPW5ldyBUKEQsQSwwLGYseSksWj1uZXcgVChuZXcgQXJyYXkoMCksRSwwLHAsdyl9LFc9dD0+e2xldCBlO2ZvcihlPTA7ZTxfO2UrKyl0LmR5bl9sdHJlZVsyKmVdPTA7Zm9yKGU9MDtlPGY7ZSsrKXQuZHluX2R0cmVlWzIqZV09MDtmb3IoZT0wO2U8cDtlKyspdC5ibF90cmVlWzIqZV09MDt0LmR5bl9sdHJlZVsyKm1dPTEsdC5vcHRfbGVuPXQuc3RhdGljX2xlbj0wLHQubGFzdF9saXQ9dC5tYXRjaGVzPTB9LFk9dD0+e3QuYmlfdmFsaWQ+OD9JKHQsdC5iaV9idWYpOnQuYmlfdmFsaWQ+MCYmKHQucGVuZGluZ19idWZbdC5wZW5kaW5nKytdPXQuYmlfYnVmKSx0LmJpX2J1Zj0wLHQuYmlfdmFsaWQ9MH0sVj0odCxlLHIsbik9PntZKHQpLG4mJihJKHQsciksSSh0LH5yKSksdC5wZW5kaW5nX2J1Zi5zZXQodC53aW5kb3cuc3ViYXJyYXkoZSxlK3IpLHQucGVuZGluZyksdC5wZW5kaW5nKz1yfSxKPSh0LGUscixuKT0+e2NvbnN0IGk9MiplLGE9MipyO3JldHVybiB0W2ldPHRbYV18fHRbaV09PT10W2FdJiZuW2VdPD1uW3JdfSxRPSh0LGUscik9Pntjb25zdCBuPXQuaGVhcFtyXTtsZXQgaT1yPDwxO2Zvcig7aTw9dC5oZWFwX2xlbiYmKGk8dC5oZWFwX2xlbiYmSihlLHQuaGVhcFtpKzFdLHQuaGVhcFtpXSx0LmRlcHRoKSYmaSsrLCFKKGUsbix0LmhlYXBbaV0sdC5kZXB0aCkpOyl0LmhlYXBbcl09dC5oZWFwW2ldLHI9aSxpPDw9MTt0LmhlYXBbcl09bn0sdHQ9KHQsZSxyKT0+e2xldCBuLGksYSxvLHM9MDtpZigwIT09dC5sYXN0X2xpdClkb3tuPXQucGVuZGluZ19idWZbdC5kX2J1ZisyKnNdPDw4fHQucGVuZGluZ19idWZbdC5kX2J1ZisyKnMrMV0saT10LnBlbmRpbmdfYnVmW3QubF9idWYrc10scysrLDA9PT1uP1AodCxpLGUpOihhPVVbaV0sUCh0LGErZCsxLGUpLG89elthXSwwIT09byYmKGktPU9bYV0sJCh0LGksbykpLG4tLSxhPU4obiksUCh0LGEsciksbz1BW2FdLDAhPT1vJiYobi09Q1thXSwkKHQsbixvKSkpfXdoaWxlKHM8dC5sYXN0X2xpdCk7UCh0LG0sZSl9LGV0PSh0LGUpPT57Y29uc3Qgcj1lLmR5bl90cmVlLG49ZS5zdGF0X2Rlc2Muc3RhdGljX3RyZWUsaT1lLnN0YXRfZGVzYy5oYXNfc3RyZWUsYT1lLnN0YXRfZGVzYy5lbGVtcztsZXQgbyxzLGgsbD0tMTtmb3IodC5oZWFwX2xlbj0wLHQuaGVhcF9tYXg9ZyxvPTA7bzxhO28rKykwIT09clsyKm9dPyh0LmhlYXBbKyt0LmhlYXBfbGVuXT1sPW8sdC5kZXB0aFtvXT0wKTpyWzIqbysxXT0wO2Zvcig7dC5oZWFwX2xlbjwyOyloPXQuaGVhcFsrK3QuaGVhcF9sZW5dPWw8Mj8rK2w6MCxyWzIqaF09MSx0LmRlcHRoW2hdPTAsdC5vcHRfbGVuLS0saSYmKHQuc3RhdGljX2xlbi09blsyKmgrMV0pO2ZvcihlLm1heF9jb2RlPWwsbz10LmhlYXBfbGVuPj4xO28+PTE7by0tKVEodCxyLG8pO2g9YTtkb3tvPXQuaGVhcFsxXSx0LmhlYXBbMV09dC5oZWFwW3QuaGVhcF9sZW4tLV0sUSh0LHIsMSkscz10LmhlYXBbMV0sdC5oZWFwWy0tdC5oZWFwX21heF09byx0LmhlYXBbLS10LmhlYXBfbWF4XT1zLHJbMipoXT1yWzIqb10rclsyKnNdLHQuZGVwdGhbaF09KHQuZGVwdGhbb10+PXQuZGVwdGhbc10/dC5kZXB0aFtvXTp0LmRlcHRoW3NdKSsxLHJbMipvKzFdPXJbMipzKzFdPWgsdC5oZWFwWzFdPWgrKyxRKHQsciwxKX13aGlsZSh0LmhlYXBfbGVuPj0yKTt0LmhlYXBbLS10LmhlYXBfbWF4XT10LmhlYXBbMV0sWCh0LGUpLHEocixsLHQuYmxfY291bnQpfSxydD0odCxlLHIpPT57bGV0IG4saSxhPS0xLG89ZVsxXSxzPTAsaD03LGw9NDtmb3IoMD09PW8mJihoPTEzOCxsPTMpLGVbMioocisxKSsxXT02NTUzNSxuPTA7bjw9cjtuKyspaT1vLG89ZVsyKihuKzEpKzFdLCsrczxoJiZpPT09b3x8KHM8bD90LmJsX3RyZWVbMippXSs9czowIT09aT8oaSE9PWEmJnQuYmxfdHJlZVsyKmldKyssdC5ibF90cmVlWzIqYl0rKyk6czw9MTA/dC5ibF90cmVlWzIqeF0rKzp0LmJsX3RyZWVbMiprXSsrLHM9MCxhPWksMD09PW8/KGg9MTM4LGw9Myk6aT09PW8/KGg9NixsPTMpOihoPTcsbD00KSl9LG50PSh0LGUscik9PntsZXQgbixpLGE9LTEsbz1lWzFdLHM9MCxoPTcsbD00O2ZvcigwPT09byYmKGg9MTM4LGw9Myksbj0wO248PXI7bisrKWlmKGk9byxvPWVbMioobisxKSsxXSwhKCsrczxoJiZpPT09bykpe2lmKHM8bClkb3tQKHQsaSx0LmJsX3RyZWUpfXdoaWxlKDAhPS0tcyk7ZWxzZSAwIT09aT8oaSE9PWEmJihQKHQsaSx0LmJsX3RyZWUpLHMtLSksUCh0LGIsdC5ibF90cmVlKSwkKHQscy0zLDIpKTpzPD0xMD8oUCh0LHgsdC5ibF90cmVlKSwkKHQscy0zLDMpKTooUCh0LGssdC5ibF90cmVlKSwkKHQscy0xMSw3KSk7cz0wLGE9aSwwPT09bz8oaD0xMzgsbD0zKTppPT09bz8oaD02LGw9Myk6KGg9NyxsPTQpfX0saXQ9dD0+e2xldCBlO2ZvcihydCh0LHQuZHluX2x0cmVlLHQubF9kZXNjLm1heF9jb2RlKSxydCh0LHQuZHluX2R0cmVlLHQuZF9kZXNjLm1heF9jb2RlKSxldCh0LHQuYmxfZGVzYyksZT1wLTE7ZT49MyYmMD09PXQuYmxfdHJlZVsyKlNbZV0rMV07ZS0tKTtyZXR1cm4gdC5vcHRfbGVuKz0zKihlKzEpKzUrNSs0LGV9LGF0PSh0LGUscixuKT0+e2xldCBpO2ZvcigkKHQsZS0yNTcsNSksJCh0LHItMSw1KSwkKHQsbi00LDQpLGk9MDtpPG47aSsrKSQodCx0LmJsX3RyZWVbMipTW2ldKzFdLDMpO250KHQsdC5keW5fbHRyZWUsZS0xKSxudCh0LHQuZHluX2R0cmVlLHItMSl9LG90PXQ9PntsZXQgZSxpPTQwOTM2MjQ0NDc7Zm9yKGU9MDtlPD0zMTtlKyssaT4+Pj0xKWlmKDEmaSYmMCE9PXQuZHluX2x0cmVlWzIqZV0pcmV0dXJuIHI7aWYoMCE9PXQuZHluX2x0cmVlWzE4XXx8MCE9PXQuZHluX2x0cmVlWzIwXXx8MCE9PXQuZHluX2x0cmVlWzI2XSlyZXR1cm4gbjtmb3IoZT0zMjtlPGQ7ZSsrKWlmKDAhPT10LmR5bl9sdHJlZVsyKmVdKXJldHVybiBuO3JldHVybiByfTtsZXQgc3Q9ITE7Y29uc3QgaHQ9KHQsZSxyLG4pPT57JCh0LChvPDwxKSsobj8xOjApLDMpLFYodCxlLHIsITApfSxsdD0odCxyLG4sYSk9PntsZXQgbyxsLGM9MDt0LmxldmVsPjA/KHQuc3RybS5kYXRhX3R5cGU9PT1pJiYodC5zdHJtLmRhdGFfdHlwZT1vdCh0KSksZXQodCx0LmxfZGVzYyksZXQodCx0LmRfZGVzYyksYz1pdCh0KSxvPXQub3B0X2xlbiszKzc+Pj4zLGw9dC5zdGF0aWNfbGVuKzMrNz4+PjMsbDw9byYmKG89bCkpOm89bD1uKzUsbis0PD1vJiYtMSE9PXI/aHQodCxyLG4sYSk6dC5zdHJhdGVneT09PWV8fGw9PT1vPygkKHQsKHM8PDEpKyhhPzE6MCksMyksdHQodCxSLEQpKTooJCh0LChoPDwxKSsoYT8xOjApLDMpLGF0KHQsdC5sX2Rlc2MubWF4X2NvZGUrMSx0LmRfZGVzYy5tYXhfY29kZSsxLGMrMSksdHQodCx0LmR5bl9sdHJlZSx0LmR5bl9kdHJlZSkpLFcodCksYSYmWSh0KX07dmFyIGN0PXtfdHJfaW5pdDp0PT57c3R8fChHKCksc3Q9ITApLHQubF9kZXNjPW5ldyBNKHQuZHluX2x0cmVlLEYpLHQuZF9kZXNjPW5ldyBNKHQuZHluX2R0cmVlLEgpLHQuYmxfZGVzYz1uZXcgTSh0LmJsX3RyZWUsWiksdC5iaV9idWY9MCx0LmJpX3ZhbGlkPTAsVyh0KX0sX3RyX3N0b3JlZF9ibG9jazpodCxfdHJfZmx1c2hfYmxvY2s6bHQsX3RyX3RhbGx5Oih0LGUscik9Pih0LnBlbmRpbmdfYnVmW3QuZF9idWYrMip0Lmxhc3RfbGl0XT1lPj4+OCYyNTUsdC5wZW5kaW5nX2J1Zlt0LmRfYnVmKzIqdC5sYXN0X2xpdCsxXT0yNTUmZSx0LnBlbmRpbmdfYnVmW3QubF9idWYrdC5sYXN0X2xpdF09MjU1JnIsdC5sYXN0X2xpdCsrLDA9PT1lP3QuZHluX2x0cmVlWzIqcl0rKzoodC5tYXRjaGVzKyssZS0tLHQuZHluX2x0cmVlWzIqKFVbcl0rZCsxKV0rKyx0LmR5bl9kdHJlZVsyKk4oZSldKyspLHQubGFzdF9saXQ9PT10LmxpdF9idWZzaXplLTEpLF90cl9hbGlnbjp0PT57JCh0LHM8PDEsMyksUCh0LG0sUiksSyh0KX19LHV0PSh0LGUscixuKT0+e2xldCBpPTY1NTM1JnR8MCxhPXQ+Pj4xNiY2NTUzNXwwLG89MDtmb3IoOzAhPT1yOyl7bz1yPjJlMz8yZTM6cixyLT1vO2Rve2k9aStlW24rK118MCxhPWEraXwwfXdoaWxlKC0tbyk7aSU9NjU1MjEsYSU9NjU1MjF9cmV0dXJuIGl8YTw8MTZ8MH07Y29uc3QgZHQ9bmV3IFVpbnQzMkFycmF5KCgoKT0+e2xldCB0LGU9W107Zm9yKHZhciByPTA7cjwyNTY7cisrKXt0PXI7Zm9yKHZhciBuPTA7bjw4O24rKyl0PTEmdD8zOTg4MjkyMzg0XnQ+Pj4xOnQ+Pj4xO2Vbcl09dH1yZXR1cm4gZX0pKCkpO3ZhciBfdD0odCxlLHIsbik9Pntjb25zdCBpPWR0LGE9bityO3RePS0xO2ZvcihsZXQgcj1uO3I8YTtyKyspdD10Pj4+OF5pWzI1NSYodF5lW3JdKV07cmV0dXJuLTFedH0sZnQ9ezI6Im5lZWQgZGljdGlvbmFyeSIsMToic3RyZWFtIGVuZCIsMDoiIiwiLTEiOiJmaWxlIGVycm9yIiwiLTIiOiJzdHJlYW0gZXJyb3IiLCItMyI6ImRhdGEgZXJyb3IiLCItNCI6Imluc3VmZmljaWVudCBtZW1vcnkiLCItNSI6ImJ1ZmZlciBlcnJvciIsIi02IjoiaW5jb21wYXRpYmxlIHZlcnNpb24ifSxwdD17Wl9OT19GTFVTSDowLFpfUEFSVElBTF9GTFVTSDoxLFpfU1lOQ19GTFVTSDoyLFpfRlVMTF9GTFVTSDozLFpfRklOSVNIOjQsWl9CTE9DSzo1LFpfVFJFRVM6NixaX09LOjAsWl9TVFJFQU1fRU5EOjEsWl9ORUVEX0RJQ1Q6MixaX0VSUk5POi0xLFpfU1RSRUFNX0VSUk9SOi0yLFpfREFUQV9FUlJPUjotMyxaX01FTV9FUlJPUjotNCxaX0JVRl9FUlJPUjotNSxaX05PX0NPTVBSRVNTSU9OOjAsWl9CRVNUX1NQRUVEOjEsWl9CRVNUX0NPTVBSRVNTSU9OOjksWl9ERUZBVUxUX0NPTVBSRVNTSU9OOi0xLFpfRklMVEVSRUQ6MSxaX0hVRkZNQU5fT05MWToyLFpfUkxFOjMsWl9GSVhFRDo0LFpfREVGQVVMVF9TVFJBVEVHWTowLFpfQklOQVJZOjAsWl9URVhUOjEsWl9VTktOT1dOOjIsWl9ERUZMQVRFRDo4fTtjb25zdHtfdHJfaW5pdDpndCxfdHJfc3RvcmVkX2Jsb2NrOnl0LF90cl9mbHVzaF9ibG9jazp2dCxfdHJfdGFsbHk6d3QsX3RyX2FsaWduOm10fT1jdCx7Wl9OT19GTFVTSDpidCxaX1BBUlRJQUxfRkxVU0g6eHQsWl9GVUxMX0ZMVVNIOmt0LFpfRklOSVNIOnp0LFpfQkxPQ0s6QXQsWl9PSzpFdCxaX1NUUkVBTV9FTkQ6U3QsWl9TVFJFQU1fRVJST1I6QnQsWl9EQVRBX0VSUk9SOlJ0LFpfQlVGX0VSUk9SOkR0LFpfREVGQVVMVF9DT01QUkVTU0lPTjpMdCxaX0ZJTFRFUkVEOlV0LFpfSFVGRk1BTl9PTkxZOk90LFpfUkxFOkN0LFpfRklYRUQ6VHQsWl9ERUZBVUxUX1NUUkFURUdZOkZ0LFpfVU5LTk9XTjpIdCxaX0RFRkxBVEVEOlp0fT1wdCxNdD05LE50PTE1LEl0PTgsJHQ9Mjg2LFB0PTMwLGp0PTE5LEt0PTIqJHQrMSxYdD0xNSxxdD0zLEd0PTI1OCxXdD1HdCtxdCsxLFl0PTMyLFZ0PTQyLEp0PTY5LFF0PTczLHRlPTkxLGVlPTEwMyxyZT0xMTMsbmU9NjY2LGllPTEsYWU9MixvZT0zLHNlPTQsaGU9MyxsZT0odCxlKT0+KHQubXNnPWZ0W2VdLGUpLGNlPXQ9Pih0PDwxKS0odD40Pzk6MCksdWU9dD0+e2xldCBlPXQubGVuZ3RoO2Zvcig7LS1lPj0wOyl0W2VdPTB9O2xldCBkZT0odCxlLHIpPT4oZTw8dC5oYXNoX3NoaWZ0XnIpJnQuaGFzaF9tYXNrO2NvbnN0IF9lPXQ9Pntjb25zdCBlPXQuc3RhdGU7bGV0IHI9ZS5wZW5kaW5nO3I+dC5hdmFpbF9vdXQmJihyPXQuYXZhaWxfb3V0KSwwIT09ciYmKHQub3V0cHV0LnNldChlLnBlbmRpbmdfYnVmLnN1YmFycmF5KGUucGVuZGluZ19vdXQsZS5wZW5kaW5nX291dCtyKSx0Lm5leHRfb3V0KSx0Lm5leHRfb3V0Kz1yLGUucGVuZGluZ19vdXQrPXIsdC50b3RhbF9vdXQrPXIsdC5hdmFpbF9vdXQtPXIsZS5wZW5kaW5nLT1yLDA9PT1lLnBlbmRpbmcmJihlLnBlbmRpbmdfb3V0PTApKX0sZmU9KHQsZSk9Pnt2dCh0LHQuYmxvY2tfc3RhcnQ+PTA/dC5ibG9ja19zdGFydDotMSx0LnN0cnN0YXJ0LXQuYmxvY2tfc3RhcnQsZSksdC5ibG9ja19zdGFydD10LnN0cnN0YXJ0LF9lKHQuc3RybSl9LHBlPSh0LGUpPT57dC5wZW5kaW5nX2J1Zlt0LnBlbmRpbmcrK109ZX0sZ2U9KHQsZSk9Pnt0LnBlbmRpbmdfYnVmW3QucGVuZGluZysrXT1lPj4+OCYyNTUsdC5wZW5kaW5nX2J1Zlt0LnBlbmRpbmcrK109MjU1JmV9LHllPSh0LGUscixuKT0+e2xldCBpPXQuYXZhaWxfaW47cmV0dXJuIGk+biYmKGk9biksMD09PWk/MDoodC5hdmFpbF9pbi09aSxlLnNldCh0LmlucHV0LnN1YmFycmF5KHQubmV4dF9pbix0Lm5leHRfaW4raSksciksMT09PXQuc3RhdGUud3JhcD90LmFkbGVyPXV0KHQuYWRsZXIsZSxpLHIpOjI9PT10LnN0YXRlLndyYXAmJih0LmFkbGVyPV90KHQuYWRsZXIsZSxpLHIpKSx0Lm5leHRfaW4rPWksdC50b3RhbF9pbis9aSxpKX0sdmU9KHQsZSk9PntsZXQgcixuLGk9dC5tYXhfY2hhaW5fbGVuZ3RoLGE9dC5zdHJzdGFydCxvPXQucHJldl9sZW5ndGgscz10Lm5pY2VfbWF0Y2g7Y29uc3QgaD10LnN0cnN0YXJ0PnQud19zaXplLVd0P3Quc3Ryc3RhcnQtKHQud19zaXplLVd0KTowLGw9dC53aW5kb3csYz10LndfbWFzayx1PXQucHJldixkPXQuc3Ryc3RhcnQrR3Q7bGV0IF89bFthK28tMV0sZj1sW2Erb107dC5wcmV2X2xlbmd0aD49dC5nb29kX21hdGNoJiYoaT4+PTIpLHM+dC5sb29rYWhlYWQmJihzPXQubG9va2FoZWFkKTtkb3tpZihyPWUsbFtyK29dPT09ZiYmbFtyK28tMV09PT1fJiZsW3JdPT09bFthXSYmbFsrK3JdPT09bFthKzFdKXthKz0yLHIrKztkb3t9d2hpbGUobFsrK2FdPT09bFsrK3JdJiZsWysrYV09PT1sWysrcl0mJmxbKythXT09PWxbKytyXSYmbFsrK2FdPT09bFsrK3JdJiZsWysrYV09PT1sWysrcl0mJmxbKythXT09PWxbKytyXSYmbFsrK2FdPT09bFsrK3JdJiZsWysrYV09PT1sWysrcl0mJmE8ZCk7aWYobj1HdC0oZC1hKSxhPWQtR3Qsbj5vKXtpZih0Lm1hdGNoX3N0YXJ0PWUsbz1uLG4+PXMpYnJlYWs7Xz1sW2Erby0xXSxmPWxbYStvXX19fXdoaWxlKChlPXVbZSZjXSk+aCYmMCE9LS1pKTtyZXR1cm4gbzw9dC5sb29rYWhlYWQ/bzp0Lmxvb2thaGVhZH0sd2U9dD0+e2NvbnN0IGU9dC53X3NpemU7bGV0IHIsbixpLGEsbztkb3tpZihhPXQud2luZG93X3NpemUtdC5sb29rYWhlYWQtdC5zdHJzdGFydCx0LnN0cnN0YXJ0Pj1lKyhlLVd0KSl7dC53aW5kb3cuc2V0KHQud2luZG93LnN1YmFycmF5KGUsZStlKSwwKSx0Lm1hdGNoX3N0YXJ0LT1lLHQuc3Ryc3RhcnQtPWUsdC5ibG9ja19zdGFydC09ZSxuPXQuaGFzaF9zaXplLHI9bjtkb3tpPXQuaGVhZFstLXJdLHQuaGVhZFtyXT1pPj1lP2ktZTowfXdoaWxlKC0tbik7bj1lLHI9bjtkb3tpPXQucHJldlstLXJdLHQucHJldltyXT1pPj1lP2ktZTowfXdoaWxlKC0tbik7YSs9ZX1pZigwPT09dC5zdHJtLmF2YWlsX2luKWJyZWFrO2lmKG49eWUodC5zdHJtLHQud2luZG93LHQuc3Ryc3RhcnQrdC5sb29rYWhlYWQsYSksdC5sb29rYWhlYWQrPW4sdC5sb29rYWhlYWQrdC5pbnNlcnQ+PXF0KWZvcihvPXQuc3Ryc3RhcnQtdC5pbnNlcnQsdC5pbnNfaD10LndpbmRvd1tvXSx0Lmluc19oPWRlKHQsdC5pbnNfaCx0LndpbmRvd1tvKzFdKTt0Lmluc2VydCYmKHQuaW5zX2g9ZGUodCx0Lmluc19oLHQud2luZG93W28rcXQtMV0pLHQucHJldltvJnQud19tYXNrXT10LmhlYWRbdC5pbnNfaF0sdC5oZWFkW3QuaW5zX2hdPW8sbysrLHQuaW5zZXJ0LS0sISh0Lmxvb2thaGVhZCt0Lmluc2VydDxxdCkpOyk7fXdoaWxlKHQubG9va2FoZWFkPFd0JiYwIT09dC5zdHJtLmF2YWlsX2luKX0sbWU9KHQsZSk9PntsZXQgcixuO2Zvcig7Oyl7aWYodC5sb29rYWhlYWQ8V3Qpe2lmKHdlKHQpLHQubG9va2FoZWFkPFd0JiZlPT09YnQpcmV0dXJuIGllO2lmKDA9PT10Lmxvb2thaGVhZClicmVha31pZihyPTAsdC5sb29rYWhlYWQ+PXF0JiYodC5pbnNfaD1kZSh0LHQuaW5zX2gsdC53aW5kb3dbdC5zdHJzdGFydCtxdC0xXSkscj10LnByZXZbdC5zdHJzdGFydCZ0LndfbWFza109dC5oZWFkW3QuaW5zX2hdLHQuaGVhZFt0Lmluc19oXT10LnN0cnN0YXJ0KSwwIT09ciYmdC5zdHJzdGFydC1yPD10Lndfc2l6ZS1XdCYmKHQubWF0Y2hfbGVuZ3RoPXZlKHQscikpLHQubWF0Y2hfbGVuZ3RoPj1xdClpZihuPXd0KHQsdC5zdHJzdGFydC10Lm1hdGNoX3N0YXJ0LHQubWF0Y2hfbGVuZ3RoLXF0KSx0Lmxvb2thaGVhZC09dC5tYXRjaF9sZW5ndGgsdC5tYXRjaF9sZW5ndGg8PXQubWF4X2xhenlfbWF0Y2gmJnQubG9va2FoZWFkPj1xdCl7dC5tYXRjaF9sZW5ndGgtLTtkb3t0LnN0cnN0YXJ0KyssdC5pbnNfaD1kZSh0LHQuaW5zX2gsdC53aW5kb3dbdC5zdHJzdGFydCtxdC0xXSkscj10LnByZXZbdC5zdHJzdGFydCZ0LndfbWFza109dC5oZWFkW3QuaW5zX2hdLHQuaGVhZFt0Lmluc19oXT10LnN0cnN0YXJ0fXdoaWxlKDAhPS0tdC5tYXRjaF9sZW5ndGgpO3Quc3Ryc3RhcnQrK31lbHNlIHQuc3Ryc3RhcnQrPXQubWF0Y2hfbGVuZ3RoLHQubWF0Y2hfbGVuZ3RoPTAsdC5pbnNfaD10LndpbmRvd1t0LnN0cnN0YXJ0XSx0Lmluc19oPWRlKHQsdC5pbnNfaCx0LndpbmRvd1t0LnN0cnN0YXJ0KzFdKTtlbHNlIG49d3QodCwwLHQud2luZG93W3Quc3Ryc3RhcnRdKSx0Lmxvb2thaGVhZC0tLHQuc3Ryc3RhcnQrKztpZihuJiYoZmUodCwhMSksMD09PXQuc3RybS5hdmFpbF9vdXQpKXJldHVybiBpZX1yZXR1cm4gdC5pbnNlcnQ9dC5zdHJzdGFydDxxdC0xP3Quc3Ryc3RhcnQ6cXQtMSxlPT09enQ/KGZlKHQsITApLDA9PT10LnN0cm0uYXZhaWxfb3V0P29lOnNlKTp0Lmxhc3RfbGl0JiYoZmUodCwhMSksMD09PXQuc3RybS5hdmFpbF9vdXQpP2llOmFlfSxiZT0odCxlKT0+e2xldCByLG4saTtmb3IoOzspe2lmKHQubG9va2FoZWFkPFd0KXtpZih3ZSh0KSx0Lmxvb2thaGVhZDxXdCYmZT09PWJ0KXJldHVybiBpZTtpZigwPT09dC5sb29rYWhlYWQpYnJlYWt9aWYocj0wLHQubG9va2FoZWFkPj1xdCYmKHQuaW5zX2g9ZGUodCx0Lmluc19oLHQud2luZG93W3Quc3Ryc3RhcnQrcXQtMV0pLHI9dC5wcmV2W3Quc3Ryc3RhcnQmdC53X21hc2tdPXQuaGVhZFt0Lmluc19oXSx0LmhlYWRbdC5pbnNfaF09dC5zdHJzdGFydCksdC5wcmV2X2xlbmd0aD10Lm1hdGNoX2xlbmd0aCx0LnByZXZfbWF0Y2g9dC5tYXRjaF9zdGFydCx0Lm1hdGNoX2xlbmd0aD1xdC0xLDAhPT1yJiZ0LnByZXZfbGVuZ3RoPHQubWF4X2xhenlfbWF0Y2gmJnQuc3Ryc3RhcnQtcjw9dC53X3NpemUtV3QmJih0Lm1hdGNoX2xlbmd0aD12ZSh0LHIpLHQubWF0Y2hfbGVuZ3RoPD01JiYodC5zdHJhdGVneT09PVV0fHx0Lm1hdGNoX2xlbmd0aD09PXF0JiZ0LnN0cnN0YXJ0LXQubWF0Y2hfc3RhcnQ+NDA5NikmJih0Lm1hdGNoX2xlbmd0aD1xdC0xKSksdC5wcmV2X2xlbmd0aD49cXQmJnQubWF0Y2hfbGVuZ3RoPD10LnByZXZfbGVuZ3RoKXtpPXQuc3Ryc3RhcnQrdC5sb29rYWhlYWQtcXQsbj13dCh0LHQuc3Ryc3RhcnQtMS10LnByZXZfbWF0Y2gsdC5wcmV2X2xlbmd0aC1xdCksdC5sb29rYWhlYWQtPXQucHJldl9sZW5ndGgtMSx0LnByZXZfbGVuZ3RoLT0yO2RveysrdC5zdHJzdGFydDw9aSYmKHQuaW5zX2g9ZGUodCx0Lmluc19oLHQud2luZG93W3Quc3Ryc3RhcnQrcXQtMV0pLHI9dC5wcmV2W3Quc3Ryc3RhcnQmdC53X21hc2tdPXQuaGVhZFt0Lmluc19oXSx0LmhlYWRbdC5pbnNfaF09dC5zdHJzdGFydCl9d2hpbGUoMCE9LS10LnByZXZfbGVuZ3RoKTtpZih0Lm1hdGNoX2F2YWlsYWJsZT0wLHQubWF0Y2hfbGVuZ3RoPXF0LTEsdC5zdHJzdGFydCsrLG4mJihmZSh0LCExKSwwPT09dC5zdHJtLmF2YWlsX291dCkpcmV0dXJuIGllfWVsc2UgaWYodC5tYXRjaF9hdmFpbGFibGUpe2lmKG49d3QodCwwLHQud2luZG93W3Quc3Ryc3RhcnQtMV0pLG4mJmZlKHQsITEpLHQuc3Ryc3RhcnQrKyx0Lmxvb2thaGVhZC0tLDA9PT10LnN0cm0uYXZhaWxfb3V0KXJldHVybiBpZX1lbHNlIHQubWF0Y2hfYXZhaWxhYmxlPTEsdC5zdHJzdGFydCsrLHQubG9va2FoZWFkLS19cmV0dXJuIHQubWF0Y2hfYXZhaWxhYmxlJiYobj13dCh0LDAsdC53aW5kb3dbdC5zdHJzdGFydC0xXSksdC5tYXRjaF9hdmFpbGFibGU9MCksdC5pbnNlcnQ9dC5zdHJzdGFydDxxdC0xP3Quc3Ryc3RhcnQ6cXQtMSxlPT09enQ/KGZlKHQsITApLDA9PT10LnN0cm0uYXZhaWxfb3V0P29lOnNlKTp0Lmxhc3RfbGl0JiYoZmUodCwhMSksMD09PXQuc3RybS5hdmFpbF9vdXQpP2llOmFlfSx4ZT0odCxlKT0+e2xldCByLG4saSxhO2NvbnN0IG89dC53aW5kb3c7Zm9yKDs7KXtpZih0Lmxvb2thaGVhZDw9R3Qpe2lmKHdlKHQpLHQubG9va2FoZWFkPD1HdCYmZT09PWJ0KXJldHVybiBpZTtpZigwPT09dC5sb29rYWhlYWQpYnJlYWt9aWYodC5tYXRjaF9sZW5ndGg9MCx0Lmxvb2thaGVhZD49cXQmJnQuc3Ryc3RhcnQ+MCYmKGk9dC5zdHJzdGFydC0xLG49b1tpXSxuPT09b1srK2ldJiZuPT09b1srK2ldJiZuPT09b1srK2ldKSl7YT10LnN0cnN0YXJ0K0d0O2Rve313aGlsZShuPT09b1srK2ldJiZuPT09b1srK2ldJiZuPT09b1srK2ldJiZuPT09b1srK2ldJiZuPT09b1srK2ldJiZuPT09b1srK2ldJiZuPT09b1srK2ldJiZuPT09b1srK2ldJiZpPGEpO3QubWF0Y2hfbGVuZ3RoPUd0LShhLWkpLHQubWF0Y2hfbGVuZ3RoPnQubG9va2FoZWFkJiYodC5tYXRjaF9sZW5ndGg9dC5sb29rYWhlYWQpfWlmKHQubWF0Y2hfbGVuZ3RoPj1xdD8ocj13dCh0LDEsdC5tYXRjaF9sZW5ndGgtcXQpLHQubG9va2FoZWFkLT10Lm1hdGNoX2xlbmd0aCx0LnN0cnN0YXJ0Kz10Lm1hdGNoX2xlbmd0aCx0Lm1hdGNoX2xlbmd0aD0wKToocj13dCh0LDAsdC53aW5kb3dbdC5zdHJzdGFydF0pLHQubG9va2FoZWFkLS0sdC5zdHJzdGFydCsrKSxyJiYoZmUodCwhMSksMD09PXQuc3RybS5hdmFpbF9vdXQpKXJldHVybiBpZX1yZXR1cm4gdC5pbnNlcnQ9MCxlPT09enQ/KGZlKHQsITApLDA9PT10LnN0cm0uYXZhaWxfb3V0P29lOnNlKTp0Lmxhc3RfbGl0JiYoZmUodCwhMSksMD09PXQuc3RybS5hdmFpbF9vdXQpP2llOmFlfSxrZT0odCxlKT0+e2xldCByO2Zvcig7Oyl7aWYoMD09PXQubG9va2FoZWFkJiYod2UodCksMD09PXQubG9va2FoZWFkKSl7aWYoZT09PWJ0KXJldHVybiBpZTticmVha31pZih0Lm1hdGNoX2xlbmd0aD0wLHI9d3QodCwwLHQud2luZG93W3Quc3Ryc3RhcnRdKSx0Lmxvb2thaGVhZC0tLHQuc3Ryc3RhcnQrKyxyJiYoZmUodCwhMSksMD09PXQuc3RybS5hdmFpbF9vdXQpKXJldHVybiBpZX1yZXR1cm4gdC5pbnNlcnQ9MCxlPT09enQ/KGZlKHQsITApLDA9PT10LnN0cm0uYXZhaWxfb3V0P29lOnNlKTp0Lmxhc3RfbGl0JiYoZmUodCwhMSksMD09PXQuc3RybS5hdmFpbF9vdXQpP2llOmFlfTtmdW5jdGlvbiB6ZSh0LGUscixuLGkpe3RoaXMuZ29vZF9sZW5ndGg9dCx0aGlzLm1heF9sYXp5PWUsdGhpcy5uaWNlX2xlbmd0aD1yLHRoaXMubWF4X2NoYWluPW4sdGhpcy5mdW5jPWl9Y29uc3QgQWU9W25ldyB6ZSgwLDAsMCwwLCgodCxlKT0+e2xldCByPTY1NTM1O2ZvcihyPnQucGVuZGluZ19idWZfc2l6ZS01JiYocj10LnBlbmRpbmdfYnVmX3NpemUtNSk7Oyl7aWYodC5sb29rYWhlYWQ8PTEpe2lmKHdlKHQpLDA9PT10Lmxvb2thaGVhZCYmZT09PWJ0KXJldHVybiBpZTtpZigwPT09dC5sb29rYWhlYWQpYnJlYWt9dC5zdHJzdGFydCs9dC5sb29rYWhlYWQsdC5sb29rYWhlYWQ9MDtjb25zdCBuPXQuYmxvY2tfc3RhcnQrcjtpZigoMD09PXQuc3Ryc3RhcnR8fHQuc3Ryc3RhcnQ+PW4pJiYodC5sb29rYWhlYWQ9dC5zdHJzdGFydC1uLHQuc3Ryc3RhcnQ9bixmZSh0LCExKSwwPT09dC5zdHJtLmF2YWlsX291dCkpcmV0dXJuIGllO2lmKHQuc3Ryc3RhcnQtdC5ibG9ja19zdGFydD49dC53X3NpemUtV3QmJihmZSh0LCExKSwwPT09dC5zdHJtLmF2YWlsX291dCkpcmV0dXJuIGllfXJldHVybiB0Lmluc2VydD0wLGU9PT16dD8oZmUodCwhMCksMD09PXQuc3RybS5hdmFpbF9vdXQ/b2U6c2UpOih0LnN0cnN0YXJ0PnQuYmxvY2tfc3RhcnQmJihmZSh0LCExKSx0LnN0cm0uYXZhaWxfb3V0KSxpZSl9KSksbmV3IHplKDQsNCw4LDQsbWUpLG5ldyB6ZSg0LDUsMTYsOCxtZSksbmV3IHplKDQsNiwzMiwzMixtZSksbmV3IHplKDQsNCwxNiwxNixiZSksbmV3IHplKDgsMTYsMzIsMzIsYmUpLG5ldyB6ZSg4LDE2LDEyOCwxMjgsYmUpLG5ldyB6ZSg4LDMyLDEyOCwyNTYsYmUpLG5ldyB6ZSgzMiwxMjgsMjU4LDEwMjQsYmUpLG5ldyB6ZSgzMiwyNTgsMjU4LDQwOTYsYmUpXSxFZT10PT57dC53aW5kb3dfc2l6ZT0yKnQud19zaXplLHVlKHQuaGVhZCksdC5tYXhfbGF6eV9tYXRjaD1BZVt0LmxldmVsXS5tYXhfbGF6eSx0Lmdvb2RfbWF0Y2g9QWVbdC5sZXZlbF0uZ29vZF9sZW5ndGgsdC5uaWNlX21hdGNoPUFlW3QubGV2ZWxdLm5pY2VfbGVuZ3RoLHQubWF4X2NoYWluX2xlbmd0aD1BZVt0LmxldmVsXS5tYXhfY2hhaW4sdC5zdHJzdGFydD0wLHQuYmxvY2tfc3RhcnQ9MCx0Lmxvb2thaGVhZD0wLHQuaW5zZXJ0PTAsdC5tYXRjaF9sZW5ndGg9dC5wcmV2X2xlbmd0aD1xdC0xLHQubWF0Y2hfYXZhaWxhYmxlPTAsdC5pbnNfaD0wfTtmdW5jdGlvbiBTZSgpe3RoaXMuc3RybT1udWxsLHRoaXMuc3RhdHVzPTAsdGhpcy5wZW5kaW5nX2J1Zj1udWxsLHRoaXMucGVuZGluZ19idWZfc2l6ZT0wLHRoaXMucGVuZGluZ19vdXQ9MCx0aGlzLnBlbmRpbmc9MCx0aGlzLndyYXA9MCx0aGlzLmd6aGVhZD1udWxsLHRoaXMuZ3ppbmRleD0wLHRoaXMubWV0aG9kPVp0LHRoaXMubGFzdF9mbHVzaD0tMSx0aGlzLndfc2l6ZT0wLHRoaXMud19iaXRzPTAsdGhpcy53X21hc2s9MCx0aGlzLndpbmRvdz1udWxsLHRoaXMud2luZG93X3NpemU9MCx0aGlzLnByZXY9bnVsbCx0aGlzLmhlYWQ9bnVsbCx0aGlzLmluc19oPTAsdGhpcy5oYXNoX3NpemU9MCx0aGlzLmhhc2hfYml0cz0wLHRoaXMuaGFzaF9tYXNrPTAsdGhpcy5oYXNoX3NoaWZ0PTAsdGhpcy5ibG9ja19zdGFydD0wLHRoaXMubWF0Y2hfbGVuZ3RoPTAsdGhpcy5wcmV2X21hdGNoPTAsdGhpcy5tYXRjaF9hdmFpbGFibGU9MCx0aGlzLnN0cnN0YXJ0PTAsdGhpcy5tYXRjaF9zdGFydD0wLHRoaXMubG9va2FoZWFkPTAsdGhpcy5wcmV2X2xlbmd0aD0wLHRoaXMubWF4X2NoYWluX2xlbmd0aD0wLHRoaXMubWF4X2xhenlfbWF0Y2g9MCx0aGlzLmxldmVsPTAsdGhpcy5zdHJhdGVneT0wLHRoaXMuZ29vZF9tYXRjaD0wLHRoaXMubmljZV9tYXRjaD0wLHRoaXMuZHluX2x0cmVlPW5ldyBVaW50MTZBcnJheSgyKkt0KSx0aGlzLmR5bl9kdHJlZT1uZXcgVWludDE2QXJyYXkoMiooMipQdCsxKSksdGhpcy5ibF90cmVlPW5ldyBVaW50MTZBcnJheSgyKigyKmp0KzEpKSx1ZSh0aGlzLmR5bl9sdHJlZSksdWUodGhpcy5keW5fZHRyZWUpLHVlKHRoaXMuYmxfdHJlZSksdGhpcy5sX2Rlc2M9bnVsbCx0aGlzLmRfZGVzYz1udWxsLHRoaXMuYmxfZGVzYz1udWxsLHRoaXMuYmxfY291bnQ9bmV3IFVpbnQxNkFycmF5KFh0KzEpLHRoaXMuaGVhcD1uZXcgVWludDE2QXJyYXkoMiokdCsxKSx1ZSh0aGlzLmhlYXApLHRoaXMuaGVhcF9sZW49MCx0aGlzLmhlYXBfbWF4PTAsdGhpcy5kZXB0aD1uZXcgVWludDE2QXJyYXkoMiokdCsxKSx1ZSh0aGlzLmRlcHRoKSx0aGlzLmxfYnVmPTAsdGhpcy5saXRfYnVmc2l6ZT0wLHRoaXMubGFzdF9saXQ9MCx0aGlzLmRfYnVmPTAsdGhpcy5vcHRfbGVuPTAsdGhpcy5zdGF0aWNfbGVuPTAsdGhpcy5tYXRjaGVzPTAsdGhpcy5pbnNlcnQ9MCx0aGlzLmJpX2J1Zj0wLHRoaXMuYmlfdmFsaWQ9MH1jb25zdCBCZT10PT57aWYoIXR8fCF0LnN0YXRlKXJldHVybiBsZSh0LEJ0KTt0LnRvdGFsX2luPXQudG90YWxfb3V0PTAsdC5kYXRhX3R5cGU9SHQ7Y29uc3QgZT10LnN0YXRlO3JldHVybiBlLnBlbmRpbmc9MCxlLnBlbmRpbmdfb3V0PTAsZS53cmFwPDAmJihlLndyYXA9LWUud3JhcCksZS5zdGF0dXM9ZS53cmFwP1Z0OnJlLHQuYWRsZXI9Mj09PWUud3JhcD8wOjEsZS5sYXN0X2ZsdXNoPWJ0LGd0KGUpLEV0fSxSZT10PT57Y29uc3QgZT1CZSh0KTtyZXR1cm4gZT09PUV0JiZFZSh0LnN0YXRlKSxlfSxEZT0odCxlLHIsbixpLGEpPT57aWYoIXQpcmV0dXJuIEJ0O2xldCBvPTE7aWYoZT09PUx0JiYoZT02KSxuPDA/KG89MCxuPS1uKTpuPjE1JiYobz0yLG4tPTE2KSxpPDF8fGk+TXR8fHIhPT1adHx8bjw4fHxuPjE1fHxlPDB8fGU+OXx8YTwwfHxhPlR0KXJldHVybiBsZSh0LEJ0KTs4PT09biYmKG49OSk7Y29uc3Qgcz1uZXcgU2U7cmV0dXJuIHQuc3RhdGU9cyxzLnN0cm09dCxzLndyYXA9byxzLmd6aGVhZD1udWxsLHMud19iaXRzPW4scy53X3NpemU9MTw8cy53X2JpdHMscy53X21hc2s9cy53X3NpemUtMSxzLmhhc2hfYml0cz1pKzcscy5oYXNoX3NpemU9MTw8cy5oYXNoX2JpdHMscy5oYXNoX21hc2s9cy5oYXNoX3NpemUtMSxzLmhhc2hfc2hpZnQ9fn4oKHMuaGFzaF9iaXRzK3F0LTEpL3F0KSxzLndpbmRvdz1uZXcgVWludDhBcnJheSgyKnMud19zaXplKSxzLmhlYWQ9bmV3IFVpbnQxNkFycmF5KHMuaGFzaF9zaXplKSxzLnByZXY9bmV3IFVpbnQxNkFycmF5KHMud19zaXplKSxzLmxpdF9idWZzaXplPTE8PGkrNixzLnBlbmRpbmdfYnVmX3NpemU9NCpzLmxpdF9idWZzaXplLHMucGVuZGluZ19idWY9bmV3IFVpbnQ4QXJyYXkocy5wZW5kaW5nX2J1Zl9zaXplKSxzLmRfYnVmPTEqcy5saXRfYnVmc2l6ZSxzLmxfYnVmPTMqcy5saXRfYnVmc2l6ZSxzLmxldmVsPWUscy5zdHJhdGVneT1hLHMubWV0aG9kPXIsUmUodCl9O3ZhciBMZT17ZGVmbGF0ZUluaXQ6KHQsZSk9PkRlKHQsZSxadCxOdCxJdCxGdCksZGVmbGF0ZUluaXQyOkRlLGRlZmxhdGVSZXNldDpSZSxkZWZsYXRlUmVzZXRLZWVwOkJlLGRlZmxhdGVTZXRIZWFkZXI6KHQsZSk9PnQmJnQuc3RhdGU/MiE9PXQuc3RhdGUud3JhcD9CdDoodC5zdGF0ZS5nemhlYWQ9ZSxFdCk6QnQsZGVmbGF0ZToodCxlKT0+e2xldCByLG47aWYoIXR8fCF0LnN0YXRlfHxlPkF0fHxlPDApcmV0dXJuIHQ/bGUodCxCdCk6QnQ7Y29uc3QgaT10LnN0YXRlO2lmKCF0Lm91dHB1dHx8IXQuaW5wdXQmJjAhPT10LmF2YWlsX2lufHxpLnN0YXR1cz09PW5lJiZlIT09enQpcmV0dXJuIGxlKHQsMD09PXQuYXZhaWxfb3V0P0R0OkJ0KTtpLnN0cm09dDtjb25zdCBhPWkubGFzdF9mbHVzaDtpZihpLmxhc3RfZmx1c2g9ZSxpLnN0YXR1cz09PVZ0KWlmKDI9PT1pLndyYXApdC5hZGxlcj0wLHBlKGksMzEpLHBlKGksMTM5KSxwZShpLDgpLGkuZ3poZWFkPyhwZShpLChpLmd6aGVhZC50ZXh0PzE6MCkrKGkuZ3poZWFkLmhjcmM/MjowKSsoaS5nemhlYWQuZXh0cmE/NDowKSsoaS5nemhlYWQubmFtZT84OjApKyhpLmd6aGVhZC5jb21tZW50PzE2OjApKSxwZShpLDI1NSZpLmd6aGVhZC50aW1lKSxwZShpLGkuZ3poZWFkLnRpbWU+PjgmMjU1KSxwZShpLGkuZ3poZWFkLnRpbWU+PjE2JjI1NSkscGUoaSxpLmd6aGVhZC50aW1lPj4yNCYyNTUpLHBlKGksOT09PWkubGV2ZWw/MjppLnN0cmF0ZWd5Pj1PdHx8aS5sZXZlbDwyPzQ6MCkscGUoaSwyNTUmaS5nemhlYWQub3MpLGkuZ3poZWFkLmV4dHJhJiZpLmd6aGVhZC5leHRyYS5sZW5ndGgmJihwZShpLDI1NSZpLmd6aGVhZC5leHRyYS5sZW5ndGgpLHBlKGksaS5nemhlYWQuZXh0cmEubGVuZ3RoPj44JjI1NSkpLGkuZ3poZWFkLmhjcmMmJih0LmFkbGVyPV90KHQuYWRsZXIsaS5wZW5kaW5nX2J1ZixpLnBlbmRpbmcsMCkpLGkuZ3ppbmRleD0wLGkuc3RhdHVzPUp0KToocGUoaSwwKSxwZShpLDApLHBlKGksMCkscGUoaSwwKSxwZShpLDApLHBlKGksOT09PWkubGV2ZWw/MjppLnN0cmF0ZWd5Pj1PdHx8aS5sZXZlbDwyPzQ6MCkscGUoaSxoZSksaS5zdGF0dXM9cmUpO2Vsc2V7bGV0IGU9WnQrKGkud19iaXRzLTg8PDQpPDw4LHI9LTE7cj1pLnN0cmF0ZWd5Pj1PdHx8aS5sZXZlbDwyPzA6aS5sZXZlbDw2PzE6Nj09PWkubGV2ZWw/MjozLGV8PXI8PDYsMCE9PWkuc3Ryc3RhcnQmJihlfD1ZdCksZSs9MzEtZSUzMSxpLnN0YXR1cz1yZSxnZShpLGUpLDAhPT1pLnN0cnN0YXJ0JiYoZ2UoaSx0LmFkbGVyPj4+MTYpLGdlKGksNjU1MzUmdC5hZGxlcikpLHQuYWRsZXI9MX1pZihpLnN0YXR1cz09PUp0KWlmKGkuZ3poZWFkLmV4dHJhKXtmb3Iocj1pLnBlbmRpbmc7aS5nemluZGV4PCg2NTUzNSZpLmd6aGVhZC5leHRyYS5sZW5ndGgpJiYoaS5wZW5kaW5nIT09aS5wZW5kaW5nX2J1Zl9zaXplfHwoaS5nemhlYWQuaGNyYyYmaS5wZW5kaW5nPnImJih0LmFkbGVyPV90KHQuYWRsZXIsaS5wZW5kaW5nX2J1ZixpLnBlbmRpbmctcixyKSksX2UodCkscj1pLnBlbmRpbmcsaS5wZW5kaW5nIT09aS5wZW5kaW5nX2J1Zl9zaXplKSk7KXBlKGksMjU1JmkuZ3poZWFkLmV4dHJhW2kuZ3ppbmRleF0pLGkuZ3ppbmRleCsrO2kuZ3poZWFkLmhjcmMmJmkucGVuZGluZz5yJiYodC5hZGxlcj1fdCh0LmFkbGVyLGkucGVuZGluZ19idWYsaS5wZW5kaW5nLXIscikpLGkuZ3ppbmRleD09PWkuZ3poZWFkLmV4dHJhLmxlbmd0aCYmKGkuZ3ppbmRleD0wLGkuc3RhdHVzPVF0KX1lbHNlIGkuc3RhdHVzPVF0O2lmKGkuc3RhdHVzPT09UXQpaWYoaS5nemhlYWQubmFtZSl7cj1pLnBlbmRpbmc7ZG97aWYoaS5wZW5kaW5nPT09aS5wZW5kaW5nX2J1Zl9zaXplJiYoaS5nemhlYWQuaGNyYyYmaS5wZW5kaW5nPnImJih0LmFkbGVyPV90KHQuYWRsZXIsaS5wZW5kaW5nX2J1ZixpLnBlbmRpbmctcixyKSksX2UodCkscj1pLnBlbmRpbmcsaS5wZW5kaW5nPT09aS5wZW5kaW5nX2J1Zl9zaXplKSl7bj0xO2JyZWFrfW49aS5nemluZGV4PGkuZ3poZWFkLm5hbWUubGVuZ3RoPzI1NSZpLmd6aGVhZC5uYW1lLmNoYXJDb2RlQXQoaS5nemluZGV4KyspOjAscGUoaSxuKX13aGlsZSgwIT09bik7aS5nemhlYWQuaGNyYyYmaS5wZW5kaW5nPnImJih0LmFkbGVyPV90KHQuYWRsZXIsaS5wZW5kaW5nX2J1ZixpLnBlbmRpbmctcixyKSksMD09PW4mJihpLmd6aW5kZXg9MCxpLnN0YXR1cz10ZSl9ZWxzZSBpLnN0YXR1cz10ZTtpZihpLnN0YXR1cz09PXRlKWlmKGkuZ3poZWFkLmNvbW1lbnQpe3I9aS5wZW5kaW5nO2Rve2lmKGkucGVuZGluZz09PWkucGVuZGluZ19idWZfc2l6ZSYmKGkuZ3poZWFkLmhjcmMmJmkucGVuZGluZz5yJiYodC5hZGxlcj1fdCh0LmFkbGVyLGkucGVuZGluZ19idWYsaS5wZW5kaW5nLXIscikpLF9lKHQpLHI9aS5wZW5kaW5nLGkucGVuZGluZz09PWkucGVuZGluZ19idWZfc2l6ZSkpe249MTticmVha31uPWkuZ3ppbmRleDxpLmd6aGVhZC5jb21tZW50Lmxlbmd0aD8yNTUmaS5nemhlYWQuY29tbWVudC5jaGFyQ29kZUF0KGkuZ3ppbmRleCsrKTowLHBlKGksbil9d2hpbGUoMCE9PW4pO2kuZ3poZWFkLmhjcmMmJmkucGVuZGluZz5yJiYodC5hZGxlcj1fdCh0LmFkbGVyLGkucGVuZGluZ19idWYsaS5wZW5kaW5nLXIscikpLDA9PT1uJiYoaS5zdGF0dXM9ZWUpfWVsc2UgaS5zdGF0dXM9ZWU7aWYoaS5zdGF0dXM9PT1lZSYmKGkuZ3poZWFkLmhjcmM/KGkucGVuZGluZysyPmkucGVuZGluZ19idWZfc2l6ZSYmX2UodCksaS5wZW5kaW5nKzI8PWkucGVuZGluZ19idWZfc2l6ZSYmKHBlKGksMjU1JnQuYWRsZXIpLHBlKGksdC5hZGxlcj4+OCYyNTUpLHQuYWRsZXI9MCxpLnN0YXR1cz1yZSkpOmkuc3RhdHVzPXJlKSwwIT09aS5wZW5kaW5nKXtpZihfZSh0KSwwPT09dC5hdmFpbF9vdXQpcmV0dXJuIGkubGFzdF9mbHVzaD0tMSxFdH1lbHNlIGlmKDA9PT10LmF2YWlsX2luJiZjZShlKTw9Y2UoYSkmJmUhPT16dClyZXR1cm4gbGUodCxEdCk7aWYoaS5zdGF0dXM9PT1uZSYmMCE9PXQuYXZhaWxfaW4pcmV0dXJuIGxlKHQsRHQpO2lmKDAhPT10LmF2YWlsX2lufHwwIT09aS5sb29rYWhlYWR8fGUhPT1idCYmaS5zdGF0dXMhPT1uZSl7bGV0IHI9aS5zdHJhdGVneT09PU90P2tlKGksZSk6aS5zdHJhdGVneT09PUN0P3hlKGksZSk6QWVbaS5sZXZlbF0uZnVuYyhpLGUpO2lmKHIhPT1vZSYmciE9PXNlfHwoaS5zdGF0dXM9bmUpLHI9PT1pZXx8cj09PW9lKXJldHVybiAwPT09dC5hdmFpbF9vdXQmJihpLmxhc3RfZmx1c2g9LTEpLEV0O2lmKHI9PT1hZSYmKGU9PT14dD9tdChpKTplIT09QXQmJih5dChpLDAsMCwhMSksZT09PWt0JiYodWUoaS5oZWFkKSwwPT09aS5sb29rYWhlYWQmJihpLnN0cnN0YXJ0PTAsaS5ibG9ja19zdGFydD0wLGkuaW5zZXJ0PTApKSksX2UodCksMD09PXQuYXZhaWxfb3V0KSlyZXR1cm4gaS5sYXN0X2ZsdXNoPS0xLEV0fXJldHVybiBlIT09enQ/RXQ6aS53cmFwPD0wP1N0OigyPT09aS53cmFwPyhwZShpLDI1NSZ0LmFkbGVyKSxwZShpLHQuYWRsZXI+PjgmMjU1KSxwZShpLHQuYWRsZXI+PjE2JjI1NSkscGUoaSx0LmFkbGVyPj4yNCYyNTUpLHBlKGksMjU1JnQudG90YWxfaW4pLHBlKGksdC50b3RhbF9pbj4+OCYyNTUpLHBlKGksdC50b3RhbF9pbj4+MTYmMjU1KSxwZShpLHQudG90YWxfaW4+PjI0JjI1NSkpOihnZShpLHQuYWRsZXI+Pj4xNiksZ2UoaSw2NTUzNSZ0LmFkbGVyKSksX2UodCksaS53cmFwPjAmJihpLndyYXA9LWkud3JhcCksMCE9PWkucGVuZGluZz9FdDpTdCl9LGRlZmxhdGVFbmQ6dD0+e2lmKCF0fHwhdC5zdGF0ZSlyZXR1cm4gQnQ7Y29uc3QgZT10LnN0YXRlLnN0YXR1cztyZXR1cm4gZSE9PVZ0JiZlIT09SnQmJmUhPT1RdCYmZSE9PXRlJiZlIT09ZWUmJmUhPT1yZSYmZSE9PW5lP2xlKHQsQnQpOih0LnN0YXRlPW51bGwsZT09PXJlP2xlKHQsUnQpOkV0KX0sZGVmbGF0ZVNldERpY3Rpb25hcnk6KHQsZSk9PntsZXQgcj1lLmxlbmd0aDtpZighdHx8IXQuc3RhdGUpcmV0dXJuIEJ0O2NvbnN0IG49dC5zdGF0ZSxpPW4ud3JhcDtpZigyPT09aXx8MT09PWkmJm4uc3RhdHVzIT09VnR8fG4ubG9va2FoZWFkKXJldHVybiBCdDtpZigxPT09aSYmKHQuYWRsZXI9dXQodC5hZGxlcixlLHIsMCkpLG4ud3JhcD0wLHI+PW4ud19zaXplKXswPT09aSYmKHVlKG4uaGVhZCksbi5zdHJzdGFydD0wLG4uYmxvY2tfc3RhcnQ9MCxuLmluc2VydD0wKTtsZXQgdD1uZXcgVWludDhBcnJheShuLndfc2l6ZSk7dC5zZXQoZS5zdWJhcnJheShyLW4ud19zaXplLHIpLDApLGU9dCxyPW4ud19zaXplfWNvbnN0IGE9dC5hdmFpbF9pbixvPXQubmV4dF9pbixzPXQuaW5wdXQ7Zm9yKHQuYXZhaWxfaW49cix0Lm5leHRfaW49MCx0LmlucHV0PWUsd2Uobik7bi5sb29rYWhlYWQ+PXF0Oyl7bGV0IHQ9bi5zdHJzdGFydCxlPW4ubG9va2FoZWFkLShxdC0xKTtkb3tuLmluc19oPWRlKG4sbi5pbnNfaCxuLndpbmRvd1t0K3F0LTFdKSxuLnByZXZbdCZuLndfbWFza109bi5oZWFkW24uaW5zX2hdLG4uaGVhZFtuLmluc19oXT10LHQrK313aGlsZSgtLWUpO24uc3Ryc3RhcnQ9dCxuLmxvb2thaGVhZD1xdC0xLHdlKG4pfXJldHVybiBuLnN0cnN0YXJ0Kz1uLmxvb2thaGVhZCxuLmJsb2NrX3N0YXJ0PW4uc3Ryc3RhcnQsbi5pbnNlcnQ9bi5sb29rYWhlYWQsbi5sb29rYWhlYWQ9MCxuLm1hdGNoX2xlbmd0aD1uLnByZXZfbGVuZ3RoPXF0LTEsbi5tYXRjaF9hdmFpbGFibGU9MCx0Lm5leHRfaW49byx0LmlucHV0PXMsdC5hdmFpbF9pbj1hLG4ud3JhcD1pLEV0fSxkZWZsYXRlSW5mbzoicGFrbyBkZWZsYXRlIChmcm9tIE5vZGVjYSBwcm9qZWN0KSJ9O2NvbnN0IFVlPSh0LGUpPT5PYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwodCxlKTt2YXIgT2U9ZnVuY3Rpb24odCl7Y29uc3QgZT1BcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsMSk7Zm9yKDtlLmxlbmd0aDspe2NvbnN0IHI9ZS5zaGlmdCgpO2lmKHIpe2lmKCJvYmplY3QiIT10eXBlb2Ygcil0aHJvdyBuZXcgVHlwZUVycm9yKHIrIm11c3QgYmUgbm9uLW9iamVjdCIpO2Zvcihjb25zdCBlIGluIHIpVWUocixlKSYmKHRbZV09cltlXSl9fXJldHVybiB0fSxDZT17YXNzaWduOk9lLGZsYXR0ZW5DaHVua3M6dD0+e2xldCBlPTA7Zm9yKGxldCByPTAsbj10Lmxlbmd0aDtyPG47cisrKWUrPXRbcl0ubGVuZ3RoO2NvbnN0IHI9bmV3IFVpbnQ4QXJyYXkoZSk7Zm9yKGxldCBlPTAsbj0wLGk9dC5sZW5ndGg7ZTxpO2UrKyl7bGV0IGk9dFtlXTtyLnNldChpLG4pLG4rPWkubGVuZ3RofXJldHVybiByfX07bGV0IFRlPSEwO3RyeXtTdHJpbmcuZnJvbUNoYXJDb2RlLmFwcGx5KG51bGwsbmV3IFVpbnQ4QXJyYXkoMSkpfWNhdGNoKHQpe1RlPSExfWNvbnN0IEZlPW5ldyBVaW50OEFycmF5KDI1Nik7Zm9yKGxldCB0PTA7dDwyNTY7dCsrKUZlW3RdPXQ+PTI1Mj82OnQ+PTI0OD81OnQ+PTI0MD80OnQ+PTIyND8zOnQ+PTE5Mj8yOjE7RmVbMjU0XT1GZVsyNTRdPTE7Y29uc3QgSGU9KHQsZSk9PntpZihlPDY1NTM0JiZ0LnN1YmFycmF5JiZUZSlyZXR1cm4gU3RyaW5nLmZyb21DaGFyQ29kZS5hcHBseShudWxsLHQubGVuZ3RoPT09ZT90OnQuc3ViYXJyYXkoMCxlKSk7bGV0IHI9IiI7Zm9yKGxldCBuPTA7bjxlO24rKylyKz1TdHJpbmcuZnJvbUNoYXJDb2RlKHRbbl0pO3JldHVybiByfTt2YXIgWmU9e3N0cmluZzJidWY6dD0+e2lmKCJmdW5jdGlvbiI9PXR5cGVvZiBUZXh0RW5jb2RlciYmVGV4dEVuY29kZXIucHJvdG90eXBlLmVuY29kZSlyZXR1cm4obmV3IFRleHRFbmNvZGVyKS5lbmNvZGUodCk7bGV0IGUscixuLGksYSxvPXQubGVuZ3RoLHM9MDtmb3IoaT0wO2k8bztpKyspcj10LmNoYXJDb2RlQXQoaSksNTUyOTY9PSg2NDUxMiZyKSYmaSsxPG8mJihuPXQuY2hhckNvZGVBdChpKzEpLDU2MzIwPT0oNjQ1MTImbikmJihyPTY1NTM2KyhyLTU1Mjk2PDwxMCkrKG4tNTYzMjApLGkrKykpLHMrPXI8MTI4PzE6cjwyMDQ4PzI6cjw2NTUzNj8zOjQ7Zm9yKGU9bmV3IFVpbnQ4QXJyYXkocyksYT0wLGk9MDthPHM7aSsrKXI9dC5jaGFyQ29kZUF0KGkpLDU1Mjk2PT0oNjQ1MTImcikmJmkrMTxvJiYobj10LmNoYXJDb2RlQXQoaSsxKSw1NjMyMD09KDY0NTEyJm4pJiYocj02NTUzNisoci01NTI5Njw8MTApKyhuLTU2MzIwKSxpKyspKSxyPDEyOD9lW2ErK109cjpyPDIwNDg/KGVbYSsrXT0xOTJ8cj4+PjYsZVthKytdPTEyOHw2MyZyKTpyPDY1NTM2PyhlW2ErK109MjI0fHI+Pj4xMixlW2ErK109MTI4fHI+Pj42JjYzLGVbYSsrXT0xMjh8NjMmcik6KGVbYSsrXT0yNDB8cj4+PjE4LGVbYSsrXT0xMjh8cj4+PjEyJjYzLGVbYSsrXT0xMjh8cj4+PjYmNjMsZVthKytdPTEyOHw2MyZyKTtyZXR1cm4gZX0sYnVmMnN0cmluZzoodCxlKT0+e2NvbnN0IHI9ZXx8dC5sZW5ndGg7aWYoImZ1bmN0aW9uIj09dHlwZW9mIFRleHREZWNvZGVyJiZUZXh0RGVjb2Rlci5wcm90b3R5cGUuZGVjb2RlKXJldHVybihuZXcgVGV4dERlY29kZXIpLmRlY29kZSh0LnN1YmFycmF5KDAsZSkpO2xldCBuLGk7Y29uc3QgYT1uZXcgQXJyYXkoMipyKTtmb3IoaT0wLG49MDtuPHI7KXtsZXQgZT10W24rK107aWYoZTwxMjgpe2FbaSsrXT1lO2NvbnRpbnVlfWxldCBvPUZlW2VdO2lmKG8+NClhW2krK109NjU1MzMsbis9by0xO2Vsc2V7Zm9yKGUmPTI9PT1vPzMxOjM9PT1vPzE1Ojc7bz4xJiZuPHI7KWU9ZTw8Nnw2MyZ0W24rK10sby0tO28+MT9hW2krK109NjU1MzM6ZTw2NTUzNj9hW2krK109ZTooZS09NjU1MzYsYVtpKytdPTU1Mjk2fGU+PjEwJjEwMjMsYVtpKytdPTU2MzIwfDEwMjMmZSl9fXJldHVybiBIZShhLGkpfSx1dGY4Ym9yZGVyOih0LGUpPT57KGU9ZXx8dC5sZW5ndGgpPnQubGVuZ3RoJiYoZT10Lmxlbmd0aCk7bGV0IHI9ZS0xO2Zvcig7cj49MCYmMTI4PT0oMTkyJnRbcl0pOylyLS07cmV0dXJuIHI8MHx8MD09PXI/ZTpyK0ZlW3Rbcl1dPmU/cjplfX07ZnVuY3Rpb24gTWUoKXt0aGlzLmlucHV0PW51bGwsdGhpcy5uZXh0X2luPTAsdGhpcy5hdmFpbF9pbj0wLHRoaXMudG90YWxfaW49MCx0aGlzLm91dHB1dD1udWxsLHRoaXMubmV4dF9vdXQ9MCx0aGlzLmF2YWlsX291dD0wLHRoaXMudG90YWxfb3V0PTAsdGhpcy5tc2c9IiIsdGhpcy5zdGF0ZT1udWxsLHRoaXMuZGF0YV90eXBlPTIsdGhpcy5hZGxlcj0wfXZhciBOZT1NZTtjb25zdCBJZT1PYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLHtaX05PX0ZMVVNIOiRlLFpfU1lOQ19GTFVTSDpQZSxaX0ZVTExfRkxVU0g6amUsWl9GSU5JU0g6S2UsWl9PSzpYZSxaX1NUUkVBTV9FTkQ6cWUsWl9ERUZBVUxUX0NPTVBSRVNTSU9OOkdlLFpfREVGQVVMVF9TVFJBVEVHWTpXZSxaX0RFRkxBVEVEOlllfT1wdDtmdW5jdGlvbiBWZSh0KXt0aGlzLm9wdGlvbnM9Q2UuYXNzaWduKHtsZXZlbDpHZSxtZXRob2Q6WWUsY2h1bmtTaXplOjE2Mzg0LHdpbmRvd0JpdHM6MTUsbWVtTGV2ZWw6OCxzdHJhdGVneTpXZX0sdHx8e30pO2xldCBlPXRoaXMub3B0aW9ucztlLnJhdyYmZS53aW5kb3dCaXRzPjA/ZS53aW5kb3dCaXRzPS1lLndpbmRvd0JpdHM6ZS5nemlwJiZlLndpbmRvd0JpdHM+MCYmZS53aW5kb3dCaXRzPDE2JiYoZS53aW5kb3dCaXRzKz0xNiksdGhpcy5lcnI9MCx0aGlzLm1zZz0iIix0aGlzLmVuZGVkPSExLHRoaXMuY2h1bmtzPVtdLHRoaXMuc3RybT1uZXcgTmUsdGhpcy5zdHJtLmF2YWlsX291dD0wO2xldCByPUxlLmRlZmxhdGVJbml0Mih0aGlzLnN0cm0sZS5sZXZlbCxlLm1ldGhvZCxlLndpbmRvd0JpdHMsZS5tZW1MZXZlbCxlLnN0cmF0ZWd5KTtpZihyIT09WGUpdGhyb3cgbmV3IEVycm9yKGZ0W3JdKTtpZihlLmhlYWRlciYmTGUuZGVmbGF0ZVNldEhlYWRlcih0aGlzLnN0cm0sZS5oZWFkZXIpLGUuZGljdGlvbmFyeSl7bGV0IHQ7aWYodD0ic3RyaW5nIj09dHlwZW9mIGUuZGljdGlvbmFyeT9aZS5zdHJpbmcyYnVmKGUuZGljdGlvbmFyeSk6IltvYmplY3QgQXJyYXlCdWZmZXJdIj09PUllLmNhbGwoZS5kaWN0aW9uYXJ5KT9uZXcgVWludDhBcnJheShlLmRpY3Rpb25hcnkpOmUuZGljdGlvbmFyeSxyPUxlLmRlZmxhdGVTZXREaWN0aW9uYXJ5KHRoaXMuc3RybSx0KSxyIT09WGUpdGhyb3cgbmV3IEVycm9yKGZ0W3JdKTt0aGlzLl9kaWN0X3NldD0hMH19ZnVuY3Rpb24gSmUodCxlKXtjb25zdCByPW5ldyBWZShlKTtpZihyLnB1c2godCwhMCksci5lcnIpdGhyb3cgci5tc2d8fGZ0W3IuZXJyXTtyZXR1cm4gci5yZXN1bHR9ZnVuY3Rpb24gUWUodCxlKXtyZXR1cm4oZT1lfHx7fSkucmF3PSEwLEplKHQsZSl9ZnVuY3Rpb24gdHIodCxlKXtyZXR1cm4oZT1lfHx7fSkuZ3ppcD0hMCxKZSh0LGUpfVZlLnByb3RvdHlwZS5wdXNoPWZ1bmN0aW9uKHQsZSl7Y29uc3Qgcj10aGlzLnN0cm0sbj10aGlzLm9wdGlvbnMuY2h1bmtTaXplO2xldCBpLGE7aWYodGhpcy5lbmRlZClyZXR1cm4hMTtmb3IoYT1lPT09fn5lP2U6ITA9PT1lP0tlOiRlLCJzdHJpbmciPT10eXBlb2YgdD9yLmlucHV0PVplLnN0cmluZzJidWYodCk6IltvYmplY3QgQXJyYXlCdWZmZXJdIj09PUllLmNhbGwodCk/ci5pbnB1dD1uZXcgVWludDhBcnJheSh0KTpyLmlucHV0PXQsci5uZXh0X2luPTAsci5hdmFpbF9pbj1yLmlucHV0Lmxlbmd0aDs7KWlmKDA9PT1yLmF2YWlsX291dCYmKHIub3V0cHV0PW5ldyBVaW50OEFycmF5KG4pLHIubmV4dF9vdXQ9MCxyLmF2YWlsX291dD1uKSwoYT09PVBlfHxhPT09amUpJiZyLmF2YWlsX291dDw9Nil0aGlzLm9uRGF0YShyLm91dHB1dC5zdWJhcnJheSgwLHIubmV4dF9vdXQpKSxyLmF2YWlsX291dD0wO2Vsc2V7aWYoaT1MZS5kZWZsYXRlKHIsYSksaT09PXFlKXJldHVybiByLm5leHRfb3V0PjAmJnRoaXMub25EYXRhKHIub3V0cHV0LnN1YmFycmF5KDAsci5uZXh0X291dCkpLGk9TGUuZGVmbGF0ZUVuZCh0aGlzLnN0cm0pLHRoaXMub25FbmQoaSksdGhpcy5lbmRlZD0hMCxpPT09WGU7aWYoMCE9PXIuYXZhaWxfb3V0KXtpZihhPjAmJnIubmV4dF9vdXQ+MCl0aGlzLm9uRGF0YShyLm91dHB1dC5zdWJhcnJheSgwLHIubmV4dF9vdXQpKSxyLmF2YWlsX291dD0wO2Vsc2UgaWYoMD09PXIuYXZhaWxfaW4pYnJlYWt9ZWxzZSB0aGlzLm9uRGF0YShyLm91dHB1dCl9cmV0dXJuITB9LFZlLnByb3RvdHlwZS5vbkRhdGE9ZnVuY3Rpb24odCl7dGhpcy5jaHVua3MucHVzaCh0KX0sVmUucHJvdG90eXBlLm9uRW5kPWZ1bmN0aW9uKHQpe3Q9PT1YZSYmKHRoaXMucmVzdWx0PUNlLmZsYXR0ZW5DaHVua3ModGhpcy5jaHVua3MpKSx0aGlzLmNodW5rcz1bXSx0aGlzLmVycj10LHRoaXMubXNnPXRoaXMuc3RybS5tc2d9O3ZhciBlcj1WZSxycj1KZSxucj1RZSxpcj10cixhcj1wdCxvcj17RGVmbGF0ZTplcixkZWZsYXRlOnJyLGRlZmxhdGVSYXc6bnIsZ3ppcDppcixjb25zdGFudHM6YXJ9O3QuRGVmbGF0ZT1lcix0LmNvbnN0YW50cz1hcix0LmRlZmF1bHQ9b3IsdC5kZWZsYXRlPXJyLHQuZGVmbGF0ZVJhdz1ucix0Lmd6aXA9aXIsT2JqZWN0LmRlZmluZVByb3BlcnR5KHQsIl9fZXNNb2R1bGUiLHt2YWx1ZTohMH0pfSkoZS5leHBvcnRzKTt2YXIgcixuPXtleHBvcnRzOnt9fSxpPXtleHBvcnRzOnt9fTtpLmV4cG9ydHM9KHI9cnx8ZnVuY3Rpb24oZSxyKXt2YXIgbjtpZigidW5kZWZpbmVkIiE9dHlwZW9mIHdpbmRvdyYmd2luZG93LmNyeXB0byYmKG49d2luZG93LmNyeXB0byksInVuZGVmaW5lZCIhPXR5cGVvZiBzZWxmJiZzZWxmLmNyeXB0byYmKG49c2VsZi5jcnlwdG8pLCJ1bmRlZmluZWQiIT10eXBlb2YgZ2xvYmFsVGhpcyYmZ2xvYmFsVGhpcy5jcnlwdG8mJihuPWdsb2JhbFRoaXMuY3J5cHRvKSwhbiYmInVuZGVmaW5lZCIhPXR5cGVvZiB3aW5kb3cmJndpbmRvdy5tc0NyeXB0byYmKG49d2luZG93Lm1zQ3J5cHRvKSwhbiYmdm9pZCAwIT09dCYmdC5jcnlwdG8mJihuPXQuY3J5cHRvKSwhbil0cnl7bj1yZXF1aXJlKCJjcnlwdG8iKX1jYXRjaCh0KXt9dmFyIGk9ZnVuY3Rpb24oKXtpZihuKXtpZigiZnVuY3Rpb24iPT10eXBlb2Ygbi5nZXRSYW5kb21WYWx1ZXMpdHJ5e3JldHVybiBuLmdldFJhbmRvbVZhbHVlcyhuZXcgVWludDMyQXJyYXkoMSkpWzBdfWNhdGNoKHQpe31pZigiZnVuY3Rpb24iPT10eXBlb2Ygbi5yYW5kb21CeXRlcyl0cnl7cmV0dXJuIG4ucmFuZG9tQnl0ZXMoNCkucmVhZEludDMyTEUoKX1jYXRjaCh0KXt9fXRocm93IG5ldyBFcnJvcigiTmF0aXZlIGNyeXB0byBtb2R1bGUgY291bGQgbm90IGJlIHVzZWQgdG8gZ2V0IHNlY3VyZSByYW5kb20gbnVtYmVyLiIpfSxhPU9iamVjdC5jcmVhdGV8fGZ1bmN0aW9uKCl7ZnVuY3Rpb24gdCgpe31yZXR1cm4gZnVuY3Rpb24oZSl7dmFyIHI7cmV0dXJuIHQucHJvdG90eXBlPWUscj1uZXcgdCx0LnByb3RvdHlwZT1udWxsLHJ9fSgpLG89e30scz1vLmxpYj17fSxoPXMuQmFzZT17ZXh0ZW5kOmZ1bmN0aW9uKHQpe3ZhciBlPWEodGhpcyk7cmV0dXJuIHQmJmUubWl4SW4odCksZS5oYXNPd25Qcm9wZXJ0eSgiaW5pdCIpJiZ0aGlzLmluaXQhPT1lLmluaXR8fChlLmluaXQ9ZnVuY3Rpb24oKXtlLiRzdXBlci5pbml0LmFwcGx5KHRoaXMsYXJndW1lbnRzKX0pLGUuaW5pdC5wcm90b3R5cGU9ZSxlLiRzdXBlcj10aGlzLGV9LGNyZWF0ZTpmdW5jdGlvbigpe3ZhciB0PXRoaXMuZXh0ZW5kKCk7cmV0dXJuIHQuaW5pdC5hcHBseSh0LGFyZ3VtZW50cyksdH0saW5pdDpmdW5jdGlvbigpe30sbWl4SW46ZnVuY3Rpb24odCl7Zm9yKHZhciBlIGluIHQpdC5oYXNPd25Qcm9wZXJ0eShlKSYmKHRoaXNbZV09dFtlXSk7dC5oYXNPd25Qcm9wZXJ0eSgidG9TdHJpbmciKSYmKHRoaXMudG9TdHJpbmc9dC50b1N0cmluZyl9LGNsb25lOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuaW5pdC5wcm90b3R5cGUuZXh0ZW5kKHRoaXMpfX0sbD1zLldvcmRBcnJheT1oLmV4dGVuZCh7aW5pdDpmdW5jdGlvbih0LGUpe3Q9dGhpcy53b3Jkcz10fHxbXSx0aGlzLnNpZ0J5dGVzPWUhPXI/ZTo0KnQubGVuZ3RofSx0b1N0cmluZzpmdW5jdGlvbih0KXtyZXR1cm4odHx8dSkuc3RyaW5naWZ5KHRoaXMpfSxjb25jYXQ6ZnVuY3Rpb24odCl7dmFyIGU9dGhpcy53b3JkcyxyPXQud29yZHMsbj10aGlzLnNpZ0J5dGVzLGk9dC5zaWdCeXRlcztpZih0aGlzLmNsYW1wKCksbiU0KWZvcih2YXIgYT0wO2E8aTthKyspe3ZhciBvPXJbYT4+PjJdPj4+MjQtYSU0KjgmMjU1O2VbbithPj4+Ml18PW88PDI0LShuK2EpJTQqOH1lbHNlIGZvcih2YXIgcz0wO3M8aTtzKz00KWVbbitzPj4+Ml09cltzPj4+Ml07cmV0dXJuIHRoaXMuc2lnQnl0ZXMrPWksdGhpc30sY2xhbXA6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLndvcmRzLHI9dGhpcy5zaWdCeXRlczt0W3I+Pj4yXSY9NDI5NDk2NzI5NTw8MzItciU0KjgsdC5sZW5ndGg9ZS5jZWlsKHIvNCl9LGNsb25lOmZ1bmN0aW9uKCl7dmFyIHQ9aC5jbG9uZS5jYWxsKHRoaXMpO3JldHVybiB0LndvcmRzPXRoaXMud29yZHMuc2xpY2UoMCksdH0scmFuZG9tOmZ1bmN0aW9uKHQpe2Zvcih2YXIgZT1bXSxyPTA7cjx0O3IrPTQpZS5wdXNoKGkoKSk7cmV0dXJuIG5ldyBsLmluaXQoZSx0KX19KSxjPW8uZW5jPXt9LHU9Yy5IZXg9e3N0cmluZ2lmeTpmdW5jdGlvbih0KXtmb3IodmFyIGU9dC53b3JkcyxyPXQuc2lnQnl0ZXMsbj1bXSxpPTA7aTxyO2krKyl7dmFyIGE9ZVtpPj4+Ml0+Pj4yNC1pJTQqOCYyNTU7bi5wdXNoKChhPj4+NCkudG9TdHJpbmcoMTYpKSxuLnB1c2goKDE1JmEpLnRvU3RyaW5nKDE2KSl9cmV0dXJuIG4uam9pbigiIil9LHBhcnNlOmZ1bmN0aW9uKHQpe2Zvcih2YXIgZT10Lmxlbmd0aCxyPVtdLG49MDtuPGU7bis9MilyW24+Pj4zXXw9cGFyc2VJbnQodC5zdWJzdHIobiwyKSwxNik8PDI0LW4lOCo0O3JldHVybiBuZXcgbC5pbml0KHIsZS8yKX19LGQ9Yy5MYXRpbjE9e3N0cmluZ2lmeTpmdW5jdGlvbih0KXtmb3IodmFyIGU9dC53b3JkcyxyPXQuc2lnQnl0ZXMsbj1bXSxpPTA7aTxyO2krKyl7dmFyIGE9ZVtpPj4+Ml0+Pj4yNC1pJTQqOCYyNTU7bi5wdXNoKFN0cmluZy5mcm9tQ2hhckNvZGUoYSkpfXJldHVybiBuLmpvaW4oIiIpfSxwYXJzZTpmdW5jdGlvbih0KXtmb3IodmFyIGU9dC5sZW5ndGgscj1bXSxuPTA7bjxlO24rKylyW24+Pj4yXXw9KDI1NSZ0LmNoYXJDb2RlQXQobikpPDwyNC1uJTQqODtyZXR1cm4gbmV3IGwuaW5pdChyLGUpfX0sXz1jLlV0Zjg9e3N0cmluZ2lmeTpmdW5jdGlvbih0KXt0cnl7cmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChlc2NhcGUoZC5zdHJpbmdpZnkodCkpKX1jYXRjaCh0KXt0aHJvdyBuZXcgRXJyb3IoIk1hbGZvcm1lZCBVVEYtOCBkYXRhIil9fSxwYXJzZTpmdW5jdGlvbih0KXtyZXR1cm4gZC5wYXJzZSh1bmVzY2FwZShlbmNvZGVVUklDb21wb25lbnQodCkpKX19LGY9cy5CdWZmZXJlZEJsb2NrQWxnb3JpdGhtPWguZXh0ZW5kKHtyZXNldDpmdW5jdGlvbigpe3RoaXMuX2RhdGE9bmV3IGwuaW5pdCx0aGlzLl9uRGF0YUJ5dGVzPTB9LF9hcHBlbmQ6ZnVuY3Rpb24odCl7InN0cmluZyI9PXR5cGVvZiB0JiYodD1fLnBhcnNlKHQpKSx0aGlzLl9kYXRhLmNvbmNhdCh0KSx0aGlzLl9uRGF0YUJ5dGVzKz10LnNpZ0J5dGVzfSxfcHJvY2VzczpmdW5jdGlvbih0KXt2YXIgcixuPXRoaXMuX2RhdGEsaT1uLndvcmRzLGE9bi5zaWdCeXRlcyxvPXRoaXMuYmxvY2tTaXplLHM9YS8oNCpvKSxoPShzPXQ/ZS5jZWlsKHMpOmUubWF4KCgwfHMpLXRoaXMuX21pbkJ1ZmZlclNpemUsMCkpKm8sYz1lLm1pbig0KmgsYSk7aWYoaCl7Zm9yKHZhciB1PTA7dTxoO3UrPW8pdGhpcy5fZG9Qcm9jZXNzQmxvY2soaSx1KTtyPWkuc3BsaWNlKDAsaCksbi5zaWdCeXRlcy09Y31yZXR1cm4gbmV3IGwuaW5pdChyLGMpfSxjbG9uZTpmdW5jdGlvbigpe3ZhciB0PWguY2xvbmUuY2FsbCh0aGlzKTtyZXR1cm4gdC5fZGF0YT10aGlzLl9kYXRhLmNsb25lKCksdH0sX21pbkJ1ZmZlclNpemU6MH0pO3MuSGFzaGVyPWYuZXh0ZW5kKHtjZmc6aC5leHRlbmQoKSxpbml0OmZ1bmN0aW9uKHQpe3RoaXMuY2ZnPXRoaXMuY2ZnLmV4dGVuZCh0KSx0aGlzLnJlc2V0KCl9LHJlc2V0OmZ1bmN0aW9uKCl7Zi5yZXNldC5jYWxsKHRoaXMpLHRoaXMuX2RvUmVzZXQoKX0sdXBkYXRlOmZ1bmN0aW9uKHQpe3JldHVybiB0aGlzLl9hcHBlbmQodCksdGhpcy5fcHJvY2VzcygpLHRoaXN9LGZpbmFsaXplOmZ1bmN0aW9uKHQpe3JldHVybiB0JiZ0aGlzLl9hcHBlbmQodCksdGhpcy5fZG9GaW5hbGl6ZSgpfSxibG9ja1NpemU6MTYsX2NyZWF0ZUhlbHBlcjpmdW5jdGlvbih0KXtyZXR1cm4gZnVuY3Rpb24oZSxyKXtyZXR1cm4gbmV3IHQuaW5pdChyKS5maW5hbGl6ZShlKX19LF9jcmVhdGVIbWFjSGVscGVyOmZ1bmN0aW9uKHQpe3JldHVybiBmdW5jdGlvbihlLHIpe3JldHVybiBuZXcgcC5ITUFDLmluaXQodCxyKS5maW5hbGl6ZShlKX19fSk7dmFyIHA9by5hbGdvPXt9O3JldHVybiBvfShNYXRoKSxyKSxmdW5jdGlvbih0LGUpe3QuZXhwb3J0cz1mdW5jdGlvbih0KXtyZXR1cm4gZnVuY3Rpb24oKXt2YXIgZT10LHI9ZS5saWIuV29yZEFycmF5O2Z1bmN0aW9uIG4odCxlLG4pe2Zvcih2YXIgaT1bXSxhPTAsbz0wO288ZTtvKyspaWYobyU0KXt2YXIgcz1uW3QuY2hhckNvZGVBdChvLTEpXTw8byU0KjJ8blt0LmNoYXJDb2RlQXQobyldPj4+Ni1vJTQqMjtpW2E+Pj4yXXw9czw8MjQtYSU0KjgsYSsrfXJldHVybiByLmNyZWF0ZShpLGEpfWUuZW5jLkJhc2U2ND17c3RyaW5naWZ5OmZ1bmN0aW9uKHQpe3ZhciBlPXQud29yZHMscj10LnNpZ0J5dGVzLG49dGhpcy5fbWFwO3QuY2xhbXAoKTtmb3IodmFyIGk9W10sYT0wO2E8cjthKz0zKWZvcih2YXIgbz0oZVthPj4+Ml0+Pj4yNC1hJTQqOCYyNTUpPDwxNnwoZVthKzE+Pj4yXT4+PjI0LShhKzEpJTQqOCYyNTUpPDw4fGVbYSsyPj4+Ml0+Pj4yNC0oYSsyKSU0KjgmMjU1LHM9MDtzPDQmJmErLjc1KnM8cjtzKyspaS5wdXNoKG4uY2hhckF0KG8+Pj42KigzLXMpJjYzKSk7dmFyIGg9bi5jaGFyQXQoNjQpO2lmKGgpZm9yKDtpLmxlbmd0aCU0OylpLnB1c2goaCk7cmV0dXJuIGkuam9pbigiIil9LHBhcnNlOmZ1bmN0aW9uKHQpe3ZhciBlPXQubGVuZ3RoLHI9dGhpcy5fbWFwLGk9dGhpcy5fcmV2ZXJzZU1hcDtpZighaSl7aT10aGlzLl9yZXZlcnNlTWFwPVtdO2Zvcih2YXIgYT0wO2E8ci5sZW5ndGg7YSsrKWlbci5jaGFyQ29kZUF0KGEpXT1hfXZhciBvPXIuY2hhckF0KDY0KTtpZihvKXt2YXIgcz10LmluZGV4T2Yobyk7LTEhPT1zJiYoZT1zKX1yZXR1cm4gbih0LGUsaSl9LF9tYXA6IkFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXowMTIzNDU2Nzg5Ky89In19KCksdC5lbmMuQmFzZTY0fShpLmV4cG9ydHMpfShuKTt2YXIgYT1uLmV4cG9ydHMsbz17ZXhwb3J0czp7fX0scz17ZXhwb3J0czp7fX07IWZ1bmN0aW9uKHQsZSl7dC5leHBvcnRzPWZ1bmN0aW9uKHQpe3JldHVybiBmdW5jdGlvbihlKXt2YXIgcj10LG49ci5saWIsaT1uLldvcmRBcnJheSxhPW4uSGFzaGVyLG89ci5hbGdvLHM9W107IWZ1bmN0aW9uKCl7Zm9yKHZhciB0PTA7dDw2NDt0Kyspc1t0XT00Mjk0OTY3Mjk2KmUuYWJzKGUuc2luKHQrMSkpfDB9KCk7dmFyIGg9by5NRDU9YS5leHRlbmQoe19kb1Jlc2V0OmZ1bmN0aW9uKCl7dGhpcy5faGFzaD1uZXcgaS5pbml0KFsxNzMyNTg0MTkzLDQwMjMyMzM0MTcsMjU2MjM4MzEwMiwyNzE3MzM4NzhdKX0sX2RvUHJvY2Vzc0Jsb2NrOmZ1bmN0aW9uKHQsZSl7Zm9yKHZhciByPTA7cjwxNjtyKyspe3ZhciBuPWUrcixpPXRbbl07dFtuXT0xNjcxMTkzNSYoaTw8OHxpPj4+MjQpfDQyNzgyNTUzNjAmKGk8PDI0fGk+Pj44KX12YXIgYT10aGlzLl9oYXNoLndvcmRzLG89dFtlKzBdLGg9dFtlKzFdLF89dFtlKzJdLGY9dFtlKzNdLHA9dFtlKzRdLGc9dFtlKzVdLHk9dFtlKzZdLHY9dFtlKzddLHc9dFtlKzhdLG09dFtlKzldLGI9dFtlKzEwXSx4PXRbZSsxMV0saz10W2UrMTJdLHo9dFtlKzEzXSxBPXRbZSsxNF0sRT10W2UrMTVdLFM9YVswXSxCPWFbMV0sUj1hWzJdLEQ9YVszXTtTPWwoUyxCLFIsRCxvLDcsc1swXSksRD1sKEQsUyxCLFIsaCwxMixzWzFdKSxSPWwoUixELFMsQixfLDE3LHNbMl0pLEI9bChCLFIsRCxTLGYsMjIsc1szXSksUz1sKFMsQixSLEQscCw3LHNbNF0pLEQ9bChELFMsQixSLGcsMTIsc1s1XSksUj1sKFIsRCxTLEIseSwxNyxzWzZdKSxCPWwoQixSLEQsUyx2LDIyLHNbN10pLFM9bChTLEIsUixELHcsNyxzWzhdKSxEPWwoRCxTLEIsUixtLDEyLHNbOV0pLFI9bChSLEQsUyxCLGIsMTcsc1sxMF0pLEI9bChCLFIsRCxTLHgsMjIsc1sxMV0pLFM9bChTLEIsUixELGssNyxzWzEyXSksRD1sKEQsUyxCLFIseiwxMixzWzEzXSksUj1sKFIsRCxTLEIsQSwxNyxzWzE0XSksUz1jKFMsQj1sKEIsUixELFMsRSwyMixzWzE1XSksUixELGgsNSxzWzE2XSksRD1jKEQsUyxCLFIseSw5LHNbMTddKSxSPWMoUixELFMsQix4LDE0LHNbMThdKSxCPWMoQixSLEQsUyxvLDIwLHNbMTldKSxTPWMoUyxCLFIsRCxnLDUsc1syMF0pLEQ9YyhELFMsQixSLGIsOSxzWzIxXSksUj1jKFIsRCxTLEIsRSwxNCxzWzIyXSksQj1jKEIsUixELFMscCwyMCxzWzIzXSksUz1jKFMsQixSLEQsbSw1LHNbMjRdKSxEPWMoRCxTLEIsUixBLDksc1syNV0pLFI9YyhSLEQsUyxCLGYsMTQsc1syNl0pLEI9YyhCLFIsRCxTLHcsMjAsc1syN10pLFM9YyhTLEIsUixELHosNSxzWzI4XSksRD1jKEQsUyxCLFIsXyw5LHNbMjldKSxSPWMoUixELFMsQix2LDE0LHNbMzBdKSxTPXUoUyxCPWMoQixSLEQsUyxrLDIwLHNbMzFdKSxSLEQsZyw0LHNbMzJdKSxEPXUoRCxTLEIsUix3LDExLHNbMzNdKSxSPXUoUixELFMsQix4LDE2LHNbMzRdKSxCPXUoQixSLEQsUyxBLDIzLHNbMzVdKSxTPXUoUyxCLFIsRCxoLDQsc1szNl0pLEQ9dShELFMsQixSLHAsMTEsc1szN10pLFI9dShSLEQsUyxCLHYsMTYsc1szOF0pLEI9dShCLFIsRCxTLGIsMjMsc1szOV0pLFM9dShTLEIsUixELHosNCxzWzQwXSksRD11KEQsUyxCLFIsbywxMSxzWzQxXSksUj11KFIsRCxTLEIsZiwxNixzWzQyXSksQj11KEIsUixELFMseSwyMyxzWzQzXSksUz11KFMsQixSLEQsbSw0LHNbNDRdKSxEPXUoRCxTLEIsUixrLDExLHNbNDVdKSxSPXUoUixELFMsQixFLDE2LHNbNDZdKSxTPWQoUyxCPXUoQixSLEQsUyxfLDIzLHNbNDddKSxSLEQsbyw2LHNbNDhdKSxEPWQoRCxTLEIsUix2LDEwLHNbNDldKSxSPWQoUixELFMsQixBLDE1LHNbNTBdKSxCPWQoQixSLEQsUyxnLDIxLHNbNTFdKSxTPWQoUyxCLFIsRCxrLDYsc1s1Ml0pLEQ9ZChELFMsQixSLGYsMTAsc1s1M10pLFI9ZChSLEQsUyxCLGIsMTUsc1s1NF0pLEI9ZChCLFIsRCxTLGgsMjEsc1s1NV0pLFM9ZChTLEIsUixELHcsNixzWzU2XSksRD1kKEQsUyxCLFIsRSwxMCxzWzU3XSksUj1kKFIsRCxTLEIseSwxNSxzWzU4XSksQj1kKEIsUixELFMseiwyMSxzWzU5XSksUz1kKFMsQixSLEQscCw2LHNbNjBdKSxEPWQoRCxTLEIsUix4LDEwLHNbNjFdKSxSPWQoUixELFMsQixfLDE1LHNbNjJdKSxCPWQoQixSLEQsUyxtLDIxLHNbNjNdKSxhWzBdPWFbMF0rU3wwLGFbMV09YVsxXStCfDAsYVsyXT1hWzJdK1J8MCxhWzNdPWFbM10rRHwwfSxfZG9GaW5hbGl6ZTpmdW5jdGlvbigpe3ZhciB0PXRoaXMuX2RhdGEscj10LndvcmRzLG49OCp0aGlzLl9uRGF0YUJ5dGVzLGk9OCp0LnNpZ0J5dGVzO3JbaT4+PjVdfD0xMjg8PDI0LWklMzI7dmFyIGE9ZS5mbG9vcihuLzQyOTQ5NjcyOTYpLG89bjtyWzE1KyhpKzY0Pj4+OTw8NCldPTE2NzExOTM1JihhPDw4fGE+Pj4yNCl8NDI3ODI1NTM2MCYoYTw8MjR8YT4+PjgpLHJbMTQrKGkrNjQ+Pj45PDw0KV09MTY3MTE5MzUmKG88PDh8bz4+PjI0KXw0Mjc4MjU1MzYwJihvPDwyNHxvPj4+OCksdC5zaWdCeXRlcz00KihyLmxlbmd0aCsxKSx0aGlzLl9wcm9jZXNzKCk7Zm9yKHZhciBzPXRoaXMuX2hhc2gsaD1zLndvcmRzLGw9MDtsPDQ7bCsrKXt2YXIgYz1oW2xdO2hbbF09MTY3MTE5MzUmKGM8PDh8Yz4+PjI0KXw0Mjc4MjU1MzYwJihjPDwyNHxjPj4+OCl9cmV0dXJuIHN9LGNsb25lOmZ1bmN0aW9uKCl7dmFyIHQ9YS5jbG9uZS5jYWxsKHRoaXMpO3JldHVybiB0Ll9oYXNoPXRoaXMuX2hhc2guY2xvbmUoKSx0fX0pO2Z1bmN0aW9uIGwodCxlLHIsbixpLGEsbyl7dmFyIHM9dCsoZSZyfH5lJm4pK2krbztyZXR1cm4oczw8YXxzPj4+MzItYSkrZX1mdW5jdGlvbiBjKHQsZSxyLG4saSxhLG8pe3ZhciBzPXQrKGUmbnxyJn5uKStpK287cmV0dXJuKHM8PGF8cz4+PjMyLWEpK2V9ZnVuY3Rpb24gdSh0LGUscixuLGksYSxvKXt2YXIgcz10KyhlXnJebikraStvO3JldHVybihzPDxhfHM+Pj4zMi1hKStlfWZ1bmN0aW9uIGQodCxlLHIsbixpLGEsbyl7dmFyIHM9dCsocl4oZXx+bikpK2krbztyZXR1cm4oczw8YXxzPj4+MzItYSkrZX1yLk1ENT1hLl9jcmVhdGVIZWxwZXIoaCksci5IbWFjTUQ1PWEuX2NyZWF0ZUhtYWNIZWxwZXIoaCl9KE1hdGgpLHQuTUQ1fShpLmV4cG9ydHMpfShzKTt2YXIgaD17ZXhwb3J0czp7fX0sbD17ZXhwb3J0czp7fX07IWZ1bmN0aW9uKHQsZSl7dC5leHBvcnRzPWZ1bmN0aW9uKHQpe3JldHVybiBmdW5jdGlvbigpe3ZhciBlPXQscj1lLmxpYixuPXIuV29yZEFycmF5LGk9ci5IYXNoZXIsYT1lLmFsZ28sbz1bXSxzPWEuU0hBMT1pLmV4dGVuZCh7X2RvUmVzZXQ6ZnVuY3Rpb24oKXt0aGlzLl9oYXNoPW5ldyBuLmluaXQoWzE3MzI1ODQxOTMsNDAyMzIzMzQxNywyNTYyMzgzMTAyLDI3MTczMzg3OCwzMjg1Mzc3NTIwXSl9LF9kb1Byb2Nlc3NCbG9jazpmdW5jdGlvbih0LGUpe2Zvcih2YXIgcj10aGlzLl9oYXNoLndvcmRzLG49clswXSxpPXJbMV0sYT1yWzJdLHM9clszXSxoPXJbNF0sbD0wO2w8ODA7bCsrKXtpZihsPDE2KW9bbF09MHx0W2UrbF07ZWxzZXt2YXIgYz1vW2wtM11eb1tsLThdXm9bbC0xNF1eb1tsLTE2XTtvW2xdPWM8PDF8Yz4+PjMxfXZhciB1PShuPDw1fG4+Pj4yNykraCtvW2xdO3UrPWw8MjA/MTUxODUwMDI0OSsoaSZhfH5pJnMpOmw8NDA/MTg1OTc3NTM5MysoaV5hXnMpOmw8NjA/KGkmYXxpJnN8YSZzKS0xODk0MDA3NTg4OihpXmFecyktODk5NDk3NTE0LGg9cyxzPWEsYT1pPDwzMHxpPj4+MixpPW4sbj11fXJbMF09clswXStufDAsclsxXT1yWzFdK2l8MCxyWzJdPXJbMl0rYXwwLHJbM109clszXStzfDAscls0XT1yWzRdK2h8MH0sX2RvRmluYWxpemU6ZnVuY3Rpb24oKXt2YXIgdD10aGlzLl9kYXRhLGU9dC53b3JkcyxyPTgqdGhpcy5fbkRhdGFCeXRlcyxuPTgqdC5zaWdCeXRlcztyZXR1cm4gZVtuPj4+NV18PTEyODw8MjQtbiUzMixlWzE0KyhuKzY0Pj4+OTw8NCldPU1hdGguZmxvb3Ioci80Mjk0OTY3Mjk2KSxlWzE1KyhuKzY0Pj4+OTw8NCldPXIsdC5zaWdCeXRlcz00KmUubGVuZ3RoLHRoaXMuX3Byb2Nlc3MoKSx0aGlzLl9oYXNofSxjbG9uZTpmdW5jdGlvbigpe3ZhciB0PWkuY2xvbmUuY2FsbCh0aGlzKTtyZXR1cm4gdC5faGFzaD10aGlzLl9oYXNoLmNsb25lKCksdH19KTtlLlNIQTE9aS5fY3JlYXRlSGVscGVyKHMpLGUuSG1hY1NIQTE9aS5fY3JlYXRlSG1hY0hlbHBlcihzKX0oKSx0LlNIQTF9KGkuZXhwb3J0cyl9KGwpO3ZhciBjPXtleHBvcnRzOnt9fTshZnVuY3Rpb24odCxlKXt0LmV4cG9ydHM9ZnVuY3Rpb24odCl7dmFyIGUscixuO3I9KGU9dCkubGliLkJhc2Usbj1lLmVuYy5VdGY4LGUuYWxnby5ITUFDPXIuZXh0ZW5kKHtpbml0OmZ1bmN0aW9uKHQsZSl7dD10aGlzLl9oYXNoZXI9bmV3IHQuaW5pdCwic3RyaW5nIj09dHlwZW9mIGUmJihlPW4ucGFyc2UoZSkpO3ZhciByPXQuYmxvY2tTaXplLGk9NCpyO2Uuc2lnQnl0ZXM+aSYmKGU9dC5maW5hbGl6ZShlKSksZS5jbGFtcCgpO2Zvcih2YXIgYT10aGlzLl9vS2V5PWUuY2xvbmUoKSxvPXRoaXMuX2lLZXk9ZS5jbG9uZSgpLHM9YS53b3JkcyxoPW8ud29yZHMsbD0wO2w8cjtsKyspc1tsXV49MTU0OTU1NjgyOCxoW2xdXj05MDk1MjI0ODY7YS5zaWdCeXRlcz1vLnNpZ0J5dGVzPWksdGhpcy5yZXNldCgpfSxyZXNldDpmdW5jdGlvbigpe3ZhciB0PXRoaXMuX2hhc2hlcjt0LnJlc2V0KCksdC51cGRhdGUodGhpcy5faUtleSl9LHVwZGF0ZTpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5faGFzaGVyLnVwZGF0ZSh0KSx0aGlzfSxmaW5hbGl6ZTpmdW5jdGlvbih0KXt2YXIgZT10aGlzLl9oYXNoZXIscj1lLmZpbmFsaXplKHQpO3JldHVybiBlLnJlc2V0KCksZS5maW5hbGl6ZSh0aGlzLl9vS2V5LmNsb25lKCkuY29uY2F0KHIpKX19KX0oaS5leHBvcnRzKX0oYyksZnVuY3Rpb24odCxlKXt0LmV4cG9ydHM9ZnVuY3Rpb24odCl7cmV0dXJuIGZ1bmN0aW9uKCl7dmFyIGU9dCxyPWUubGliLG49ci5CYXNlLGk9ci5Xb3JkQXJyYXksYT1lLmFsZ28sbz1hLk1ENSxzPWEuRXZwS0RGPW4uZXh0ZW5kKHtjZmc6bi5leHRlbmQoe2tleVNpemU6NCxoYXNoZXI6byxpdGVyYXRpb25zOjF9KSxpbml0OmZ1bmN0aW9uKHQpe3RoaXMuY2ZnPXRoaXMuY2ZnLmV4dGVuZCh0KX0sY29tcHV0ZTpmdW5jdGlvbih0LGUpe2Zvcih2YXIgcixuPXRoaXMuY2ZnLGE9bi5oYXNoZXIuY3JlYXRlKCksbz1pLmNyZWF0ZSgpLHM9by53b3JkcyxoPW4ua2V5U2l6ZSxsPW4uaXRlcmF0aW9ucztzLmxlbmd0aDxoOyl7ciYmYS51cGRhdGUocikscj1hLnVwZGF0ZSh0KS5maW5hbGl6ZShlKSxhLnJlc2V0KCk7Zm9yKHZhciBjPTE7YzxsO2MrKylyPWEuZmluYWxpemUociksYS5yZXNldCgpO28uY29uY2F0KHIpfXJldHVybiBvLnNpZ0J5dGVzPTQqaCxvfX0pO2UuRXZwS0RGPWZ1bmN0aW9uKHQsZSxyKXtyZXR1cm4gcy5jcmVhdGUocikuY29tcHV0ZSh0LGUpfX0oKSx0LkV2cEtERn0oaS5leHBvcnRzKX0oaCk7dmFyIHU9e2V4cG9ydHM6e319OyFmdW5jdGlvbih0LGUpe3QuZXhwb3J0cz1mdW5jdGlvbih0KXt0LmxpYi5DaXBoZXJ8fGZ1bmN0aW9uKGUpe3ZhciByPXQsbj1yLmxpYixpPW4uQmFzZSxhPW4uV29yZEFycmF5LG89bi5CdWZmZXJlZEJsb2NrQWxnb3JpdGhtLHM9ci5lbmM7cy5VdGY4O3ZhciBoPXMuQmFzZTY0LGw9ci5hbGdvLkV2cEtERixjPW4uQ2lwaGVyPW8uZXh0ZW5kKHtjZmc6aS5leHRlbmQoKSxjcmVhdGVFbmNyeXB0b3I6ZnVuY3Rpb24odCxlKXtyZXR1cm4gdGhpcy5jcmVhdGUodGhpcy5fRU5DX1hGT1JNX01PREUsdCxlKX0sY3JlYXRlRGVjcnlwdG9yOmZ1bmN0aW9uKHQsZSl7cmV0dXJuIHRoaXMuY3JlYXRlKHRoaXMuX0RFQ19YRk9STV9NT0RFLHQsZSl9LGluaXQ6ZnVuY3Rpb24odCxlLHIpe3RoaXMuY2ZnPXRoaXMuY2ZnLmV4dGVuZChyKSx0aGlzLl94Zm9ybU1vZGU9dCx0aGlzLl9rZXk9ZSx0aGlzLnJlc2V0KCl9LHJlc2V0OmZ1bmN0aW9uKCl7by5yZXNldC5jYWxsKHRoaXMpLHRoaXMuX2RvUmVzZXQoKX0scHJvY2VzczpmdW5jdGlvbih0KXtyZXR1cm4gdGhpcy5fYXBwZW5kKHQpLHRoaXMuX3Byb2Nlc3MoKX0sZmluYWxpemU6ZnVuY3Rpb24odCl7cmV0dXJuIHQmJnRoaXMuX2FwcGVuZCh0KSx0aGlzLl9kb0ZpbmFsaXplKCl9LGtleVNpemU6NCxpdlNpemU6NCxfRU5DX1hGT1JNX01PREU6MSxfREVDX1hGT1JNX01PREU6MixfY3JlYXRlSGVscGVyOmZ1bmN0aW9uKCl7ZnVuY3Rpb24gdCh0KXtyZXR1cm4ic3RyaW5nIj09dHlwZW9mIHQ/dzp5fXJldHVybiBmdW5jdGlvbihlKXtyZXR1cm57ZW5jcnlwdDpmdW5jdGlvbihyLG4saSl7cmV0dXJuIHQobikuZW5jcnlwdChlLHIsbixpKX0sZGVjcnlwdDpmdW5jdGlvbihyLG4saSl7cmV0dXJuIHQobikuZGVjcnlwdChlLHIsbixpKX19fX0oKX0pO24uU3RyZWFtQ2lwaGVyPWMuZXh0ZW5kKHtfZG9GaW5hbGl6ZTpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9wcm9jZXNzKCEwKX0sYmxvY2tTaXplOjF9KTt2YXIgdT1yLm1vZGU9e30sZD1uLkJsb2NrQ2lwaGVyTW9kZT1pLmV4dGVuZCh7Y3JlYXRlRW5jcnlwdG9yOmZ1bmN0aW9uKHQsZSl7cmV0dXJuIHRoaXMuRW5jcnlwdG9yLmNyZWF0ZSh0LGUpfSxjcmVhdGVEZWNyeXB0b3I6ZnVuY3Rpb24odCxlKXtyZXR1cm4gdGhpcy5EZWNyeXB0b3IuY3JlYXRlKHQsZSl9LGluaXQ6ZnVuY3Rpb24odCxlKXt0aGlzLl9jaXBoZXI9dCx0aGlzLl9pdj1lfX0pLF89dS5DQkM9ZnVuY3Rpb24oKXt2YXIgdD1kLmV4dGVuZCgpO2Z1bmN0aW9uIHIodCxyLG4pe3ZhciBpLGE9dGhpcy5faXY7YT8oaT1hLHRoaXMuX2l2PWUpOmk9dGhpcy5fcHJldkJsb2NrO2Zvcih2YXIgbz0wO288bjtvKyspdFtyK29dXj1pW29dfXJldHVybiB0LkVuY3J5cHRvcj10LmV4dGVuZCh7cHJvY2Vzc0Jsb2NrOmZ1bmN0aW9uKHQsZSl7dmFyIG49dGhpcy5fY2lwaGVyLGk9bi5ibG9ja1NpemU7ci5jYWxsKHRoaXMsdCxlLGkpLG4uZW5jcnlwdEJsb2NrKHQsZSksdGhpcy5fcHJldkJsb2NrPXQuc2xpY2UoZSxlK2kpfX0pLHQuRGVjcnlwdG9yPXQuZXh0ZW5kKHtwcm9jZXNzQmxvY2s6ZnVuY3Rpb24odCxlKXt2YXIgbj10aGlzLl9jaXBoZXIsaT1uLmJsb2NrU2l6ZSxhPXQuc2xpY2UoZSxlK2kpO24uZGVjcnlwdEJsb2NrKHQsZSksci5jYWxsKHRoaXMsdCxlLGkpLHRoaXMuX3ByZXZCbG9jaz1hfX0pLHR9KCksZj0oci5wYWQ9e30pLlBrY3M3PXtwYWQ6ZnVuY3Rpb24odCxlKXtmb3IodmFyIHI9NCplLG49ci10LnNpZ0J5dGVzJXIsaT1uPDwyNHxuPDwxNnxuPDw4fG4sbz1bXSxzPTA7czxuO3MrPTQpby5wdXNoKGkpO3ZhciBoPWEuY3JlYXRlKG8sbik7dC5jb25jYXQoaCl9LHVucGFkOmZ1bmN0aW9uKHQpe3ZhciBlPTI1NSZ0LndvcmRzW3Quc2lnQnl0ZXMtMT4+PjJdO3Quc2lnQnl0ZXMtPWV9fTtuLkJsb2NrQ2lwaGVyPWMuZXh0ZW5kKHtjZmc6Yy5jZmcuZXh0ZW5kKHttb2RlOl8scGFkZGluZzpmfSkscmVzZXQ6ZnVuY3Rpb24oKXt2YXIgdDtjLnJlc2V0LmNhbGwodGhpcyk7dmFyIGU9dGhpcy5jZmcscj1lLml2LG49ZS5tb2RlO3RoaXMuX3hmb3JtTW9kZT09dGhpcy5fRU5DX1hGT1JNX01PREU/dD1uLmNyZWF0ZUVuY3J5cHRvcjoodD1uLmNyZWF0ZURlY3J5cHRvcix0aGlzLl9taW5CdWZmZXJTaXplPTEpLHRoaXMuX21vZGUmJnRoaXMuX21vZGUuX19jcmVhdG9yPT10P3RoaXMuX21vZGUuaW5pdCh0aGlzLHImJnIud29yZHMpOih0aGlzLl9tb2RlPXQuY2FsbChuLHRoaXMsciYmci53b3JkcyksdGhpcy5fbW9kZS5fX2NyZWF0b3I9dCl9LF9kb1Byb2Nlc3NCbG9jazpmdW5jdGlvbih0LGUpe3RoaXMuX21vZGUucHJvY2Vzc0Jsb2NrKHQsZSl9LF9kb0ZpbmFsaXplOmZ1bmN0aW9uKCl7dmFyIHQsZT10aGlzLmNmZy5wYWRkaW5nO3JldHVybiB0aGlzLl94Zm9ybU1vZGU9PXRoaXMuX0VOQ19YRk9STV9NT0RFPyhlLnBhZCh0aGlzLl9kYXRhLHRoaXMuYmxvY2tTaXplKSx0PXRoaXMuX3Byb2Nlc3MoITApKToodD10aGlzLl9wcm9jZXNzKCEwKSxlLnVucGFkKHQpKSx0fSxibG9ja1NpemU6NH0pO3ZhciBwPW4uQ2lwaGVyUGFyYW1zPWkuZXh0ZW5kKHtpbml0OmZ1bmN0aW9uKHQpe3RoaXMubWl4SW4odCl9LHRvU3RyaW5nOmZ1bmN0aW9uKHQpe3JldHVybih0fHx0aGlzLmZvcm1hdHRlcikuc3RyaW5naWZ5KHRoaXMpfX0pLGc9KHIuZm9ybWF0PXt9KS5PcGVuU1NMPXtzdHJpbmdpZnk6ZnVuY3Rpb24odCl7dmFyIGU9dC5jaXBoZXJ0ZXh0LHI9dC5zYWx0O3JldHVybihyP2EuY3JlYXRlKFsxMzk4ODkzNjg0LDE3MDEwNzY4MzFdKS5jb25jYXQocikuY29uY2F0KGUpOmUpLnRvU3RyaW5nKGgpfSxwYXJzZTpmdW5jdGlvbih0KXt2YXIgZSxyPWgucGFyc2UodCksbj1yLndvcmRzO3JldHVybiAxMzk4ODkzNjg0PT1uWzBdJiYxNzAxMDc2ODMxPT1uWzFdJiYoZT1hLmNyZWF0ZShuLnNsaWNlKDIsNCkpLG4uc3BsaWNlKDAsNCksci5zaWdCeXRlcy09MTYpLHAuY3JlYXRlKHtjaXBoZXJ0ZXh0OnIsc2FsdDplfSl9fSx5PW4uU2VyaWFsaXphYmxlQ2lwaGVyPWkuZXh0ZW5kKHtjZmc6aS5leHRlbmQoe2Zvcm1hdDpnfSksZW5jcnlwdDpmdW5jdGlvbih0LGUscixuKXtuPXRoaXMuY2ZnLmV4dGVuZChuKTt2YXIgaT10LmNyZWF0ZUVuY3J5cHRvcihyLG4pLGE9aS5maW5hbGl6ZShlKSxvPWkuY2ZnO3JldHVybiBwLmNyZWF0ZSh7Y2lwaGVydGV4dDphLGtleTpyLGl2Om8uaXYsYWxnb3JpdGhtOnQsbW9kZTpvLm1vZGUscGFkZGluZzpvLnBhZGRpbmcsYmxvY2tTaXplOnQuYmxvY2tTaXplLGZvcm1hdHRlcjpuLmZvcm1hdH0pfSxkZWNyeXB0OmZ1bmN0aW9uKHQsZSxyLG4pe3JldHVybiBuPXRoaXMuY2ZnLmV4dGVuZChuKSxlPXRoaXMuX3BhcnNlKGUsbi5mb3JtYXQpLHQuY3JlYXRlRGVjcnlwdG9yKHIsbikuZmluYWxpemUoZS5jaXBoZXJ0ZXh0KX0sX3BhcnNlOmZ1bmN0aW9uKHQsZSl7cmV0dXJuInN0cmluZyI9PXR5cGVvZiB0P2UucGFyc2UodCx0aGlzKTp0fX0pLHY9KHIua2RmPXt9KS5PcGVuU1NMPXtleGVjdXRlOmZ1bmN0aW9uKHQsZSxyLG4pe258fChuPWEucmFuZG9tKDgpKTt2YXIgaT1sLmNyZWF0ZSh7a2V5U2l6ZTplK3J9KS5jb21wdXRlKHQsbiksbz1hLmNyZWF0ZShpLndvcmRzLnNsaWNlKGUpLDQqcik7cmV0dXJuIGkuc2lnQnl0ZXM9NCplLHAuY3JlYXRlKHtrZXk6aSxpdjpvLHNhbHQ6bn0pfX0sdz1uLlBhc3N3b3JkQmFzZWRDaXBoZXI9eS5leHRlbmQoe2NmZzp5LmNmZy5leHRlbmQoe2tkZjp2fSksZW5jcnlwdDpmdW5jdGlvbih0LGUscixuKXt2YXIgaT0obj10aGlzLmNmZy5leHRlbmQobikpLmtkZi5leGVjdXRlKHIsdC5rZXlTaXplLHQuaXZTaXplKTtuLml2PWkuaXY7dmFyIGE9eS5lbmNyeXB0LmNhbGwodGhpcyx0LGUsaS5rZXksbik7cmV0dXJuIGEubWl4SW4oaSksYX0sZGVjcnlwdDpmdW5jdGlvbih0LGUscixuKXtuPXRoaXMuY2ZnLmV4dGVuZChuKSxlPXRoaXMuX3BhcnNlKGUsbi5mb3JtYXQpO3ZhciBpPW4ua2RmLmV4ZWN1dGUocix0LmtleVNpemUsdC5pdlNpemUsZS5zYWx0KTtyZXR1cm4gbi5pdj1pLml2LHkuZGVjcnlwdC5jYWxsKHRoaXMsdCxlLGkua2V5LG4pfX0pfSgpfShpLmV4cG9ydHMpfSh1KSxmdW5jdGlvbih0LGUpe3QuZXhwb3J0cz1mdW5jdGlvbih0KXtyZXR1cm4gZnVuY3Rpb24oKXt2YXIgZT10LHI9ZS5saWIuQmxvY2tDaXBoZXIsbj1lLmFsZ28saT1bXSxhPVtdLG89W10scz1bXSxoPVtdLGw9W10sYz1bXSx1PVtdLGQ9W10sXz1bXTshZnVuY3Rpb24oKXtmb3IodmFyIHQ9W10sZT0wO2U8MjU2O2UrKyl0W2VdPWU8MTI4P2U8PDE6ZTw8MV4yODM7dmFyIHI9MCxuPTA7Zm9yKGU9MDtlPDI1NjtlKyspe3ZhciBmPW5ebjw8MV5uPDwyXm48PDNebjw8NDtmPWY+Pj44XjI1NSZmXjk5LGlbcl09ZixhW2ZdPXI7dmFyIHA9dFtyXSxnPXRbcF0seT10W2ddLHY9MjU3KnRbZl1eMTY4NDMwMDgqZjtvW3JdPXY8PDI0fHY+Pj44LHNbcl09djw8MTZ8dj4+PjE2LGhbcl09djw8OHx2Pj4+MjQsbFtyXT12LHY9MTY4NDMwMDkqeV42NTUzNypnXjI1NypwXjE2ODQzMDA4KnIsY1tmXT12PDwyNHx2Pj4+OCx1W2ZdPXY8PDE2fHY+Pj4xNixkW2ZdPXY8PDh8dj4+PjI0LF9bZl09dixyPyhyPXBedFt0W3RbeV5wXV1dLG5ePXRbdFtuXV0pOnI9bj0xfX0oKTt2YXIgZj1bMCwxLDIsNCw4LDE2LDMyLDY0LDEyOCwyNyw1NF0scD1uLkFFUz1yLmV4dGVuZCh7X2RvUmVzZXQ6ZnVuY3Rpb24oKXtpZighdGhpcy5fblJvdW5kc3x8dGhpcy5fa2V5UHJpb3JSZXNldCE9PXRoaXMuX2tleSl7Zm9yKHZhciB0PXRoaXMuX2tleVByaW9yUmVzZXQ9dGhpcy5fa2V5LGU9dC53b3JkcyxyPXQuc2lnQnl0ZXMvNCxuPTQqKCh0aGlzLl9uUm91bmRzPXIrNikrMSksYT10aGlzLl9rZXlTY2hlZHVsZT1bXSxvPTA7bzxuO28rKylvPHI/YVtvXT1lW29dOihsPWFbby0xXSxvJXI/cj42JiZvJXI9PTQmJihsPWlbbD4+PjI0XTw8MjR8aVtsPj4+MTYmMjU1XTw8MTZ8aVtsPj4+OCYyNTVdPDw4fGlbMjU1JmxdKToobD1pWyhsPWw8PDh8bD4+PjI0KT4+PjI0XTw8MjR8aVtsPj4+MTYmMjU1XTw8MTZ8aVtsPj4+OCYyNTVdPDw4fGlbMjU1JmxdLGxePWZbby9yfDBdPDwyNCksYVtvXT1hW28tcl1ebCk7Zm9yKHZhciBzPXRoaXMuX2ludktleVNjaGVkdWxlPVtdLGg9MDtoPG47aCsrKXtpZihvPW4taCxoJTQpdmFyIGw9YVtvXTtlbHNlIGw9YVtvLTRdO3NbaF09aDw0fHxvPD00P2w6Y1tpW2w+Pj4yNF1dXnVbaVtsPj4+MTYmMjU1XV1eZFtpW2w+Pj44JjI1NV1dXl9baVsyNTUmbF1dfX19LGVuY3J5cHRCbG9jazpmdW5jdGlvbih0LGUpe3RoaXMuX2RvQ3J5cHRCbG9jayh0LGUsdGhpcy5fa2V5U2NoZWR1bGUsbyxzLGgsbCxpKX0sZGVjcnlwdEJsb2NrOmZ1bmN0aW9uKHQsZSl7dmFyIHI9dFtlKzFdO3RbZSsxXT10W2UrM10sdFtlKzNdPXIsdGhpcy5fZG9DcnlwdEJsb2NrKHQsZSx0aGlzLl9pbnZLZXlTY2hlZHVsZSxjLHUsZCxfLGEpLHI9dFtlKzFdLHRbZSsxXT10W2UrM10sdFtlKzNdPXJ9LF9kb0NyeXB0QmxvY2s6ZnVuY3Rpb24odCxlLHIsbixpLGEsbyxzKXtmb3IodmFyIGg9dGhpcy5fblJvdW5kcyxsPXRbZV1eclswXSxjPXRbZSsxXV5yWzFdLHU9dFtlKzJdXnJbMl0sZD10W2UrM11eclszXSxfPTQsZj0xO2Y8aDtmKyspe3ZhciBwPW5bbD4+PjI0XV5pW2M+Pj4xNiYyNTVdXmFbdT4+PjgmMjU1XV5vWzI1NSZkXV5yW18rK10sZz1uW2M+Pj4yNF1eaVt1Pj4+MTYmMjU1XV5hW2Q+Pj44JjI1NV1eb1syNTUmbF1ecltfKytdLHk9blt1Pj4+MjRdXmlbZD4+PjE2JjI1NV1eYVtsPj4+OCYyNTVdXm9bMjU1JmNdXnJbXysrXSx2PW5bZD4+PjI0XV5pW2w+Pj4xNiYyNTVdXmFbYz4+PjgmMjU1XV5vWzI1NSZ1XV5yW18rK107bD1wLGM9Zyx1PXksZD12fXA9KHNbbD4+PjI0XTw8MjR8c1tjPj4+MTYmMjU1XTw8MTZ8c1t1Pj4+OCYyNTVdPDw4fHNbMjU1JmRdKV5yW18rK10sZz0oc1tjPj4+MjRdPDwyNHxzW3U+Pj4xNiYyNTVdPDwxNnxzW2Q+Pj44JjI1NV08PDh8c1syNTUmbF0pXnJbXysrXSx5PShzW3U+Pj4yNF08PDI0fHNbZD4+PjE2JjI1NV08PDE2fHNbbD4+PjgmMjU1XTw8OHxzWzI1NSZjXSlecltfKytdLHY9KHNbZD4+PjI0XTw8MjR8c1tsPj4+MTYmMjU1XTw8MTZ8c1tjPj4+OCYyNTVdPDw4fHNbMjU1JnVdKV5yW18rK10sdFtlXT1wLHRbZSsxXT1nLHRbZSsyXT15LHRbZSszXT12fSxrZXlTaXplOjh9KTtlLkFFUz1yLl9jcmVhdGVIZWxwZXIocCl9KCksdC5BRVN9KGkuZXhwb3J0cyl9KG8pO3ZhciBkPW8uZXhwb3J0cyxfPXtleHBvcnRzOnt9fTshZnVuY3Rpb24odCxlKXt0LmV4cG9ydHM9ZnVuY3Rpb24odCl7cmV0dXJuIGZ1bmN0aW9uKGUpe3ZhciByPXQsbj1yLmxpYixpPW4uV29yZEFycmF5LGE9bi5IYXNoZXIsbz1yLmFsZ28scz1bXSxoPVtdOyFmdW5jdGlvbigpe2Z1bmN0aW9uIHQodCl7Zm9yKHZhciByPWUuc3FydCh0KSxuPTI7bjw9cjtuKyspaWYoISh0JW4pKXJldHVybiExO3JldHVybiEwfWZ1bmN0aW9uIHIodCl7cmV0dXJuIDQyOTQ5NjcyOTYqKHQtKDB8dCkpfDB9Zm9yKHZhciBuPTIsaT0wO2k8NjQ7KXQobikmJihpPDgmJihzW2ldPXIoZS5wb3cobiwuNSkpKSxoW2ldPXIoZS5wb3cobiwxLzMpKSxpKyspLG4rK30oKTt2YXIgbD1bXSxjPW8uU0hBMjU2PWEuZXh0ZW5kKHtfZG9SZXNldDpmdW5jdGlvbigpe3RoaXMuX2hhc2g9bmV3IGkuaW5pdChzLnNsaWNlKDApKX0sX2RvUHJvY2Vzc0Jsb2NrOmZ1bmN0aW9uKHQsZSl7Zm9yKHZhciByPXRoaXMuX2hhc2gud29yZHMsbj1yWzBdLGk9clsxXSxhPXJbMl0sbz1yWzNdLHM9cls0XSxjPXJbNV0sdT1yWzZdLGQ9cls3XSxfPTA7Xzw2NDtfKyspe2lmKF88MTYpbFtfXT0wfHRbZStfXTtlbHNle3ZhciBmPWxbXy0xNV0scD0oZjw8MjV8Zj4+PjcpXihmPDwxNHxmPj4+MTgpXmY+Pj4zLGc9bFtfLTJdLHk9KGc8PDE1fGc+Pj4xNyleKGc8PDEzfGc+Pj4xOSleZz4+PjEwO2xbX109cCtsW18tN10reStsW18tMTZdfXZhciB2PW4maV5uJmFeaSZhLHc9KG48PDMwfG4+Pj4yKV4objw8MTl8bj4+PjEzKV4objw8MTB8bj4+PjIyKSxtPWQrKChzPDwyNnxzPj4+NileKHM8PDIxfHM+Pj4xMSleKHM8PDd8cz4+PjI1KSkrKHMmY15+cyZ1KStoW19dK2xbX107ZD11LHU9YyxjPXMscz1vK218MCxvPWEsYT1pLGk9bixuPW0rKHcrdil8MH1yWzBdPXJbMF0rbnwwLHJbMV09clsxXStpfDAsclsyXT1yWzJdK2F8MCxyWzNdPXJbM10rb3wwLHJbNF09cls0XStzfDAscls1XT1yWzVdK2N8MCxyWzZdPXJbNl0rdXwwLHJbN109cls3XStkfDB9LF9kb0ZpbmFsaXplOmZ1bmN0aW9uKCl7dmFyIHQ9dGhpcy5fZGF0YSxyPXQud29yZHMsbj04KnRoaXMuX25EYXRhQnl0ZXMsaT04KnQuc2lnQnl0ZXM7cmV0dXJuIHJbaT4+PjVdfD0xMjg8PDI0LWklMzIsclsxNCsoaSs2ND4+Pjk8PDQpXT1lLmZsb29yKG4vNDI5NDk2NzI5NiksclsxNSsoaSs2ND4+Pjk8PDQpXT1uLHQuc2lnQnl0ZXM9NCpyLmxlbmd0aCx0aGlzLl9wcm9jZXNzKCksdGhpcy5faGFzaH0sY2xvbmU6ZnVuY3Rpb24oKXt2YXIgdD1hLmNsb25lLmNhbGwodGhpcyk7cmV0dXJuIHQuX2hhc2g9dGhpcy5faGFzaC5jbG9uZSgpLHR9fSk7ci5TSEEyNTY9YS5fY3JlYXRlSGVscGVyKGMpLHIuSG1hY1NIQTI1Nj1hLl9jcmVhdGVIbWFjSGVscGVyKGMpfShNYXRoKSx0LlNIQTI1Nn0oaS5leHBvcnRzKX0oXyk7dmFyIGY9Xy5leHBvcnRzLHA9e2V4cG9ydHM6e319OyFmdW5jdGlvbih0LGUpe3QuZXhwb3J0cz1mdW5jdGlvbih0KXtyZXR1cm4gZnVuY3Rpb24oKXtpZigiZnVuY3Rpb24iPT10eXBlb2YgQXJyYXlCdWZmZXIpe3ZhciBlPXQubGliLldvcmRBcnJheSxyPWUuaW5pdCxuPWUuaW5pdD1mdW5jdGlvbih0KXtpZih0IGluc3RhbmNlb2YgQXJyYXlCdWZmZXImJih0PW5ldyBVaW50OEFycmF5KHQpKSwodCBpbnN0YW5jZW9mIEludDhBcnJheXx8InVuZGVmaW5lZCIhPXR5cGVvZiBVaW50OENsYW1wZWRBcnJheSYmdCBpbnN0YW5jZW9mIFVpbnQ4Q2xhbXBlZEFycmF5fHx0IGluc3RhbmNlb2YgSW50MTZBcnJheXx8dCBpbnN0YW5jZW9mIFVpbnQxNkFycmF5fHx0IGluc3RhbmNlb2YgSW50MzJBcnJheXx8dCBpbnN0YW5jZW9mIFVpbnQzMkFycmF5fHx0IGluc3RhbmNlb2YgRmxvYXQzMkFycmF5fHx0IGluc3RhbmNlb2YgRmxvYXQ2NEFycmF5KSYmKHQ9bmV3IFVpbnQ4QXJyYXkodC5idWZmZXIsdC5ieXRlT2Zmc2V0LHQuYnl0ZUxlbmd0aCkpLHQgaW5zdGFuY2VvZiBVaW50OEFycmF5KXtmb3IodmFyIGU9dC5ieXRlTGVuZ3RoLG49W10saT0wO2k8ZTtpKyspbltpPj4+Ml18PXRbaV08PDI0LWklNCo4O3IuY2FsbCh0aGlzLG4sZSl9ZWxzZSByLmFwcGx5KHRoaXMsYXJndW1lbnRzKX07bi5wcm90b3R5cGU9ZX19KCksdC5saWIuV29yZEFycmF5fShpLmV4cG9ydHMpfShwKTt2YXIgZz1wLmV4cG9ydHMseT17ZXhwb3J0czp7fX07IWZ1bmN0aW9uKHQsZSl7dC5leHBvcnRzPWZ1bmN0aW9uKHQpe3JldHVybiB0LkhtYWNTSEEyNTZ9KGkuZXhwb3J0cyl9KHkpO3ZhciB2PXkuZXhwb3J0cztsZXQgdyxtLGI7e2I9cmVxdWlyZSgiaHR0cHMiKTtjb25zdHtwYXJlbnRQb3J0OnR9PXJlcXVpcmUoIndvcmtlcl90aHJlYWRzIik7dC5vbigibWVzc2FnZSIsKHQ9PmZ1bmN0aW9uKHQpe2NvbnN0e2pvYjpyLGNtZDpuLHNlcnZlcjppLHBhdGg6byxidWZmZXI6cyxrZXlCYXNlNjQ6aCxnemlwOmwscmVmZXJyZXI6YyxpZDp1LGFwcElkOl8scGVyc2lzdGVudElkOnAsQ1JPUVVFVF9WRVJTSU9OOnksZGVidWc6Yix3aGF0Omssb2ZmbGluZTp6fT10LmRhdGE7eiYmKHc9RCk7c3dpdGNoKG4pe2Nhc2UidXBsb2FkRW5jcnlwdGVkIjpSKG8pO2JyZWFrO2Nhc2UiZ2V0T2ZmbGluZUZpbGUiOkwodC5kYXRhLnVybCk7YnJlYWs7ZGVmYXVsdDpjb25zb2xlLmVycm9yKCJVbmtub3duIHdvcmtlciBjb21tYW5kIixuKX1mdW5jdGlvbiBBKHQpe2NvbnN0IGU9RGF0ZS5ub3coKSxyPWcuY3JlYXRlKHQpLG49YS5wYXJzZShoKSxpPXYocixuKSxvPWcucmFuZG9tKDE2KSx7Y2lwaGVydGV4dDpzfT1kLmVuY3J5cHQocixuLHtpdjpvfSksbD1uZXcgQXJyYXlCdWZmZXIoNCtvLnNpZ0J5dGVzK2kuc2lnQnl0ZXMrcy5zaWdCeXRlcyksYz1uZXcgRGF0YVZpZXcobCk7bGV0IF89MDtjLnNldFVpbnQzMihfLDExMjk0NjgyMDksITEpLF8rPTQ7Zm9yKGNvbnN0IHQgb2ZbbyxpLHNdKWZvcihjb25zdCBlIG9mIHQud29yZHMpYy5zZXRJbnQzMihfLGUsITEpLF8rPTQ7cmV0dXJuIGImJmNvbnNvbGUubG9nKGAke3V9ICR7a30gZW5jcnlwdGVkICgke2wuYnl0ZUxlbmd0aH0gYnl0ZXMpIGluICR7RGF0ZS5ub3coKS1lfW1zYCksbH1mdW5jdGlvbiBFKHQpe2NvbnN0IHI9RGF0ZS5ub3coKSxuPWUuZXhwb3J0cy5kZWZsYXRlKHQse2d6aXA6ITAsbGV2ZWw6MX0pO3JldHVybiBiJiZjb25zb2xlLmxvZyhgJHt1fSAke2t9IGNvbXByZXNzZWQgKCR7bi5sZW5ndGh9IGJ5dGVzKSBpbiAke0RhdGUubm93KCktcn1tc2ApLG59ZnVuY3Rpb24gUyh0KXtjb25zdCBlPURhdGUubm93KCkscj1mKGcuY3JlYXRlKHQpKSxuPWEuc3RyaW5naWZ5KHIpLnJlcGxhY2UoLz0vZywiIikucmVwbGFjZSgvXCsvZywiLSIpLnJlcGxhY2UoL1wvL2csIl8iKTtyZXR1cm4gYiYmY29uc29sZS5sb2coYCR7dX0gJHtrfSBoYXNoZWQgKCR7dC5sZW5ndGh9IGJ5dGVzKSBpbiAke0RhdGUubm93KCktZX1tc2ApLG59YXN5bmMgZnVuY3Rpb24gQih0KXtpZih6KXtjb25zdCBlPWBvZmZsaW5lOi8vLyR7dH1gO3JldHVybnt1cmw6ZSx1cGxvYWRVcmw6ZX19Y29uc3QgZT1EYXRlLm5vdygpLHI9YCR7aS51cmx9LyR7dH1gO2lmKCFpLmFwaUtleSlyZXR1cm57dXJsOnIsdXBsb2FkVXJsOnJ9O2NvbnN0IG49YXdhaXQgdyhyLHtoZWFkZXJzOnsiWC1Dcm9xdWV0LUF1dGgiOmkuYXBpS2V5LCJYLUNyb3F1ZXQtQXBwIjpfLCJYLUNyb3F1ZXQtSWQiOnAsIlgtQ3JvcXVldC1TZXNzaW9uIjp1LCJYLUNyb3F1ZXQtVmVyc2lvbiI6eSwiWC1Dcm9xdWV0LVBhdGgiOm5ldyBVUkwoYykucGF0aG5hbWV9LHJlZmVycmVyOmN9KSx7b2s6YSxzdGF0dXM6byxzdGF0dXNUZXh0OnN9PW47aWYoIWEpdGhyb3cgRXJyb3IoYEVycm9yIGluIHNpZ25pbmcgVVJMOiAke299IC0gJHtzfWApO2NvbnN0e2Vycm9yOmgscmVhZDpsLHdyaXRlOmR9PWF3YWl0IG4uanNvbigpO2lmKGgpdGhyb3cgRXJyb3IoaCk7cmV0dXJuIGImJmNvbnNvbGUubG9nKGAke3V9ICR7a30gYXV0aG9yaXplZCBpbiAke0RhdGUubm93KCktZX1tc2ApLHt1cmw6bCx1cGxvYWRVcmw6ZH19YXN5bmMgZnVuY3Rpb24gUih0KXt0cnl7bGV0IGU9QShsP0Uocyk6cyk7ZT1uZXcgVWludDhBcnJheShlKSx0LmluY2x1ZGVzKCIlSEFTSCUiKSYmKHQ9dC5yZXBsYWNlKCIlSEFTSCUiLFMoZSkpKTtjb25zdHt1cGxvYWRVcmw6bix1cmw6aX09YXdhaXQgQih0KSxhPURhdGUubm93KCkse29rOm8sc3RhdHVzOmgsc3RhdHVzVGV4dDpkfT1hd2FpdCB3KG4se21ldGhvZDoiUFVUIixtb2RlOiJjb3JzIixoZWFkZXJzOnsiQ29udGVudC1UeXBlIjoiYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtIiwiWC1Dcm9xdWV0LUFwcCI6XywiWC1Dcm9xdWV0LUlkIjpwLCJYLUNyb3F1ZXQtU2Vzc2lvbiI6dSwiWC1Dcm9xdWV0LVZlcnNpb24iOnl9LHJlZmVycmVyOmMsYm9keTplfSk7aWYoIW8pdGhyb3cgRXJyb3IoYHNlcnZlciByZXR1cm5lZCAke2h9ICR7ZH0gZm9yIFBVVCAke259YCk7YiYmY29uc29sZS5sb2coYCR7dX0gJHtrfSB1cGxvYWRlZCAoJHtofSkgaW4gJHtEYXRlLm5vdygpLWF9bXMgJHtpfWApLG0oe2pvYjpyLHVybDppLG9rOm8sc3RhdHVzOmgsc3RhdHVzVGV4dDpkLGJ5dGVzOmUubGVuZ3RofSl9Y2F0Y2godCl7YiYmY29uc29sZS5lcnJvcihgJHt1fSB1cGxvYWQgZXJyb3IgJHt0Lm1lc3NhZ2V9YCksbSh7am9iOnIsb2s6ITEsc3RhdHVzOi0xLHN0YXR1c1RleHQ6dC5tZXNzYWdlfSl9fWZ1bmN0aW9uIEQodCxlKXtyZXR1cm4gYiYmY29uc29sZS5sb2coYCR7dX0gc3RvcmluZyAke3R9YCkseC5zZXQodCxlLmJvZHkpLHtvazohMCxzdGF0dXM6MjAxLHN0YXR1c1RleHQ6Ik9mZmxpbmUgY3JlYXRlZCJ9fWZ1bmN0aW9uIEwodCl7Y29uc3QgZT14LmdldCh0KTtpZighZSlyZXR1cm4gYiYmY29uc29sZS5lcnJvcihgJHt1fSBmaWxlIG5vdCBmb3VuZCAke3R9YCksdm9pZCBtKHtqb2I6cixvazohMSxzdGF0dXM6LTEsc3RhdHVzVGV4dDoiT2ZmbGluZSBmaWxlIG5vdCBmb3VuZCJ9KTtiJiZjb25zb2xlLmxvZyhgJHt1fSByZXRyaWV2ZWQgJHt0fWApLG0oe2pvYjpyLG9rOiEwLHN0YXR1czoyMDAsc3RhdHVzVGV4dDoiT2ZmbGluZSBmaWxlIGZvdW5kIixib2R5OmUsYnl0ZXM6ZS5sZW5ndGh9KX19KHtkYXRhOnR9KSkpLHc9ZnVuY3Rpb24odCxlKXtyZXR1cm4gbmV3IFByb21pc2UoKChyLG4pPT57Y29uc3QgaT1uZXcgVVJMKHQpLGE9e2hvc3RuYW1lOmkuaG9zdG5hbWUscG9ydDo0NDMscGF0aDppLnBhdGhuYW1lK2kuc2VhcmNoLG1ldGhvZDplLm1ldGhvZHx8IkdFVCIsaGVhZGVyczplLmhlYWRlcnN9LG89Yi5yZXF1ZXN0KGEsKHQ9PntsZXQgZT0iIjt0Lm9uKCJkYXRhIiwodD0+ZSs9dCkpLHQub24oImVuZCIsKCgpPT57Y29uc3R7c3RhdHVzQ29kZTpuLHN0YXR1c01lc3NhZ2U6aX09dCxhPW4+PTIwMCYmbjwzMDAsbz17b2s6YSxzdGF0dXM6bixzdGF0dXNUZXh0Oml9O2EmJihvLmpzb249KCk9PkpTT04ucGFyc2UoZSkpLHIobyl9KSl9KSk7by5vbigiZXJyb3IiLCh0PT57bih0KX0pKSxlLmJvZHkmJm8ud3JpdGUoZS5ib2R5KSxvLmVuZCgpfSkpfSxtPWU9PnQucG9zdE1lc3NhZ2Uoe2RhdGE6ZX0pfWNvbnN0IHg9bmV3IE1hcH0oKTsKCg==\",void 0!==(zd=!1)&&zd),Od=Ud.indexOf(\"\\n\",10)+1,Qd=Ud.substring(Od)+(jd?\"\\/\\/# sourceMappingURL=\"+jd:\"\"),function(e){return new Fd(Qd,Object.assign({},e,{eval:!0}))});globalThis.WebSocket=Wc;const Dd=P,Bd=\"node\"===C;console.log(\"Croquet \"+Dd);const Ad=!Bd;let $d=null;function qd(e){const t=e.lastIndexOf(\":\"),r=-1===t?e:e.slice(t+1),s=-1===t?\"\":e.slice(0,t);let n=H.backend||s;const i=H.reflector?.includes(\"/\");if(\"none\"===n||i||$d.offline)return{apiKey:r,signServer:\"none\",reflector:\"overridden\"};if(!n&&!Bd)switch(window.location.hostname){case\"croquet.dev\":n=\"dev\";break;case\"staging.croquet.io\":n=\"staging\"}let o;switch(n){case\"\":case\"prod\":o=\"croquet.io\";break;case\"staging\":o=\"staging.croquet.io\";break;case\"dev\":o=\"croquet.dev\";break;default:o=`${n}.croquet.dev`}return{apiKey:r,signServer:`https://api.${o}/sign`,reflector:`wss://api.${o}/reflector/v1`}}const eh=H.nocheat,th=[0];let rh;const sh=new Jd;sh.onerror=e=>console.error(`UploadWorker error: ${e.message}`);let nh=0;const ih=new Set;function oh(e){for(const t of ih)if(t.id===e){const{appId:e,persistentId:r}=t.sessionSpec;return{appId:e,persistentId:r,uploadEncrypted:e=>t.uploadEncrypted(e),downloadEncrypted:e=>t.downloadEncrypted(e)}}return{}}class ah{constructor(){!function(){const e=H.dev||!1!==H.dev&&\"localhost\",t=H.dev||!1!==H.dev&&Ad;$d={messages:H.has(\"debug\",\"messages\",!1),sends:H.has(\"debug\",\"sends\",!1),ticks:H.has(\"debug\",\"ticks\",!1),pong:H.has(\"debug\",\"pong\",!1),snapshot:H.has(\"debug\",\"snapshot\",!1),session:H.has(\"debug\",\"session\",!1),initsnapshot:H.has(\"debug\",\"initsnapshot\",e),reflector:H.has(\"debug\",\"reflector\",t),offline:H.has(\"debug\",\"offline\",H.offline)},$d.offline&&ie.showMessage(\"Croquet: offline mode enabled, no multiuser\",{level:\"warning\"})}(),this.reset()}reset(){globalThis.CROQUETVM===this.vm&&delete globalThis.CROQUETVM,this.vm=null,this.session=null,this.connection=this.connection||new lh(this),this.networkQueue=[],this.reflectorTime=0,this.msPerTick=this.msPerTick||0,this.tickMultiplier=this.tickMultiplier||1,this.extrapolatedTimeBase=Date.now(),this.key=this.key||null,this.tove=this.tove||null,this.viewId=this.viewId||Math.floor(Math.random()*36**10).toString(36),this.timeline=\"\",this.rejoinTimeout&&clearTimeout(this.rejoinTimeout),this.rejoinTimeout=0,this.sendBuffer=[],this.users=0,this.usersTotal=0,this.cpuTime=0,this.triggeringCpuTime=null,this.synced=null,this.latency=0,this.latencyHistory&&(this.latencyHistory=[]),this.localTicker&&(globalThis.clearInterval(this.localTicker),delete this.localTicker),this.syncTimer&&(globalThis.clearTimeout(this.syncTimer),delete this.syncTimer),this.tuttiHistory=[],this.lastAnimationEnd=0,this.animationGapCheck=[],this.rateLimitedSendTimes=[],this.rateLimitBuffer=[],this.rateLimitSoftWarned=!1,this.rateLimitBufferWarned=!1,this.rateLimitLastLogged=0,this.payloadSizeWarned=!1,ae.removeAllSubscriptionsFor(this.viewId),ae.addSubscription(this.viewId,\"__peers__\",this.viewId,(e=>se(`users now ${e.count}`)),\"oncePerFrameWhileSynced\"),this.leaving||ie.showSyncWait(!0)}get id(){return this.vm?this.vm.id:this.sessionSpec.id}get persistentId(){return this.sessionSpec.persistentId}get versionId(){return this.sessionSpec.codeHash}get extrapolatedTime(){return Date.now()-this.extrapolatedTimeBase}get viewOnly(){return this.sessionSpec.viewOnly}get backlog(){return this.vm?this.reflectorTime-this.vm.time:0}get starvation(){return Date.now()-this.lastReceived}get lag(){return this.vm?Math.max(0,this.extrapolatedTime-this.vm.time-this.msPerTick):0}get activity(){return Date.now()-this.lastSent}get viewed(){return!(!this.session||!this.session.view)}get connected(){return this.connection.connected}get shouldLeaveWhenDisconnected(){return this.leaving||!this.canRejoinSeamlessly||0===this.sessionSpec.rejoinLimit}get canRejoinSeamlessly(){return!!this.timeline}checkForConnection(e){this.connection.checkForConnection(e)}dormantDisconnect(){this.connected&&this.connection.dormantDisconnect()}async initFromSessionSpec(e){const{name:t,optionsFromUrl:r,password:s,appId:n,apiKey:i,viewIdDebugSuffix:o}=e,a=n?`${n}/${t}`:t;o&&(this.viewId=this.viewId.replace(/_.*$/,\"\")+\"_\"+encodeURIComponent((\"\"+o).slice(0,16)).replace(/[^a-z0-9]/gi,(e=>`_${\"%\"===e?\"\":e.charCodeAt(0).toString(16).toUpperCase()}`)));const l={...e.options};if(r)for(const e of r)e in H&&(l[e]=H[e]);const c={};for(const t of[\"hashOverride\"])t in H?c[t]=H[t]:t in e&&(c[t]=e[t]);this.key=Cn(s,\"\",{keySize:8});const d=await async function(e,t){return $(e+E(t))}(a,l),{developerId:h,token:u}=await this.verifyApiKey(i,n,d),{id:f,codeHash:p,computedCodeHash:m}=await async function(e,t,r,s){let n,i;const o=ee[e];let a=\"\";o?(n=o.codeHashes,i=o.computedCodeHash,a=\" (code hashing from cache)\"):(n=await Promise.all(q),i=await $([s,...n].join(\"|\")),ee[e]={codeHashes:n,computedCodeHash:i});const{hashOverride:l,...c}=r,d=l||i,h=await $(e+\"|\"+t+E(c)+d);if(D()&&!te.has(h)){B[i].what=\"Version ID\",B[e].what=\"Persistent ID\",B[h].what=\"Session ID\",d!==i&&(n.push(i),B[i].what=\"Computed Version ID (replaced by overrideHash)\",B[d]={what:\"Version ID (as specified by overrideHash)\"});const t=[...n,d,e,h].map((e=>({hash:e,...B[e]})));console.log(`Croquet: Debug Hashing for session ${h}${a}`,t),te.add(h)}return D()||(B={}),{id:h,persistentId:e,codeHash:d,computedCodeHash:i}}(d,h,c,Dd);this.tove=await this.encrypt(f),$d.session&&console.log(`Croquet session \"${a}\":\\n        sessionId=${f}${n?`\\n        persistentId=${d}`:\"\"}\\n        versionId=${p===m?p:`${p} (specified in hashOverride)\\n        versionId=${m} (computed)`}\\n        viewId=${this.viewId}`),this.eventRateLimit=e.eventRateLimit,this.eventHistoryLimit=this.eventRateLimit,this.eventMaxBundles=this.eventRateLimit,this.sessionSpec={...e,options:l,name:a,id:f,persistentId:d,developerId:h,token:u,codeHash:p,computedCodeHash:m};const{msPerTick:b,multiplier:y}=this.getTickAndMultiplier();this.msPerTick=b,this.tickMultiplier=y,this.setUpActivityChecks()}async establishSession(){const{id:e,persistentId:t,codeHash:r}=this.sessionSpec;this.sessionSpec.snapshot={id:e,time:0,meta:{id:e,persistentId:t,codeHash:r,created:(new Date).toISOString()}};const s=new Promise((e=>this.sessionSpec.sessionJoined=e));this.checkForConnection(!1),$d.session&&console.log(e,\"waiting for SYNC\"),await s}async verifyApiKey(e,t,r){const{signServer:s,apiKey:n}=qd(e);if(\"none\"===s)return{developerId:\"unknown_dev_id\"};try{const e=await Ed(`${s}/join?meta=login`,{method:\"GET\",mode:\"cors\",headers:{\"X-Croquet-Auth\":n,\"X-Croquet-App\":t,\"X-Croquet-Id\":r,\"X-Croquet-Version\":Dd,\"X-Croquet-Path\":new URL(ie.referrerURL()).pathname},referrer:ie.referrerURL(),referrerPolicy:\"no-referrer-when-downgrade\"}),{error:i,developerId:o,token:a}=await e.json();if(i)throw Error(i);return $d.session&&console.log(\"Croquet: verified API key\"),{developerId:o,token:a}}catch(t){throw Error(`Croquet API key validation failed for \"${e}\": ${t.message}`)}}lastKnownTime(e){return Math.max(e.time,e.externalTime)}takeSnapshot(){const e=this.vm.snapshot(),t=this.lastKnownTime(e),r=e.externalSeq;return e.meta={...this.sessionSpec.snapshot.meta,options:this.sessionSpec.options,time:t,seq:r,date:(new globalThis.CroquetViewDate).toISOString(),host:\"localhost\",sdk:Dd},delete e.meta.hash,e}takeSnapshotHandleErrors(){let e,t,r;try{e=Xn.begin(\"snapshot\"),r=this.takeSnapshot()}catch(e){return ne(\"snapshot\",e),null}finally{t=Xn.end(\"snapshot\")-e}return $d.snapshot&&console.log(this.id,`snapshot taken in ${Math.ceil(t)} ms`),r}scheduleSnapshot(){if(!this.connected||!this.vm||this.viewOnly)return;const e=this.vm.time,t=e-this.vm.lastSnapshotPoll;if(t<5e3)return void($d.snapshot&&console.log(`not requesting snapshot poll (${t}ms since poll scheduled)`));const r=new Yh(e,0,\"_\",\"handlePollForSnapshot\",[]);this.sendTagged(r,{debounce:5e3,msgID:\"pollForSnapshot\"}),$d.snapshot&&console.log(this.id,\"requesting snapshot poll via reflector\")}handlePollForSnapshot(e){if(!0!==this.synced||this.viewOnly)return void(this.triggeringCpuTime=null);const t=this.triggeringCpuTime||this.cpuTime;let r,s,n;this.triggeringCpuTime=null,this.cpuTime=0;try{r=Xn.begin(\"snapshot\"),s={cpuTime:t,hash:this.vm.getSummaryHash(),viewId:this.viewId}}catch(e){return void ne(\"snapshot\",e)}finally{n=Xn.end(\"snapshot\")-r,this.cpuTime-=n}$d.snapshot&&console.log(this.id,`Summary hashing took ${Math.ceil(n)}ms`),Promise.resolve().then((()=>this.pollForSnapshot(e,s)))}pollForSnapshot(e,t){t.cpuTime+=Math.random(),$d.snapshot&&console.log(this.id,\"sending snapshot vote\",t),this.sendTutti({time:e,topic:\"snapshot\",data:t,tallyTarget:[\"handleSnapshotVote\"]})}handleSnapshotVote(e){const{tally:t}=e;$d.snapshot&&console.log(this.id,\"received snapshot votes\",t);const{numberOfGroups:r,shouldUpload:s,dissidentFlag:n}=this.analyzeTally(t,\"cpuTime\");if(r>1){this.diverged=!0;const e=this.vm.diverged?this.vm.diverged.size:0;console.error(this.id,`Session diverged (#${e})! Snapshots fall into ${r} groups`)}if(!0===this.synced){if(s){const e=this.takeSnapshotHandleErrors();e&&Promise.resolve().then((()=>this.uploadSnapshot(e,n)))}}else $d.snapshot&&console.log(this.id,\"Ignoring snapshot vote during sync\")}analyzeTally(e,t){let r=!1,s=null;const n=[],i={};let o=null;Object.keys(e).forEach(((e,t)=>{const r=JSON.parse(e);n.push(r);const{hash:s,viewId:a}=r;a===this.viewId&&(o=t),i[s]||(i[s]=[]),i[s].push(t)}));const a=Object.keys(i),l=a.length;let c=0;l>1&&(a.sort(((e,t)=>i[t].length-i[e].length)),i[a[0]].length===i[a[1]].length&&($d.snapshot&&console.log(this.id,\"Deciding consensus by tie-break\"),a[1]<a[0]&&(c=1)));const d=a[c];if(null!==o){const e=n[o].hash,a=i[e];a.length>1&&a.sort(((e,r)=>n[e][t]-n[r][t])),a[0]===o&&(r=!0,e!==d&&(s={groupVotes:a.length,allVotes:n.length}))}return{numberOfGroups:l,shouldUpload:r,dissidentFlag:s}}snapshotPath(e,t,r){const s=Math.ceil(e).toString().padStart(10,\"0\"),{appId:n,persistentId:i,codeHash:o,apiKey:a}=this.sessionSpec;return a?`apps/${n}/snap/${o}/${i}.${this.id}/${s}_${t}.${r}`:`snapshots/${this.id}/${s}_${t}-${r}.snap`}hashSnapshot(e){return e.meta.hash?e.meta.hash:(e.meta.hashPromise||(e.meta.hashPromise=new Promise((t=>{const r={...e};delete r.meta,$(JSON.stringify(r)).then((r=>{e.meta.hash=r,delete e.meta.hashPromise,t(r)}))}))),e.meta.hashPromise)}uploadServer(e){if(\"string\"==typeof H.files){let e=new URL(H.files,window.location).href;return e.endsWith(\"/\")&&(e=e.slice(0,-1)),{url:e,apiKey:null}}const{apiKey:t,signServer:r}=qd(e);if(\"none\"===r&&!$d.offline)throw Error(\"no file server configured\");return{url:r,apiKey:t}}async uploadSnapshot(e,t=null){await this.hashSnapshot(e);const r=Xn.begin(\"snapshot\"),s=JSON.stringify(e),n=Xn.end(\"snapshot\")-r;$d.snapshot&&console.log(this.id,`snapshot stringified (${s.length} bytes) in ${Math.ceil(n)}ms`);const{time:i,seq:o,hash:a}=e.meta,l=this.connection.socket;try{const e=await this.uploadEncrypted({content:s,path:this.snapshotPath(i,o,a),key:this.key,gzip:!0,debug:$d.snapshot,what:\"snapshot\"});return this.connection.socket!==l?(console.warn(this.id,\"Controller was reset while trying to upload snapshot\"),!1):(this.announceSnapshotUrl(i,o,a,e,t),!0)}catch(e){return console.error(this.id,\"Failed to upload snapshot\"),!1}}announceSnapshotUrl(e,t,r,s,n){if($d.snapshot){let i=`time: ${e}, seq: ${t}, hash: ${r}`;n&&(i+=\", as dissident; \"+JSON.stringify(n)),console.log(this.id,`sending snapshot url to reflector (${i}): ${s}`)}try{this.connection.send(JSON.stringify({id:this.id,action:\"SNAP\",args:{time:e,seq:t,hash:r,url:s,dissident:n}}))}catch(e){console.error(\"ERROR while sending\",e)}this.diverged&&this.vm.publishFromView(\"__VM__\",\"__diverged__\",{key:`@${e}#${t}`,url:s,dissident:n})}async diffDivergedSnapshots(e){const t=await Promise.all(e.map((e=>this.downloadEncrypted({url:e,gzip:!0,key:this.key,debug:$d.snapshot,json:!0,what:\"diverged snapshot\"}))));for(const e of t)delete e.meta;let r=0;!function e(t,s,n){if(typeof t!=typeof s)console.log(`${n} diverged (${typeof t} vs ${typeof s}):`,t,s),r++;else if(Array.isArray(t)!==Array.isArray(s))console.log(`${n} diverged (array vs object):`,t,s),r++;else if(\"object\"==typeof t){const i=t?Object.keys(t):[],o=s?Object.keys(s):[],a=i.filter((e=>!o.includes(e))),l=o.filter((e=>!i.includes(e)));(a.length||l.length)&&(console.log(`${n} diverged (keys mismatch):`,a,l),r++);for(const r of i)if(o.includes(r)){const i=Array.isArray(t)?`[${r}]`:r.match(/^[a-z_$][a-z0-9_$]*$/i)?`.${r}`:`[\"${r}\"]`;e(t[r],s[r],`${n}${i}`)}}else t!==s&&(console.log(`${n} diverged (value mismatch):`,t,s),r++)}(t[0],t[1],\"CROQUETVM\"),r?console.log(`Total ${r} differences between diverged snapshots:`,t.slice(0,2)):console.log(\"... but diverged snapshots are identical?!\")}async downloadEncrypted({url:e,gzip:t,key:r,debug:s,json:n,what:i}){e.startsWith(\"https://croquet.io/files/v1\")&&(e=e.replace(\"https://croquet.io/files/v1\",\"https://files.croquet.io\"));const o=e.startsWith(\"offline:\");let a=Date.now();const l=await(o?this.fetchOffline(e,i,s):Ed(e,{method:\"GET\",mode:\"cors\",headers:{\"X-Croquet-App\":this.sessionSpec.appId,\"X-Croquet-Id\":this.sessionSpec.persistentId,\"X-Croquet-Session\":this.sessionSpec.id,\"X-Croquet-Version\":Dd},referrer:ie.referrerURL()})),c=await l.arrayBuffer();s&&console.log(this.id,`${i} fetched (${c.byteLength} bytes) in ${-a+(a=Date.now())}ms`),Xn.addNetworkTraffic(`${i}_in`,c.byteLength);const d=this.decryptBinary(c,r);s&&console.log(this.id,`${i} decrypted (${d.length} bytes) in ${-a+(a=Date.now())}ms`);const h=t?Ma.inflate(d):d;return s&&t&&console.log(this.id,`${i} inflated (${h.length} bytes) in ${-a+(a=Date.now())}ms`),n?JSON.parse((new TextDecoder).decode(h)):h}async fetchOffline(e,t,r){const s=++nh;return new Promise(((n,i)=>{sh.postMessage({job:s,cmd:\"getOfflineFile\",url:e,id:this.id,what:t,debug:r,offline:$d.offline});const o=e=>{if(s!==e.data.job)return;const{ok:r,status:a,statusText:l,body:c,bytes:d}=e.data;Xn.addNetworkTraffic(`${t}_out`,d),sh.removeListener(\"message\",o),r?n({arrayBuffer:()=>c}):i(Error(`${a}: ${l}`))};try{sh.addListener(\"message\",o)}catch(e){console.log(\"failed to add listener\",e)}}))}async uploadEncrypted({content:e,path:t,key:r,gzip:s,keep:n,debug:i,what:o}){const a=\"string\"==typeof e?(new TextEncoder).encode(e).buffer:e,l=n?void 0:[a],c=\"string\"==typeof r?r:xn.stringify(r),{apiKey:d,appId:h,persistentId:u}=this.sessionSpec,f=++nh;return new Promise(((e,r)=>{sh.postMessage({job:f,cmd:\"uploadEncrypted\",server:this.uploadServer(d),path:t,buffer:a,keyBase64:c,gzip:s,referrer:ie.referrerURL(),id:this.id,appId:h,persistentId:u,CROQUET_VERSION:Dd,debug:i,what:o,offline:$d.offline},l);const n=t=>{if(f!==t.data.job)return;const{url:s,ok:i,status:a,statusText:l,bytes:c}=t.data;Xn.addNetworkTraffic(`${o}_out`,c),sh.removeListener(\"message\",n),i?e(s):r(Error(`${a}: ${l}`))};try{sh.addListener(\"message\",n)}catch(e){console.log(\"failed to add listener\",e)}}))}persistentPath(e){const{appId:t,persistentId:r}=this.sessionSpec;return`apps/${t}/${r}/save/${e}`}pollForPersist(e,t,r,s,n){if(!this.synced)return;if(!this.sessionSpec.appId)throw Error(\"Persistence API requires appId\");if($d.offline)return;const i={viewId:this.viewId,hash:s,ms:n+.001*Math.random()},o={persistTime:t,persistentHash:s,persistentString:r};$d.snapshot&&console.log(this.id,`sending persistence vote for time @${t}`,i),this.sendTutti({time:e,topic:\"persist\",data:i,localContext:o,tallyTarget:[\"handlePersistVote\"]})}async handlePersistVote(e){const{tally:t,localContext:r}=e;if($d.snapshot){const e=!!r?`for time @${r.persistTime}`:\"that we didn't participate in\";console.log(this.id,`received persistence vote ${e}`,t)}const{numberOfGroups:s,shouldUpload:n,dissidentFlag:i}=this.analyzeTally(t,\"ms\");if(s>1&&console.warn(this.id,`Persistence records fall into ${s} groups`),!n||!r)return;const{persistTime:o,persistentHash:a,persistentString:l}=r,c=await this.uploadEncrypted({path:this.persistentPath(a),content:l,key:this.key,gzip:!0,debug:$d.snapshot,what:\"persistence\"});if($d.snapshot){const e=i?` (as dissident; ${JSON.stringify(i)})`:\"\";console.log(this.id,`sending persistent data url to reflector${e}: ${c}`)}try{this.connection.send(JSON.stringify({id:this.id,action:\"SAVE\",args:{persistTime:o,url:c,dissident:i}}))}catch(e){console.error(\"ERROR while sending\",e)}}convertReflectorMessage(e){let t=\"noop\",r=[];switch(e[2].what){case\"users\":{const{joined:s,left:n,active:i,total:o}=e[2];this.users=i,this.usersTotal=o;const a=\"__peers__\",l={entered:s||[],exited:n||[],count:i};t=\"publishFromModelOnly\",r=[\"__VM__\",a,l],ae.handleEvent(this.viewId+\":\"+a,l);break}case\"tally\":{const{tuttiSeq:s,tuttiKey:n,tally:i,tallyTarget:o,missingClients:a}=e[2];($d.messages||$d.snapshot)&&a&&console.log(`${a} ${1===a?\"client\":\"clients\"} failed to participate in tally ${n||s}`),t=\"handleTuttiResult\",r=[{tuttiSeq:s,tuttiKey:n,tally:i,tallyTarget:o}];break}}const s=new Yh(0,0,\"_\",t,r);e[2]=s.asState()[2]}handleTuttiResult(e){const{tuttiSeq:t,tuttiKey:r,tally:s,tallyTarget:n}=e,i=r?e=>e.tuttiKey===r:e=>e.dummyTuttiSeq===t,o=this.tuttiHistory.findIndex(i),a=-1!==o&&this.tuttiHistory.splice(o,1)[0];let l=null,c=null;if(a&&(l=a.payload,c=a.localContext),n){const[e,...t]=n,r=[...t,{tally:s,localPayload:l,localContext:c}],i=new Yh(0,0,\"_\",e,r);this.vm.verifyExternal(i),i.executeOn(this.vm,!0)}}async receive(e,t){const r=this.lastReceived;switch(this.lastReceived=this.connection.lastReceived,e){case\"SYNC\":{this.syncReceived=!0,this.clearSyncReceiptTimeout(),ih.add(this);const{progressReporter:e}=this.sessionSpec,r=e||(()=>{}),{messages:s,url:n,persisted:i,time:o,seq:a,snapshotSeq:l,tove:c,reflector:d,flags:h}=t;if(c&&c!==this.tove)try{if(this.decrypt(c)!==this.id)throw Error(\"wrong sessionId in tove?!\")}catch(e){return this.connection.closeConnectionWithError(\"SYNC\",Error(`session password check: ${e.message}`),4200),void r(-1)}const u=t.timeline||t.reflectorSession;this.flags=h||{};const f=i?\"persistence\":\"snapshot\";$d.session&&console.log(this.id,`received SYNC from ${d} reflector: time ${o}, ${s.length} messages, ${f} ${n||\"<none>\"}`);let p=!!this.vm;if(p){this.networkQueue.length=0;const e=!!u&&u===this.timeline,t=s[0],r=a,n=void 0!==l?l:t?t[1]:r;$d.messages&&console.log(this.id,`rejoin: we have #${this.vm.seq} SYNC has #${n}-#${r}`);let i=e&&Vh(n,this.vm.seq)&&Vh(this.vm.seq,r)&&o>=this.reflectorTime;if(i){let e=0;t&&Vh(t[1],this.vm.seq)&&(e=this.vm.seq-t[1]+1>>>0);for(let t=e;i&&t<s.length;t++){const e=s[t][2];\"string\"!=typeof e&&\"users\"===e.what&&e.left&&e.left.includes(this.viewId)&&($d.session&&console.log(this.id,\"reflector reports that this view has left\"),i=!1)}i&&e&&($d.messages&&console.log(this.id,`rejoin: discarding ${e} messages #${t[1]}-#${this.vm.seq}`),s.splice(0,e))}if(i){if(this.sendBuffer.length>0){const e=this.sendBuffer;this.sendBuffer=[],$d.session&&console.log(this.id,`rejoin: sending ${e.length} messages buffered while disconnected`);for(const t of e)t()}}else $d.session&&console.log(this.id,\"cannot rejoin seamlessly; rebooting model/view\"),this.leave(!0),p=!1}const m=this.networkQueue;this.networkQueue=[];for(const e of s){if(\"string\"!=typeof e[2])this.convertReflectorMessage(e);else try{e[2]=this.decryptPayload(e[2])[0]}catch(e){return this.connection.closeConnectionWithError(\"SYNC\",Error(`session password decrypt: ${e.message}`),4200),void r(-1)}$d.messages&&console.log(this.id,\"received in SYNC \"+JSON.stringify(e)),this.networkQueue.push(e)}if(this.networkQueue.push(...m),o>this.reflectorTime&&this.timeFromReflector(o,\"reflector\"),p)return $d.session&&console.log(this.id,\"seamless rejoin successful\"),void this.sessionSpec.sessionJoined();let b;if(this.timeline=u||\"\",$d.snapshot&&n&&console.log(`${this.id} fetching ${f} ${n}`),n)try{b=await this.downloadEncrypted({url:n,gzip:!0,key:this.key,debug:$d.snapshot,json:!0,what:f})}catch(e){return this.connection.closeConnectionWithError(\"SYNC\",Error(`failed to fetch ${f}: ${e.message}`),4200),void r(-1)}if(!this.connected)return console.log(this.id,\"disconnected during SYNC\"),void r(-1);i?this.install(b):(b&&(this.sessionSpec.snapshot=b),this.install()),$d.session&&console.log(`${this.id} fast-forwarding from ${Math.round(this.vm.time)} to at least ${o}`);const y=this.vm.time,g=await new Promise((e=>{const{port1:t,port2:s}=new MessageChannel;t.onmessage=()=>{let t=!0;if(this.vm.time===this.reflectorTime)this.viewId in this.vm.views&&(r(1),e(!0),t=!1);else{const e=(this.vm.time-y)/(this.reflectorTime-y);r(e)}t&&this.stepSession(\"fastForward\",{budget:200})};this.fastForwardHandler=t=>{this.connected&&this.vm?\"error\"===t?(r(-1),e(!1)):s.postMessage(\"tick\"):(console.log(this.id,\"disconnected during SYNC fast-forwarding\"),r(-1),e(!1))},Promise.resolve().then((()=>this.stepSession(\"fastForward\",{budget:200})))}));return delete this.fastForwardHandler,g&&$d.session&&console.log(`${this.id} fast-forwarded to ${Math.round(this.vm.time)}`),g&&this.vm.diverged&&ie.showMessage(\"Croquet: session had diverged\",{level:\"warning\",only:\"once\"}),void(g&&this.sessionSpec.sessionJoined())}case\"RECV\":{const e=t;if(e[1]>>>=0,\"string\"!=typeof e[2])$d.messages&&console.log(this.id,\"received META \"+JSON.stringify(e)),this.convertReflectorMessage(e),$d.messages&&console.log(this.id,\"converted to \"+JSON.stringify(e));else try{const[t,r,s]=this.decryptPayload(e[2]);e[2]=t,r===this.viewId&&this.addToStatistics(s,this.lastReceived),$d.messages&&console.log(this.id,\"received \"+JSON.stringify(e))}catch(e){return void this.connection.closeConnectionWithError(\"RECV\",Error(`session password decrypt: ${e.message}`),4200)}let r;return this.networkQueue.push(e),this.flags.rawtime&&(r=e[e.length-1]),this.timeFromReflector(e[0],\"reflector\",r),void(this.simulateIfNeeded&&Promise.resolve().then((()=>this.simulateIfNeeded())))}case\"TICK\":{if(!this.vm)return;const e=\"number\"==typeof t?t:t.time;if($d.ticks){const t=r&&this.lastReceived-r-this.msPerTick*this.tickMultiplier|0;console.log(this.id,`Controller received TICK ${e} ${Math.abs(t)<5?\"on time\":t<0?\"early\":\"late\"} (${t} ms)`)}return this.timeFromReflector(e,\"reflector\"),this.tickMultiplier>1&&this.multiplyTick(e),void(this.simulateIfNeeded&&Promise.resolve().then((()=>this.simulateIfNeeded())))}case\"INFO\":{const{msg:e,options:r}=t;return void ie.showMessage(e,r)}case\"REQU\":return $d.snapshot&&console.log(\"received REQU (snapshot request) from reflector\"),void(this.cpuTime=12345);default:console.warn(\"Unknown action:\",e,t)}}install(e){const t=Date.now(),{snapshot:r,initFn:s,options:n}=this.sessionSpec,[i,o]=r.modelsById?[\"deserializ\",\"snapshot\"]:[\"initializ\",\"root model\"];$d.session&&console.log(`${this.id} ${i}ing ${o}`);let a=new Ph(r,(()=>{try{return s(n,e)}catch(e){throw ne(\"init\",e,\"fatal\"),e}}));if(($d.session||$d.snapshot&&r.modelsById)&&console.log(`${this.id} ${o} ${i}ed in ${Date.now()-t}ms`),$d.initsnapshot&&!r.modelsById){$d.snapshot&&console.log(`${this.id} exercising snapshot and restore after init()`);let e=null;try{e=JSON.stringify(a.snapshot())}catch(e){throw ne(\"initial snapshot\",e,\"fatal\"),e}try{a=new Ph(JSON.parse(e),(()=>s(n)))}catch(e){throw ne(\"initial snapshot resume\",e,\"fatal\"),e}}const l=this.lastKnownTime(a);this.reflectorTime=Math.max(this.reflectorTime,l),this.setVM(a)}setVM(e){this.vm=e,this.vm.controller=this}sendJoin(){this.syncReceived=!1,delete this.fastForwardHandler,this.rejoinTimeout&&(clearTimeout(this.rejoinTimeout),this.rejoinTimeout=0),$d.session&&console.log(this.id,\"Controller sending JOIN\");const{tick:e,delay:t}=this.getTickAndMultiplier(),{name:r,codeHash:s,appId:n,apiKey:i,persistentId:o,developerId:a,heraldUrl:l,rejoinLimit:c,autoSleep:d,computedCodeHash:h,location:u,flags:f}=this.sessionSpec,{apiKey:p}=qd(i),m=u?[this.viewId]:this.viewId,b={name:r,apiKey:p,appId:n,persistentId:o,url:ie.referrerURL(),sdk:Dd,developerId:a,version:1,user:m,location:u,ticks:{tick:e,delay:t},dormantDelay:d,tove:this.tove,codeHash:s};l&&Object.assign(b,{heraldUrl:l}),c&&Object.assign(b,{leaveDelay:c+250}),h!==s&&Object.assign(b,{computedCodeHash:h}),f&&Object.assign(b,{flags:f}),this.connection.send(JSON.stringify({id:this.id,action:\"JOIN\",args:b})),this.syncReceiptTimeout=setTimeout((()=>{delete this.syncReceiptTimeout,this.syncReceived||this.connection.closeConnectionWithError(\"JOIN\",Error(\"Initial reflector connection timed out\"))}),5e3)}clearSyncReceiptTimeout(){this.syncReceiptTimeout&&(clearTimeout(this.syncReceiptTimeout),delete this.syncReceiptTimeout)}connectionInterrupted(){this.syncReceived&&(this.shouldLeaveWhenDisconnected?this.leave():this.rejoinTimeout||(this.rejoinTimeout=setTimeout((()=>{$d.session&&console.log(this.id,\"rejoin timed out\"),this.rejoinTimeout=0,this.leave()}),this.sessionSpec.rejoinLimit)))}leave(e=!1){const{rebootModelView:t}=this.sessionSpec;if(this.reset(),$d.session&&console.log(this.id,`resetting ${e?\"(but keeping)\":\"and discarding\"} controller`),e||ih.delete(this),!this.sessionSpec)throw Error(\"do not discard sessionSpec!\");t()}async encrypt(e){const t=N.random(16),r=Hn.encrypt(e,this.key,{iv:t}),s=En(e,this.key);return`${xn.stringify(t)}${xn.stringify(s)}${r}`}get deprecatedDefaultKey(){return rh||(rh=Cn(\"THIS SHOULDN'T BE IN LOGS\",\"\",{keySize:8})),rh}decrypt(e,t=this.key){const r=xn.parse(e.slice(0,24)),s=xn.parse(e.slice(24,68)),n=e.slice(68),i=Hn.decrypt(n,t,{iv:r});let o=\"\";try{o=kn.stringify(i)}catch(e){}const a=En(o,this.key);if(this.compareHmacs(s.words,a.words))return o;if(t!==this.deprecatedDefaultKey)return this.decrypt(e,this.deprecatedDefaultKey);throw Error(\"Decryption error\")}decryptBinary(e,t){const r=(new TextDecoder).decode(new Uint8Array(e,0,4));let s,n,i,o,a;switch(\"string\"==typeof t&&(t=xn.parse(t)),r){case\"CRQ0\":s=(new TextDecoder).decode(e),n=xn.parse(s.slice(4,28)),i=xn.parse(s.slice(28,72)),o=s.slice(72),a=Hn.decrypt(o,t,{iv:n});break;case\"CRQ1\":s=new Uint8Array(e),n=N.create(s.subarray(4,20)),i=N.create(s.subarray(20,52)),o=N.create(s.subarray(52)),a=Hn.decrypt({ciphertext:o},t,{iv:n});break;default:throw Error(`${this.id} unknown encryption version ${r}`)}a.clamp();const l=En(a,t);if(this.compareHmacs(i.words,l.words))return O(a);if(t!==this.deprecatedDefaultKey)return this.decryptBinary(e,this.deprecatedDefaultKey);throw Error(\"Decryption error\")}async encryptMessage(e,t,r){const[s,n,i]=e.asState();return[s,n,await this.encryptPayload([i,t,r])]}async encryptPayload(e){return this.encrypt(JSON.stringify(e))}decryptPayload(e){return JSON.parse(this.decrypt(e))}compareHmacs(e,t){let r=e.length===t.length;for(let s=0;s<e.length;s++)e[s]!==t[s]&&(r=!1);return r}sendMessage(e){if(this.viewOnly||!this.vm)return;const t=e.asState()[2].length;if(t>16384)return void console.warn(`${this.id} Message with payload of ${t} bytes exceeds maximum 16384 and will not be sent to reflector.`);!this.payloadSizeWarned&&t>4096&&(console.log(`${this.id} Message with payload of ${t} bytes being sent to reflector. Maximum recommended is 4096.`),this.payloadSizeWarned=!0);const r=Date.now(),s=this.rateLimitedSendTimes,n=this.rateLimitBuffer;if(Xn.perSecondTally({requestedMessages:1}),n.length)return void this.addToRateLimitBuffer(e);let i=0;if(s.length&&this.synced){const e=s[s.length-1],t=1e3/this.eventRateLimit-(r-e);t>1&&(i=Math.ceil(t))}i?(this.addToRateLimitBuffer(e),setTimeout((()=>this.serviceRateLimitBuffer()),i)):(this.recordRateLimitedSend(r),this.socketSendMessage(e),Xn.perSecondTally({sentSingleMessages:1,sentMessagesTotal:1,sentPayloadTotal:t}))}recordRateLimitedSend(e){const t=this.rateLimitedSendTimes;!this.synced&&t.length&&t[t.length-1]===e||(t.push(e),t.length>this.eventHistoryLimit&&t.shift()),!this.rateLimitSoftWarned&&t.length===this.eventHistoryLimit&&e-t[0]<1010&&(console.warn(`${this.id} Sends to reflector are at or above recommended limit of ${this.eventHistoryLimit} within one second. Events will be bundled as necessary to keep to the limit.`),this.rateLimitSoftWarned=!0)}addToRateLimitBuffer(e){Xn.perSecondTally({bundledMessages:1});const t=Date.now(),r=e.asState(),s=r[2].length,n=this.rateLimitBuffer;if(n.length){const e=n[n.length-1],{msgStates:i,totalPayload:o}=e;if(o<4096)return i.push({msgState:r,bufferTime:t}),void(e.totalPayload+=s)}Xn.perSecondTally({newBundles:1}),n.push({msgStates:[{msgState:r,bufferTime:t}],totalPayload:s});const i=n.length;$d.session&&i%5==0&&i!==this.rateLimitLastLogged&&(console.log(`${this.id} SEND rate-limit buffer grew to ${i} event bundles (max ${this.eventMaxBundles})`),this.rateLimitLastLogged=i),i>this.eventMaxBundles?(console.error(`${this.id} Disconnecting after overflow of SEND rate-limit buffer.`),this.connection.closeConnectionWithError(\"SEND\",Error(\"Send rate exceeded\"),4200)):!this.rateLimitBufferWarned&&i>this.eventMaxBundles/2&&(console.warn(`${this.id} SEND rate-limit buffer is 50% full. If send rate does not drop, the app will be disconnected.`),this.rateLimitBufferWarned=!0)}serviceRateLimitBuffer(){if(!this.connected)return;const e=this.rateLimitBuffer;if(!e.length)return;const t=Date.now(),r=1e3/this.eventRateLimit,s=this.rateLimitedSendTimes;if(s.length){const e=s[s.length-1];if(r-(t-e)>0)return}const n=e.shift(),{msgStates:i,totalPayload:o}=n,a=[];let l=0;if(i.forEach((e=>{a.push(e.msgState),l+=t-e.bufferTime})),1===a.length){const e=Yh.fromState(a[0],this.vm);this.socketSendMessage(e)}else{const e=new Yh(this.vm.time,0,\"_\",\"handleBundledEvents\",[a]);this.socketSendMessage(e)}if(this.recordRateLimitedSend(t),Xn.perSecondTally({sentBundles:1,sentMessagesTotal:i.length,sendDelay:l,sentBundlePayload:o,sentPayloadTotal:o}),$d.session&&this.connected){const t=e.length;t&&t%5==0&&t!==this.rateLimitLastLogged&&(console.log(`${this.id} SEND rate-limit buffer dropped to ${t} event bundles`),this.rateLimitLastLogged=t)}e.length&&setTimeout((()=>this.serviceRateLimitBuffer()),r)}async socketSendMessage(e,t=null){const r=await this.encryptMessage(e,this.viewId,Date.now()),s=t?`tagged SEND ${e.asState()} with tags ${JSON.stringify(t)}`:`SEND ${e.asState()}`;if(!this.connected)return void(this.vm&&($d.sends&&console.log(this.id,`buffering ${s}`),this.sendBuffer.push((()=>this.socketSendMessage(e,t)))));$d.sends&&console.log(this.id,`sending ${s}`);const n={id:this.id,action:\"SEND\",args:[...r,this.latency]};t&&(n.tags=t),this.lastSent=Date.now(),this.connection.send(JSON.stringify(n))}async sendTagged(e,t){this.viewOnly||this.socketSendMessage(e,t)}async sendTutti({time:e,topic:t,data:r,localContext:s=null,firstMessage:n=null,wantsVote:i=!0,tallyTarget:o=null}){if(this.viewOnly)return;const a=n&&await this.encryptMessage(n,this.viewId,Date.now()),l=E(r);if(!this.connected)return void(this.vm&&($d.sends&&console.log(this.id,`buffering \"${t}\" TUTTI ${l} ${n&&n.asState()}`),this.sendBuffer.push((()=>this.sendTutti({time:e,topic:t,data:r,localContext:s,firstMessage:n,wantsVote:i,tallyTarget:o})))));$d.sends&&console.log(this.id,`sending \"${t}\" TUTTI ${l} ${n&&n.asState()}`),this.lastSent=Date.now();const c=`${t}@${e}`;this.connection.send(JSON.stringify({id:this.id,action:\"TUTTI\",args:[e,0,l,a,i,o,c]})),this.tuttiHistory.length>100&&this.tuttiHistory.shift(),this.tuttiHistory.push({time:e,tuttiKey:c,dummyTuttiSeq:0,payload:l,localContext:s})}sendLog(...e){this.connected?($d.sends&&console.log(this.id,\"sending LOG\"),e.length<2&&(e=e[0]),this.connection.send(JSON.stringify({action:\"LOG\",args:e}))):this.vm&&($d.sends&&console.log(this.id,\"buffering LOG\"),this.sendBuffer.push((()=>this.sendLog(...e))))}addToStatistics(e,t){this.latency=t-e,this.latencyHistory&&(this.latencyHistory.length>=100&&this.latencyHistory.shift(),this.latencyHistory.push({time:t,ms:this.latency}))}get latencies(){return this.latencyHistory||(this.latencyHistory=[]),this.latencyHistory}getTickAndMultiplier(){const e=this.sessionSpec.options,t=[\"number\",\"string\"].includes(typeof e.tps)?e.tps:[\"number\",\"string\"].includes(typeof this.sessionSpec.tps)?this.sessionSpec.tps:20,[r,s]=(t+\"x\").split(\"x\").map((e=>Number.parseFloat(\"0\"+e))),n=1e3/Math.max(1/30,Math.min(60,r)),i=Math.max(1,s);let o=n,a=0;return i>1&&!eh&&(o=n/i,a=Math.ceil(o*(i-1))),{msPerTick:o,multiplier:i,tick:n,delay:a}}simulate(e){if(!this.vm)return!0;try{let t=!0;if(this.networkQueue.length+this.vm.messages.size===0)t=this.vm.advanceTo(this.reflectorTime,e);else{const r=Xn.begin(\"simulate\");for(;t;){const r=this.networkQueue[0];if(!r)break;if(t=this.vm.advanceTo(r[0],e),!t)break;this.networkQueue.shift();const s=this.vm.scheduleExternalMessage(r);t=this.vm.advanceTo(s.time,e),this.cpuTime+=5}t&&(t=this.vm.advanceTo(this.reflectorTime,e)),this.cpuTime+=Math.max(.01,Xn.end(\"simulate\")-r)}Xn.backlog(this.backlog);const r=this.lag,s=Math.max(200,.1*this.msPerTick),n=Math.max(2e3,.2*this.msPerTick);if(\"boolean\"==typeof this.synced&&this.viewed&&(this.synced&&r>n||!this.synced&&r<s)){!this.synced?this.syncTimer||(this.syncTimer=setTimeout((()=>{delete this.syncTimer,this.connected&&this.lag<s&&this.applySyncChange(!0)}),200)):this.applySyncChange(!1)}return this.synced&&t&&this.cpuTime>5e3&&!$d.offline&&(this.triggeringCpuTime=this.cpuTime,this.cpuTime=0,this.isBeingAnimated()?setTimeout((()=>this.scheduleSnapshot()),Math.floor(2e3*Math.random())):this.scheduleSnapshot()),t}catch(e){return ne(\"simulate\",e),this.connection.closeConnectionWithError(\"simulate\",e),\"error\"}}stepSession(e,t={}){const r=Xn.stepSession(t.frameTime,!0);r&&console.log(r);const{backlog:s,latency:n,starvation:i,activity:o}=this;if(\"animation\"===e){Xn.animationFrame(t.frameTime,{backlog:s,starvation:i,latency:n,activity:o,users:this.users});const e=Date.now();if(this.lastAnimationEnd){const t=e-this.lastAnimationEnd;if(!0===this.animationGapCheck&&t>200&&(this.animationGapCheck=[],$d.session&&console.log(`${this.id} animation has stopped (too long between steps)`)),!0!==this.animationGapCheck){const e=this.animationGapCheck;e.push(t),e.length>4&&e.shift(),4===e.length&&e.reduce(((e,t)=>e+t),0)<=400&&(this.animationGapCheck=!0,$d.session&&console.log(`${this.id} animation has started`))}}this.lastAnimationEnd=e}if(!this.connected)return void(this.isInBackground()||this.checkForConnection(!0));if(!this.vm)return;let a;switch(e){case\"animation\":{const e=t.expectedSimFPS,r=Date.now(),s=th.reduce(((e,t)=>e+t),0)/th.length;if(a=this.simulate(r+Math.min(s,200)),!1===a){const t=0===e?0:1e3/e*4;this.backlog>t&&(a=this.simulate(r+200-s))}\"error\"!==a&&(th.push(Date.now()-r),th.length>4&&th.shift());break}case\"fastForward\":case\"background\":a=this.simulate(Date.now()+t.budget);break;default:console.warn(e)}this.fastForwardHandler&&this.fastForwardHandler(a),\"error\"!==a&&(Xn.begin(\"update\"),this.processModelViewEvents(\"animation\"===e),Xn.end(\"update\"),this.serviceRateLimitBuffer(),\"animation\"===e&&(t.view&&(Xn.begin(\"render\"),this.inViewRealm((()=>t.view.update(t.frameTime))),Xn.end(\"render\")),this.lastAnimationEnd=Date.now()))}applySyncChange(e){$d.session&&console.log(this.id,`synced=${e}`),this.synced=e,ie.showSyncWait(!e),this.vm.publishFromView(this.viewId,\"synced\",e)}inViewRealm(e){return pe(this.vm,(()=>e(this.vm)))}processModelViewEvents(e){return this.vm?this.vm.processModelViewEvents(e):0}timeFromReflector(e,t,r){e<this.reflectorTime?(\"controller\"!==t||$d.ticks)&&console.warn(`time is ${this.reflectorTime}, ignoring time ${e} from ${t}`):(\"boolean\"!=typeof this.synced&&(this.synced=!1),this.reflectorTime=e,this.extrapolatedTimeBase=Date.now()-e,this.vm&&Xn.backlog(this.backlog),this.tickHook&&this.tickHook(e,r))}multiplyTick(e){this.localTicker&&globalThis.clearInterval(this.localTicker);const t=this.msPerTick,r=this.tickMultiplier;let s=1;this.localTicker=globalThis.setInterval((()=>{this.timeFromReflector(Math.round(e+s*t),\"controller\"),$d.ticks&&console.log(this.id,\"Controller generate TICK \"+this.reflectorTime,s),++s>=r&&(globalThis.clearInterval(this.localTicker),this.localTicker=0)}),t)}startStepping(e){const t=r=>{this.leaving||(this.isOutOfSight()||e(r),window.requestAnimationFrame(t))};window.requestAnimationFrame(t)}setUpActivityChecks(){this.isOutOfSight=()=>!Bd,this.isBeingAnimated=()=>{const e=!0===this.animationGapCheck,t=Date.now()-this.lastAnimationEnd<200;return e&&!t&&(this.animationGapCheck=[],$d.session&&console.log(`${this.id} animation has stopped (too long since last step)`)),e&&t},this.isInBackground=()=>this.isOutOfSight()||!this.isBeingAnimated();const e=this.sessionSpec.autoSleep;let t;if(e){const r=1e3*e;let s=0,n=0;t=()=>{const e=Date.now();e-s<980||(s=e,this.isOutOfSight()?n?e-n>r&&(this.dormantDisconnect(),n=0):n=e:n=0)}}const r=()=>{this.leaving?s&&(clearInterval(s),s=null):this.connected&&this.vm&&(t&&t(),this.isBeingAnimated()||this.connection.keepAlive(Date.now()))};let s=setInterval(r,1e3);this.simulateIfNeeded=()=>{if(!this.isBeingAnimated()&&(r(),!this.fastForwardHandler&&this.connected)){let t=.9*this.msPerTick;e&&(t=Math.min(t,200));const r=this.synced?\"background\":\"fastForward\";this.stepSession(r,{budget:t})}}}toString(){return`Controller[${this.id}]`}[Symbol.toPrimitive](){return this.toString()}}class lh{constructor(e){this.controller=e,this.socketLastSent=0,this.connectBlocked=!1,this.connectRestricted=!1,this.connectHasBeenCalled=!1,this.reconnectDelay=0,this.missingTickThreshold=1/0}get id(){return this.controller.id}setTick(e){this.missingTickThreshold=Math.min(3*e,45e3)}get connected(){return!(!this.socket||this.socket.readyState!==WebSocket.OPEN)}checkForConnection(e){this.socket||this.connectHasBeenCalled||this.connectBlocked||this.connectRestricted&&!e||this.connectToReflector()}connectToReflector(){if(this.socket||this.connectHasBeenCalled)return;let e;if(this.connectHasBeenCalled=!0,this.connectBlocked=!1,this.connectRestricted=!1,$d.offline)e=new Ea;else{let t=qd(this.controller.sessionSpec.apiKey).reflector;const r=void 0,s={},n=this.controller.sessionSpec.token;if(n&&(s.token=n),H.reflector){const e=H.reflector.toUpperCase();\"CF\"===e||e.match(/^[A-Z]{3}$/)?(t=$d.reflector?\"wss://croquet.network/reflector/dev/\":\"wss://croquet.network/reflector/\",3===e.length&&(s.colo=e)):H.reflector.match(/^[-a-z0-9]+$/i)?s.region=H.reflector:t=new URL(H.reflector,r).href.replace(/^http/,\"ws\")}if(!t.match(/^wss?:/))throw Error(\"Cannot interpret reflector address \"+t);t.endsWith(\"/\")||(t+=\"/\");const i=new URL(t+this.id,r);for(const[e,t]of Object.entries(s))i.searchParams.append(e,t);e=new WebSocket(i)}e.onopen=t=>{const r=this.socket;r&&(r.onopen=r.onmessage=r.onerror=r.onclose=null),this.socket=e,this.connectHasBeenCalled=!1,$d.session&&console.log(this.id,this.socket.constructor.name,\"connected to\",this.socket.url),this.reconnectDelay=0,Xn.connected(!0),this.controller.sendJoin()},e.onmessage=t=>{Xn.addNetworkTraffic(\"reflector_in\",t.data.length),e===this.socket&&this.receive(t.data)},e.onerror=t=>{$d.session&&console.log(this.id,e.constructor.name,\"connection error\"),this.connectHasBeenCalled=!1,this.controller.clearSyncReceiptTimeout()},e.onclose=e=>{this.socketClosed(e.code,e.reason)}}socketClosed(e,t){this.controller.clearSyncReceiptTimeout();const r=1e3!==e&&e<4100,s=4110===e;s||1e3===e||this.reconnectDelay||setTimeout((()=>{this.connected||ie.showMessage(`Connection closed: ${e} ${t}`,{level:r?\"error\":\"fatal\"})}),500),$d.session&&console.log(this.id,`${this.socket?this.socket.constructor.name+\" closed\":\"closed before opening,\"} with code: ${e} ${t}`),Xn.connected(!1),s?this.connectRestricted=!0:this.connectBlocked=!0,this.disconnected(),r&&($d.session&&console.log(this.id,`reconnecting in ${this.reconnectDelay} ms`),this.reconnectTimeout=globalThis.setTimeout((()=>{delete this.reconnectTimeout,this.connectToReflector()}),this.reconnectDelay),this.reconnectDelay=Math.min(3e4,Math.round((this.reconnectDelay+100)*(1+Math.random()))))}disconnected(){this.socket&&(this.socket=null,this.lastReceived=0,this.socketLastSent=0,this.stalledSince=0,this.connectHasBeenCalled=!1,this.controller.connectionInterrupted())}send(e){this.socketLastSent=Date.now(),this.socket.send(e),Xn.addNetworkTraffic(\"reflector_out\",e.length)}receive(e){this.lastReceived=Date.now();const{id:t,action:r,args:s}=JSON.parse(e);if(t)try{this.controller.receive(r,s)}catch(e){this.closeConnectionWithError(\"receive\",e)}else if(\"PONG\"===r){if($d.pong&&console.log(\"PONG after\",Date.now()-s,\"ms\"),this.pongHook)try{this.pongHook(s)}catch(e){console.error(e)}}else console.warn(\"Unknown action\",r)}dormantDisconnect(){this.connected&&($d.session&&console.log(this.id,\"dormant; disconnecting from reflector\"),this.closeConnection(4110,\"Going dormant\"))}closeConnectionWithError(e,t,r=4e3){console.error(t),console.warn(\"closing socket\"),r>=4100&&4110!==r&&(this.controller.leaving=()=>{}),this.closeConnection(r,`Error in ${e}: ${t.message||t}`)}closeConnection(e,t){this.socket&&(this.socket.onclose=null,this.socket.close(e,t),this.socketClosed(e,t))}PULSE(e){this.connected&&(0===this.socket.bufferedAmount?(this.send(JSON.stringify({action:\"PULSE\"})),this.stalledSince=0):this.stalledSince&&e-this.stalledSince>500?console.log(`${this.id} Reflector connection stalled: ${this.socket.bufferedAmount} bytes unsent for ${e-this.stalledSince} ms`):this.stalledSince=Date.now())}keepAlive(e){0!==this.lastReceived&&(e-this.socketLastSent>25e3?this.PULSE(e):e-this.lastReceived>5e4?this.closeConnectionWithError(\"connection\",Error(\"Reflector has gone away\")):e-this.lastReceived>this.missingTickThreshold&&this.PULSE(e))}PING(e=Date.now()){this.connected&&this.send(JSON.stringify({action:\"PING\",args:e}))}}globalThis.setInterval((()=>{for(const e of ih)e.connected&&e.vm&&e.connection.keepAlive(Date.now())}),100);const ch=Symbol(\"hash\"),dh=Symbol(\"key\"),hh=Symbol(\"url\"),uh=new Map;function fh(e){return H.has(\"debug\",e,!1)}function ph(e){return e.replace(/=/g,\"\").replace(/\\+/g,\"-\").replace(/\\//g,\"_\")}function mh(e){return e.replace(/-/g,\"+\").replace(/_/g,\"/\").padEnd(e.length+3&-4,\"=\")}function bh(e,t){return t.replace(/[\\s\\S]/g,(t=>String.fromCharCode(t.charCodeAt(0)^e.charCodeAt(0))))}class yh{static async store(e,t,r=!1){if(\"object\"==typeof e&&(console.warn(\"Deprecated: Croquet.Data.store(sessionId, data) called without sessionId\"),t=e),Ph.hasCurrent())throw Error(\"Croquet.Data.store() called from Model code\");const{appId:s,persistentId:n,uploadEncrypted:i}=oh(e),o=N.random(32).toString(xn),a=`apps/${s}/${n}/data/%HASH%`,l=await i({path:a,content:t,key:o,keep:r,debug:fh(\"data\"),what:\"data\"}),c=function(e){return e.replace(/.*\\//,\"\")}(l);return new yh(c,o,l)}static async fetch(e,t){if(\"object\"==typeof e&&(console.warn(\"Deprecated: Croquet.Data.fetch(sessionId, handle) called without sessionId\"),t=e),Ph.hasCurrent())throw Error(\"Croquet.Data.fetch() called from Model code\");const{downloadEncrypted:r}=oh(e),s=t&&t[ch],n=t&&t[dh],i=t&&t[hh];if(\"string\"!=typeof s||\"string\"!=typeof n||\"string\"!=typeof i)throw Error(\"Croquet.Data.fetch() called with invalid handle\");return r({url:i,key:n,debug:fh(\"data\"),what:\"data\"})}static hash(e,t=\"base64url\"){\"function\"==typeof e&&(e=Function.prototype.toString.call(e)),\"string\"==typeof e?e=(new TextEncoder).encode(e):e&&e.constructor===DataView?e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e&&e.constructor===ArrayBuffer?e=new Uint8Array(e):ArrayBuffer.isView(e)||(e=(new TextEncoder).encode(E(e)));const r=j(N.create(e));switch(t){case\"hex\":return r.toString();case\"base64\":return r.toString(xn);case\"base64url\":return ph(r.toString(xn));default:throw Error(`Croquet.Data: unknown hash output \"${t}\", expected \"hex\"/\"base64\"/\"base64url\"`)}}static fromId(e){const t=e.slice(0,1);let r,s,n,i;switch(t){case\"0\":r=e.slice(1,44),s=e.slice(44),n=`https://files.croquet.io/sessiondata/${r}`;break;case\"1\":r=e.slice(1,44),s=e.slice(44,87)+\"=\",i=e.slice(87),n=`https://files.croquet.io/apps/${i}/data/${r}`;break;case\"2\":r=e.slice(1,44),s=mh(e.slice(44,87)),i=bh(s,atob(mh(e.slice(87)))),n=`https://files.croquet.io/apps/${i}/data/${r}`;break;case\"3\":s=mh(e.slice(1,44)),n=bh(s,atob(mh(e.slice(44)))),r=n.slice(-43);break;default:throw Error(`Croquet.Data expected handle v0-v3 got v${t}`)}return new this(r,s,n)}static toId(e){if(!e)return\"\";const t=e[ch],r=e[dh],s=e[hh];if(s.slice(-43)!==t)throw Error(\"Croquet Data: malformed URL\");return`3${ph(r)}${ph(btoa(bh(r,s)))}`}constructor(e,t,r){const s=uh.get(e);if(s)return fh(\"data\")&&console.log(`Croquet.Data: using cached handle for ${e}`),s;if(r.slice(-43)!==e)throw Error(\"Croquet Data: malformed URL\");Object.defineProperty(this,ch,{value:e}),Object.defineProperty(this,dh,{value:t}),Object.defineProperty(this,hh,{value:r}),uh.set(e,this),fh(\"data\")&&console.log(`Croquet.Data: created new handle for ${e}`)}}const gh={cls:yh,write:e=>yh.toId(e),read:e=>yh.fromId(e)};let wh=null,Sh=null;const vh=Symbol(\"DEBUG_WRITES_TARGET\");let _h=null;class Zh extends Error{}function Xh(){if(!globalThis.CroquetViewMath){globalThis.CroquetMath.random=()=>wh.random(),globalThis.CroquetViewMath={};for(const[e,t]of Object.entries(Object.getOwnPropertyDescriptors(Math)))globalThis.CroquetViewMath[e]=t.value;for(const[r,s]of Object.entries(globalThis.CroquetMath)){const n=Math[r];Math[r]=1===s.length?e=>wh?s(e):n(e):(e,t)=>wh?s(e,t):n(e,t)}}if(!globalThis.CroquetViewDate){const i=globalThis.Date;let o=!1;function a(e,t){return o||(o=!0,console.warn(new Zh(`${e} used in Model code`))),t}function l(e,t,r,s,n,o,c){const d=this instanceof l,h=[e,t,r,s,n,o,c];if(h.length=arguments.length,wh)switch(a(d?\"new Date()\":\"Date()\"),arguments.length){case 0:h.push(wh.time);break;case 1:break;default:h[0]=i.UTC(...h),h.length=1}const u=new i(...h);return d?u:\"\"+u}l.prototype=i.prototype,l.UTC=i.UTC,l.now=()=>wh?a(\"Date.now()\",wh.time):i.now(),l.parse=(...e)=>wh?a(\"Date.parse()\",0):i.parse(...e),globalThis.CroquetViewDate=i,globalThis.Date=l}}Object.defineProperty(Zh.prototype,\"name\",{value:\"CroquetWarning\"});const Lh={};function xh(e,t){const{qPara:r,qArgs:s,qFn:n}=JSON.parse(atob(e.slice(1,-1))),i=JSON.stringify(r),o=Lh[i]||(Lh[i]=new Function(...r));return\"number\"==typeof n&&(s[n]=o),o.call(t,...s).bind(t)}function Th(e,t){if(wh)throw Error(\"VirtualMachine confusion\");if(!(e instanceof Ph))throw Error(\"not a VM: \"+e);const r=wh;try{wh=e,globalThis.CROQUETVM=e,t()}finally{wh=r}}const kh=[\"handleModelEventInModel\",\"handleBundledEvents\",\"publishFromModelOnly\",\"handlePollForSnapshot\",\"handleTuttiResult\",\"handleTuttiDivergence\",\"handleSnapshotVote\",\"handlePersistVote\",\"handleModelEventInView\",\"noop\"],Gh={};for(let e=0;e<kh.length;e++)Gh[kh[e]]=e;const Rh=new WeakMap;function Wh(e){Rh.set(e,null)}class Ch{random(){throw Error(\"Math.random() cannot be used in Model.evaluate()\")}}class Ph{static current(){return wh||console.warn(\"VirtualMachine.current() called from outside the vm!\"),wh}static hasCurrent(){return!!wh}static evaluate(e){if(wh)return e();Xh();const t=wh;try{return wh=new Ch,e()}finally{wh=t}}constructor(e,t){Xh(),Sh={snapshot:H.has(\"debug\",\"snapshot\",!1),session:H.has(\"debug\",\"session\",!1),write:H.has(\"debug\",\"write\",!1)},Wh(this),Th(this,(()=>{fe(this,(()=>{if(this.modelsById={},this.modelsByName={},this.messages=new yn(((e,t)=>e.before(t))),this.subscriptions={},this.subscribers=new Map,this.views={},this._random=()=>{throw Error(\"You must not use random when applying state!\")},this.id=e.id,this.time=0,this.seq=4294967280,this.externalTime=0,this.externalSeq=this.seq,this.futureSeq=0,this.lastSnapshotPoll=0,this.lastPersistencePoll=0,this.inPersistenceCoolOff=!1,this.persisted=\"\",this.modelsId=0,this.diverged=null,this.controller=null,e.modelsById){const t=Kh.newOrRecycled(this).readVM(e,\"vm\");let r=[];for(const e of Object.keys(t))e in this||\"meta\"===e?\"_random\"===e?this[e]=new be(null,{state:t[e]}):\"messages\"===e?r=t.messages:this[e]=t[e]:console.warn(`Ignoring property snapshot.${e}`);for(const e of r)this.messages.add(e);for(const[e,t]of Object.entries(this.subscriptions))for(const r of t){const[t]=r.split(\".\");let s=this.subscribers.get(t);s||this.subscribers.set(t,s=new Set),s.add(e)}}else this._random=new be(e.id,{state:!0}),this.addSubscription(this,\"__VM__\",\"__peers__\",this.generateJoinExit),this.addSubscription(this,\"__VM__\",\"__diverged__\",this.handleSessionDiverged),t(this)}))}))}registerModel(e,t){if(wh!==this)throw Error(\"You can only create models from model code!\");return t||(t=\"M\"+ ++this.modelsId),this.modelsById[t]=e,t}deregisterModel(e){if(wh!==this)throw Error(\"You can only destroy models from model code!\");const t=this.modelsById;delete this.modelsById[e];for(const[e,r]of Object.entries(this.modelsByName))t===r&&delete this.modelsByName[e];this.messages.removeMany((t=>t.hasReceiver(e)))}lookUpModel(e){if(\"_\"===e)return this;let t=this.modelsById[e];if(t)return t;const[r,s,n]=e.match(/^([^#]+)#(.*)$/)||[];return t=this.modelsById[s],t&&t.lookUp(n)}get(e){const t=this.modelsByName[e];return wh!==this&&Sh.write?this.debugWriteProxy(this,t):t}set(e,t){if(wh!==this)throw Error(\"You can only make a model well-known from model code!\");this.modelsByName[e]=t}debugWriteProxy(e,t){if(\"object\"!=typeof t||null===t)return t;if(!this.$debugWriteProxyHandler){function s(){throw Error(\"Attempt to modify Croquet model state from outside!\")}_h||(_h=new WeakMap),this.$debugWriteProxyHandler={set(t,r,n){wh!==e&&s(),t[r]=n},deleteProperty(t,r){wh!==e&&s(),delete t[r]},get(t,r){if(r===vh)return t;const n=t[r];if(n&&n[vh])return n;if(wh!==e&&\"object\"==typeof n&&null!==n){if(n instanceof Map){const t=new Map([...n.entries()].map((([t,r])=>[e.debugWriteProxy(e,t),e.debugWriteProxy(e,r)])));return t[vh]=n,t.set=s,t.delete=s,t}if(n instanceof Set){const t=new Set([...n.entries()].map((t=>e.debugWriteProxy(e,t))));return t[vh]=n,t.set=s,t.delete=s,t}return e.debugWriteProxy(e,n)}return n}}}let r=_h.get(t);return r||(r=new Proxy(t,this.$debugWriteProxyHandler),_h.set(t,r)),r}noop(){}generateJoinExit({entered:e,exited:t,count:r}){const s={};for(const t of e){if(!Array.isArray(t))continue;const e=t[1]||{};e.region&&(e.country=e.region.slice(0,2),e.region=e.region.slice(2)),s[t[0]]={loc:e}}if(e=e.map((e=>Array.isArray(e)?e[0]:e)),t=t.map((e=>Array.isArray(e)?e[0]:e)),e.length===r){t=Object.keys(this.views);for(const e of t)this.views[e].extraConnections=0}if(0!==e.length&&0!==t.length){const r=e.filter((e=>t.includes(e)));if(0!==r.length&&(e=e.filter((e=>!r.includes(e))),t=t.filter((e=>!r.includes(e))),0===e.length&&0===t.length))return}for(const e of t)if(this.views[e]){if(this.views[e].extraConnections){this.views[e].extraConnections--,Sh.session&&console.log(`${this.id} @${this.time}#${this.seq} view ${e} closed extra connection`);continue}delete this.views[e],this.publishFromModelOnly(this.id,\"view-exit\",e)}else{const{time:t,seq:r}=this;console.error(`${this.id} @${t}#${r} view ${e} exited without being present - this should not happen`),Promise.resolve().then((()=>{this.controller.sendLog(`view-exit-mismatch @${t}#${r} ${e} left without being present`)}))}for(const t of e)this.views[t]?(Sh.session&&console.log(`${this.id} @${this.time}#${this.seq} view ${t} opened another connection`),this.views[t].extraConnections=(this.views[t].extraConnections||0)+1):(this.views[t]=s[t]||{},this.publishFromModelOnly(this.id,\"view-join\",t));const n=Object.values(this.views).reduce(((e,t)=>e+1+(t.extraConnections||0)),0);if(r!==n){const{time:e,seq:t}=this;console.error(`@${e}#${t} view count mismatch (model: ${n}, reflector: ${r}) - this should not happen`),Promise.resolve().then((()=>{this.controller.sendLog(`view-exit-mismatch @${e}#${t} connections model: ${n} reflector: ${r}`)}))}}scheduleExternalMessage(e){const t=Yh.fromState(e,this);if(t.time<this.time)throw Error(\"past message from reflector \"+e);const r=this.externalSeq+1>>>0;if(t.seq!==r)throw Error(`External message error. Expected message #${r} got #${t.seq}`);return this.externalTime=t.time,this.externalSeq=t.seq,t.seq=2*t.seq+1,this.verifyExternal(t),this.messages.add(t),t}verifyExternal(e){if(\"_\"!==e.receiver)throw Error(`invalid receiver in external message: ${e}`);if(!(e.selector in Gh))throw Error(`unexpected external message: ${e.selector}`)}futureSend(e,t,r,s){if(e.every)return this.futureRepeat(e.every,t,r,s);if(e<0)throw Error(\"attempt to send future message into the past\");this.futureSeq=this.futureSeq+1>>>0;const n=new Yh(this.time+e,2*this.futureSeq,t,r,s);return this.messages.add(n),{time:n.time,seq:n.seq}}cancelFuture(e,t){const r=this.messages;let s;if(\"number\"==typeof t.time){const{time:e,seq:n}=t;s=r.removeOne((t=>t.time===e&&t.seq===n))}else{if(\"*\"===t)return s=r.removeMany((t=>t.receiver===e.id)),s.length>0;{const n=this.asQFunc(e,t,\"cancelFuture message\"),i=e.id;s=r.removeOne((e=>e.receiver===i&&e.selector===n||\"_\"===e.receiver&&\"futureExecAndRepeat\"===e.selector&&e.args[1]===i&&e.args[2]===n))}}return void 0!==s}futureRepeat(e,t,r,s){this.futureSend(e,\"_\",\"futureExecAndRepeat\",[e,t,r,s])}futureExecAndRepeat(e,t,r,s){const n=this.lookUpModel(t);if(n){if(\"function\"==typeof n[r])try{n[r](...s)}catch(e){ne(`future message ${n}.${r}`,e)}else{const e=xh(r,n);try{e(...s)}catch(t){ne(`future message ${n} ${e}`,t)}}this.futureRepeat(e,t,r,s)}}future(e,t,r,s){if(!this.lookUpModel(e.id))throw Error(`future send to unregistered model ${e}`);if(void 0===r){const r=this;return new Proxy(e,{get:(s,n)=>(...s)=>r.future(e,t,n,s)})}const n=this.asQFunc(e,r,\"future message\");if(\"string\"!=typeof n)throw Error(`future message to ${e} ${n} is not a string`);if(\"function\"!=typeof e[n]&&n.indexOf(\".\")<0&&\"{\"!==n[0])throw Error(`future send to ${e} with unknown method ${n}()`);return this.futureSend(t,e.id,n,s)}advanceTo(e,t){if(wh)throw Error(\"cannot advance time from model code\");let r;for(;(r=this.messages.peek())&&r.time<=e;){const{time:e,seq:s}=r;if(e<this.time)throw Error(\"past message encountered: \"+r);if(1&s&&(this.seq=this.seq+1>>>0,s/2>>>0!==this.seq))throw Error(`Sequence error: expected ${this.seq} got ${s/2>>>0} in ${r}`);if(this.messages.poll(),this.time=r.time,r.executeOn(this),globalThis.CroquetViewDate.now()>=t)return!1}return this.time=e,!0}asQFunc(e,t,r=\"subscription handler\"){if(\"string\"==typeof t)return t;if(\"function\"==typeof t){if(e[t.name]===t)return t.name;let s=e;for(;null!==s;){for(const[e,r]of Object.entries(Object.getOwnPropertyDescriptors(s)))if(r.value===t)return e;s=Object.getPrototypeOf(s)}re(`${r} is not a method of ${e}: ${t}\\n`,{only:\"once\"});const n=/^\\(?([a-z][a-z0-9]*)?\\)? *=> *this\\.([a-z][a-z0-9]*) *\\( *([a-z][a-z0-9]*)? *\\) *$/i,i=t.toString().match(n);return!i||i[3]&&i[3]!==i[1]?function(e,t){\"function\"==typeof e&&(t=e,e={});const r=Object.keys(e).concat([\"return \"+t]),s=Object.values(e),n={qPara:r,qArgs:s},i=s.indexOf(t);return i>=0&&(s[i]=r[i],n.qFn=i),`{${btoa(JSON.stringify(n))}}`}(t):i[2]}return null}addSubscription(e,t,r,s){if(wh!==this)throw Error(\"Cannot add a model subscription from outside model code\");const n=this.asQFunc(e,s);if(\"string\"!=typeof n)throw Error(`Subscription handler for \"${r}\" must be a method name`);if(n.indexOf(\".\")<0&&\"function\"!=typeof e[n]&&\"{\"!==n[0])throw Error(`Subscriber method for \"${r}\" not found: ${e}.${n}()`);const i=t+\":\"+r,o=e===this?\"_\":e.id,a=o+\".\"+n;if(this.subscriptions[i]){if(-1!==this.subscriptions[i].indexOf(a))throw Error(`${e}.${n} already subscribed to ${r}`)}else this.subscriptions[i]=[];this.subscriptions[i].push(a);let l=this.subscribers.get(o);l||this.subscribers.set(o,l=new Set),l.add(i)}removeSubscription(e,t,r,s=\"*\"){if(wh!==this)throw Error(\"Cannot remove a model subscription from outside model code\");const n=t+\":\"+r,i=this.subscriptions[n];if(i){const t=e.id+\".\";if(\"*\"===s){for(let e=i.length-1;e>=0;e--)i[e].startsWith(t)&&i.splice(e,1);0===i.length&&delete this.subscriptions[n]}else{const o=this.asQFunc(e,s);if(\"string\"!=typeof o)throw Error(`Invalid unsubscribe args for \"${r}\" in ${e}: ${s}`);const a=t+o,l=i.indexOf(a);if(-1!==l&&(i.splice(l,1),0===i.length&&delete this.subscriptions[n]),i.find((e=>e.startsWith(t))))return}const o=this.subscribers.get(e.id);o.delete(n),0===o.size&&this.subscribers.delete(e.id)}}removeAllSubscriptionsFor(e){const t=this.subscribers.get(e.id);if(t){const r=e.id+\".\";for(const e of t){const t=this.subscriptions[e];for(let e=t.length-1;e>=0;e--)t[e].startsWith(r)&&t.splice(e,1);0===t.length&&delete this.subscriptions[e]}this.subscribers.delete(e.id)}}publishFromModel(e,t,r){if(wh!==this)throw Error(\"Cannot publish a model event from outside model code\");const s=t.endsWith(\"#reflected\");s&&(t=t.slice(0,t.length-\"#reflected\".length));const n=e+\":\"+t;this.handleModelEventInModel(n,r,s),this.handleModelEventInView(n,r)}publishFromModelOnly(e,t,r){if(wh!==this)throw Error(\"Cannot publish a model event from outside model code\");const s=e+\":\"+t;this.handleModelEventInModel(s,r)}publishFromView(e,t,r){if(wh)throw Error(\"Cannot publish a view event from model code\");const s=e+\":\"+t;this.handleViewEventInModel(s,r),this.handleViewEventInView(s,r)}handleBundledEvents(e){for(const t of e){const e=Yh.fromState(t,this);this.verifyExternal(e),e.executeOn(this,!0)}}handleModelEventInModel(e,t,r=!1){if(wh!==this)throw Error(\"handleModelEventInModel called from outside model code\");if(r){if(!0!==this.controller.synced)return;const r=e+\"#__vote\",s=e+\"#divergence\",n=!!ae.subscriptions[r],i=!!this.subscriptions[e],o=!!this.subscriptions[s];n&&o&&console.log(`divergence subscription for ${e} overridden by vote subscription`);const a=i?new Yh(this.time,0,\"_\",\"handleModelEventInModel\",[e,t]):null;let l;l=n?[\"handleModelEventInView\",r]:[\"handleTuttiDivergence\",s],Promise.resolve().then((()=>this.controller.sendTutti({time:this.time,topic:e,data:t,firstMessage:a,wantsVote:n,tallyTarget:l})))}else if(this.subscriptions[e]){const r=this.subscriptions[e],s=r.slice();for(let n=0;n<s.length;n++){const i=s[n];if(i!==r[n]&&!r.includes(i))continue;const[o,...a]=i.split(\".\"),l=a.join(\".\"),c=this.lookUpModel(o);if(c)if(\"{\"!==l[0])if(l.indexOf(\".\")>=0){const r=l.indexOf(\".\"),s=l.slice(0,r),n=l.slice(r+1);try{c.call(s,n,t)}catch(t){ne(`event ${e} ${c}.call(${JSON.stringify(s)}, ${JSON.stringify(n)})`,t)}}else if(\"function\"==typeof c[l])try{c[l](t)}catch(t){ne(`event ${e} ${c}.${l}()`,t)}else ne(`event ${e} ${c}.${l}(): method not found`);else{const r=xh(l,c);try{r(t)}catch(t){ne(`event ${e} ${c} ${r}`,t)}}else re(`event ${e} .${l}(): subscriber not found`)}}}handleViewEventInModel(e,t){if(this.subscriptions[e]){const r=[e];void 0!==t&&r.push(t);const s=new Yh(this.time,0,\"_\",\"handleModelEventInModel\",r);this.controller.sendMessage(s)}}handleModelEventInView(e,t){Sh.write&&(t=this.debugWriteProxy(this,t)),ae.handleEvent(e,t,(e=>function(e){if(!wh)throw Error(\"VirtualMachine confusion\");const t=wh;try{wh=null,e()}finally{wh=t}}((()=>pe(this,e,!0)))))}handleViewEventInView(e,t){ae.handleEvent(e,t)}handleTuttiDivergence(e,t){if(this.subscriptions[e])this.handleModelEventInModel(e,t);else{const r=e.split(\":\").slice(-1)[0];console.warn(`uncaptured divergence in ${r}:`,t)}}handleSessionDiverged(e){const{key:t,url:r}=e;this.diverged||(this.diverged=new Map);let s=this.diverged.get(t);s||this.diverged.set(t,s=[]),s.push(r),2===s.length&&this.controller&&!this.controller.fastForwardHandler&&this.debugDiverged(t)}debugDiverged(e){e||(e=this.diverged.keys().next().value);const t=this.diverged.get(e);if(!t||t.length<2)throw Error(`no diverged urls for snapshot ${e}`);Promise.resolve().then((()=>this.controller.diffDivergedSnapshots(t)))}processModelViewEvents(e){if(wh)throw Error(\"cannot process view events in model code\");return pe(this,(()=>ae.processFrameEvents(e,!!this.controller.synced)))}handlePollForSnapshot(){const e=this.time,t=e-this.lastSnapshotPoll;t<5e3?console.log(`rejecting snapshot poll ${t}ms after previous`):(this.lastSnapshotPoll=e,this.controller.handlePollForSnapshot(e))}handleTuttiResult(e){this.controller.handleTuttiResult(e)}handleSnapshotVote(e){this.controller.handleSnapshotVote(e)}handlePersistVote(e){this.controller.handlePersistVote(e)}snapshot(){return Eh.newOrRecycled(this).snapshot(this,\"_\")}getSummaryHash(){return E((new Mh).getHash(this))}persist(e,t){this.controller&&\"no.appId\"===this.controller.sessionSpec.appId&&console.warn(\"Croquet: appId should be provided in Session.join() to not overwrite another apps's persistent data\");const r=Xn.begin(\"snapshot\"),s=\"function\"==typeof t?t.call(e):t;if(\"object\"!=typeof s)throw Error(`Croquet: persistSession() can only persist objects (got ${typeof s})`);const n=E(s),i=yh.hash(n),o=Xn.end(\"snapshot\")-r,a=this.persisted===i,l=this.time;var c,d;if(Sh.snapshot&&console.log(`${this.id} persistent data @${l} collected, stringified and hashed in ${Math.ceil(o)}ms${a?\" (unchanged, ignoring)\":\"\"}`),!a)if(c=this,d={persistTime:l,persistentString:n,persistentHash:i,ms:o},Rh.set(c,d),this.persisted=i,this.inPersistenceCoolOff)Sh.snapshot&&console.log(`${this.id} persistence poll postponed by cooloff`);else{const e=this.lastPersistencePoll?this.lastPersistencePoll+25e3-this.time:0;e>0?(Sh.snapshot&&console.log(`${this.id} postponing persistence poll by ${e}ms`),this.futureSend(e,\"_\",\"triggerPersistencePoll\",[]),this.inPersistenceCoolOff=!0):this.triggerPersistencePoll()}}triggerPersistencePoll(){this.inPersistenceCoolOff=!1,this.lastPersistencePoll=this.controller?this.time:0;const e=(t=this,Rh.get(t));var t;if(!e)return;const{persistTime:r,persistentString:s,persistentHash:n,ms:i}=e;if(Wh(this),this.controller&&this.controller.synced){Sh.snapshot&&console.log(`${this.id} asking controller to poll for persistence @${r}`);const e=this.time;Promise.resolve().then((()=>this.controller.pollForPersist(e,r,s,n,i)))}}random(){if(wh!==this)throw Error(\"synchronized random accessed from outside the model\");return this._random()}randomID(){if(wh!==this)throw Error(\"synchronized random accessed from outside the model\");let e=\"\";for(let t=0;t<4;t++)e+=(this._random.int32()>>>0).toString(16).padStart(8,\"0\");return e}toString(){return`VirtualMachine[${this.id}]`}[Symbol.toPrimitive](){return this.toString()}}function Ih(e,t,r){let s;if(\"_\"===e){const e=Gh[t];\"number\"==typeof e&&(s=e.toString(36))}if(void 0===s&&(s=`${e}>${t}`),r.length>0){const e=Nh.newOrRecycled();s+=JSON.stringify(e.encode(r))}return s}function Vh(e,t){return(t-e|0)>=0}class Yh{constructor(e,t,r,s,n){this.time=e,this.seq=t,this.receiver=r,this.selector=s,this.args=n}before(e){return this.time!==e.time?this.time<e.time:this.isExternal()!==e.isExternal()?e.isExternal():this.isExternal()?Vh(this.externalSeq,e.externalSeq):Vh(this.internalSeq,e.internalSeq)}hasReceiver(e){return this.receiver===e}isExternal(){return 1&this.seq}get externalSeq(){return this.seq/2>>>0}set externalSeq(e){this.seq=2*e+1}get internalSeq(){return this.seq/2>>>0}set internalSeq(e){this.seq=2*e}asState(){return[this.time,this.seq,Ih(this.receiver,this.selector,this.args)]}static fromState(e,t){const[r,s,n]=e,{receiver:i,selector:o,args:a}=function(e,t){let r,s,n;if(1===e.length||\"[\"===e[1]){const t=parseInt(e[0],36);r=\"_\",s=kh[t],n=e.slice(1)}else{const t=e.indexOf(\">\");let i=e.indexOf(\"[\");-1===i&&(i=e.length),r=e.slice(0,t),s=e.slice(t+1,i),n=e.slice(i)}let i=[];n&&(i=zh.newOrRecycled(t).decode(JSON.parse(n)));return{receiver:r,selector:s,args:i}}(n,t);return new Yh(r,s,i,o,a)}executeOn(e,t=!1){const r=t?e=>e():t=>Th(e,(()=>fe(e,t))),{receiver:s,selector:n,args:i}=this,o=e.lookUpModel(s);if(o)if(\"{\"===n[0]){const e=xh(n,o);r((()=>{try{e(...i)}catch(t){ne(`${this.shortString()} ${e}`,t)}}))}else n.indexOf(\".\")>=0?r((()=>{const e=n.indexOf(\".\"),t=n.slice(0,e),r=n.slice(e+1);try{o.call(t,r,...i)}catch(e){ne(`${this.shortString()} ${o}.call(${JSON.stringify(t)}, ${JSON.stringify(r)})`,e)}})):\"function\"!=typeof o[n]?re(`${this.shortString()} ${o}.${n}(): method not found`):r((()=>{try{o[n](...i)}catch(e){ne(`${this.shortString()} ${o}.${n}()`,e)}}));else re(`${this.shortString()} ${n}(): receiver not found`)}shortString(){return(this.isExternal()?\"External\":\"Future\")+\"Message\"}toString(){const{receiver:e,selector:t,args:r}=this,s=this.isExternal(),n=s?this.externalSeq:this.internalSeq;return`${s?\"External\":\"Future\"}Message[${this.time}${\":#\"[+s]}${n} ${e}.${t}(${r.map(JSON.stringify).join(\", \")})]`}[Symbol.toPrimitive](){return this.toString()}}const Hh=(()=>{const e=new ArrayBuffer(8),t=new DataView(e);return e=>(t.setFloat64(0,e,!0),t.getInt32(0,!0)+t.getInt32(4,!0))})();class Mh{constructor(){this.done=new Set,this.todo=[],this.hashers=new Map,this.addHasher(\"Teatime:Message\",Yh),this.addHasher(\"Teatime:Data\",gh);for(const[e,t]of Dh.allClassTypes())this.addHasher(e,t)}addHasher(e,t){const{cls:r,write:s}=Object.getPrototypeOf(t)===Object.prototype?t:{cls:t,write:e=>({...e})};this.hashers.set(r,(e=>this.hashStructure(e,s(e))))}getHash(e){this.hashState={oC:0,mC:0,nanC:0,infC:0,zC:0,nC:0,nH:0,sC:0,sL:0,fC:0};for(const[t,r]of Object.entries(e))if(\"controller\"!==t&&\"meta\"!==t)if(\"_random\"===t)this.hash(r.state(),!1);else if(\"messages\"===t){const e=r.asArray();(this.hashState.fC=e.length)&&this.hash(e,!1)}else this.hashEntry(t,r);return this.hashDeferred(),this.hashState}hashDeferred(){let e=0;for(;e<this.todo.length;){const{key:t,value:r}=this.todo[e++];this.hashEntry(t,r,!1)}this.todo.length=0}hash(e,t=!0){switch(typeof e){case\"number\":return void(Number.isNaN(e)?this.hashState.nanC++:Number.isFinite(e)?0===e?this.hashState.zC++:(this.hashState.nC++,this.hashState.nH+=Hh(e)):this.hashState.infC++);case\"string\":return this.hashState.sC++,void(this.hashState.sL+=e.length);case\"boolean\":case\"undefined\":return;case\"bigint\":if(0n===e)this.hashState.zC++;else{this.hashState.nC++;const t=e<0?-1n:0n;for(;e!==t;)this.hashState.nH+=Number(0xFFFFFFFFn&e),e>>=32n}return;default:{if(this.done.has(e))return;if(null===e)return;if(this.hashers.has(e.constructor))return void this.hashers.get(e.constructor)(e);const r=Object.prototype.toString.call(e).slice(8,-1);if(this.hashers.has(r))return void this.hashers.get(r)(e);switch(r){case\"Array\":return void this.hashArray(e,t);case\"ArrayBuffer\":return void this.hashIntArray(new Uint8Array(e));case\"Set\":return void this.hashStructure(e,[...e]);case\"Map\":return void this.hashStructure(e,[...e],!1);case\"DataView\":return void this.hashIntArray(new Uint8Array(e.buffer,e.byteOffset,e.byteLength));case\"Int8Array\":case\"Uint8Array\":case\"Uint8ClampedArray\":case\"Int16Array\":case\"Uint16Array\":case\"Int32Array\":case\"Uint32Array\":return void this.hashIntArray(e);case\"Float32Array\":case\"Float64Array\":return void this.hashArray(e,!1);case\"Object\":e instanceof Dh?this.hashModel(e):e.constructor===Object&&this.hashObject(e,t)}}}}hashModel(e){this.hashState.mC++,this.done.add(e);for(const[t,r]of Object.entries(e))\"__realm\"!==t&&void 0!==r&&this.hashEntry(t,r)}hashObject(e,t=!0){this.hashState.oC++,this.done.add(e);for(const[r,s]of Object.entries(e))void 0!==s&&this.hashEntry(r,s,t)}hashArray(e,t=!0){this.done.add(e);for(let r=0;r<e.length;r++)this.hashEntry(r,e[r],t)}hashIntArray(e){this.done.add(e);for(let t=0;t<e.length;t++){const r=e[t];0===r?this.hashState.zC++:(this.hashState.nC++,this.hashState.nH+=r)}}hashStructure(e,t,r=!0){void 0!==t&&(this.done.add(e),this.hash(t,r))}hashEntry(e,t,r=!0){\"$\"!==e[0]&&(r&&\"object\"==typeof t?this.todo.push({key:e,value:t}):this.hash(t,r))}}class Eh{static newOrRecycled(e){let t=this.reusableInstance;return t?(t.vm=e,t.nextRef=1,t.refs=new Map,t.todo=[]):t=this.reusableInstance=new this(e),t}static get reusableInstance(){return this[this.name+\"-instance\"]}static set reusableInstance(e){this[this.name+\"-instance\"]=e}static resetInstance(){this.reusableInstance=null}constructor(e){this.vm=e,this.nextRef=1,this.refs=new Map,this.todo=[],this.writers=new Map,this.addWriter(\"Teatime:Message\",Yh),this.addWriter(\"Teatime:Data\",gh);for(const[e,t]of Dh.allClassTypes())this.addWriter(e,t);this.okayToIgnore={$debugWriteProxyHandler:!0};for(const e of Dh.allClasses())if(Object.prototype.hasOwnProperty.call(e,\"okayToIgnore\")){const t=e.okayToIgnore();if(!Array.isArray(t))throw new Error(\"okayToIgnore() must return an array\");for(const e of t){if(\"$\"!==e[0])throw Error(`okayToIgnore: ignored prop \"${e}\" must start with '$'`);this.okayToIgnore[e]=!0}}}addWriter(e,t){const{cls:r,write:s}=Object.getPrototypeOf(t)===Object.prototype?t:{cls:t,write:e=>({...e})};this.writers.set(r,((t,r)=>this.writeAs(e,t,s(t),r)))}snapshot(e){const t={_random:e._random.state(),messages:this.write(e.messages.asArray(),\"vm.messages\"),subscribers:void 0,controller:void 0};for(const[r,s]of Object.entries(e))r in t||this.writeInto(t,r,s,`vm.${r}`);return this.writeDeferred(),t}writeDeferred(){let e=0;for(;e<this.todo.length;){const{state:t,key:r,value:s,path:n}=this.todo[e++];this.writeInto(t,r,s,n,!1)}this.todo.length=0}write(e,t,r=!0){switch(typeof e){case\"number\":return Object.is(e,-0)?{$class:\"NegZero\"}:Number.isFinite(e)?e:Number.isNaN(e)?{$class:\"NaN\"}:{$class:\"Infinity\",$value:Math.sign(e)};case\"string\":case\"boolean\":return e;case\"undefined\":return{$class:\"Undefined\"};case\"bigint\":return{$class:\"BigInt\",$value:e.toString()};default:{if(this.refs.has(e))return this.writeRef(e);if(null===e)return e;if(this.writers.has(e.constructor))return this.writers.get(e.constructor)(e,t);const s=Object.prototype.toString.call(e).slice(8,-1);if(this.writers.has(s))return this.writers.get(s)(e,t);switch(s){case\"Array\":return this.writeArray(e,t,r);case\"ArrayBuffer\":return this.writeArrayBuffer(e);case\"Set\":return this.writeAs(s,e,[...e],t);case\"Map\":return this.writeAs(s,e,[...e].flat(),t);case\"DataView\":case\"Int8Array\":case\"Uint8Array\":case\"Uint8ClampedArray\":case\"Int16Array\":case\"Uint16Array\":case\"Int32Array\":case\"Uint32Array\":case\"Float32Array\":case\"Float64Array\":return this.writeTypedArray(s,e);case\"Object\":if(e instanceof Dh)return this.writeModel(e,t);if(e.constructor===Object||\"function\"!=typeof e.constructor)return this.writeObject(e,t,r);throw console.error(`Croquet: unknown class at ${t}:`,e),Error(`Croquet: class not registered in Model.types(): ${e.constructor.name}`);default:throw console.error(`Croquet: unsupported property at ${t}:`,e),Error(`Croquet: serialization of ${s}s is not supported`)}}}}writeModel(e,t){const r={};this.refs.set(e,r);try{r.$model=Dh.classToID(e.constructor)}catch(r){throw console.error(`unregistered model class at ${t}:`,e),r}for(const s of Object.keys(e).sort()){if(\"__realm\"===s)continue;const n=e[s];(\"number\"==typeof n&&Number.isFinite(n)&&!Object.is(n,-0)||\"string\"==typeof n||\"boolean\"==typeof n)&&\"$\"!==s[0]?r[s]=n:this.writeInto(r,s,n,t)}return r}writeObject(e,t,r=!0){const s={};this.refs.set(e,s);for(const n of Object.keys(e).sort()){const i=e[n];(\"number\"==typeof i&&Number.isFinite(i)&&!Object.is(i,-0)||\"string\"==typeof i||\"boolean\"==typeof i)&&\"$\"!==n[0]?s[n]=i:this.writeInto(s,n,i,t,r)}return s}writeArray(e,t,r=!0){const s=[];this.refs.set(e,s);for(let n=0;n<e.length;n++){const i=e[n];\"number\"==typeof i&&Number.isFinite(i)&&!Object.is(i,-0)||\"string\"==typeof i||\"boolean\"==typeof i?s[n]=i:this.writeInto(s,n,i,t,r)}return s}writeArrayBuffer(e){const t={$class:\"ArrayBuffer\",$value:Uh(e)};return this.refs.set(e,t),t}writeTypedArray(e,t){const r={$class:e,$value:[this.write(t.buffer),t.byteOffset,\"DataView\"===e?t.byteLength:t.length]};return this.refs.set(t,r),r}writeAs(e,t,r,s){const n={$class:e};this.refs.set(t,n);const i=this.write(r,s,!1);return\"object\"!=typeof i||null===i||i.$class||Array.isArray(i)?n.$value=i:Object.assign(n,i),n}writeRef(e){const t=this.refs.get(e);if(\"object\"!=typeof t)throw Error(\"Non-object in refs: \"+e);Array.isArray(t)&&(t.toJSON=function(){return{$id:this.$id,$class:\"Array\",$value:[...this]}});return{$ref:t.$id||(t.$id=this.nextRef++)}}writeInto(e,t,r,s,n=!0){if(\"$\"===t[0])return void(this.okayToIgnore[t]||(re(`snapshot: ignoring property ${t} (declare as okayToIgnore to suppress warning)`,{only:\"once\"}),this.okayToIgnore[t]=!0));if(n&&\"object\"==typeof r)return void this.todo.push({state:e,key:t,value:r,path:s});const i=s+(\"string\"==typeof t&&t.match(/^[_a-z][_a-z0-9]*$/i)?`.${t}`:`[${JSON.stringify(t)}]`),o=this.write(r,i);e[t]=o}}const Fh=Symbol(\"croquet:unresolved\");class Kh{static newOrRecycled(e){let t=this.reusableInstance;return t?(t.vm=e,t.refs=new Map,t.todo=[],t.unresolved=[],t.postprocess=[]):t=this.reusableInstance=new this(e),t}static get reusableInstance(){return this[this.name+\"-instance\"]}static set reusableInstance(e){this[this.name+\"-instance\"]=e}static resetInstance(){this.reusableInstance=null}constructor(e){this.vm=e,this.refs=new Map,this.todo=[],this.unresolved=[],this.postprocess=[],this.readers=new Map,this.addReader(\"Teatime:Message\",Yh),this.addReader(\"Teatime:Data\",gh),this.readers.set(\"Undefined\",(()=>{})),this.readers.set(\"NaN\",(()=>NaN)),this.readers.set(\"Infinity\",(e=>e*(1/0))),this.readers.set(\"NegZero\",(()=>-0)),this.readers.set(\"BigInt\",(e=>BigInt(e))),this.readers.set(\"ArrayBuffer\",(e=>function(e){const t=globalThis.atob(e),r=t.length,s=new Uint8Array(r);for(let e=0;e<r;e++)s[e]=t.charCodeAt(e);return s.buffer}(e))),this.readers.set(\"DataView\",(e=>new DataView(...e))),this.readers.set(\"Int8Array\",(e=>new Int8Array(...e))),this.readers.set(\"Uint8Array\",(e=>new Uint8Array(...e))),this.readers.set(\"Uint8ClampedArray\",(e=>new Uint8ClampedArray(...e))),this.readers.set(\"Int16Array\",(e=>new Int16Array(...e))),this.readers.set(\"Uint16Array\",(e=>new Uint16Array(...e))),this.readers.set(\"Int32Array\",(e=>new Int32Array(...e))),this.readers.set(\"Uint32Array\",(e=>new Uint32Array(...e))),this.readers.set(\"Float32Array\",(e=>new Float32Array(...e))),this.readers.set(\"Float64Array\",(e=>new Float64Array(...e)));for(const[e,t]of Dh.allClassTypes())this.addReader(e,t)}addReader(e,t){const r=\"object\"==typeof t?t.read:e=>Object.assign(Object.create(t.prototype),e);this.readers.set(e,r)}readVM(e,t){if(\"vm\"!==t)throw Error(\"VirtualMachine must be root object\");const r=this.read(e,t,!1);return this.readDeferred(),this.resolveRefs(),this.doPostprocess(),r}readDeferred(){let e=0;for(;e<this.todo.length;){const{object:t,key:r,value:s,path:n}=this.todo[e++];this.readInto(t,r,s,n,!1)}this.todo.length=0}resolveRefs(){for(const{object:e,key:t,ref:r,path:s}of this.unresolved){if(!this.refs.has(r))throw Error(`Unresolved ref: ${r} at ${s}[${JSON.stringify(t)}]`);e[t]=this.refs.get(r)}this.unresolved.length=0,this.refs.clear()}doPostprocess(){for(const e of this.postprocess)e();this.postprocess.length=0}read(e,t,r=!0){switch(typeof e){case\"number\":case\"string\":case\"boolean\":return e;default:{const s=Object.prototype.toString.call(e).slice(8,-1);switch(s){case\"Array\":return this.readArray(e,t,r);case\"Null\":return null;case\"Object\":{const{$class:s,$model:n,$ref:i}=e;if(i)throw Error(\"refs should have been handled in readInto()\");return n?this.readModel(e,t):s?this.readAs(s,e,t):this.readObject(Object,e,t,r)}default:throw Error(`Don't know how to deserialize ${s} at ${t}`)}}}}readModel(e,t){const r=Dh.instantiateClassID(e.$model,e.id);e.$id&&this.refs.set(e.$id,r);for(const[s,n]of Object.entries(e))\"id\"!==s&&\"$\"!==s[0]&&this.readInto(r,s,n,t);return r}readObject(e,t,r,s=!0){const n=new e;t.$id&&this.refs.set(t.$id,n);for(const[e,i]of Object.entries(t))\"$\"!==e[0]&&this.readInto(n,e,i,r,s);return n}readArray(e,t,r=!0){const s=[];e.$id&&this.refs.set(e.$id,s);for(let n=0;n<e.length;n++)void 0!==e[n]&&this.readInto(s,n,e[n],t,r);return s}readAsArray(e,t,r=!0){const s=e.$value;return e.$id&&(s.$id=e.$id),this.readArray(s,t,r)}readAsSet(e,t){const r=new Set;e.$id&&this.refs.set(e.$id,r);const s=this.unresolved.length,n=this.read(e.$value,t,!1),i=()=>{for(const e of n)r.add(e)};return this.unresolved.length===s?i():this.postprocess.push(i),r}readAsMap(e,t){const r=new Map;e.$id&&this.refs.set(e.$id,r);const s=this.unresolved.length,n=this.read(e.$value,t,!1),i=()=>{for(let e=0;e<n.length;e+=2)r.set(n[e],n[e+1])};return this.unresolved.length===s?i():this.postprocess.push(i),r}readAsClass(e,t,r){let s={};const n=new Map;if(\"$value\"in t)s=this.read(t.$value,r,!1);else for(const[e,i]of Object.entries(t)){if(\"$\"===e[0])continue;const t=i&&i.$ref;t?this.refs.has(t)?s[e]=this.refs.get(t):(s[e]=Fh,n.set(t,e)):this.readInto(s,e,i,r,!1)}const i=this.readers.get(e)(s,r);i||\"Undefined\"===e||\"BigInt\"===e||\"NaN\"===e||\"NegZero\"===e||console.warn(`Reading \"${e}\" returned ${i} at ${r}`),t.$id&&this.refs.set(t.$id,i);for(const[e,t]of n.entries())this.unresolved.push({object:i,key:t,ref:e,path:r});return i}readAs(e,t,r){switch(e){case\"Array\":return this.readAsArray(t,r);case\"Set\":return this.readAsSet(t,r);case\"Map\":return this.readAsMap(t,r);default:return this.readAsClass(e,t,r)}}readRef(e,t,r,s){if(!r||!r.$ref)return!1;const n=r.$ref;return this.refs.has(n)?e[t]=this.refs.get(n):(e[t]=Fh,this.unresolved.push({object:e,key:t,ref:n,path:s})),!0}readInto(e,t,r,s,n=!0){if(this.readRef(e,t,r,s))return;if(n&&\"object\"==typeof r)return void this.todo.push({object:e,key:t,value:r,path:s});const i=s+(\"string\"==typeof t&&t.match(/^[_a-z][_a-z0-9]*$/i)?`.${t}`:`[${JSON.stringify(t)}]`);e[t]=this.read(r,i)}}class Nh extends Eh{encode(e){const t=this.writeArray(e,\"args\");return this.writeDeferred(),t}writeModel(e){return{$ref:e.id}}}class zh extends Kh{decode(e){const t=this.readArray(e,\"args\");return this.readDeferred(),this.resolveRefs(),this.doPostprocess(),t}resolveRefs(){for(const{object:e,key:t,ref:r,path:s}of this.unresolved)if(this.refs.has(r))e[t]=this.refs.get(r);else{const n=this.vm.lookUpModel(r);if(!n)throw Error(`Unresolved ref: ${r} at ${s}[${JSON.stringify(t)}]`);e[t]=n}}}function jh(e,t=\"\",r={},s=new Set){const n=Object.values(e).filter((e=>{const t=Object.prototype.toString.call(e).slice(8,-1);return(\"Object\"===t||\"Array\"===t)&&!s.has(e)}));for(const e of n){s.add(e);const n=t+\".\"+e.constructor.name;if(r[n]){if(r[n]!==e.constructor)throw new Error(\"Class with name \"+n+\" already gathered, but new one has different identity\")}else r[n]=e.constructor}for(const e of n)jh(e,t,r,s)}function Uh(e){const t=new Uint8Array(e),r=[];for(let e=0;e<t.byteLength;e+=4096){const s=t.subarray(e,e+4096);r.push(String.fromCharCode.apply(null,s))}return globalThis.btoa(r.join(\"\"))}const Oh={classes:H.has(\"debug\",\"classes\",!1),write:void 0};let Qh=Symbol(\"SECRET\");const Jh=new WeakSet;class Dh{static create(e,t,r){if(!qh(this))throw Error(`Model class \"${this.name}\" not registered`);const s=this,n=this.createNoInit();return Jh.add(n),\"string\"==typeof t&&(console.warn(`Croquet: Model.create(..., \"${t}\") with a well-known name argument is deprecated!`),n.beWellKnownAs(t),t=void 0),r&&n.beWellKnownAs(r),n.init(e,t),Jh.has(n)&&(Jh.delete(n),Object.getPrototypeOf(s)!==Dh&&console.warn(`${n} did not call super.init(options)`)),n}static createNoInit(e){const t=ue(),r=new this(Qh);return e||(e=t.register(r)),void 0===Oh.write&&(Oh.write=H.has(\"debug\",\"write\",!1)),Object.defineProperty(r,\"__realm\",{value:t,writable:Oh.write}),Object.defineProperty(r,\"id\",{value:e,enumerable:!0}),r}static allowConstructors(){Qh=void 0,console.warn(\"disabling error reporting for Model constructors\")}static register(e){return e||(e=this.name,console.warn(`Deprecation warning: ${this.name}.register(classId) called without classId. See https://croquet.io/docs/croquet/Model.html#.register`)),Kh.resetInstance(),Eh.resetInstance(),Nh.resetInstance(),zh.resetInstance(),function(e,t){const r=Q(e),s=$(`${t}:${r}`);q.push(s),s.then((e=>B[e].what=`Class ${t}`))}(this,e),function(e,t){const r=Bh[t];if(r&&r!==e)throw Error(`Registering model class ${e.name} failed, id \"${t}\" already used by ${r.name}`);qh(e)?Oh.classes&&!r&&console.warn(`ignoring re-exported model class ${t}`):(Oh.classes&&console.log(`registering model class ${t}`),e[Ah]=t);Bh[t]=e}(this,e),Dh.lastRegistered=this,this}static wellKnownModel(e){if(!Ph.hasCurrent())throw Error(\"static Model.wellKnownModel() called from outside model\");return Ph.current().get(e)}static evaluate(e){return Ph.evaluate(e)}static types(){return{}}static okayToIgnore(){return[]}static classToID(e){return function(e){if(qh(e))return e[Ah];const t=e.name||\"ClassName\";throw Error(`Model class not registered, did you call ${t}.register(\"${t}\")?`)}(e)}static classFromID(e){return eu(e)}static allClasses(){return $h()}static allClassTypes(){return function(){const e={};for(const t of $h())Object.assign(e,t.types());return Object.entries(e)}()}static instantiateClassID(e,t){return eu(e).createNoInit(t)}constructor(e){if(e!==Qh)throw Error('You must create Croquet Models using create() not \"new\"!')}init(e,t){Jh.delete(this)}destroy(){ue().unsubscribeAll(this),ue().deregister(this)}publish(e,t,r){this.__realm||this.__realmError(),this.__realm.publish(t,r,e)}subscribe(e,t,r){return this.__realm||this.__realmError(),this.__realm.subscribe(this,e,t,r)}unsubscribe(e,t,r=\"*\"){this.__realm||this.__realmError(),this.__realm.unsubscribe(this,e,t,r)}unsubscribeAll(){this.__realm||this.__realmError(),this.__realm.unsubscribeAll(this)}__realmError(){if(!this.id)throw Error(`${this} has no ID, did you call super.init(options)?`)}future(e=0,t,...r){return this.__realm||this.__realmError(),this.__realm.future(this,e,t,r)}cancelFuture(e){return this.__realm||this.__realmError(),this.__realm.cancelFuture(this,e)}random(){return ue().random()}now(){return ue().now()}beWellKnownAs(e){ue().vm.set(e,this)}getModel(e){return this.__realm.vm.lookUpModel(e)}wellKnownModel(e){return this.__realm.vm.get(e)}modelOnly(e){if(Ph.current()===this.__realm.vm)return!0;const t=Error(e||`${this}.modelOnly() called from outside a model!`);throw ne(\"view code\",t),t}get sessionId(){return this.__realm.vm.id}get viewCount(){return Object.keys(this.__realm.vm.views).length}persistSession(e){if(this!==this.wellKnownModel(\"modelRoot\"))throw Error(\"persistSession() must only be called on the root model\");this.__realm.vm.persist(this,e)}[Symbol.toPrimitive](){return`${this.constructor[Ah]||this.constructor.name}#${this.id}`}}const Bh={},Ah=Symbol(\"CLASS_ID\");function $h(){return Object.values(Bh)}function qh(e){return Object.prototype.hasOwnProperty.call(e,Ah)}function eu(e){if(Bh[e])return Bh[e];throw Error(`Model class \"${e}\" in snapshot, but not registered?`)}Dh[Ah]=\"Croquet.Model\",Bh[\"Croquet.Model\"]=Dh;class tu{static displayStatus(e,t){return se(e,t)}static displayWarning(e,t){return re(e,t)}static displayError(e,t){return function(e,t={}){return e&&ie.showMessage(e,{...t,level:\"error\"})}(e,t)}constructor(e){\"object\"==typeof e&&\"__realm\"in e||console.warn(\"Croquet: argument to View constructor needs to be a Model\");let t=ue(\"\");t&&t.isViewRealm()||(t=pe(e.__realm.vm,(()=>ue()),!0)),Object.defineProperty(this,\"realm\",{value:t}),Object.defineProperty(this,\"id\",{value:t.register(this),configurable:!0});const r=t.vm.controller.session;r.view||(r.view=this)}detach(){this.unsubscribeAll(),this.realm.deregister(this),Object.defineProperty(this,\"id\",{value:\"\"})}reattach(){Object.defineProperty(this,\"id\",{value:this.realm.register(this)})}publish(e,t,r){this.realm.publish(t,r,e)}subscribe(e,t,r){\"string\"==typeof r&&(r=this[r]);const s=r;(r=s.bind(this)).unbound=s;const{event:n,handling:i}=t.event?t:{event:t};this.realm.subscribe(n,this.id,r,e,i)}unsubscribe(e,t,r=null){\"string\"==typeof r&&(r=this[r]),this.realm.unsubscribe(t,this.id,r,e)}unsubscribeAll(){this.realm.unsubscribeAll(this.id)}future(e=0){return this.realm.future(this,e)}random(){return ue().random()}now(){return this.realm.now()}externalNow(){return this.realm.externalNow()}extrapolatedNow(){return this.realm.extrapolatedNow()}update(e){}wellKnownModel(e){return this.realm.vm.get(e)}get sessionId(){return this.realm.vm.id}get session(){return this.realm.vm.controller.session}get viewId(){return this.realm.vm.controller.viewId}[Symbol.toPrimitive](){const e=this.constructor.name;return e.includes(\"View\")?e:`${e}[View]`}}const ru=new class{constructor(){this.ready=!1}setReceiver(e){}setIframeEnumerator(e){}on(e,t){}detach(){}removeSubscription(e,t){}removeAllSubscriptions(){}receive(e){}handleEvent(e,t,r){}send(e,t,r){}startPublishingPointerMove(){}stopPublishingPointerMove(){}};let su=60;class nu{static async join(e){try{return await this.join_impl(e)}catch(e){throw ie.showMessage(e.message||e,{level:\"fatal\"}),e}}static async join_impl(e){if(\"object\"!=typeof e)throw Error(\"Croquet: please use new Session.join( {apiKey, ...} ) API. See https://croquet.io/docs/croquet/Session.html#.join\");e.appId||(e.appId=\"no.appId\"),e.name||(e.name=ie.autoSession(),e.password||(e.password=ie.autoPassword())),e.model||(e.model=Dh.lastRegistered),e.view||(e.view=tu);for(const[p,m]of Object.entries(e))m instanceof Promise&&(e[p]=await m);function t(e,t){return e===t||e.prototype instanceof t}if(\"string\"!=typeof e.apiKey)throw Error(\"Croquet: no apiKey provided in Session.join()!\");if(e.apiKey.length>128)throw Error(\"Croquet: apiKey > 128 characters in Session.join()!\");if(\"string\"!=typeof e.name)throw Error(\"Croquet: no session name provided in Session.join()!\");if(e.name.length>128)throw Error(\"Croquet: session name > 128 characters in Session.join()!\");const r=e.model;if(\"function\"!=typeof r||!t(r,Dh))throw Error(\"Croquet: bad model class in Session.join()\");const s=e.view||tu;if(\"function\"!=typeof s||!t(s,tu))throw Error(\"Croquet: bad view class in Session.join()\");if(\"string\"!=typeof e.appId)throw Error(\"Croquet: no appId provided in Session.join()\");if(!e.appId.length>128)throw Error(\"Croquet: appId > 128 characters in Session.join()\");if(!e.appId.match(/^[a-z](-?[a-z0-9_])*(\\.[a-z0-9_](-?[a-z0-9_])*)+$/i))throw Error(\"Croquet: malformed appId in Session.join()\");if(\"string\"!=typeof e.password||!e.password)throw Error(\"Croquet: no password provided in Session.join()\");const n=H.reflector||e.reflector;n&&(H.reflector=n);const i=H.files||e.files;i&&(H.files=i);const o=H.backend||e.backend;if(o&&(H.backend=o),\"manual\"!==e.step)throw Error(\"stepping must be manual in a Node.js app\");if(\"rejoinLimit\"in e){if(\"number\"!=typeof e.rejoinLimit||e.rejoinLimit<0||e.rejoinLimit>6e4)throw Error(\"rejoinLimit range: 0-60000\")}else e.rejoinLimit=1e3;if(\"eventRateLimit\"in e){if(\"number\"!=typeof e.eventRateLimit||e.eventRateLimit<1||e.eventRateLimit>60)throw Error(\"eventRateLimit range: 1-60\")}else e.eventRateLimit=20;if(e.heraldUrl){if(e.heraldUrl.length>256)throw Error(\"heraldUrl can only be 256 characters\");if(!e.heraldUrl.startsWith(\"https://\"))throw Error(\"heraldUrl needs to be https\")}if(e.hashOverride){if(43!==e.hashOverride.length)throw Error(\"hashOverride must be 43 characters\");if(-1!==e.hashOverride.search(/[^-_a-zA-Z0-9]/))throw Error(\"hashOverride must be base64url encoded\")}if(e.debug){function b(e){return\"string\"==typeof e&&(e=e.split(\",\")),e?Array.isArray(e)?e:[e]:[]}H.debug=[...b(e.debug),...b(H.debug)].join(\",\")}if(\"autoSleep\"in e){const y=e.autoSleep,g=typeof y;if(\"number\"===g){if(y<0)throw Error(\"an autoSleep value must be >= 0\")}else{if(\"boolean\"!==g)throw Error(\"autoSleep must be numeric or boolean\");e.autoSleep=y?10:0}}else e.autoSleep=10;if(e.flags){let w=e.flags;\"string\"==typeof w&&(w=w.split(\",\")),w=w?Array.isArray(w)?w:[w]:[],w=w.filter((e=>\"object\"!=typeof e)),w.length?(e.flags={},w.forEach((t=>e.flags[t]=!0))):e.flags=null}\"expectedSimFPS\"in e&&(su=Math.min(e.expectedSimFPS,120));const a=[\"name\",\"password\",\"apiKey\",\"appId\",\"tps\",\"autoSleep\",\"heraldUrl\",\"rejoinLimit\",\"eventRateLimit\",\"optionsFromUrl\",\"viewOptions\",\"viewIdDebugSuffix\",\"hashOverride\",\"location\",\"flags\",\"progressReporter\"];!function(){if(Object.isFrozen(iu))return;ou(iu),function(e){const t=JSON.stringify(e,((e,t)=>\"function\"==typeof t?Q(t):t));if(\"{}\"===t)return;const r=JSON.parse(t),s=$(E(r));q.push(s),s.then((e=>B[e].what=\"Croquet Constants\"))}(iu)}();const l=new ah,c=JSON.parse(JSON.stringify({...e.options})),d={id:\"\",persistentId:\"\",versionId:\"\",name:e.name,model:null,view:null,step(e){l.stepSession(\"animation\",{frameTime:e,view:d.view,expectedSimFPS:su})},leave:()=>nu.leave(d.id),get latency(){return l.latency},get latencies(){return l.latencies}},h={options:c,initFn:(e,t)=>r.create(e,t,\"modelRoot\"),rebootModelView:f};for(const[S,v]of Object.entries(e))a.includes(S)&&(h[S]=v);await l.initFromSessionSpec(h);let u=!1;return await f(),\"manual\"!==e.step&&l.startStepping(d.step),d;async function f(){!function(){d.model=null,d.view&&(H.has(\"debug\",\"session\",!1)&&console.log(d.id,\"detaching root view\"),d.view.detach(),\"\"!==d.view.id&&console.warn(`Croquet: ${d.view} did not call super.detach()`),d.view=null);ie.clearSessionMoniker(),ru.ready&&ru.detach()}(),l.leaving?l.leaving(!0):u||(u=!0,await l.establishSession(h),u=!1,d.model=l.vm.get(\"modelRoot\"),d.id=l.id,d.persistentId=l.persistentId,d.versionId=l.versionId,l.session=d,ie.makeSessionWidgets(d.id),l.inViewRealm((()=>{H.has(\"debug\",\"session\",!1)&&console.log(d.id,\"creating root view\"),new s(d.model,h.viewOptions)})))}}static async leave(e){const t=function(e){for(const t of ih)if(t.id===e)return t;return null}(e);if(!t)return!1;t.reconnectTimeout&&(clearTimeout(t.reconnectTimeout),delete t.reconnectTimeout);const r=new Promise((e=>t.leaving=e)),s=t.connection;return!!s.connected&&(s.closeConnection(1e3),r)}static thisSession(){const e=Ph.current();return e?e.id:\"\"}}const iu={};function ou(e){if(!Object.isFrozen(e)){Object.freeze(e);for(const t of Object.values(e))!t||\"object\"!=typeof t&&\"function\"!=typeof t||ou(t)}}let au=0;const lu={START_BOUNDARY:au++,HEADER_FIELD_START:au++,HEADER_FIELD:au++,HEADER_VALUE_START:au++,HEADER_VALUE:au++,HEADER_VALUE_ALMOST_DONE:au++,HEADERS_ALMOST_DONE:au++,PART_DATA_START:au++,PART_DATA:au++,END:au++};let cu=1;const du=cu,hu=cu*=2,uu=e=>32|e,fu=()=>{};class pu{constructor(e){this.index=0,this.flags=0,this.onHeaderEnd=fu,this.onHeaderField=fu,this.onHeadersEnd=fu,this.onHeaderValue=fu,this.onPartBegin=fu,this.onPartData=fu,this.onPartEnd=fu,this.boundaryChars={},e=\"\\r\\n--\"+e;const t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r),this.boundaryChars[t[r]]=!0;this.boundary=t,this.lookbehind=new Uint8Array(this.boundary.length+8),this.state=lu.START_BOUNDARY}write(e){let t=0;const r=e.length;let s=this.index,{lookbehind:n,boundary:i,boundaryChars:o,index:a,state:l,flags:c}=this;const d=this.boundary.length,h=d-1,u=e.length;let f,p;const m=e=>{this[e+\"Mark\"]=t},b=e=>{delete this[e+\"Mark\"]},y=(e,t,r,s)=>{void 0!==t&&t===r||this[e](s&&s.subarray(t,r))},g=(r,s)=>{const n=r+\"Mark\";n in this&&(s?(y(r,this[n],t,e),delete this[n]):(y(r,this[n],e.length,e),this[n]=0))};for(t=0;t<r;t++)switch(f=e[t],l){case lu.START_BOUNDARY:if(a===i.length-2){if(45===f)c|=hu;else if(13!==f)return;a++;break}if(a-1==i.length-2){if(c&hu&&45===f)l=lu.END,c=0;else{if(c&hu||10!==f)return;a=0,y(\"onPartBegin\"),l=lu.HEADER_FIELD_START}break}f!==i[a+2]&&(a=-2),f===i[a+2]&&a++;break;case lu.HEADER_FIELD_START:l=lu.HEADER_FIELD,m(\"onHeaderField\"),a=0;case lu.HEADER_FIELD:if(13===f){b(\"onHeaderField\"),l=lu.HEADERS_ALMOST_DONE;break}if(a++,45===f)break;if(58===f){if(1===a)return;g(\"onHeaderField\",!0),l=lu.HEADER_VALUE_START;break}if(p=uu(f),p<97||p>122)return;break;case lu.HEADER_VALUE_START:if(32===f)break;m(\"onHeaderValue\"),l=lu.HEADER_VALUE;case lu.HEADER_VALUE:13===f&&(g(\"onHeaderValue\",!0),y(\"onHeaderEnd\"),l=lu.HEADER_VALUE_ALMOST_DONE);break;case lu.HEADER_VALUE_ALMOST_DONE:if(10!==f)return;l=lu.HEADER_FIELD_START;break;case lu.HEADERS_ALMOST_DONE:if(10!==f)return;y(\"onHeadersEnd\"),l=lu.PART_DATA_START;break;case lu.PART_DATA_START:l=lu.PART_DATA,m(\"onPartData\");case lu.PART_DATA:if(s=a,0===a){for(t+=h;t<u&&!(e[t]in o);)t+=d;t-=h,f=e[t]}if(a<i.length)i[a]===f?(0===a&&g(\"onPartData\",!0),a++):a=0;else if(a===i.length)a++,13===f?c|=du:45===f?c|=hu:a=0;else if(a-1===i.length)if(c&du){if(a=0,10===f){c&=~du,y(\"onPartEnd\"),y(\"onPartBegin\"),l=lu.HEADER_FIELD_START;break}}else c&hu&&45===f?(y(\"onPartEnd\"),l=lu.END,c=0):a=0;if(a>0)n[a-1]=f;else if(s>0){const e=new Uint8Array(n.buffer,n.byteOffset,n.byteLength);y(\"onPartData\",0,s,e),s=0,m(\"onPartData\"),t--}break;case lu.END:break;default:throw new Error(`Unexpected state entered: ${l}`)}g(\"onHeaderField\"),g(\"onHeaderValue\"),g(\"onPartData\"),this.index=a,this.state=l,this.flags=c}end(){if(this.state===lu.HEADER_FIELD_START&&0===this.index||this.state===lu.PART_DATA&&this.index===this.boundary.length)this.onPartEnd();else if(this.state!==lu.END)throw new Error(\"MultipartParser.end(): stream ended unexpectedly\")}}var mu=Object.freeze({__proto__:null,toFormData:async function(e,t){if(!/multipart/i.test(t))throw new TypeError(\"Failed to fetch\");const r=t.match(/boundary=(?:\"([^\"]+)\"|([^;]+))/i);if(!r)throw new TypeError(\"no or bad content-type header, no multipart boundary\");const s=new pu(r[1]||r[2]);let n,i,o,a,l,c;const d=[],h=new cd,u=e=>{o+=b.decode(e,{stream:!0})},f=e=>{d.push(e)},p=()=>{const e=new ed(d,c,{type:l});h.append(a,e)},m=()=>{h.append(a,o)},b=new TextDecoder(\"utf-8\");b.decode(),s.onPartBegin=function(){s.onPartData=u,s.onPartEnd=m,n=\"\",i=\"\",o=\"\",a=\"\",l=\"\",c=null,d.length=0},s.onHeaderField=function(e){n+=b.decode(e,{stream:!0})},s.onHeaderValue=function(e){i+=b.decode(e,{stream:!0})},s.onHeaderEnd=function(){if(i+=b.decode(),n=n.toLowerCase(),\"content-disposition\"===n){const e=i.match(/\\bname=(\"([^\"]*)\"|([^()<>@,;:\\\\\"/[\\]?={}\\s\\t]+))/i);e&&(a=e[2]||e[3]||\"\"),c=function(e){const t=e.match(/\\bfilename=(\"(.*?)\"|([^()<>@,;:\\\\\"/[\\]?={}\\s\\t]+))($|;\\s)/i);if(!t)return;const r=t[2]||t[3]||\"\";let s=r.slice(r.lastIndexOf(\"\\\\\")+1);return s=s.replace(/%22/g,'\"'),s=s.replace(/&#(\\d{4});/g,((e,t)=>String.fromCharCode(t))),s}(i),c&&(s.onPartData=f,s.onPartEnd=p)}else\"content-type\"===n&&(l=i);i=\"\",n=\"\"};for await(const t of e)s.write(t);return s.end(),h}});exports.App=ie,exports.Constants=iu,exports.Data=yh,exports.Messenger=ru,exports.Model=Dh,exports.Session=nu,exports.View=tu,exports.gatherInternalClassTypes=function(e,t){const r={};return jh({root:e},t,r,new Set),r},exports.startSession=function(...e){return ie.showMessage(\"Croquet.startSession() is deprecated, please use Croquet.Session.join()\",{level:\"warning\",only:\"once\"}),nu.join(...e)};\n\n\n\n//# sourceURL=webpack:///../node_modules/@croquet/croquet/cjs/croquet-croquet-node.js?");

/***/ }),

/***/ "../node_modules/@croquet/worldcore-kernel/index.js":
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AM_Avatar: () => (/* reexport safe */ _src_User__WEBPACK_IMPORTED_MODULE_8__.AM_Avatar),\n/* harmony export */   AM_Behavioral: () => (/* reexport safe */ _src_Behavior__WEBPACK_IMPORTED_MODULE_2__.AM_Behavioral),\n/* harmony export */   AM_Grid: () => (/* reexport safe */ _src_NavGrid__WEBPACK_IMPORTED_MODULE_13__.AM_Grid),\n/* harmony export */   AM_NavGrid: () => (/* reexport safe */ _src_NavGrid__WEBPACK_IMPORTED_MODULE_13__.AM_NavGrid),\n/* harmony export */   AM_OnGrid: () => (/* reexport safe */ _src_NavGrid__WEBPACK_IMPORTED_MODULE_13__.AM_OnGrid),\n/* harmony export */   AM_OnNavGrid: () => (/* reexport safe */ _src_NavGrid__WEBPACK_IMPORTED_MODULE_13__.AM_OnNavGrid),\n/* harmony export */   AM_Smoothed: () => (/* reexport safe */ _src_Mixins__WEBPACK_IMPORTED_MODULE_4__.AM_Smoothed),\n/* harmony export */   AM_Spatial: () => (/* reexport safe */ _src_Mixins__WEBPACK_IMPORTED_MODULE_4__.AM_Spatial),\n/* harmony export */   AM_Spec: () => (/* reexport safe */ _src_Spec__WEBPACK_IMPORTED_MODULE_7__.AM_Spec),\n/* harmony export */   Account: () => (/* reexport safe */ _src_User__WEBPACK_IMPORTED_MODULE_8__.Account),\n/* harmony export */   AccountManager: () => (/* reexport safe */ _src_User__WEBPACK_IMPORTED_MODULE_8__.AccountManager),\n/* harmony export */   Actor: () => (/* reexport safe */ _src_Actor__WEBPACK_IMPORTED_MODULE_1__.Actor),\n/* harmony export */   ActorManager: () => (/* reexport safe */ _src_Actor__WEBPACK_IMPORTED_MODULE_1__.ActorManager),\n/* harmony export */   Behavior: () => (/* reexport safe */ _src_Behavior__WEBPACK_IMPORTED_MODULE_2__.Behavior),\n/* harmony export */   BranchBehavior: () => (/* reexport safe */ _src_Behavior__WEBPACK_IMPORTED_MODULE_2__.BranchBehavior),\n/* harmony export */   CompositeBehavior: () => (/* reexport safe */ _src_Behavior__WEBPACK_IMPORTED_MODULE_2__.CompositeBehavior),\n/* harmony export */   CreateFromSpec: () => (/* reexport safe */ _src_Spec__WEBPACK_IMPORTED_MODULE_7__.CreateFromSpec),\n/* harmony export */   DecoratorBehavior: () => (/* reexport safe */ _src_Behavior__WEBPACK_IMPORTED_MODULE_2__.DecoratorBehavior),\n/* harmony export */   DelayBehavior: () => (/* reexport safe */ _src_Behavior__WEBPACK_IMPORTED_MODULE_2__.DelayBehavior),\n/* harmony export */   DestroyBehavior: () => (/* reexport safe */ _src_Behavior__WEBPACK_IMPORTED_MODULE_2__.DestroyBehavior),\n/* harmony export */   FailBehavior: () => (/* reexport safe */ _src_Behavior__WEBPACK_IMPORTED_MODULE_2__.FailBehavior),\n/* harmony export */   GetModelService: () => (/* reexport safe */ _src_Root__WEBPACK_IMPORTED_MODULE_6__.GetModelService),\n/* harmony export */   GetPawn: () => (/* reexport safe */ _src_Pawn__WEBPACK_IMPORTED_MODULE_5__.GetPawn),\n/* harmony export */   GetViewService: () => (/* reexport safe */ _src_Root__WEBPACK_IMPORTED_MODULE_6__.GetViewService),\n/* harmony export */   InputManager: () => (/* reexport safe */ _src_Input__WEBPACK_IMPORTED_MODULE_12__.InputManager),\n/* harmony export */   InterruptBehavior: () => (/* reexport safe */ _src_Behavior__WEBPACK_IMPORTED_MODULE_2__.InterruptBehavior),\n/* harmony export */   InvertBehavior: () => (/* reexport safe */ _src_Behavior__WEBPACK_IMPORTED_MODULE_2__.InvertBehavior),\n/* harmony export */   KeyDown: () => (/* reexport safe */ _src_Input__WEBPACK_IMPORTED_MODULE_12__.KeyDown),\n/* harmony export */   LevelManager: () => (/* reexport safe */ _src_Level__WEBPACK_IMPORTED_MODULE_3__.LevelManager),\n/* harmony export */   LoopBehavior: () => (/* reexport safe */ _src_Behavior__WEBPACK_IMPORTED_MODULE_2__.LoopBehavior),\n/* harmony export */   ModelRoot: () => (/* reexport safe */ _src_Root__WEBPACK_IMPORTED_MODULE_6__.ModelRoot),\n/* harmony export */   ModelService: () => (/* reexport safe */ _src_Root__WEBPACK_IMPORTED_MODULE_6__.ModelService),\n/* harmony export */   PM_Avatar: () => (/* reexport safe */ _src_User__WEBPACK_IMPORTED_MODULE_8__.PM_Avatar),\n/* harmony export */   PM_Smoothed: () => (/* reexport safe */ _src_Mixins__WEBPACK_IMPORTED_MODULE_4__.PM_Smoothed),\n/* harmony export */   PM_Spatial: () => (/* reexport safe */ _src_Mixins__WEBPACK_IMPORTED_MODULE_4__.PM_Spatial),\n/* harmony export */   Pawn: () => (/* reexport safe */ _src_Pawn__WEBPACK_IMPORTED_MODULE_5__.Pawn),\n/* harmony export */   PawnManager: () => (/* reexport safe */ _src_Pawn__WEBPACK_IMPORTED_MODULE_5__.PawnManager),\n/* harmony export */   PerlinNoise: () => (/* reexport safe */ _src_Utilities__WEBPACK_IMPORTED_MODULE_9__.PerlinNoise),\n/* harmony export */   PrintBehavior: () => (/* reexport safe */ _src_Behavior__WEBPACK_IMPORTED_MODULE_2__.PrintBehavior),\n/* harmony export */   PriorityQueue: () => (/* reexport safe */ _src_Utilities__WEBPACK_IMPORTED_MODULE_9__.PriorityQueue),\n/* harmony export */   PublishBehavior: () => (/* reexport safe */ _src_Behavior__WEBPACK_IMPORTED_MODULE_2__.PublishBehavior),\n/* harmony export */   RandomBehavior: () => (/* reexport safe */ _src_Behavior__WEBPACK_IMPORTED_MODULE_2__.RandomBehavior),\n/* harmony export */   RegisterMixin: () => (/* reexport safe */ _src_Mixins__WEBPACK_IMPORTED_MODULE_4__.RegisterMixin),\n/* harmony export */   RetryBehavior: () => (/* reexport safe */ _src_Behavior__WEBPACK_IMPORTED_MODULE_2__.RetryBehavior),\n/* harmony export */   SelectorBehavior: () => (/* reexport safe */ _src_Behavior__WEBPACK_IMPORTED_MODULE_2__.SelectorBehavior),\n/* harmony export */   SequenceBehavior: () => (/* reexport safe */ _src_Behavior__WEBPACK_IMPORTED_MODULE_2__.SequenceBehavior),\n/* harmony export */   SetBehavior: () => (/* reexport safe */ _src_Behavior__WEBPACK_IMPORTED_MODULE_2__.SetBehavior),\n/* harmony export */   Shuffle: () => (/* reexport safe */ _src_Utilities__WEBPACK_IMPORTED_MODULE_9__.Shuffle),\n/* harmony export */   SpinBehavior: () => (/* reexport safe */ _src_Behavior__WEBPACK_IMPORTED_MODULE_2__.SpinBehavior),\n/* harmony export */   StartWorldcore: () => (/* reexport safe */ _src_Root__WEBPACK_IMPORTED_MODULE_6__.StartWorldcore),\n/* harmony export */   SubscribeBehavior: () => (/* reexport safe */ _src_Behavior__WEBPACK_IMPORTED_MODULE_2__.SubscribeBehavior),\n/* harmony export */   SucceedBehavior: () => (/* reexport safe */ _src_Behavior__WEBPACK_IMPORTED_MODULE_2__.SucceedBehavior),\n/* harmony export */   TAU: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.TAU),\n/* harmony export */   TO_DEG: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.TO_DEG),\n/* harmony export */   TO_RAD: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.TO_RAD),\n/* harmony export */   TryBehavior: () => (/* reexport safe */ _src_Behavior__WEBPACK_IMPORTED_MODULE_2__.TryBehavior),\n/* harmony export */   TwoWayMap: () => (/* reexport safe */ _src_Utilities__WEBPACK_IMPORTED_MODULE_9__.TwoWayMap),\n/* harmony export */   User: () => (/* reexport safe */ _src_User__WEBPACK_IMPORTED_MODULE_8__.User),\n/* harmony export */   UserManager: () => (/* reexport safe */ _src_User__WEBPACK_IMPORTED_MODULE_8__.UserManager),\n/* harmony export */   ViewRoot: () => (/* reexport safe */ _src_Root__WEBPACK_IMPORTED_MODULE_6__.ViewRoot),\n/* harmony export */   ViewService: () => (/* reexport safe */ _src_Root__WEBPACK_IMPORTED_MODULE_6__.ViewService),\n/* harmony export */   Widget: () => (/* reexport safe */ _src_Widget__WEBPACK_IMPORTED_MODULE_11__.Widget),\n/* harmony export */   WorldcoreModel: () => (/* reexport safe */ _src_Root__WEBPACK_IMPORTED_MODULE_6__.WorldcoreModel),\n/* harmony export */   WorldcoreView: () => (/* reexport safe */ _src_Root__WEBPACK_IMPORTED_MODULE_6__.WorldcoreView),\n/* harmony export */   clampRad: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.clampRad),\n/* harmony export */   fromD: () => (/* reexport safe */ _src_Behavior__WEBPACK_IMPORTED_MODULE_2__.fromD),\n/* harmony export */   fromH: () => (/* reexport safe */ _src_Behavior__WEBPACK_IMPORTED_MODULE_2__.fromH),\n/* harmony export */   fromM: () => (/* reexport safe */ _src_Behavior__WEBPACK_IMPORTED_MODULE_2__.fromM),\n/* harmony export */   fromS: () => (/* reexport safe */ _src_Behavior__WEBPACK_IMPORTED_MODULE_2__.fromS),\n/* harmony export */   gaussian: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.gaussian),\n/* harmony export */   m2_identity: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.m2_identity),\n/* harmony export */   m2_rotation: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.m2_rotation),\n/* harmony export */   m2_zero: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.m2_zero),\n/* harmony export */   m4_determinant: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.m4_determinant),\n/* harmony export */   m4_getRotation: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.m4_getRotation),\n/* harmony export */   m4_getScale: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.m4_getScale),\n/* harmony export */   m4_getScaleRotationTranslation: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.m4_getScaleRotationTranslation),\n/* harmony export */   m4_getTranslation: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.m4_getTranslation),\n/* harmony export */   m4_identity: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.m4_identity),\n/* harmony export */   m4_invert: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.m4_invert),\n/* harmony export */   m4_multiply: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.m4_multiply),\n/* harmony export */   m4_perspective: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.m4_perspective),\n/* harmony export */   m4_rotation: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.m4_rotation),\n/* harmony export */   m4_rotationQ: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.m4_rotationQ),\n/* harmony export */   m4_rotationX: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.m4_rotationX),\n/* harmony export */   m4_rotationY: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.m4_rotationY),\n/* harmony export */   m4_rotationZ: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.m4_rotationZ),\n/* harmony export */   m4_scale: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.m4_scale),\n/* harmony export */   m4_scaleRotationTranslation: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.m4_scaleRotationTranslation),\n/* harmony export */   m4_toNormal4: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.m4_toNormal4),\n/* harmony export */   m4_translation: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.m4_translation),\n/* harmony export */   m4_transpose: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.m4_transpose),\n/* harmony export */   m4_zero: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.m4_zero),\n/* harmony export */   mix: () => (/* reexport safe */ _src_Mixins__WEBPACK_IMPORTED_MODULE_4__.mix),\n/* harmony export */   q_axisAngle: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.q_axisAngle),\n/* harmony export */   q_conjugate: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.q_conjugate),\n/* harmony export */   q_dot: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.q_dot),\n/* harmony export */   q_equals: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.q_equals),\n/* harmony export */   q_euler: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.q_euler),\n/* harmony export */   q_eulerYXZ: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.q_eulerYXZ),\n/* harmony export */   q_identity: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.q_identity),\n/* harmony export */   q_invert: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.q_invert),\n/* harmony export */   q_isZero: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.q_isZero),\n/* harmony export */   q_lookAt: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.q_lookAt),\n/* harmony export */   q_magnitude: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.q_magnitude),\n/* harmony export */   q_multiply: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.q_multiply),\n/* harmony export */   q_normalize: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.q_normalize),\n/* harmony export */   q_pitch: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.q_pitch),\n/* harmony export */   q_roll: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.q_roll),\n/* harmony export */   q_slerp: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.q_slerp),\n/* harmony export */   q_toAxisAngle: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.q_toAxisAngle),\n/* harmony export */   q_yaw: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.q_yaw),\n/* harmony export */   rayTriangleIntersect: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.rayTriangleIntersect),\n/* harmony export */   slerp: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.slerp),\n/* harmony export */   sphericalRandom: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.sphericalRandom),\n/* harmony export */   toDeg: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.toDeg),\n/* harmony export */   toRad: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.toRad),\n/* harmony export */   v2_abs: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.v2_abs),\n/* harmony export */   v2_add: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.v2_add),\n/* harmony export */   v2_angle: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.v2_angle),\n/* harmony export */   v2_ceil: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.v2_ceil),\n/* harmony export */   v2_closest: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.v2_closest),\n/* harmony export */   v2_distance: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.v2_distance),\n/* harmony export */   v2_distanceSqr: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.v2_distanceSqr),\n/* harmony export */   v2_divide: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.v2_divide),\n/* harmony export */   v2_dot: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.v2_dot),\n/* harmony export */   v2_equals: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.v2_equals),\n/* harmony export */   v2_floor: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.v2_floor),\n/* harmony export */   v2_inverse: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.v2_inverse),\n/* harmony export */   v2_isZero: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.v2_isZero),\n/* harmony export */   v2_lerp: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.v2_lerp),\n/* harmony export */   v2_magnitude: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.v2_magnitude),\n/* harmony export */   v2_manhattan: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.v2_manhattan),\n/* harmony export */   v2_max: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.v2_max),\n/* harmony export */   v2_min: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.v2_min),\n/* harmony export */   v2_multiply: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.v2_multiply),\n/* harmony export */   v2_normalize: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.v2_normalize),\n/* harmony export */   v2_perpendicular: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.v2_perpendicular),\n/* harmony export */   v2_random: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.v2_random),\n/* harmony export */   v2_rotate: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.v2_rotate),\n/* harmony export */   v2_scale: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.v2_scale),\n/* harmony export */   v2_signedAngle: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.v2_signedAngle),\n/* harmony export */   v2_sqrMag: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.v2_sqrMag),\n/* harmony export */   v2_sub: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.v2_sub),\n/* harmony export */   v2_transform: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.v2_transform),\n/* harmony export */   v2_zero: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.v2_zero),\n/* harmony export */   v3_abs: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.v3_abs),\n/* harmony export */   v3_add: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.v3_add),\n/* harmony export */   v3_angle: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.v3_angle),\n/* harmony export */   v3_ceil: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.v3_ceil),\n/* harmony export */   v3_cross: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.v3_cross),\n/* harmony export */   v3_distance: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.v3_distance),\n/* harmony export */   v3_distanceSqr: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.v3_distanceSqr),\n/* harmony export */   v3_divide: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.v3_divide),\n/* harmony export */   v3_dot: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.v3_dot),\n/* harmony export */   v3_equals: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.v3_equals),\n/* harmony export */   v3_floor: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.v3_floor),\n/* harmony export */   v3_inverse: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.v3_inverse),\n/* harmony export */   v3_isZero: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.v3_isZero),\n/* harmony export */   v3_lerp: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.v3_lerp),\n/* harmony export */   v3_magnitude: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.v3_magnitude),\n/* harmony export */   v3_manhattan: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.v3_manhattan),\n/* harmony export */   v3_max: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.v3_max),\n/* harmony export */   v3_min: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.v3_min),\n/* harmony export */   v3_multiply: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.v3_multiply),\n/* harmony export */   v3_normalize: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.v3_normalize),\n/* harmony export */   v3_random: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.v3_random),\n/* harmony export */   v3_rotate: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.v3_rotate),\n/* harmony export */   v3_rotateX: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.v3_rotateX),\n/* harmony export */   v3_rotateY: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.v3_rotateY),\n/* harmony export */   v3_rotateZ: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.v3_rotateZ),\n/* harmony export */   v3_scale: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.v3_scale),\n/* harmony export */   v3_sqrMag: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.v3_sqrMag),\n/* harmony export */   v3_sub: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.v3_sub),\n/* harmony export */   v3_transform: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.v3_transform),\n/* harmony export */   v3_zero: () => (/* reexport safe */ _src_Vector__WEBPACK_IMPORTED_MODULE_10__.v3_zero),\n/* harmony export */   viewRoot: () => (/* reexport safe */ _src_Root__WEBPACK_IMPORTED_MODULE_6__.viewRoot)\n/* harmony export */ });\n/* harmony import */ var _croquet_croquet__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(\"../node_modules/@croquet/croquet/cjs/croquet-croquet-node.js\");\n/* harmony import */ var _croquet_croquet__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_croquet_croquet__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony reexport (unknown) */ var __WEBPACK_REEXPORT_OBJECT__ = {};\n/* harmony reexport (unknown) */ for(const __WEBPACK_IMPORT_KEY__ in _croquet_croquet__WEBPACK_IMPORTED_MODULE_0__) if(__WEBPACK_IMPORT_KEY__ !== \"default\") __WEBPACK_REEXPORT_OBJECT__[__WEBPACK_IMPORT_KEY__] = () => _croquet_croquet__WEBPACK_IMPORTED_MODULE_0__[__WEBPACK_IMPORT_KEY__]\n/* harmony reexport (unknown) */ __webpack_require__.d(__webpack_exports__, __WEBPACK_REEXPORT_OBJECT__);\n/* harmony import */ var _src_Actor__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(\"../node_modules/@croquet/worldcore-kernel/src/Actor.js\");\n/* harmony import */ var _src_Behavior__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(\"../node_modules/@croquet/worldcore-kernel/src/Behavior.js\");\n/* harmony import */ var _src_Level__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(\"../node_modules/@croquet/worldcore-kernel/src/Level.js\");\n/* harmony import */ var _src_Mixins__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(\"../node_modules/@croquet/worldcore-kernel/src/Mixins.js\");\n/* harmony import */ var _src_Pawn__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(\"../node_modules/@croquet/worldcore-kernel/src/Pawn.js\");\n/* harmony import */ var _src_Root__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(\"../node_modules/@croquet/worldcore-kernel/src/Root.js\");\n/* harmony import */ var _src_Spec__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(\"../node_modules/@croquet/worldcore-kernel/src/Spec.js\");\n/* harmony import */ var _src_User__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(\"../node_modules/@croquet/worldcore-kernel/src/User.js\");\n/* harmony import */ var _src_Utilities__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(\"../node_modules/@croquet/worldcore-kernel/src/Utilities.js\");\n/* harmony import */ var _src_Vector__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(\"../node_modules/@croquet/worldcore-kernel/src/Vector.js\");\n/* harmony import */ var _src_Widget__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(\"../node_modules/@croquet/worldcore-kernel/src/Widget.js\");\n/* harmony import */ var _src_Input__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(\"../node_modules/@croquet/worldcore-kernel/src/Input.js\");\n/* harmony import */ var _src_NavGrid__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(\"../node_modules/@croquet/worldcore-kernel/src/NavGrid.js\");\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n//# sourceURL=webpack:///../node_modules/@croquet/worldcore-kernel/index.js?");

/***/ }),

/***/ "../node_modules/@croquet/worldcore-kernel/src/Actor.js":
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Actor: () => (/* binding */ Actor),\n/* harmony export */   ActorManager: () => (/* binding */ ActorManager)\n/* harmony export */ });\n/* harmony import */ var _croquet_croquet__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(\"../node_modules/@croquet/croquet/cjs/croquet-croquet-node.js\");\n/* harmony import */ var _croquet_croquet__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_croquet_croquet__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _Pawn__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(\"../node_modules/@croquet/worldcore-kernel/src/Pawn.js\");\n/* harmony import */ var _Root__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(\"../node_modules/@croquet/worldcore-kernel/src/Root.js\");\n\n\n\n\n//------------------------------------------------------------------------------------------\n//-- ActorManager --------------------------------------------------------------------------\n//------------------------------------------------------------------------------------------\n\nclass ActorManager extends _Root__WEBPACK_IMPORTED_MODULE_2__.ModelService {\n    init() {\n        super.init('ActorManager');\n        this.actors = new Map();\n    }\n\n    add(actor) {\n        this.actors.set(actor.id, actor);\n    }\n\n    has(id) {\n        return this.actors.has(id);\n    }\n\n    get(id) {\n        return this.actors.get(id);\n    }\n\n    delete(actor) {\n        this.actors.delete(actor.id);\n    }\n\n}\nActorManager.register(\"ActorManager\");\n\n//------------------------------------------------------------------------------------------\n//-- Actor ---------------------------------------------------------------------------------\n//------------------------------------------------------------------------------------------\n\n_croquet_croquet__WEBPACK_IMPORTED_MODULE_0__.Constants.WC_SAVE = new Map();\n\nclass Actor extends _Root__WEBPACK_IMPORTED_MODULE_2__.WorldcoreModel {\n\n    static okayToIgnore() {return [\"$local\", \"$global\"] }\n\n    get pawn() {return this._pawn}\n    get doomed() {return this._doomed} // About to be destroyed. This is used to prevent creating new future messages.\n    get parent() { return this._parent}\n    get children() { return this._children || new Set() }\n    get name() {return this._name || \"Actor\"}\n\n    get tags() {  return this.__tags || new Set() }\n    set _tags(tags) {\n        if (!this.__tags) this.__tags = new Set();\n        for (const tag of tags) this.__tags.add(tag);\n    }\n\n    init(options) {\n        super.init();\n        this.set(options);\n        this.listen(\"_set\", this.set);\n        this.listen(\"_snap\", this.snap);\n        this.service('ActorManager').add(this);\n        this.publish(\"actor\", \"createActor\", this);\n    }\n\n    destroy() {\n        this.destroyChildren();\n        this.set({parent: null});\n        this._doomed = true; // About to be destroyed. This is used to prevent creating new future messages.\n        this.publish(\"actor\", \"destroyActor\", this);\n        this.service('ActorManager').delete(this);\n        super.destroy();\n    }\n\n    destroyChildren() {\n        new Set(this.children).forEach(child => child.destroy());\n    }\n\n    set(options = {}) {\n        const sorted = Object.entries(options).sort((a,b) => { return b[0] < a[0] ? 1 : -1 } );\n        for (const option of sorted) {\n            const name = option[0];\n            const value = option[1];\n            const ul = \"_\" + name;\n            const nameSet = name+'Set';\n            const old = this[ul];\n            this[ul] = value;\n            if (this[nameSet]) this[nameSet](value,old);\n            const data = {old, value, o: old, v: value};\n            this._say(nameSet, data);\n        }\n        return sorted;\n    }\n\n    snap(options = {}) {\n        const sorted = this.set(options);\n        for (const option of sorted) {\n            const name = option[0];\n            const value = option[1];\n            const nameSnap = name+'Snap';\n            if (this[nameSnap]) this[nameSnap](value);\n            this._say(nameSnap, value);\n        }\n    }\n\n    parentSet(value, old) {\n        if (old) old.removeChild(this);\n        if (value) value.addChild(this);\n    }\n\n    addChild(child) {\n        if (!this._children) this._children = new Set();\n        this._children.add(child);\n    }\n\n    removeChild(child) {\n        this.children.delete(child);\n    }\n\n    removeTag(tag) {\n        this.tags.delete(tag);\n    }\n\n    say(event, data) {\n        // an explicit say(), as opposed to the automatically generated _say().\n        // we publish in the normal way, but also as arguments to a generic event\n        // type that a client such as a bridge can subscribe to in order to capture\n        // and forward all the explicit say() occurrences.\n        this.publish(this.id, event, data);\n        this.publish(\"__wc\", \"say\", [ this.id, event, data ]);\n    }\n\n    _say(event, data) {\n        this.publish(this.id, event, data);\n    }\n\n    listen(event, callback) {\n        this.subscribe(this.id, event, callback);\n    }\n\n    ignore(event) {\n        this.unsubscribe(this.id, event);\n    }\n\n    actorFromId(id) {\n        return this.service(\"ActorManager\").get(id);\n    }\n\n}\nActor.register(\"Actor\");\n\n\n\n//# sourceURL=webpack:///../node_modules/@croquet/worldcore-kernel/src/Actor.js?");

/***/ }),

/***/ "../node_modules/@croquet/worldcore-kernel/src/Behavior.js":
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AM_Behavioral: () => (/* binding */ AM_Behavioral),\n/* harmony export */   Behavior: () => (/* binding */ Behavior),\n/* harmony export */   BranchBehavior: () => (/* binding */ BranchBehavior),\n/* harmony export */   CompositeBehavior: () => (/* binding */ CompositeBehavior),\n/* harmony export */   DecoratorBehavior: () => (/* binding */ DecoratorBehavior),\n/* harmony export */   DelayBehavior: () => (/* binding */ DelayBehavior),\n/* harmony export */   DestroyBehavior: () => (/* binding */ DestroyBehavior),\n/* harmony export */   FailBehavior: () => (/* binding */ FailBehavior),\n/* harmony export */   InterruptBehavior: () => (/* binding */ InterruptBehavior),\n/* harmony export */   InvertBehavior: () => (/* binding */ InvertBehavior),\n/* harmony export */   LoopBehavior: () => (/* binding */ LoopBehavior),\n/* harmony export */   PrintBehavior: () => (/* binding */ PrintBehavior),\n/* harmony export */   PublishBehavior: () => (/* binding */ PublishBehavior),\n/* harmony export */   RandomBehavior: () => (/* binding */ RandomBehavior),\n/* harmony export */   RetryBehavior: () => (/* binding */ RetryBehavior),\n/* harmony export */   SelectorBehavior: () => (/* binding */ SelectorBehavior),\n/* harmony export */   SequenceBehavior: () => (/* binding */ SequenceBehavior),\n/* harmony export */   SetBehavior: () => (/* binding */ SetBehavior),\n/* harmony export */   SpinBehavior: () => (/* binding */ SpinBehavior),\n/* harmony export */   SubscribeBehavior: () => (/* binding */ SubscribeBehavior),\n/* harmony export */   SucceedBehavior: () => (/* binding */ SucceedBehavior),\n/* harmony export */   TryBehavior: () => (/* binding */ TryBehavior),\n/* harmony export */   fromD: () => (/* binding */ fromD),\n/* harmony export */   fromH: () => (/* binding */ fromH),\n/* harmony export */   fromM: () => (/* binding */ fromM),\n/* harmony export */   fromS: () => (/* binding */ fromS)\n/* harmony export */ });\n/* harmony import */ var _croquet_croquet__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(\"../node_modules/@croquet/croquet/cjs/croquet-croquet-node.js\");\n/* harmony import */ var _croquet_croquet__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_croquet_croquet__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _Actor__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(\"../node_modules/@croquet/worldcore-kernel/src/Actor.js\");\n/* harmony import */ var _Mixins__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(\"../node_modules/@croquet/worldcore-kernel/src/Mixins.js\");\n/* harmony import */ var _Utilities__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(\"../node_modules/@croquet/worldcore-kernel/src/Utilities.js\");\n/* harmony import */ var _Vector__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(\"../node_modules/@croquet/worldcore-kernel/src/Vector.js\");\n// import { RegisterMixin, Shuffle, Actor, Constants } from \"@croquet/worldcore-kernel\";\n\n\n\n\n\n\n\n\n_croquet_croquet__WEBPACK_IMPORTED_MODULE_0__.Constants.WC_BEHAVIORS = new Map();\n\n//------------------------------------------------------------------------------------------\n//-- Utilities -----------------------------------------------------------------------------\n//------------------------------------------------------------------------------------------\n\nfunction fromS(s) {return 1000*s}\nfunction fromM(m) {return 60000*m}\nfunction fromH(h) {return 60*fromM(h)}\nfunction fromD(d) {return 24*fromH(d)}\n\n//------------------------------------------------------------------------------------------\n//-- Behavioral ----------------------------------------------------------------------------\n//------------------------------------------------------------------------------------------\n\n // Mixin to allow actors to use behavior trees.\n\n // StartBehavior sets the actor's current root behavior.\n\n const AM_Behavioral = superclass => class extends superclass {\n\n    init(options) {\n        super.init(options);\n        this.behavior = Behavior.create({actor: this});\n    }\n\n    destroy() {\n        super.destroy();\n        if (this.behavior) this.behavior.destroy();\n    }\n\n};\n(0,_Mixins__WEBPACK_IMPORTED_MODULE_2__.RegisterMixin)(AM_Behavioral);\n\n//------------------------------------------------------------------------------------------\n//-- Behavior ------------------------------------------------------------------------------\n//------------------------------------------------------------------------------------------\n\nclass Behavior extends _Actor__WEBPACK_IMPORTED_MODULE_1__.Actor {\n\n    static register(name) {\n        super.register(name);\n        _croquet_croquet__WEBPACK_IMPORTED_MODULE_0__.Constants.WC_BEHAVIORS.set(name, this);\n    }\n\n    init(options) {\n        super.init(options);\n        this.future(0).onStart();\n        if (!this.doomed && this.tickRate && this.do) {\n            let firstDelta = Math.random() * this.tickRate;\n            if (this.synched) firstDelta = 0;\n            this.future(firstDelta).tick(firstDelta);\n        }\n    }\n\n    destroy() {\n        this.onDestroy();\n        super.destroy();\n    }\n\n    get name() {return this._name || \"Behavior\"}\n    get actor() { return this._actor}\n    get tickRate() { return this._tickRate || 100}\n    get isPaused() { return this._pause}\n    get neverSucceed() {return this._neverSucceed}\n    get synched() {return this._synched}\n\n    pause() { this.set({pause:true})}\n    resume() { this.set({pause:false})}\n\n    pauseSet(pause) {\n        this._children.forEach(child => child.set({pause}));\n    }\n\n    set tickRate(t) { this._tickRate = t}\n\n    tick(delta) {\n        if (this.actor && this.actor.doomed) return;\n        if (this.doomed) return;\n        if (!this.isPaused) this.do(delta);\n        if (!this.doomed) this.future(this.tickRate).tick(this.tickRate);\n    }\n\n    kill(name) {\n        const victim = this.get(name);\n        if (victim) victim.destroy();\n    }\n\n    get(name) {\n        const b = _croquet_croquet__WEBPACK_IMPORTED_MODULE_0__.Constants.WC_BEHAVIORS.get(name);\n        if (!b) return null;\n        for (const child of this.children) if (child instanceof b) return child;\n        return null;\n    }\n\n    start(behavior) {\n        if (!behavior) return null;\n        let name = behavior;\n        let options = {};\n        if (behavior.name) {\n            name = behavior.name;\n            options = behavior;\n        }\n        options.actor = this.actor;\n        options.parent = this;\n\n        const b = _croquet_croquet__WEBPACK_IMPORTED_MODULE_0__.Constants.WC_BEHAVIORS.get(name);\n        if (b) return b.create(options);\n\n        console.warn(\"Behavior \"+ name + \" not found!\");\n        return null;\n    }\n\n    succeed(data) {\n        if (this.neverSucceed) {\n            this.progress(1);\n        } else {\n            if (this.parent) this.parent.onSucceed(this, data);\n            this.destroy();\n        }\n    }\n\n    progress(percent) {\n        if (this.parent) this.parent.onProgress(this, percent);\n    }\n\n    fail(data) {\n        if (this.parent) this.parent.onFail(this, data);\n        this.destroy();\n    }\n\n    onStart() {}\n    onDestroy() {}\n    onSucceed(child, data) {}\n    onProgress(child, percent) { this.progress(percent)}\n    onFail(child, data) {}\n\n}\nBehavior.register('Behavior');\n\n//------------------------------------------------------------------------------------------\n//-- DestroyBehavior -----------------------------------------------------------------------\n//------------------------------------------------------------------------------------------\n\n// Immediately destroys the actor (and itself)\n\nclass DestroyBehavior extends Behavior {\n\n    onStart() { this.actor.destroy() }\n\n}\nDestroyBehavior.register('DestroyBehavior');\n\n//------------------------------------------------------------------------------------------\n//-- SetBehavior -----------------------------------------------------------------------\n//------------------------------------------------------------------------------------------\n\n// Sets a property on the actor\n\nclass SetBehavior extends Behavior {\n\n\n    init(options) {\n        super.init(options);\n        delete options.name;\n        delete options.actor;\n        this.actor.set(options);\n    }\n\n}\nSetBehavior.register('SetBehavior');\n\n//------------------------------------------------------------------------------------------\n//-- PrintBehavior -----------------------------------------------------------------------\n//------------------------------------------------------------------------------------------\n\n// Prints to the console\n\nclass PrintBehavior extends Behavior {\n\n    get text() { return this._text || \"test\"}\n\n    onStart() {\n        console.log(this.text);\n        this.succeed();\n    }\n\n}\nPrintBehavior.register('PrintBehavior');\n\n//------------------------------------------------------------------------------------------\n//-- SubscribeBehavior ---------------------------------------------------------------------\n//------------------------------------------------------------------------------------------\n\n// Succeeds when an event is received.\n\nclass SubscribeBehavior extends Behavior {\n\n    get scope() { return this._scope || this.actor.id}\n    get event() { return this._event || \"event\"}\n    get data() { return this._data}\n\n    onStart() {\n        this.subscribe(this.scope, this.event, this.succeed);\n    }\n\n\n}\nSubscribeBehavior.register('SubscribeBehavior');\n\n//------------------------------------------------------------------------------------------\n//-- PublishBehavior -----------------------------------------------------------------------\n//------------------------------------------------------------------------------------------\n\n// Publishes an event and immediately succeeds\n\nclass PublishBehavior extends Behavior {\n\n    get scope() { return this._scope || this.actor.id}\n    get event() { return this._event || \"event\"}\n    get data() { return this._data}\n\n    onStart() {\n        this.publish(this.scope, this.event, this.data);\n        this.succeed();\n    }\n\n}\nPublishBehavior.register('PublishBehavior');\n\n//------------------------------------------------------------------------------------------\n//-- RandomBehavior -----------------------------------------------------------------------\n//------------------------------------------------------------------------------------------\n\n// Runs a random behavior from its list of descriptors\n\nclass RandomBehavior extends Behavior {\n\n    get behaviors() {return this._behaviors || []}\n\n    onStart() {\n        if (this.behaviors.length === 0) {\n            this.fail();\n            return;\n        }\n\n        let total = 0;\n        for (let i = 0; i < this.behaviors.length; i++) {\n            let weight = this.behaviors[i].weight;\n            if (weight===undefined) weight = 1;\n            total += weight;\n        }\n\n        if (total === 0) {\n            console.warn(\"RandomBehavior: All weights are 0!\");\n            this.start(this.behaviors[0]);\n            return;\n        }\n\n        const pick = total * this.random();\n\n        total = 0;\n        for (let i = 0; i < this.behaviors.length; i++) {\n            let weight = this.behaviors[i].weight;\n            if (weight===undefined) weight = 1;\n            total += weight;\n            if (pick <= total) {\n                this.start(this.behaviors[i]);\n                return;\n            }\n        }\n\n        this.fail();\n\n    }\n\n    onSucceed() { this.succeed() }\n    onFail() { this.fail() }\n\n}\nRandomBehavior.register('RandomBehavior');\n\n//------------------------------------------------------------------------------------------\n//-- CompositeBehavior ---------------------------------------------------------------------\n//------------------------------------------------------------------------------------------\n\n// Behaviors with multiple child behaviors. They don't tick themselves, but respond to reported success or\n// failure by their children who are ticking.\n\nclass CompositeBehavior extends Behavior {\n\n    get behaviors() {return this._behaviors || []}\n    get isParallel() { return this._parallel }\n    get isShuffle() { return this._shuffle }\n\n    onStart() {\n        this.n = 0;\n        this.pending = this.behaviors.length;\n        if (this.isShuffle) this.deck = (0,_Utilities__WEBPACK_IMPORTED_MODULE_3__.Shuffle)(this.behaviors.length);\n        this.isParallel ? this.startAll() : this.startNext();\n    }\n\n    startAll() {\n        for (let i = 0; i < this.behaviors.length; i++ ) {\n            if (this.doomed) return;\n            this.isShuffle ? this.start(this.behaviors[this.deck[i]]) : this.start(this.behaviors[i]);\n        }\n    }\n\n    startNext() {\n        if (this.isParallel) return;\n        this.isShuffle ? this.start(this.behaviors[this.deck[this.n++]]) : this.start(this.behaviors[this.n++]);\n    }\n\n}\nCompositeBehavior.register('CompositeBehavior');\n\n//------------------------------------------------------------------------------------------\n//-- SequenceBehavior ----------------------------------------------------------------------\n//------------------------------------------------------------------------------------------\n\n// Executes a sequence of behaviors in order. Fails if any of them fails. Nothing is\n// executed after the first fail. Succeeds if all of them succeed.\n\n// The equivalent of a logical AND\n\nclass SequenceBehavior extends CompositeBehavior {\n\n    onSucceed() { --this.pending ? this.startNext() : this.succeed(); }\n    onFail() { this.fail(); }\n\n}\nSequenceBehavior.register('SequenceBehavior');\n\n//------------------------------------------------------------------------------------------\n//-- SelectorBehavior ----------------------------------------------------------------------\n//------------------------------------------------------------------------------------------\n\n// Executes behaviors in order. Succeeds if any of them succeeds. Nothing is executed after\n// the first success. Fails if all of them fail.\n\n// The equivalent of a logical OR\n\nclass SelectorBehavior extends CompositeBehavior {\n\n    onSucceed() { this.succeed(); }\n    onFail() { --this.pending ? this.startNext() : this.fail(); }\n\n}\nSelectorBehavior.register('SelectorBehavior');\n\n//------------------------------------------------------------------------------------------\n//-- DecoratorBehavior ---------------------------------------------------------------------\n//------------------------------------------------------------------------------------------\n\n// Holds a single child behavior. Passes on its completion status when it finishes.\n\nclass DecoratorBehavior extends Behavior {\n\n    get behavior() { return this._behavior }\n\n    onStart() { this.child = this.start(this.behavior) }\n\n    onSucceed(child, data) {this.succeed(data)}\n    onFail(child, data) {this.fail(data)}\n\n}\nDecoratorBehavior.register('DecoratorBehavior');\n\n//------------------------------------------------------------------------------------------\n//-- InvertBehavior ------------------------------------------------------------------------\n//------------------------------------------------------------------------------------------\n\n// Inverts completion status when child finishes.\n\nclass InvertBehavior extends DecoratorBehavior {\n\n    onSucceed(child, data) {this.fail(data)}\n    onFail(child, data) {this.succeed(data)}\n\n}\nInvertBehavior.register('InvertBehavior');\n\n//------------------------------------------------------------------------------------------\n//-- SucceedBehavior -----------------------------------------------------------------------\n//------------------------------------------------------------------------------------------\n\n// Always returns success when the child finishes.\n\nclass SucceedBehavior extends DecoratorBehavior {\n\n    onSucceed(child, data) { this.succeed(data) }\n    onFail(child, data) { this.succeed(data) }\n\n}\nSucceedBehavior.register('SucceedBehavior');\n\n//------------------------------------------------------------------------------------------\n//-- FailBehavior --------------------------------------------------------------------------\n//------------------------------------------------------------------------------------------\n\n// Always returns fail when the child finishes.\n\nclass FailBehavior extends DecoratorBehavior {\n\n    onSucceed(child, data) {this.fail(data)}\n    onFail(child, data) {this.fail(data)}\n\n}\nFailBehavior.register('FailBehavior');\n\n//------------------------------------------------------------------------------------------\n//-- DelayBehavior -------------------------------------------------------------------------\n//------------------------------------------------------------------------------------------\n\n// Succeeds when delay time is reached.\n\nclass DelayBehavior extends Behavior {\n\n    get tickRate() { return 0 }\n    get delay() { return this._delay || 1000}\n\n    onStart() { this.future(this.delay).succeed() }\n\n}\nDelayBehavior.register(\"DelayBehavior\");\n\n//------------------------------------------------------------------------------------------\n//-- LoopBehavior --------------------------------------------------------------------------\n//------------------------------------------------------------------------------------------\n\n// Repeatedly executes a child behavior until count is reached, as long\n// as it succeeds. If it fails, the loop returns failure.\n// If the count is set to 0, it executes indefinitely. BEWARE: if the behavior succeeds on start in an infinite loop you will exceed the call stack\n\nclass LoopBehavior extends DecoratorBehavior {\n\n    get count() {return this._count || 0}\n\n    onStart() {\n        this.n = 1;\n        this.start(this.behavior);\n    }\n\n    onSucceed() {\n        this.progress(this.n);\n        if (!this.count || this.n < this.count) {\n            this.n++;\n            this.start(this.behavior);\n        } else { this.succeed()}\n    }\n\n    onFail() { this.fail() }\n\n}\nLoopBehavior.register('LoopBehavior');\n\n//------------------------------------------------------------------------------------------\n//-- TryBehavior ---------------------------------------------------------------------------\n//------------------------------------------------------------------------------------------\n\n// Repeatedly tries a child until it succeeds. Delays between each trial\n\nclass TryBehavior extends DecoratorBehavior {\n\n    get delay() {return this._delay || fromS(1)} // one second\n\n    onSucceed() { this.succeed()}\n    onFail() { this.future(this.delay).onStart() }\n}\nTryBehavior.register('TryBehavior');\n\n//------------------------------------------------------------------------------------------\n//-- RetryBehavior ---------------------------------------------------------------------------\n//------------------------------------------------------------------------------------------\n\n// Keeps trying a child until it fails. Delays between each trial\n\nclass RetryBehavior extends DecoratorBehavior {\n\n    get delay() {return this._delay || 1000} //\n\n    onSucceed() { this.future(this.delay).onStart() }\n    onFail() { this.fail() }\n}\nRetryBehavior.register('RetryBehavior');\n\n//------------------------------------------------------------------------------------------\n//-- BranchBehavior ------------------------------------------------------------------------\n//------------------------------------------------------------------------------------------\n\nclass BranchBehavior extends DecoratorBehavior {\n\n    get then() { return this._then}\n    get else() { return this._else}\n\n    onStart() {\n        this.conditionChild = this.start(this.behavior);\n    }\n\n    onSucceed(child) {\n        if (child === this.conditionChild) {\n            if (this.then) this.start(this.then);\n        } else {\n            this.succeed();\n        }\n    }\n\n    onFail(child) {\n        if (child === this.conditionChild) {\n            if (this.else) this.start(this.else);\n        } else {\n            this.fail();\n        }\n    }\n\n}\nBranchBehavior.register('BranchBehavior');\n\n//------------------------------------------------------------------------------------------\n//-- InterruptBehavior ---------------------------------------------------------------------\n//------------------------------------------------------------------------------------------\n\nclass InterruptBehavior extends DecoratorBehavior {\n\n    get watch() { return this._interrupt}\n\n    onStart() {\n        this.primaryChild = this.start(this.behavior);\n        this.watchChild = this.start(this.watch);\n    }\n\n    onProgress(child, percent) {\n        if (child === this.watchChild) {\n            // console.log(\"on progress: \" + percent)\n            if (percent===0) {\n                // console.log(\"interrupt!\")\n                this.primaryChild.destroy();\n            }\n            if (percent===1) {\n                // console.log(\"resume!\")\n                this.primaryChild = this.start(this.behavior);\n            }\n        } else {\n            this.progress(this, percent);\n        }\n\n    }\n\n\n}\nInterruptBehavior.register('InterruptBehavior');\n\n//------------------------------------------------------------------------------------------\n// SpinBehavior ---------------------------------------------------------------------------\n//------------------------------------------------------------------------------------------\n\nclass SpinBehavior extends Behavior {\n\n    get axis() {return this._axis || [0,1,0]}\n    get speed() {return this._speed || 1}\n\n\n    do(delta) {\n        const q = (0,_Vector__WEBPACK_IMPORTED_MODULE_4__.q_axisAngle)(this.axis, this.speed * delta / 1000);\n        const rotation = (0,_Vector__WEBPACK_IMPORTED_MODULE_4__.q_multiply)(this.actor.rotation, q);\n        this.actor.set({rotation});\n    }\n\n}\nSpinBehavior.register(\"SpinBehavior\");\n\n//------------------------------------------------------------------------------------------\n// GoBehavior ---------------------------------------------------------------------------\n//------------------------------------------------------------------------------------------\n\nclass GoBehavior extends Behavior {\n\n    get tickRate() { return this._tickRate || 50} // More than 15ms for smooth movement\n\n    get aim() {return this._aim || [0,0,1]}\n    get speed() { return this._speed || 3}\n\n    do(delta) {\n        const distance = this.speed * delta / 1000;\n\n        const x = this.aim[0] * distance;\n        const y = this.aim[1] * distance;\n        const z = this.aim[2] * distance;\n\n        const translation = (0,_Vector__WEBPACK_IMPORTED_MODULE_4__.v3_add)(this.actor.translation, [x,y,z]);\n\n        this.actor.set({translation});\n\n    }\n\n}\nGoBehavior.register(\"GoBehavior\");\n\n\n//# sourceURL=webpack:///../node_modules/@croquet/worldcore-kernel/src/Behavior.js?");

/***/ }),

/***/ "../node_modules/@croquet/worldcore-kernel/src/Input.js":
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   InputManager: () => (/* binding */ InputManager),\n/* harmony export */   KeyDown: () => (/* binding */ KeyDown)\n/* harmony export */ });\n/* harmony import */ var _Vector__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(\"../node_modules/@croquet/worldcore-kernel/src/Vector.js\");\n/* harmony import */ var _Root__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(\"../node_modules/@croquet/worldcore-kernel/src/Root.js\");\n\n\n\n// Need to add doubletap\n\nconst DOUBLE_DURATION = 300; // milliseconds\nconst TRIPLE_DURATION = 600; // milliseconds\n\nconst TAP_DURATION = 300;   // milliseconds\nconst TAP_DISTANCE = 10;     // pixels\n\nconst SWIPE_DURATION = 300;   // milliseconds\nconst SWIPE_DISTANCE = 50;     // pixels\n\nconst keys = new Set();\nconst chordNames = new Map();\nconst upChordKeys = new Map();\nconst downChordKeys = new Map();\n\n// Returns true if the key is pressed. Includes entries for mouse buttons.\nfunction KeyDown(key) {\n    return keys.has(key);\n}\n\n//Returns true if the combination of keys is pressed/unpressed.\n// export function ChordDown(name) {\n//     const chord = chordNames.get(name);\n//     if (!chord) return false;\n//     const down = chord.down;\n//     const up = chord.up;\n//     let all = true;\n//     down.forEach(d => {all &= KeyDown(d);});\n//     up.forEach(u => {all &= !KeyDown(u);});\n//     return all;\n// }\n\n//----------------------------------------------------------------------------------------------------\n// Input\n//\n// Catches all user input events and transforms them into Croquet events.\n// We don't want other systems to install their own listeners because they may not get cleaned up properly on disconnect/reconnect.\n// Supports adding chord events to report when multiple buttons are pressed simultaneously.\n//----------------------------------------------------------------------------------------------------\n\nclass InputManager extends _Root__WEBPACK_IMPORTED_MODULE_1__.ViewService {\n    constructor(name) {\n        super(name || \"InputManager\");\n\n        this.listeners = [];\n\n        this.presses = new Map();\n        this.lastDown = {};\n        this.penultimateDown = {};\n\n        document.body.style.touchAction = \"none\";\n        this.addAllListeners();\n\n        this.synthesizedModifierKeys = new Map();\n    }\n\n    destroy() {\n        super.destroy();\n        if (this.inPointerLock) document.exitPointerLock();\n        if (this.inFullscreen) document.exitFullscreen();\n        this.removeAllListeners();\n    }\n\n    addListener(element, type, callback) {\n        element.addEventListener(type, callback, {passive: false});\n        this.listeners.push({element, type, callback});\n    }\n\n    removeListener(type) {\n        const remainingListeners = this.listeners.filter(listener => listener.type !== type);\n        this.listeners.forEach(listener => {\n            if (listener.type === type) listener.element.removeEventListener(listener.type, listener.callback, {passive: false});\n        });\n        this.listeners = remainingListeners;\n    }\n\n    removeAllListeners() {\n        this.listeners.forEach(listener => listener.element.removeEventListener(listener.type, listener.callback, {passive: false}));\n        this.listeners = [];\n    }\n\n    // adds all the default input manager listeners\n    addAllListeners() {\n        this.addListener(document, 'contextmenu', e => e.preventDefault());\n        this.addListener(window, 'resize', e => this.onResize(e));\n        this.addListener(window, 'focus', e => this.onFocus(e));\n        this.addListener(window, 'blur', e => this.onBlur(e));\n        this.addListener(window, 'deviceorientation', e => this.onOrientation(e));\n        this.addListener(document, 'click', e => this.onClick(e));\n        this.addListener(document, 'pointerlockchange', e => this.onPointerLock(e));\n        this.addListener(document, 'pointerdown', e => this.onPointerDown(e));\n        this.addListener(document, 'pointerup', e => this.onPointerUp(e));\n        this.addListener(document, 'pointercancel', e => this.onPointerUp(e));\n        this.addListener(document, 'pointermove', e => this.onPointerMove(e));\n        this.addListener(document, 'wheel', e => this.onWheel(e));\n        this.addListener(document,'keydown', e => this.onKeyDown(e));\n        this.addListener(document,'keyup', e => this.onKeyUp(e));\n    }\n\n    // If you want the input handler to report a chord event, you need to add the chord and give it an event name.\n    addChord(name, down = [], up = []) {\n        chordNames.set(name, {down, up});\n        down.forEach(d => {\n            if (!downChordKeys.has(d)) downChordKeys.set(d, new Set());\n            downChordKeys.get(d).add(name);\n        });\n        up.forEach(u => {\n            if (!upChordKeys.has(u)) upChordKeys.set(u, new Set());\n            upChordKeys.get(u).add(name);\n        });\n    }\n\n    onChordDown(key) {\n        const downs = [];\n        const ups = [];\n\n        if (downChordKeys.has(key)) {\n            downChordKeys.get(key).forEach( name => {\n                if (this.chordTest(name)) downs.push(name);\n            });\n        }\n\n        if (upChordKeys.has(key)) {\n            upChordKeys.get(key).forEach( name => {\n                if (!this.chordTest(name)) ups.push(name);\n            });\n        }\n\n        ups.forEach(name => {\n            if (!KeyDown(name)) return;\n            keys.delete(name);\n            this.publish(\"input\", name + \"Up\");\n        });\n\n        downs.forEach(name => {\n            if (KeyDown(name)) return;\n            keys.add(name);\n            this.publish(\"input\", name + \"Down\");\n        });\n\n    }\n\n    onChordUp(key) {\n        const downs = [];\n        const ups = [];\n\n        if (downChordKeys.has(key)) {\n            downChordKeys.get(key).forEach( name => {\n                if (!this.chordTest(name)) ups.push(name);\n            });\n        }\n\n        if (upChordKeys.has(key)) {\n            upChordKeys.get(key).forEach( name => {\n                if (this.chordTest(name)) downs.push(name);\n            });\n        }\n\n        ups.forEach(name => {\n            if (!KeyDown(name)) return;\n            keys.delete(name);\n            this.publish(\"input\", name + \"Up\");\n        });\n\n        downs.forEach(name => {\n            if (KeyDown(name)) return;\n            keys.add(name);\n            this.publish(\"input\", name + \"Down\");\n        });\n\n    }\n\n    chordTest(name) {\n        const chord = chordNames.get(name);\n        if (!chord) return false;\n        const down = chord.down;\n        const up = chord.up;\n        let all = true;\n        down.forEach(d => {all &= KeyDown(d);});\n        up.forEach(u => {all &= !KeyDown(u);});\n        return all;\n    }\n\n    get inFullscreen() {\n        return document.fullscreenElement;\n    }\n\n    get canFullscreen() {\n        return document.documentElement.requestFullscreen;\n    }\n\n    enterFullscreen() {\n        if (this.inFullscreen) return;\n        if (!this.canFullscreen) return;\n        document.documentElement.requestFullscreen();\n    }\n\n    exitFullscreen() {\n        if (!this.inFullscreen) return;\n        document.exitFullscreen();\n    }\n\n    get inPointerLock() {\n        return document.pointerLockElement || document.mozPointerLockElement;\n    }\n\n    get canPointerLock() {\n        return document.documentElement.requestPointerLock || document.documentElement.mozRequestPointerLock;\n    }\n\n    modifierKeysFrom(event) {\n        let {altKey, ctrlKey, metaKey, shiftKey} = event;\n        altKey = !!(altKey || this.synthesizedModifierKeys.get(\"altKey\"));\n        ctrlKey = !!(ctrlKey || this.synthesizedModifierKeys.get(\"ctrlKey\"));\n        metaKey = !!(metaKey || this.synthesizedModifierKeys.get(\"metaKey\"));\n        shiftKey = !!(shiftKey || this.synthesizedModifierKeys.get(\"shiftKey\"));\n        return {altKey, ctrlKey, metaKey, shiftKey};\n    }\n\n    setModifierKeys(obj) {\n        for (let k in obj) {\n            this.synthesizedModifierKeys.set(k, !!obj[k])\n        }\n    }\n\n    modifierEqual(e1, e2) {\n        return !!e1.altKey === !!e2.altKey && !!e1.ctrlKey === !!e2.ctrlKey && !!e1.metaKey === !!e2.metaKey && !!e1.shiftKey === !!e2.shiftKey;\n    }\n\n    enterPointerLock() {\n        if (this.inPointerLock) return;\n        if (!this.canPointerLock) return;\n        document.documentElement.requestPointerLock = this.canPointerLock;\n        document.documentElement.requestPointerLock();\n    }\n\n    exitPointerLock() {\n        if (!this.inPointerLock) return;\n        document.exitPointerLock();\n    }\n\n    onPointerLock(event) {\n        this.publish(\"input\", \"pointerLock\", this.inPointerLock);\n    }\n\n    onResize(event) {\n        // Delay actual resize event to address iOS posting of resize before page layout finishes.\n        // (Also it kind of looks better .... )\n        this.publish(\"input\", \"beforeResize\");\n        this.future(500).futureResize();\n    }\n\n    futureResize() {\n        this.publish(\"input\", \"resize\", [window.innerWidth, window.innerHeight]);\n    }\n\n    onFocus(event) {\n        this.publish(\"input\", \"focus\");\n    }\n\n    onBlur(event) {\n        this.publish(\"input\", \"blur\");\n    }\n\n    // publishes  both keyDown + arg and \"xDown\" where \"x\" is the key\n\n    onKeyDown(event) {\n        const key = event.key;\n        let modKeys = this.modifierKeysFrom(event);\n        keys.add(key);\n        if (event.repeat) {\n            this.publish(\"input\", key + \"Repeat\", {key, shift: modKeys.shiftKey, alt: modKeys.altKey, ctrl: modKeys.ctrlKey, meta: modKeys.metaKey, ...modKeys});\n            this.publish(\"input\", \"keyRepeat\", {key, shift: modKeys.shiftKey, alt: modKeys.altKey, ctrl: modKeys.ctrlKey, meta: modKeys.metaKey, ...modKeys});\n            // This can generate a lot of events! Don't subscribe to in model.\n        } else {\n            this.publish(\"input\", key + \"Down\", {key, shift: modKeys.shiftKey, alt: modKeys.altKey, ctrl: modKeys.ctrlKey, meta: modKeys.metaKey, ...modKeys});\n            this.publish(\"input\", \"keyDown\", {key, shift: modKeys.shiftKey, alt: modKeys.altKey, ctrl: modKeys.ctrlKey, meta: modKeys.metaKey, ...modKeys});\n            this.onChordDown(key);\n        }\n    }\n\n    // publish both keyUp + arg and \"xUp\" where \"x\" is the key\n    onKeyUp(event) {\n        const key = event.key;\n        let modKeys = this.modifierKeysFrom(event);\n        if (!KeyDown(key)) return;\n        this.publish(\"input\", key + \"Up\", {key, shift: modKeys.shiftKey, alt: modKeys.altKey, ctrl: modKeys.ctrlKey, meta: modKeys.metaKey, ...modKeys});\n        this.publish(\"input\", \"keyUp\", {key, shift: modKeys.shiftKey, alt: modKeys.altKey, ctrl: modKeys.ctrlKey, meta: modKeys.metaKey, modKeys});\n        keys.delete(key);\n        this.onChordUp(key);\n    }\n\n    onClick(event) {\n        let modKeys = this.modifierKeysFrom(event);\n        window.focus();\n        this.publish(\"input\", \"click\", {id: event.pointerId, type: event.pointerType, button: event.button, buttons: event.buttons, ...modKeys, xy: [event.clientX, event.clientY]});\n    }\n\n    onPointerDown(event) {\n        let modKeys = this.modifierKeysFrom(event);\n        this.presses.set(event.pointerId, {id: event.pointerId, time: event.timeStamp, start: [event.clientX, event.clientY], ...modKeys, xy: [event.clientX, event.clientY]});\n        this.publish(\"input\", \"pointerDown\", {id: event.pointerId, type: event.pointerType, button: event.button, buttons: event.buttons, ...modKeys, xy: [event.clientX, event.clientY]});\n        if (event.button === this.lastDown.button && event.timeStamp - this.lastDown.time < DOUBLE_DURATION && this.modifierEqual(event, this.lastDown)) {\n            if (event.button === this.penultimateDown.button && event.timeStamp - this.penultimateDown.time < TRIPLE_DURATION) {\n                this.publish(\"input\", \"tripleDown\", {id: event.pointerId, type: event.pointerType, button: event.button, buttons: event.buttons, ...modKeys, xy: [event.clientX, event.clientY]});\n            } else {\n                this.publish(\"input\", \"doubleDown\", {id: event.pointerId, type: event.pointerType, button: event.button, buttons: event.buttons, ...modKeys, xy: [event.clientX, event.clientY]});\n            }\n        }\n        this.penultimateDown = this.lastDown;\n        this.lastDown = {id: event.pointerId, button: event.button, buttons: event.buttons, ...modKeys, time: event.timeStamp};\n        this.zoomStart();\n    }\n\n    onPointerUp(event) {\n        const press = this.presses.get(event.pointerId);\n        let modKeys = this.modifierKeysFrom(event);\n        if (press) {\n            press.xy = [event.clientX, event.clientY];\n            const duration = event.timeStamp - press.time;\n            const dx = event.clientX - press.start[0];\n            const dy = event.clientY - press.start[1];\n            const ax = Math.abs(dx);\n            const ay = Math.abs(dy);\n            if (duration < TAP_DURATION && ax < TAP_DISTANCE && ay < TAP_DISTANCE) {\n                this.publish(\"input\", \"tap\", {id: event.pointerId, type: event.pointerType, button: event.button, buttons: event.buttons, ...modKeys, xy: [event.clientX, event.clientY]});\n            }\n            if (duration < SWIPE_DURATION && ax > SWIPE_DISTANCE) {\n                this.publish(\"input\", \"swipeX\", {id: event.pointerId, type: event.pointerType, button: event.button, buttons: event.buttons, distance: dx, ...modKeys});\n            }\n            if (duration < SWIPE_DURATION && ay > SWIPE_DISTANCE) {\n                this.publish(\"input\", \"swipeY\", {id: event.pointerId, type: event.pointerType, button: event.button, buttons: event.buttons, distance: dy, ...modKeys});\n            }\n        }\n\n        this.presses.delete(event.pointerId);\n        this.publish(\"input\", \"pointerUp\", {id: event.pointerId, type: event.pointerType, button: event.button, buttons: event.buttons, ...modKeys, xy: [event.clientX, event.clientY]});\n        this.zoomEnd();\n    }\n\n    onPointerMove(event) {\n        const press = this.presses.get(event.pointerId);\n        let modKeys = this.modifierKeysFrom(event);\n        if (press) {\n            const prevXY = press.xy;\n            press.xy = [event.clientX, event.clientY];\n            const duration = event.timeStamp - press.time;\n            const dx = event.clientX - press.start[0];\n            const dy = event.clientY - press.start[1];\n            const ax = Math.abs(dx);\n            const ay = Math.abs(dy);\n            if (duration > TAP_DURATION || ax > TAP_DISTANCE || ay > TAP_DISTANCE) { // Only publish pressed move events that aren't taps\n                this.publish(\"input\", \"pointerMove\", {id: event.pointerId, type: event.pointerType, button: event.button, buttons: event.buttons, ...modKeys, xy: [event.clientX, event.clientY]});\n                // movementX/Y is not supported e.g. in iOS Safari\n                if (event.movementX !== undefined && event.movementY !== undefined) {\n                    this.publish(\"input\", \"pointerDelta\", {id: event.pointerId, type: event.pointerType, button: event.button, buttons: event.buttons, ...modKeys, xy: [event.movementX, event.movementY]});\n                } else if (prevXY) {\n                    this.publish(\"input\", \"pointerDelta\", {id: event.pointerId, type: event.pointerType, button: event.button, buttons: event.buttons, ...modKeys, xy: [event.clientX - prevXY[0], event.clientY - prevXY[1]]});\n                }\n            }\n        } else {\n            this.publish(\"input\", \"pointerMove\", {id: event.pointerId, type: event.pointerType, button: event.button, buttons: event.buttons, ...modKeys, xy: [event.clientX, event.clientY]});\n            if (event.movementX !== undefined && event.movementY !== undefined) {\n                this.publish(\"input\", \"pointerDelta\", {id: event.pointerId, type: event.pointerType, button: event.button, buttons: event.buttons, ...modKeys, xy: [event.movementX, event.movementY]});\n            }\n        }\n        this.zoomUpdate();\n    }\n\n    zoomStart() {\n        if (this.presses.size !== 2) return;\n\n        const values = Array.from(this.presses.values());\n        const press0 = values[0];\n        const press1 = values[1];\n        const mid = (0,_Vector__WEBPACK_IMPORTED_MODULE_0__.v2_scale)((0,_Vector__WEBPACK_IMPORTED_MODULE_0__.v2_add)(press0.xy, press1.xy), 0.5);\n\n        this.publish(\"input\", \"zoomStart\", {mid, zoom: 1, dial: 0});\n    }\n\n    zoomEnd() {\n        if (this.presses.size !== 1) return;\n        this.publish(\"input\", \"zoomEnd\");\n    }\n\n    zoomUpdate() {\n        if (this.presses.size < 2) return;\n\n        const values = Array.from(this.presses.values());\n        const press0 = values[0];\n        const press1 = values[1];\n        const mid = (0,_Vector__WEBPACK_IMPORTED_MODULE_0__.v2_scale)((0,_Vector__WEBPACK_IMPORTED_MODULE_0__.v2_add)(press0.xy, press1.xy), 0.5);\n\n        const delta0 = (0,_Vector__WEBPACK_IMPORTED_MODULE_0__.v2_sub)(press1.start, press0.start);\n        const delta1 = (0,_Vector__WEBPACK_IMPORTED_MODULE_0__.v2_sub)(press1.xy, press0.xy);\n        const gap0 = (0,_Vector__WEBPACK_IMPORTED_MODULE_0__.v2_magnitude)(delta0);\n        const gap1 = (0,_Vector__WEBPACK_IMPORTED_MODULE_0__.v2_magnitude)(delta1);\n\n        let zoom = 1;\n        if (gap0 > 0) zoom = gap1 / gap0;\n\n        const angle0 = Math.atan2(delta0[0], delta0[1]);\n        const angle1 = Math.atan2(delta1[0], delta1[1]);\n        let dial = (angle1 - angle0 + _Vector__WEBPACK_IMPORTED_MODULE_0__.TAU) % _Vector__WEBPACK_IMPORTED_MODULE_0__.TAU;\n        if (dial > Math.PI) dial -= _Vector__WEBPACK_IMPORTED_MODULE_0__.TAU;\n\n        this.publish(\"input\", \"zoomUpdate\", {mid, zoom, dial});\n    }\n\n    onWheel(event) {\n        let modKeys = this.modifierKeysFrom(event);\n        event.preventDefault();\n        const y = event.deltaY;\n        this.publish(\"input\", \"wheel\", {deltaY: y, ...modKeys, xy: [event.clientX, event.clientY]});\n    }\n\n    onOrientation(event) {\n        const alpha = event.alpha; // yaw\n        const beta = event.beta; // Pitch if in portrait,\n        const gamma = event.gamma;\n        const pitch = (0,_Vector__WEBPACK_IMPORTED_MODULE_0__.toRad)(beta);\n        const yaw = (0,_Vector__WEBPACK_IMPORTED_MODULE_0__.toRad)(alpha);\n\n        // For landscape mode depends on phone orientation ...\n        // const pitch = gamma;\n        // const yaw = alpha; // 90 off\n        this.publish(\"input\", \"orientation\", {pitch, yaw});\n    }\n\n}\n\n\n//# sourceURL=webpack:///../node_modules/@croquet/worldcore-kernel/src/Input.js?");

/***/ }),

/***/ "../node_modules/@croquet/worldcore-kernel/src/Level.js":
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   LevelManager: () => (/* binding */ LevelManager)\n/* harmony export */ });\n/* harmony import */ var _croquet_croquet__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(\"../node_modules/@croquet/croquet/cjs/croquet-croquet-node.js\");\n/* harmony import */ var _croquet_croquet__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_croquet_croquet__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _Actor__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(\"../node_modules/@croquet/worldcore-kernel/src/Actor.js\");\n/* harmony import */ var _Root__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(\"../node_modules/@croquet/worldcore-kernel/src/Root.js\");\n/* harmony import */ var _Spec__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(\"../node_modules/@croquet/worldcore-kernel/src/Spec.js\");\n/* harmony import */ var _Mixins__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(\"../node_modules/@croquet/worldcore-kernel/src/Mixins.js\");\n\n\n\n\n\n\n_croquet_croquet__WEBPACK_IMPORTED_MODULE_0__.Constants.WC_LEVELS = new Map();\nconst xxx = '{\"children\":[{\"actor\":\"BaseActor\",\"pawn\":\"GroundPawn\",\"children\":[{\"actor\":\"SunActor\",\"pawn\":\"TestPawn\",\"name\":\"sun\",\"translation\":[0,2,0],\"rotation\":[0,-0.7654481535684707,0,-0.6434975712453148],\"children\":[{\"actor\":\"PlanetActor\",\"pawn\":\"PlanetPawn\",\"name\":\"planet\",\"translation\":[5,0,0],\"rotation\":[0,0,-0.9314829563659172,0.36378496670397775]}]}]}]}';\nconst yyy = '{\"children\":[{\"actor\":\"BaseActor\",\"pawn\":\"GroundPawn\",\"children\":[{\"actor\":\"SunActor\",\"pawn\":\"BallPawn\",\"name\":\"sun\",\"translation\":[0,2,0],\"rotation\":[0,-0.7654481535684707,0,-0.6434975712453148],\"children\":[{\"actor\":\"PlanetActor\",\"pawn\":\"PlanetPawn\",\"name\":\"planet\",\"translation\":[5,0,0],\"rotation\":[0,0,-0.9314829563659172,0.36378496670397775]}]}]}]}';\n\n_croquet_croquet__WEBPACK_IMPORTED_MODULE_0__.Constants.WC_LEVELS.set(\"bing\", xxx);\n_croquet_croquet__WEBPACK_IMPORTED_MODULE_0__.Constants.WC_LEVELS.set(\"bong\", yyy);\n\n//------------------------------------------------------------------------------------------\n// Level -----------------------------------------------------------------------------------\n//------------------------------------------------------------------------------------------\n\nclass Level extends (0,_Mixins__WEBPACK_IMPORTED_MODULE_4__.mix)(_Actor__WEBPACK_IMPORTED_MODULE_1__.Actor).with(_Mixins__WEBPACK_IMPORTED_MODULE_4__.AM_Spatial) {\n\n    save(layer) {\n        const spec = {};\n        if (this.children.size > 0) spec.children = [];\n        for (const child of this.children) { if (child.toSpec) spec.children.push(child.toSpec(layer)); }\n        return JSON.stringify(spec);\n    }\n\n    load(json) {\n        const spec = JSON.parse(json);\n        this.destroyChildren();\n        (0,_Spec__WEBPACK_IMPORTED_MODULE_3__.CreateFromSpec)(this,spec);\n    }\n\n}\nLevel.register('Level');\n\n//------------------------------------------------------------------------------------------\n//-- LevelManager --------------------------------------------------------------------------\n//------------------------------------------------------------------------------------------\n\nclass LevelManager extends _Root__WEBPACK_IMPORTED_MODULE_2__.ModelService {\n\n    init() {\n        super.init('LevelManager');\n        this.current = Level.create();\n    }\n\n    save(layer) {\n        const spec = this.current.save(layer);\n        return spec;\n    }\n\n    load(key) {\n        const json = _croquet_croquet__WEBPACK_IMPORTED_MODULE_0__.Constants.WC_LEVELS.get(key);\n        if (json) {\n            this.current.load(json);\n        } else {\n            console.error(\"Level \" + key + \" not found!\");\n        }\n    }\n\n}\nLevelManager.register(\"LevelManager\");\n\n\n//# sourceURL=webpack:///../node_modules/@croquet/worldcore-kernel/src/Level.js?");

/***/ }),

/***/ "../node_modules/@croquet/worldcore-kernel/src/Mixins.js":
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AM_Smoothed: () => (/* binding */ AM_Smoothed),\n/* harmony export */   AM_Spatial: () => (/* binding */ AM_Spatial),\n/* harmony export */   PM_Smoothed: () => (/* binding */ PM_Smoothed),\n/* harmony export */   PM_Spatial: () => (/* binding */ PM_Spatial),\n/* harmony export */   RegisterMixin: () => (/* binding */ RegisterMixin),\n/* harmony export */   mix: () => (/* binding */ mix)\n/* harmony export */ });\n/* harmony import */ var _croquet_croquet__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(\"../node_modules/@croquet/croquet/cjs/croquet-croquet-node.js\");\n/* harmony import */ var _croquet_croquet__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_croquet_croquet__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _Vector__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(\"../node_modules/@croquet/worldcore-kernel/src/Vector.js\");\n\n\n\n// Mixin\n//\n// This contains support for mixins that can be added to Views and Models. You need to\n// define View and Model mixins slightly differently, but they otherwise use the same\n// syntax.\n//\n// This approach is based on:\n//\n// https://justinfagnani.com/2015/12/21/real-mixins-with-javascript-classes/\n// https://github.com/justinfagnani/mixwith.js\n\n\n// -- View Mixins --\n//\n// Mixins are defined as functions that transform a class into an extended version\n// of itself. The \"mix\" and \"with\" operators are semantic suger to make the construction\n// of the composite class look nice.\n//\n// Since you don't know what class a mixin will be added to, you should generally set them\n// up so they don't require arguments to their constructors and merely pass any parameter\n// they receive straight through.\n\n\n// -- Example --\n//\n// class Alpha {\n//     constructor() {\n//        }\n// }\n//\n// const Beta = superclass => class extends superclass {\n//     constructor(...args) {\n//         super(...args);\n//        }\n// };\n//\n// const Gamma = superclass => class extends superclass {\n//     constructor(...args) {\n//         super(...args);\n//        }\n// };\n//\n// class Delta extends mix(Alpha).with(Beta, Gamma) {\n//     constructor() {\n//         super();\n//     }\n// }\n\n\n// -- Model Mixins --\n//\n// Model mixins work just like View Mixins, but you need to define an init function instead\n// of a constructor. Also you need to call RegisterMixin after you define them so they get\n// added to the hash of the model code.\n\n\n// -- Example --\n//\n// const ModelBeta = superclass => class extends superclass {\n//     init(...args) {\n//         super.init(...args);\n//     }\n// };\n// RegisterMixin(ModelBeta);\n\n\n//-- Inheritance --\n//\n// Mixins can \"inherit\" from other mixins by including the parent function in the child's extension\n// definition:\n//\n// const ChildMixin = superclass => class extends ParentMixin(superclass) {};\n\n//------------------------------------------------------------------------------------------\n//-- Mixin ---------------------------------------------------------------------------------\n//------------------------------------------------------------------------------------------\n\n_croquet_croquet__WEBPACK_IMPORTED_MODULE_0__.Constants.WC_MIXIN_REGISTRY = [];\n_croquet_croquet__WEBPACK_IMPORTED_MODULE_0__.Constants.WC_MIXIN_USAGE = [];\n\nconst mix = superclass => new MixinFactory(superclass);\nconst RegisterMixin = mixin => _croquet_croquet__WEBPACK_IMPORTED_MODULE_0__.Constants.WC_MIXIN_REGISTRY.push(mixin);\n\nfunction IsModel(c) {\n    while (c) {\n        // console.log(c);\n        if (c === _croquet_croquet__WEBPACK_IMPORTED_MODULE_0__.Model) return true;\n        c = Object.getPrototypeOf(c);\n    }\n    return false;\n}\n\nclass MixinFactory  {\n    constructor(superclass) {\n        this.superclass = superclass;\n    }\n\n    with(...mixins) {\n        if (IsModel(this.superclass))_croquet_croquet__WEBPACK_IMPORTED_MODULE_0__.Constants.WC_MIXIN_USAGE.push(mixins);\n        return mixins.reduce((c, mixin) => { if (mixin) return mixin(c); return c }, this.superclass);\n    }\n}\n\n//------------------------------------------------------------------------------------------\n//-- Spatial -------------------------------------------------------------------------------\n//------------------------------------------------------------------------------------------\n\n// Spatial actors have a translation, rotation and scale in 3D space.\n//\n// They don't have any view-side smoothing, so the pawn will change its transform to exactly\n// match the transform of the actor.\n\n//-- Actor ---------------------------------------------------------------------------------\n\nconst AM_Spatial = superclass => class extends superclass {\n\n    init(...args) {\n        super.init(...args);\n        this.listen(\"setScale\", this.scaleTo);\n        this.listen(\"setRotation\", this.rotateTo);\n        this.listen(\"setTranslation\", this.translateTo);\n        this.listen(\"setPosition\", this.positionTo);\n    }\n\n    scaleTo(v) {\n        this.set({scale:v});\n    }\n\n    rotateTo(q) {\n        this.set({rotation:q});\n    }\n\n    translateTo(v) {\n        this.set({translation:v});\n    }\n\n    positionTo(data) {\n        this.set({translation:data[0], rotation: data[1]});\n    }\n\n    scaleSet(v) {\n        this._scale = v;\n        this.localChanged();\n    }\n\n    rotationSet(q) {\n        this._rotation = q;\n        this.localChanged();\n    }\n\n    translationSet(v) {\n        this._translation = v;\n        this.localChanged();\n    }\n\n    localChanged() {\n        this.$local = null;\n        this.globalChanged();\n    }\n\n    globalChanged() {\n        this.$global = null;\n        this._say(\"globalChanged\");\n        if (this.children) this.children.forEach(child => child.globalChanged());\n    }\n\n    get local() {\n        if (!this.$local) this.$local = (0,_Vector__WEBPACK_IMPORTED_MODULE_1__.m4_scaleRotationTranslation)(this.scale, this.rotation, this.translation);\n        return [...this.$local];\n    }\n    set local(v) {\n        const [scale, rotation, translation] = (0,_Vector__WEBPACK_IMPORTED_MODULE_1__.m4_getScaleRotationTranslation)(v);\n        this.set({scale, rotation, translation});\n        this.$local = v;\n    }\n\n    get global() {\n        if (this.$global) return [...this.$global];\n        if (this.parent && this.parent.global) {\n            this.$global = (0,_Vector__WEBPACK_IMPORTED_MODULE_1__.m4_multiply)(this.local, this.parent.global);\n        } else {\n            this.$global = this.local;\n        }\n        return [...this.$global];\n    }\n\n    get translation() { return this._translation?[...this._translation] : (0,_Vector__WEBPACK_IMPORTED_MODULE_1__.v3_zero)() }\n    set translation(v) { this.set({translation: v}) }\n\n    get rotation() { return this._rotation?[...this._rotation] : (0,_Vector__WEBPACK_IMPORTED_MODULE_1__.q_identity)() }\n    set rotation(q) { this.set({rotation: q}) }\n\n    get scale() { return this._scale?[...this._scale] : [1,1,1] }\n    set scale(v) { this.set({scale: v}) }\n\n    get forward() {return this._forward || [0,0,1]}\n    get up() { return this._up || [0,1,0]}\n\n};\nRegisterMixin(AM_Spatial);\n\n\n//-- Pawn ----------------------------------------------------------------------------------\n\nconst PM_Spatial = superclass => class extends superclass {\n\n    constructor(...args) {\n        super(...args);\n        this.listenOnce(\"globalChanged\", this.refreshDrawTransform);\n    }\n\n    globalChanged() {\n        console.error(\"PM_Spatial pawns can't have PM_Smoothed parents\");\n    }\n\n    refreshDrawTransform() {}\n\n    get scale() { return this.actor.scale }\n    get translation() { return this.actor.translation }\n    get rotation() { return this.actor.rotation }\n    get local() { return this.actor.local }\n    // get global() { return this.actor.global }\n\n    get forward() {return this.actor.forward}\n    get up() { return this.actor.up}\n\n    get global() {\n        if (this.localTransform) return (0,_Vector__WEBPACK_IMPORTED_MODULE_1__.m4_multiply)(this.localTransform, this.actor.global);\n        return this.actor.global;\n    }\n\n};\n\n//------------------------------------------------------------------------------------------\n//-- Smoothed ------------------------------------------------------------------------------\n//------------------------------------------------------------------------------------------\n\nconst AM_Smoothed = superclass => class extends AM_Spatial(superclass) {\n\n    init(...args) {\n        super.init(...args);\n        console.warn(\"AM_Smoothed deprecated -- use AM_Spatial instead\");\n    }\n\n};\nRegisterMixin(AM_Smoothed);\n\n//-- Pawn ----------------------------------------------------------------------------------\n\n// Tug is a value between 0 and 1 that controls the weighting between the two\n// transforms. The closer tug is to 1, the more closely the pawn will track the actor,\n// but the more vulnerable the pawn is to latency/stutters in the simulation.\n\n// When the difference between actor and pawn scale/rotation/translation drops below an epsilon,\n// interpolation is paused\n\nconst PM_Smoothed = superclass => class extends PM_Spatial(superclass) {\n\n    constructor(...args) {\n        super(...args);\n        this.tug = 0.2;\n        this.throttle = 100; //ms\n\n        this._scale = this.actor.scale;\n        this._rotation = this.actor.rotation;\n        this._translation = this.actor.translation;\n        this._global = this.actor.global;\n\n        this.listenOnce(\"scaleSnap\", this.onScaleSnap);\n        this.listenOnce(\"rotationSnap\", this.onRotationSnap);\n        this.listenOnce(\"translationSnap\", this.onTranslationSnap);\n        this.ignore(\"globalChanged\", this.refreshDrawTransform);\n    }\n\n    set tug(t) {this._tug = t}\n    get tug() { return this._tug }\n\n    get scale() { return this._scale }\n    get rotation() { return this._rotation }\n    get translation() { return this._translation }\n\n    localChanged() {\n        this._local = null;\n        this.globalChanged();\n    }\n\n    globalChanged() {\n        this._global = null;\n    }\n\n    scaleTo(v) {\n        this._scale = v;\n        this.localChanged();\n        this.say(\"setScale\", v, this.throttle);\n        this.refreshDrawTransform();\n        this.refreshChildDrawTransform();\n    }\n\n    rotateTo(q) {\n        this._rotation = q;\n        this.localChanged();\n        this.say(\"setRotation\", q, this.throttle);\n        this.refreshDrawTransform();\n        this.refreshChildDrawTransform();\n    }\n\n    translateTo(v) {\n        this._translation = v;\n        this.localChanged();\n        this.say(\"setTranslation\", v, this.throttle);\n        this.refreshDrawTransform();\n        this.refreshChildDrawTransform();\n    }\n\n    positionTo(v, q) {\n        this._translation = v;\n        this._rotation = q;\n        this.localChanged();\n        this.say(\"setPosition\", [v,q], this.throttle);\n        this.refreshDrawTransform();\n        this.refreshChildDrawTransform();\n    }\n\n    refreshChildDrawTransform() {\n        if (this.children) this.children.forEach(child => {\n            child.globalChanged();\n            child.refreshDrawTransform();\n        });\n    }\n\n    onScaleSnap() {\n        this._scale = this.actor.scale;\n        this.localChanged();\n    }\n\n    onRotationSnap() {\n        this._rotation = this.actor.rotation;\n        this.localChanged();\n    }\n\n    onTranslationSnap() {\n        this._translation = this.actor.translation;\n        this.localChanged();\n    }\n\n    get local() {\n        if (this._local) return this._local;\n        this._local = (0,_Vector__WEBPACK_IMPORTED_MODULE_1__.m4_scaleRotationTranslation)(this._scale, this._rotation, this._translation);\n        return this._local;\n    }\n\n    get global() {\n        if (this._global) return this._global;\n        if (this.parent && this.parent.global) {\n            this._global = (0,_Vector__WEBPACK_IMPORTED_MODULE_1__.m4_multiply)(this.local, this.parent.global);\n        } else {\n            this._global = this.local;\n        }\n        if (this.localTransform) return (0,_Vector__WEBPACK_IMPORTED_MODULE_1__.m4_multiply)(this.localTransform, this._global);\n        return this._global;\n    }\n\n    update(time, delta) {\n        super.update(time, delta);\n\n        let tug = this.tug;\n        if (delta) tug = Math.min(1, tug * delta / 15);\n\n        if (!this.driving) {\n            if ((0,_Vector__WEBPACK_IMPORTED_MODULE_1__.v3_equals)(this._scale, this.actor.scale, .0001)) {\n                this._scale = this.actor.scale;\n            } else {\n                this._scale = (0,_Vector__WEBPACK_IMPORTED_MODULE_1__.v3_lerp)(this._scale, this.actor.scale, tug);\n                this.localChanged();\n            }\n\n            if ((0,_Vector__WEBPACK_IMPORTED_MODULE_1__.q_equals)(this._rotation, this.actor.rotation, 0.000001)) {\n                this._rotation = this.actor.rotation;\n            } else {\n                this._rotation = (0,_Vector__WEBPACK_IMPORTED_MODULE_1__.q_slerp)(this._rotation, this.actor.rotation, tug);\n                this.localChanged();\n            }\n\n            if ((0,_Vector__WEBPACK_IMPORTED_MODULE_1__.v3_equals)(this._translation, this.actor.translation, .0001)) {\n                this._translation = this.actor.translation;\n            } else {\n                this._translation = (0,_Vector__WEBPACK_IMPORTED_MODULE_1__.v3_lerp)(this._translation, this.actor.translation, tug);\n                this.localChanged();\n            }\n\n        }\n\n        if (!this._global) {\n            this.refreshDrawTransform();\n            this.refreshChildDrawTransform();\n            if (this.children) this.children.forEach(child => child.globalChanged()); // If our global changes, so do the globals of our children\n        }\n\n    }\n\n};\n\n\n\n//# sourceURL=webpack:///../node_modules/@croquet/worldcore-kernel/src/Mixins.js?");

/***/ }),

/***/ "../node_modules/@croquet/worldcore-kernel/src/NavGrid.js":
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AM_Grid: () => (/* binding */ AM_Grid),\n/* harmony export */   AM_NavGrid: () => (/* binding */ AM_NavGrid),\n/* harmony export */   AM_OnGrid: () => (/* binding */ AM_OnGrid),\n/* harmony export */   AM_OnNavGrid: () => (/* binding */ AM_OnNavGrid)\n/* harmony export */ });\n/* harmony import */ var _Mixins__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(\"../node_modules/@croquet/worldcore-kernel/src/Mixins.js\");\n/* harmony import */ var _Vector__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(\"../node_modules/@croquet/worldcore-kernel/src/Vector.js\");\n/* harmony import */ var _Utilities__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(\"../node_modules/@croquet/worldcore-kernel/src/Utilities.js\");\n/* harmony import */ var _Behavior__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(\"../node_modules/@croquet/worldcore-kernel/src/Behavior.js\");\n\n\n\n\n\n//------------------------------------------------------------------------------------------\n// -- Utilities -----------------------------------------------------------------------------\n//------------------------------------------------------------------------------------------\n\nfunction packKey(x,y) {\n    const xx = x + 0x4000;\n    const yy = y + 0x4000;\n    return ((0x8000|xx)<<16)|yy;\n}\n\nfunction unpackKey(key) {\n    const x = (key>>>16) & 0x7FFF;\n    const y = key & 0x7FFF;\n    return [x - 0x4000, y - 0x4000];\n}\n\n//------------------------------------------------------------------------------------------\n// -- AM_Grid ------------------------------------------------------------------------------\n//------------------------------------------------------------------------------------------\n\nconst AM_Grid = superclass => class extends superclass {\n\n    get gridSize() { return this._gridSize || 16}\n    get gridScale() { return this._gridScale || 1}\n    get gridPlane() { return this._gridPlane || 0 } // 0 = xz, 1 = xy, 2 = yz\n    get isGrid() { return true}\n\n    init(options) {\n        super.init(options);\n        this.gridBins = new Map();\n    }\n\n    gridXY(x,y,z) {\n        const s = this.gridScale;\n        switch (this.gridPlane) {\n            default:\n            case 0: return [x/s, z/s];\n            case 1: return [x/s, y/s];\n            case 2: return [y/s, z/s];\n        }\n    }\n\n    gridXYZ(x,y) {\n        switch (this.gridPlane) {\n            default:\n            case 0: return [x,0,y];\n            case 1: return [x,y,0];\n            case 2: return [0,x,y];\n        }\n    }\n\n    addToBin(key,child) {\n        let bin = this.gridBins.get(key);\n        if (!bin) {\n            bin = new Set();\n            this.gridBins.set(key, bin);\n        }\n        bin.add(child);\n        child.gridBin = bin;\n    }\n\n    removeFromBin(key,child) {\n        const bin = this.gridBins.get(key);\n        if (bin) {\n            bin.delete(child);\n            if (bin.size === 0) this.gridBins.delete(key);\n        }\n        child.gridBin = null;\n    }\n\n    getBin(x,y) {\n        const key = packKey(x,y);\n        return this.gridBins.get(key);\n    }\n\n    pingAll(tag, center, radius=0, exclude) {     // returns an array of all actors with tag in radius\n        const out = [];\n\n        const xy = this.gridXY(...center);\n        const cx = Math.floor(xy[0]);\n        const cy = Math.floor(xy[1]);\n        const r = Math.floor(radius/this.gridScale);\n\n        const bbb = this.getBin(cx, cy);\n        if (bbb) {\n            for (const actor of bbb) {\n                if (actor !== exclude && actor.tags.has(tag)) out.push(actor);\n            }\n        }\n        // for (const actor of this.getBin(cx, cy)) {\n        //     if (actor !== exclude && actor.tags.has(tag)) out.push(actor);\n        // }\n\n        for (let n = 1; n<=r; n++) {\n            const x0 = cx-n;\n            const y0 = cy-n;\n            const x1 = cx+n;\n            const y1 = cy+n;\n\n            for (let x = x0; x<=x1; x++) {\n                const bin = this.getBin(x,y0);\n                if (!bin) continue;\n                for (const actor of bin) {\n                    if (actor !== exclude && actor.tags.has(tag)) out.push(actor);\n                }\n            }\n\n            for (let y = y0+1; y<y1; y++) {\n                const bin = this.getBin(x0,y);\n                if (!bin) continue;\n                for (const actor of bin) {\n                    if (actor !== exclude && actor.tags.has(tag)) out.push(actor);\n                }\n            }\n\n            for (let x = x0; x<=x1; x++) {\n                const bin = this.getBin(x,y1);\n                if (!bin) continue;\n                for (const actor of bin) {\n                    if (actor !== exclude && actor.tags.has(tag)) out.push(actor);\n                }\n            }\n\n            for (let y = y0+1; y<y1; y++) {\n                const bin = this.getBin(x1,y);\n                if (!bin) continue;\n                for (const actor of bin) {\n                    if (actor !== exclude && actor.tags.has(tag)) out.push(actor);\n                }\n            }\n        }\n\n        return out;\n    }\n\n    pingAny(tag, center, radius=0, exclude) { // Returns the first actor it finds in the radius\n\n        const xy = this.gridXY(...center);\n        const cx = Math.floor(xy[0]);\n        const cy = Math.floor(xy[1]);\n        const r = Math.floor(radius/this.gridScale);\n\n        let bin = this.getBin(cx, cy);\n        if (bin) {\n            for (const actor of bin) {\n                if (actor !== exclude && actor.tags.has(tag)) return actor;\n            }\n        }\n\n        for (let n = 1; n<=r; n++) {\n            const x0 = cx-n;\n            const y0 = cy-n;\n            const x1 = cx+n;\n            const y1 = cy+n;\n\n            for (let x = x0; x<=x1; x++) {\n                bin = this.getBin(x,y0);\n                if (!bin) continue;\n                for (const actor of bin) {\n                    if (actor !== exclude && actor.tags.has(tag)) return actor;\n                }\n            }\n\n            for (let y = y0+1; y<y1; y++) {\n                bin = this.getBin(x0,y);\n                if (!bin) continue;\n                for (const actor of bin) {\n                    if (actor !== exclude && actor.tags.has(tag)) return actor;\n                }\n            }\n\n            for (let x = x0; x<=x1; x++) {\n                bin = this.getBin(x,y1);\n                if (!bin) continue;\n                for (const actor of bin) {\n                    if (actor !== exclude && actor.tags.has(tag)) return actor;\n                }\n            }\n\n            for (let y = y0+1; y<y1; y++) {\n                bin = this.getBin(x1,y);\n                if (!bin) continue;\n                for (const actor of bin) {\n                    if (actor !== exclude && actor.tags.has(tag)) return actor;\n                }\n            }\n        }\n\n        return null;\n    }\n\n};\n(0,_Mixins__WEBPACK_IMPORTED_MODULE_0__.RegisterMixin)(AM_Grid);\n\n//------------------------------------------------------------------------------------------\n//-- AM_OnGrid -----------------------------------------------------------------------------\n//------------------------------------------------------------------------------------------\n\nconst AM_OnGrid = superclass => class extends superclass {\n\n    get xy() { return this._xy || [0,0]}\n\n    translationSet(xyz) {\n        if (!this.parent || !this.parent.isGrid) { console.error(\"AM_OnGrid must have an AM_Grid parent!\"); return}\n        const xy = this.parent.gridXY(...xyz);\n        this.set({xy});\n\n        const oldKey = this.gridKey;\n        this.gridKey = packKey(...xy);\n\n        if (this.gridKey !== oldKey) {\n            this.parent.removeFromBin(oldKey,this);\n            this.parent.addToBin(this.gridKey, this);\n        }\n    }\n\n    destroy() {\n        if (this.parent) this.parent.removeFromBin(this.gridKey, this);\n        super.destroy();\n    }\n\n    pingAll(tag, radius = 0) {\n        if (!this.parent || !this.parent.isGrid) { console.error(\"Ping requires an AM_Grid!\"); return []}\n        return this.parent.pingAll(tag, this.translation, radius, this);\n    }\n\n    pingAny(tag, radius = 0) {\n        if (!this.parent || !this.parent.isGrid) { console.error(\"Ping requires an AM_Grid!\"); return []}\n        return this.parent.pingAny(tag, this.translation, radius, this);\n    }\n};\n(0,_Mixins__WEBPACK_IMPORTED_MODULE_0__.RegisterMixin)(AM_OnGrid);\n\n//------------------------------------------------------------------------------------------\n// -- AM_NavGrid --------------------------------------------------------------------------\n//------------------------------------------------------------------------------------------\n\nconst AM_NavGrid = superclass => class extends AM_Grid(superclass) {\n\n    static types() { return { \"AM_NavGrid:NavNode\": NavNode }}\n\n    get isNavGrid() { return true}\n    get noise() { return this._noise || 0}\n\n    init(options) {\n        super.init(options);\n        this.navNodes = new Map();\n        this.navClear();\n    }\n\n    navClear() {\n        const perlin = new _Utilities__WEBPACK_IMPORTED_MODULE_2__.PerlinNoise();\n        const halfSize = this.gridSize/2;\n        for (let x = -halfSize; x < halfSize; x++) {\n            for (let y = -halfSize; y < halfSize; y++) {\n                const node = new NavNode(x,y);\n                node.clear(this.gridSize);\n                if (this.noise) node.effort += this.noise*perlin.noise2D(x,y);\n                this.navNodes.set(node.key, node);\n            }\n        }\n\n        this._say(\"navGridChanged\");\n    }\n\n    addBlock(x,y) {\n\n        const west = this.navNodes.get(packKey(x-1, y));\n        const south = this.navNodes.get(packKey(x, y-1));\n        const east = this.navNodes.get(packKey(x+1, y));\n        const north = this.navNodes.get(packKey(x, y+1));\n\n        const southwest = this.navNodes.get(packKey(x-1, y-1));\n        const southeast = this.navNodes.get(packKey(x+1, y-1));\n        const northeast = this.navNodes.get(packKey(x+1, y+1));\n        const northwest = this.navNodes.get(packKey(x-1, y+1));\n\n        if (west) west.exits[2] = 0;\n        if (south) south.exits[3] = 0;\n        if (east) east.exits[0] = 0;\n        if (north) north.exits[1] = 0;\n\n        if (southwest) southwest.exits[6] = 0;\n        if (southeast) southeast.exits[7] = 0;\n        if (northeast) northeast.exits[4] = 0;\n        if (northwest) northwest.exits[5] = 0;\n\n    }\n\n    addHorizontalFence(x,y,length) {\n\n        for ( let n = 0; n<length; n++) {\n\n            const south = this.navNodes.get(packKey(x+n,y-1));\n            const north = this.navNodes.get(packKey(x+n,y));\n\n            if (south) south.exits[3] = 0;\n            if (north) north.exits[1] = 0;\n\n            if (n>0) {\n                if (south) south.exits[7] = 0;\n                if (north) north.exits[4] = 0;\n            }\n\n            if (n<length-1) {\n                if (south) south.exits[6] = 0;\n                if (north) north.exits[5] = 0;\n            }\n        }\n    }\n\n    addVerticalFence(x,y,length) {\n\n        for ( let n = 0; n<length; n++) {\n\n            const west = this.navNodes.get(packKey(x-1,y+n));\n            const east = this.navNodes.get(packKey(x,y+n));\n\n            if (west) west.exits[2] = 0;\n            if (east) east.exits[0] = 0;\n\n            if (n>0) {\n                if (west) west.exits[5] = 0;\n                if (east) east.exits[4] = 0;\n            }\n\n            if (n<length-1) {\n                if (west) west.exits[6] = 0;\n                if (east) east.exits[7] = 0;\n            }\n        }\n\n    }\n\n    isBlocked(from, aim) {\n        const to = (0,_Vector__WEBPACK_IMPORTED_MODULE_1__.v3_add)(from,aim);\n        const fromKey = packKey(...(0,_Vector__WEBPACK_IMPORTED_MODULE_1__.v2_floor)(this.gridXY(...from)));\n        const toKey = packKey(...(0,_Vector__WEBPACK_IMPORTED_MODULE_1__.v2_floor)(this.gridXY(...to)));\n        if (fromKey === toKey) return false;\n        const node = this.navNodes.get(fromKey);\n        if (node) return !node.hasExitTo(toKey);\n        return true;\n    }\n\n    findPath(startKey, endKey) {\n\n        const path = [];\n\n        if (!this.navNodes.has(startKey)) return path;  // Invalid start waypoint\n        if (!this.navNodes.has(endKey)) return path;    // Invalid end waypoint\n        if (startKey === endKey) return [startKey]; // already at destination\n\n        const endXY = this.navNodes.get(endKey).xy;\n\n        const frontier = new _Utilities__WEBPACK_IMPORTED_MODULE_2__.PriorityQueue((a, b) => a.priority < b.priority);\n        const visited = new Map();\n\n        frontier.push({priority: 0, key: startKey});\n        visited.set(startKey, {from: startKey, cost: 0});\n\n        let key;\n        while (!frontier.isEmpty) {\n            key = frontier.pop().key;\n            if (key === endKey) break;\n            const cost = visited.get(key).cost;\n            const node = this.navNodes.get(key);\n            node.exits.forEach((exit,n) => {\n                if (!exit) return;\n                const weight = node.weight(n);\n                if (!visited.has(exit)) visited.set(exit, {}); // First time visited\n                const next = visited.get(exit);\n                if (!next.from || next.cost > cost + weight ) { // This route is better\n                    next.from = key;\n                    next.cost = cost + weight;\n                    const heuristic = (0,_Vector__WEBPACK_IMPORTED_MODULE_1__.v2_manhattan)(this.navNodes.get(exit).xy, endXY);\n                    frontier.push({priority: next.cost + heuristic, key: exit});\n                }\n            });\n        }\n\n        if (key === endKey) { // A path was found!\n            while (key !== startKey) { // Run backwards along \"from\" links to build path array\n                path.push(key);\n                key = visited.get(key).from;\n            }\n            path.push(startKey);\n            path.reverse();\n        }\n\n        return path;\n    }\n\n};\n(0,_Mixins__WEBPACK_IMPORTED_MODULE_0__.RegisterMixin)(AM_NavGrid);\n\n//------------------------------------------------------------------------------------------\n//-- NavNode -------------------------------------------------------------------------------\n//------------------------------------------------------------------------------------------\n\nclass NavNode {\n    constructor(x, y) {\n        this.xy = [x,y];\n        this.key = packKey(x,y);\n        this.exits = [0,0,0,0, 0,0,0,0];\n        this.effort = 1;\n    }\n\n    get west() { return this.exits[0] }\n    get south() { return this.exits[1] }\n    get east() { return this.exits[2] }\n    get north() { return this.exits[3] }\n\n    get southwest() { return this.exits[4] }\n    get southeast() { return this.exits[5] }\n    get northeast() { return this.exits[6] }\n    get northwest() { return this.exits[7] }\n\n    get hasExit() { return this.exits.some(e => e)}\n    get isEmpty() { return !this.hasExit }\n\n    hasExitTo(key) {\n        if (key) return this.exits.some(e => e===key);\n        return false;\n    }\n\n    exitTo(x,y) {\n        const xx = Math.abs(x) > 2*Math.abs(y);\n        const yy = Math.abs(y) > 2*Math.abs(x);\n\n        if (x>0) { // east\n            if (y>0) { // northeast\n                if (xx) return this.east;\n                if (yy) return this.north;\n                return !this.northeast;\n            } // southeast\n            if (xx) return this.east;\n            if (yy) return this.south;\n            return this.southeast;\n        } // west\n        if (y>0) { // northwest\n            if (xx) return this.west;\n            if (yy) return this.north;\n            return this.northwest;\n        } // southwest\n        if (xx) return this.west;\n        if (yy) return this.south;\n        return this.southwest;\n    }\n\n    clear(gridSize) {\n        this.exits.fill(0);\n        const x = this.xy[0];\n        const y = this.xy[1];\n        const min = -gridSize/2;\n        const max = gridSize/2-1;\n\n        if (x>min) this.exits[0] = packKey(x-1, y);\n        if (y>min) this.exits[1] = packKey(x, y-1);\n        if (x<max) this.exits[2] = packKey(x+1, y);\n        if (y<max) this.exits[3] = packKey(x, y+1);\n\n        if (x>min && y>min) this.exits[4] = packKey(x-1,y-1);\n        if (x<max && y>min) this.exits[5] = packKey(x+1,y-1);\n        if (x<max && y<max) this.exits[6] = packKey(x+1,y+1);\n        if (x>min && y<max) this.exits[7] = packKey(x-1,y+1);\n    }\n\n    weight(n) {\n        if (n>3) return 1.5 * this.effort;\n        return this.effort;\n    }\n\n}\n\n//------------------------------------------------------------------------------------------\n// -- AM_OnNavGrid -------------------------------------------------------------------------\n//------------------------------------------------------------------------------------------\n\nconst AM_OnNavGrid = superclass => class extends AM_OnGrid(superclass) {\n\n    get obstacle() { return this._obstacle}\n\n    init(options) {\n        super.init(options);\n        if (this.parent && this.obstacle) this.buildObstacle();\n    }\n\n    isBlocked(aim) {\n        return this.parent.isBlocked(this.translation, aim);\n    }\n\n    buildObstacle() {\n        this.parent.addBlock(...this.xy);\n    }\n\n};\n(0,_Mixins__WEBPACK_IMPORTED_MODULE_0__.RegisterMixin)(AM_OnNavGrid);\n\n//------------------------------------------------------------------------------------------\n//-- GotoBehavior --------------------------------------------------------------------------\n//------------------------------------------------------------------------------------------\n\nclass GotoBehavior extends _Behavior__WEBPACK_IMPORTED_MODULE_3__.Behavior {\n\n    get tickRate() { return this._tickRate || 50} // More than 15ms for smooth movement\n\n    get radius() { return this._radius || 0}\n    get speed() { return this._speed || 1}\n    get target() {return this._target || this.actor.translation}\n\n    do(delta) {\n        const distance = this.speed * delta / 1000;\n\n        const to = (0,_Vector__WEBPACK_IMPORTED_MODULE_1__.v3_sub)(this.target, this.actor.translation);\n        const left = (0,_Vector__WEBPACK_IMPORTED_MODULE_1__.v3_magnitude)(to);\n\n        if (left < this.radius) {\n            this.succeed();\n            return;\n        }\n\n        if (left<distance) {\n            this.actor.set({translation:this.target});\n            this.succeed();\n            return;\n        }\n\n        const aim = (0,_Vector__WEBPACK_IMPORTED_MODULE_1__.v3_normalize)(to);\n\n        const x = aim[0] * distance;\n        const y = aim[1] * distance;\n        const z = aim[2] * distance;\n\n        const translation = (0,_Vector__WEBPACK_IMPORTED_MODULE_1__.v3_add)(this.actor.translation, [x,y,z]);\n        const rotation = (0,_Vector__WEBPACK_IMPORTED_MODULE_1__.q_lookAt)(this.actor.forward, this.actor.up, aim);\n\n        this.actor.set({translation, rotation});\n\n    }\n\n}\nGotoBehavior.register(\"GotoBehavior\");\n\n//------------------------------------------------------------------------------------------\n//-- PathToBehavior ------------------------------------------------------------------------\n//------------------------------------------------------------------------------------------\n\nclass PathToBehavior extends _Behavior__WEBPACK_IMPORTED_MODULE_3__.Behavior {\n\n    get target() {return this._target || this.actor.translation}\n    get speed() { return this._speed || 3}\n    get radius() { return this._radius || 0}\n    get noise() { return this._noise || 0}\n\n    onStart() {\n        if (!this.actor.parent || !this.actor.parent.isNavGrid) {\n            console.warn(\"PathToBehavior must be used on a NavGrid\");\n            this.fail();\n        }\n\n        const grid = this.actor.parent;\n        const start = grid.gridXY(...this.actor.translation);\n        const end = grid.gridXY(...this.target);\n        const startKey = packKey(...(0,_Vector__WEBPACK_IMPORTED_MODULE_1__.v2_floor)(start));\n        const endKey = packKey(...(0,_Vector__WEBPACK_IMPORTED_MODULE_1__.v2_floor)(end));\n\n\n        this.path = grid.findPath(startKey, endKey);\n\n        if (this.path.length === 0) { // No path to destination\n            this.fail();\n            return;\n        }\n\n        this.step = 0;\n\n        if (this.path.length === 1) {\n            this.goto = this.start({name: \"GotoBehavior\", speed: this.speed, target: this.target});\n        } else {\n            this.goto = this.start({name: \"GotoBehavior\", speed: this.speed, neverSucceed: true});\n            this.nextStep();\n        }\n\n    }\n\n    nextStep() {\n        const grid = this.actor.parent;\n        this.step++;\n        if (this.step >  this.path.length-2) { // at end\n            this.goto.set({target: this.target, radius: this.radius});\n        } else {\n            const xy = unpackKey(this.path[this.step]);\n            this.addNoise(xy);\n            const target = grid.gridXYZ(...xy);\n            this.goto.set({target});\n        }\n    }\n\n    addNoise(xy) {\n        const s = this.actor.parent.gridScale;\n        let x = 0.5;\n        let y = 0.5;\n        const n = this.noise/2;\n        if (n) {\n            x = (0.5-n/2) + n*this.random();\n            y = (0.5-n/2) + n*this.random();\n        }\n        xy[0] += x; xy[1] += y;\n        xy[0] *=s; xy[1] *=s;\n    }\n\n    onProgress() {\n        if (this.step<this.path.length) {\n            this.nextStep();\n            this.progress(this.step/this.path.length);\n        } else {\n            this.progress(1);\n            this.succeed();\n        }\n    }\n\n    onFail() { this.fail() }\n\n    onSucceed() { this.succeed() }\n\n}\nPathToBehavior.register(\"PathToBehavior\");\n\n\n//# sourceURL=webpack:///../node_modules/@croquet/worldcore-kernel/src/NavGrid.js?");

/***/ }),

/***/ "../node_modules/@croquet/worldcore-kernel/src/Pawn.js":
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GetPawn: () => (/* binding */ GetPawn),\n/* harmony export */   Pawn: () => (/* binding */ Pawn),\n/* harmony export */   PawnManager: () => (/* binding */ PawnManager)\n/* harmony export */ });\n/* harmony import */ var _Root__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(\"../node_modules/@croquet/worldcore-kernel/src/Root.js\");\n/* eslint-disable new-cap */\n\n\n//------------------------------------------------------------------------------------------\n//-- PawnManager ---------------------------------------------------------------------------\n//------------------------------------------------------------------------------------------\n\nlet pm; // Local pointer for pawns\nconst PAWN_REGISTRY = new Map();\n\nclass PawnManager extends _Root__WEBPACK_IMPORTED_MODULE_0__.ViewService {\n    constructor() {\n        super(\"PawnManager\");\n        pm = this;\n        this.pawns = new Map();\n\n        // const actorManager = this.modelService(\"ActorManager\");\n        // actorManager.actors.forEach(actor => this.newPawn(actor));\n\n        // for (const pawn of this.pawns.values()) { pawn.link() } // recreate child links\n\n        // this.start();\n\n        this.subscribe(\"actor\", \"createActor\", this.spawnPawn);\n        this.subscribe(\"actor\", \"destroyActor\", this.destroyPawn);\n    }\n\n    start() {\n        const actorManager = this.modelService(\"ActorManager\");\n        actorManager.actors.forEach(actor => this.newPawn(actor));\n\n        for (const pawn of this.pawns.values()) { pawn.link() } // recreate child links\n    }\n\n    destroy() {\n        const doomed = new Map(this.pawns);\n        doomed.forEach(pawn => pawn.destroy());\n        pm = null;\n        super.destroy();\n    }\n\n    newPawn(actor) {\n        if (!actor.pawn) return null;\n        let p=null;\n        if (typeof actor.pawn === 'string' ) {\n            const cls = PAWN_REGISTRY.get(actor.pawn);\n            if (!cls) {\n                console.warn(actor.pawn + \" does not exist in the pawn registry!\");\n                return null;\n            }\n            p = new cls(actor);\n        } else {\n            p = new actor.pawn(actor);\n        }\n        this.pawns.set(actor.id, p);\n        return p;\n    }\n\n    spawnPawn(actor) {\n        if (!actor.pawn) return;\n        const p = this.newPawn(actor);\n        if (p) p.link();\n    }\n\n    destroyPawn(actor) {\n        const p = this.pawns.get(actor.id);\n        this.pawns.delete(actor.id);\n        if (p) p.destroy();\n    }\n\n    update(time, delta) {\n        for (const pawn of this.pawns.values()) { if (!pawn.parent) pawn.fullUpdate(time, delta); }\n    }\n}\n\nfunction GetPawn(actorId) { return pm.pawns.get(actorId) }\n\n//------------------------------------------------------------------------------------------\n//-- Pawn ----------------------------------------------------------------------------------\n//------------------------------------------------------------------------------------------\n\nclass Pawn extends _Root__WEBPACK_IMPORTED_MODULE_0__.WorldcoreView {\n\n    static register(name) {\n        if (PAWN_REGISTRY.has(name)) console.warn(name + \" already exists in pawn registry!\");\n        PAWN_REGISTRY.set(name, this);\n    }\n\n    constructor(actor) {\n        super(actor);\n        this._actor = actor;\n        this._sayNext = {};\n        this._sayCache = {};\n\n        this.listen(\"parentSet\", this.onParent);\n        this.listen(\"pawnSet\", this.onPawn);\n    }\n\n    link() { if (this.parent) this.parent.addChild(this); }\n\n    get actor() {return this._actor}\n\n    destroy() {\n        this.doomed = true;\n        this.detach(); // Calling View clean-up.\n    }\n\n    get parent() {\n        if (this.actor.parent && !this._parent) this._parent = GetPawn(this.actor.parent.id);\n        return this._parent;\n    }\n\n    get children() {\n        return this._children;\n    }\n\n    addChild(child) {\n        if (!this._children) this._children = new Set();\n        this._children.add(child);\n    }\n\n    removeChild(child) {\n        if (this._children) this._children.delete(child);\n    }\n\n    onParent(d) {\n        if (d.o) {\n            this._parent = null;\n            const p = GetPawn(d.o.id);\n            if (p) p.removeChild(this);\n        }\n        if (this.parent) this.parent.addChild(this);\n    }\n\n    onPawn() {\n        const actor = this.actor;\n        const children = new Set(this.children);\n        pm.destroyPawn(actor);\n        pm.spawnPawn(actor);\n        children.forEach(child => {\n            child._parent = null;\n            child.link();\n        });\n    }\n\n    say(event, data, throttle = 0) {\n        if (this.time < this._sayNext[event]) {\n            this._sayCache[event] = { data, throttle };\n        } else {\n            this._sayNext[event] = this.time + throttle;\n            this._sayCache[event] = null;\n            this.publish(this.actor.id, event, data);\n        }\n    }\n\n    listen(event, callback) {\n        this.subscribe(this.actor.id, event, callback);\n    }\n\n    listenImmediate(event, callback) {\n        this.subscribe(this.actor.id,{event, handling: \"immediate\"}, callback);\n    }\n\n    ignore(event, callback) {\n        this.unsubscribe(this.actor.id, event, callback);\n    }\n\n    listenOnce(event, callback) {\n        this.subscribe(this.actor.id, {event, handling: \"oncePerFrame\"}, callback);\n    }\n\n    set(options, throttle = 0) {\n        this.say(\"_set\", options, throttle);\n    }\n\n    snap(options, throttle = 0) {\n        this.say(\"_snap\", options, throttle);\n    }\n\n    preUpdate(time, delta) {} // Called immediately before the main update\n    update(time, delta) {}\n    postUpdate(time, delta){} // Called immediately after the main update.\n\n    fullUpdate(time, delta) {\n        this.preUpdate(time, delta);\n        this.update(time, delta);\n        this.postUpdate(time, delta);\n\n        for (const event in this._sayCache) { // Flushes expired cached events from throttled says\n            const cache = this._sayCache[event];\n            if (cache && time > this._sayNext[event]) {\n                const { data, throttle } = cache;\n                this._sayNext[event] = time + throttle;\n                this._sayCache[event] = null;\n                this.publish(this.actor.id, event, data);\n            }\n        }\n\n        if (this.children) this.children.forEach(child => child.fullUpdate(time, delta));\n    }\n\n}\nPawn.register(\"Pawn\");\n\n\n\n\n//# sourceURL=webpack:///../node_modules/@croquet/worldcore-kernel/src/Pawn.js?");

/***/ }),

/***/ "../node_modules/@croquet/worldcore-kernel/src/Root.js":
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GetModelService: () => (/* binding */ GetModelService),\n/* harmony export */   GetViewService: () => (/* binding */ GetViewService),\n/* harmony export */   ModelRoot: () => (/* binding */ ModelRoot),\n/* harmony export */   ModelService: () => (/* binding */ ModelService),\n/* harmony export */   StartWorldcore: () => (/* binding */ StartWorldcore),\n/* harmony export */   ViewRoot: () => (/* binding */ ViewRoot),\n/* harmony export */   ViewService: () => (/* binding */ ViewService),\n/* harmony export */   WorldcoreModel: () => (/* binding */ WorldcoreModel),\n/* harmony export */   WorldcoreView: () => (/* binding */ WorldcoreView),\n/* harmony export */   viewRoot: () => (/* binding */ viewRoot)\n/* harmony export */ });\n/* harmony import */ var _croquet_croquet__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(\"../node_modules/@croquet/croquet/cjs/croquet-croquet-node.js\");\n/* harmony import */ var _croquet_croquet__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_croquet_croquet__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _Actor__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(\"../node_modules/@croquet/worldcore-kernel/src/Actor.js\");\n/* harmony import */ var _Pawn__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(\"../node_modules/@croquet/worldcore-kernel/src/Pawn.js\");\n\n\n\n\n//------------------------------------------------------------------------------------------\n//-- WorldcoreModel ------------------------------------------------------------------------\n//------------------------------------------------------------------------------------------\n\n// Extends the model base class with Worldcore-specific methods.\n\nclass WorldcoreModel extends _croquet_croquet__WEBPACK_IMPORTED_MODULE_0__.Model {\n\n    service(name) { return this.wellKnownModel(name) }\n\n}\nWorldcoreModel.register(\"WorldcoreModel\");\n\n//------------------------------------------------------------------------------------------\n//-- ModelRoot -----------------------------------------------------------------------------\n//------------------------------------------------------------------------------------------\n\nclass ModelRoot extends WorldcoreModel {\n\n    static modelServices() { return [] }\n\n    init() {\n        super.init();\n        this.beWellKnownAs(\"ModelRoot\");\n        this.services = new Set();\n        this.services.add(_Actor__WEBPACK_IMPORTED_MODULE_1__.ActorManager.create());\n        this.constructor.modelServices().forEach( service => {\n            this.services.add(service.create());\n        });\n\n    }\n\n}\nModelRoot.register(\"ModelRoot\");\n\n//------------------------------------------------------------------------------------------\n//-- ModelService --------------------------------------------------------------------------\n//------------------------------------------------------------------------------------------\n\n// A model service is a named singleton that's created by the root model. Do not instantiate\n// model services directly.\n\nclass ModelService extends WorldcoreModel {\n\n    static async asyncStart() {}\n\n    init(name) {\n        super.init();\n        console.log(\"Starting \" + name);\n        this.name = name;\n        if (!name) console.error(\"All services must have public names!\");\n        else if (this.wellKnownModel(name)) console.error(\"Duplicate service!\");\n        else this.beWellKnownAs(name);\n    }\n\n}\nModelService.register('ModelService');\n\nfunction GetModelService(name) { return viewRoot.wellKnownModel(name) }\n\n//------------------------------------------------------------------------------------------\n//-- WorldcoreView -------------------------------------------------------------------------\n//------------------------------------------------------------------------------------------\n\n// Extends the view base class with Worldcore-specific methods.\n\nclass WorldcoreView extends _croquet_croquet__WEBPACK_IMPORTED_MODULE_0__.View {\n\n    destroy() {\n        this.detach();\n    }\n\n    service(name) { return viewServices.get(name) }\n    modelService(name) { return this.wellKnownModel(name) }\n    get time() {return time1}\n    get delta()  {return time1 - time0}\n\n}\n\n//------------------------------------------------------------------------------------------\n//-- ViewRoot ------------------------------------------------------------------------------\n//------------------------------------------------------------------------------------------\n\n// viewRoot is a special public global variable that stores the viewRoot.\n\nlet viewRoot;\nlet time0 = 0;\nlet time1 = 0;\nlet viewServices = new Map();\n\nclass ViewRoot extends WorldcoreView {\n\n    static viewServices() { return [] }\n\n    constructor(model) {\n        super(model);\n        this.model = model;\n        viewRoot = this;\n        time0 = 0;\n        time1 = 0;\n        viewServices = new Map();\n        this.constructor.viewServices().forEach( service => {\n            new service();\n        });\n        this.onStart();\n\n        let pm = this.service(\"PawnManager\");\n        if (!pm) {\n            console.log(\"Using Default PawnManager\");\n            pm = new _Pawn__WEBPACK_IMPORTED_MODULE_2__.PawnManager();\n        }\n        pm.start();\n    }\n\n    onStart() {} // A final set-up that runs before the pawns are created\n\n    detach() {\n        [...viewServices.values()].reverse().forEach(s => s.destroy());\n        super.detach();\n    }\n\n    update(time) {\n        time0 = time1;\n        time1 = time;\n        const delta = time1 - time0;\n        let done = new Set();\n\n        const pm = this.service(\"PawnManager\");\n\n        pm.update(time, delta); // Pawns update before other services\n        viewServices.forEach(s => {\n            if (done.has(s)) {return}\n            if (s === pm) return;\n            done.add(s);\n            if (s.update) s.update(time, delta);\n        });\n    }\n\n}\n\n//------------------------------------------------------------------------------------------\n//-- ViewService ---------------------------------------------------------------------------\n//------------------------------------------------------------------------------------------\n\nclass ViewService extends WorldcoreView {\n\n    static async asyncStart() {}\n\n    constructor(name) {\n        super(viewRoot.model);\n        this.model = viewRoot.model;\n        console.log(\"Starting \" + name);\n        this.name = name;\n        this.registerViewName(name);\n    }\n\n    registerViewName(name) {\n        if (!name) console.error(\"All services must have public names!\");\n        else if (viewServices.has(name)) console.error(\"Duplicate service!\");\n        else viewServices.set(name, this);\n    }\n\n    destroy() {\n        super.destroy();\n        viewServices.delete(this.name);\n    }\n\n}\n\nfunction GetViewService(name) { return viewServices.get(name) }\n\n//------------------------------------------------------------------------------------------\n//-- StartWorldcore ------------------------------------------------------------------------\n//------------------------------------------------------------------------------------------\n\nasync function StartWorldcore(options) {\n\n    await Promise.all(options.model.modelServices().map(service => {\n        if (service.service) service = service.service;\n        return service.asyncStart();\n    }));\n\n    await Promise.all(options.view.viewServices().map(service => {\n        if (service.service) service = service.service;\n        return service.asyncStart();\n    }));\n\n    if (!Array.isArray(options.flags)) options = { ...options, flags: [] };\n    if (!options.flags.includes(\"worldcore\")) options.flags.push(\"worldcore\");\n\n    const session = await _croquet_croquet__WEBPACK_IMPORTED_MODULE_0__.Session.join(options);\n\n    return session;\n}\n\n\n//# sourceURL=webpack:///../node_modules/@croquet/worldcore-kernel/src/Root.js?");

/***/ }),

/***/ "../node_modules/@croquet/worldcore-kernel/src/Spec.js":
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AM_Spec: () => (/* binding */ AM_Spec),\n/* harmony export */   CreateFromSpec: () => (/* binding */ CreateFromSpec)\n/* harmony export */ });\n/* harmony import */ var _croquet_croquet__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(\"../node_modules/@croquet/croquet/cjs/croquet-croquet-node.js\");\n/* harmony import */ var _croquet_croquet__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_croquet_croquet__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _Mixins__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(\"../node_modules/@croquet/worldcore-kernel/src/Mixins.js\");\n/* harmony import */ var _Utilities__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(\"../node_modules/@croquet/worldcore-kernel/src/Utilities.js\");\n\n\n\n\n\n_croquet_croquet__WEBPACK_IMPORTED_MODULE_0__.Constants.WC_SPEC = new _Utilities__WEBPACK_IMPORTED_MODULE_2__.TwoWayMap();\n\n//------------------------------------------------------------------------------------------\n//-- AM_Spec -------------------------------------------------------------------------------\n//------------------------------------------------------------------------------------------\n\nconst AM_Spec = superclass => class extends superclass {\n\n    static register(name) {\n        super.register(name);\n        _croquet_croquet__WEBPACK_IMPORTED_MODULE_0__.Constants.WC_SPEC.set(name, this);\n    }\n\n    get manifest() { return [] }\n\n    toSpec(layer) {\n        const spec = {};\n        if (!layer || this.tags.has(layer)) {\n            spec.actor = _croquet_croquet__WEBPACK_IMPORTED_MODULE_0__.Constants.WC_SPEC.revGet(this.constructor);\n            spec.pawn = this.pawn;\n            if (this.tags.size) spec.tags = Array.from(this.tags);\n            for (const x of this.manifest) {spec[x] = this[x]}\n        }\n\n        if (this.children.size > 0) spec.children = [];\n        for (const child of this.children) { if (child.toSpec) spec.children.push(child.toSpec(layer)); }\n        return spec;\n    }\n\n};\n(0,_Mixins__WEBPACK_IMPORTED_MODULE_1__.RegisterMixin)(AM_Spec);\n\nfunction CreateFromSpec(parent, spec) {\n    const actor = spec.actor;\n    const children = spec.children || [];\n    const options = {...spec};\n    options.parent = parent;\n    delete options.actor;\n    delete options.children;\n\n    const a = _croquet_croquet__WEBPACK_IMPORTED_MODULE_0__.Constants.WC_SPEC.get(actor);\n\n    if (actor && !a) console.error(actor + \" not found during createFromSpec!\");\n\n    let out = parent;\n    if (a) out = a.create(options);\n    for (const child of children) CreateFromSpec(out, child);\n}\n\n\n\n//# sourceURL=webpack:///../node_modules/@croquet/worldcore-kernel/src/Spec.js?");

/***/ }),

/***/ "../node_modules/@croquet/worldcore-kernel/src/User.js":
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AM_Avatar: () => (/* binding */ AM_Avatar),\n/* harmony export */   Account: () => (/* binding */ Account),\n/* harmony export */   AccountManager: () => (/* binding */ AccountManager),\n/* harmony export */   PM_Avatar: () => (/* binding */ PM_Avatar),\n/* harmony export */   User: () => (/* binding */ User),\n/* harmony export */   UserManager: () => (/* binding */ UserManager)\n/* harmony export */ });\n/* harmony import */ var _Actor__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(\"../node_modules/@croquet/worldcore-kernel/src/Actor.js\");\n/* harmony import */ var _Mixins__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(\"../node_modules/@croquet/worldcore-kernel/src/Mixins.js\");\n/* harmony import */ var _Root__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(\"../node_modules/@croquet/worldcore-kernel/src/Root.js\");\n\n\n\n\n\n// ------------------------------------------------------------------------------------------\n// -- User ----------------------------------------------------------------------------------\n// ------------------------------------------------------------------------------------------\n\nclass User extends _Actor__WEBPACK_IMPORTED_MODULE_0__.Actor {\n    get userId() { return this._userId }\n    get driver() { return this._userId }\n    get userNumber() { return this._userNumber }\n}\nUser.register('User');\n\n//------------------------------------------------------------------------------------------\n//-- UserManager ---------------------------------------------------------------------------\n//------------------------------------------------------------------------------------------\n\n// Maintains a list of users connected to the session.\n\nclass UserManager extends _Root__WEBPACK_IMPORTED_MODULE_2__.ModelService {\n\n    get defaultUser() {return User}\n\n    init() {\n        super.init('UserManager');\n        this.userNumber = 0;\n        this.users = new Map();\n        this.subscribe(this.sessionId, \"view-join\", this.onJoin);\n        this.subscribe(this.sessionId, \"view-exit\", this.onExit);\n    }\n\n    user(viewId) { return this.users.get(viewId) }\n\n    createUser(options) {\n        return this.defaultUser.create(options);\n    }\n\n    destroyUser(user) {\n        user.destroy();\n    }\n\n    onJoin(viewId) {\n        if (this.users.has(viewId)) console.warn(\"UserManager received duplicate view-join for viewId \" + viewId);\n        const user = this.createUser({userId: viewId, userNumber: this.userNumber});\n        this.userNumber++;\n        this.users.set(viewId, user);\n        this.publish(\"UserManager\", \"create\", user);\n    }\n\n    onExit(viewId) {\n        const user = this.user(viewId);\n        if (!user) return;\n        this.destroyUser(user);\n        this.users.delete(viewId);\n        this.publish(\"UserManager\", \"destroy\", viewId);\n    }\n\n    get userCount() {\n        return this.users.size;\n    }\n\n}\nUserManager.register(\"UserManager\");\n\n\n//------------------------------------------------------------------------------------------\n//-- AM_Avatar -----------------------------------------------------------------------------\n//------------------------------------------------------------------------------------------\n\n\nconst AM_Avatar = superclass => class extends superclass {\n\n    get driver() { return this._driver} // The viewId of the user controlling this avatar.\n\n};\n(0,_Mixins__WEBPACK_IMPORTED_MODULE_1__.RegisterMixin)(AM_Avatar);\n\n//------------------------------------------------------------------------------------------\n//-- PM_Avatar -----------------------------------------------------------------------------\n//------------------------------------------------------------------------------------------\n\n// Way to turn on view smoothing temporarily.\n\nconst PM_Avatar = superclass => class extends superclass {\n\n    constructor(actor) {\n        super(actor);\n        this.onDriverSet();\n        this.listenOnce(\"driverSet\", this.onDriverSet);\n    }\n\n    get isMyAvatar() {\n        return this.actor.driver === this.viewId;\n    }\n\n    onDriverSet() {\n        if (this.isMyAvatar) {\n            this.driving = true;\n            this.drive();\n        } else {\n            this.driving = false;\n            this.park();\n        }\n    }\n\n    park() {}\n    drive() {}\n\n};\n\n// ------------------------------------------------------------------------------------------\n// -- Account -------------------------------------------------------------------------------\n// ------------------------------------------------------------------------------------------\n\nclass Account extends _Actor__WEBPACK_IMPORTED_MODULE_0__.Actor {\n    get accountId() { return this._accountId }\n}\nAccount.register('Account');\n\n//------------------------------------------------------------------------------------------\n//-- AccountManager ------------------------------------------------------------------------\n//------------------------------------------------------------------------------------------\n\n// Maintains a list of accounts in the session\n\nclass AccountManager extends _Root__WEBPACK_IMPORTED_MODULE_2__.ModelService {\n\n    get defaultAccount() {return Account}\n\n    init() {\n        super.init('AccountManager');\n        this.accounts = new Map();\n        this.subscribe(\"account\", \"create\", this.onCreate);\n    }\n\n    deleteAccount(id) {\n        const account = this.accounts.get(id);\n        if (account) account.destroy();\n        this.accounts.delete(id);\n    }\n\n    onCreate(accountId) {\n        console.log(\"am onCreate\");\n        console.log(accountId);\n        if (this.accounts.has(accountId)) {\n            console.error(\"Duplicate account: \"+ accountId);\n            return;\n        }\n\n        console.log(\"new account: \" + accountId);\n        const account = this.defaultAccount.create({accountId});\n        this.accounts.set(accountId, account);\n        this.publish(\"AccountManager\", \"create\", accountId);\n    }\n\n    // onLogout(id) {\n    //     const account = this.accounts.get(id);\n    //     if (account) account.set({owner: null});\n    // }\n\n}\nAccountManager.register(\"AccountManager\");\n\n\n//# sourceURL=webpack:///../node_modules/@croquet/worldcore-kernel/src/User.js?");

/***/ }),

/***/ "../node_modules/@croquet/worldcore-kernel/src/Utilities.js":
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   PerlinNoise: () => (/* binding */ PerlinNoise),\n/* harmony export */   PriorityQueue: () => (/* binding */ PriorityQueue),\n/* harmony export */   Shuffle: () => (/* binding */ Shuffle),\n/* harmony export */   TwoWayMap: () => (/* binding */ TwoWayMap)\n/* harmony export */ });\n//------------------------------------------------------------------------------------------\n//-- PriorityQueue -------------------------------------------------------------------------\n//------------------------------------------------------------------------------------------\n\n// Implements a basic priority queue.\n\n// If you wanted to set up a queue that sorted on key/value pairs it would look like this:\n// const q = new PriorityQueue((a, b) => a.key < b.key);\n\nconst defaultComparator = (a, b) => a < b;\n\nclass PriorityQueue {\n\n    constructor(comparator = defaultComparator) {\n        this.items = [];\n        this.comparator = comparator;\n    }\n\n    get isEmpty() { return (this.items.length === 0) }\n    get count() { return this.items.length }\n    get top() { return this.items[0] }\n\n    clear() { this.items.length = 0 }\n\n    push(item) {\n        let n = this.items.length;\n        while (n > 0 && !this.comparator(this.items[n >> 1], item)) {\n            this.items[n] = this.items[n >> 1];\n            n >>= 1;\n        }\n        this.items[n] = item;\n    }\n\n    pop() {\n        const top = this.items[0];\n        const last = this.items.pop();\n        if (this.items.length > 0) {\n            this.items[0] = last;\n            this.heapify(0);\n        }\n        return top;\n    }\n\n    traverse(callback) {\n        this.items.forEach(callback);\n    }\n\n    heapify(n) {\n        let m = n;\n        const left = n << 1;\n        const right = left + 1;\n        if (left < this.items.length && this.comparator(this.items[left], this.items[m])) m = left;\n        if (right < this.items.length && this.comparator(this.items[right], this.items[m])) m = right;\n        if (m === n) return;\n        const swap = this.items[n];\n        this.items[n] = this.items[m];\n        this.items[m] = swap;\n        this.heapify(m);\n    }\n}\n\n//------------------------------------------------------------------------------------------\n//-- PerlinNoise -------------------------------------------------------------------------\n//------------------------------------------------------------------------------------------\n\nclass PerlinNoise  {\n    constructor(seed = 0.1) {\n        this.generate(seed);\n    }\n\n    generate(seed) {\n        this.hashTable = this.generateHashTable(seed);\n    }\n\n    // deterministic pseudo-random number generator\n    mulberry32(a) {\n        let t = a += 0x6D2B79F5;\n        t = Math.imul(t ^ t >>> 15, t | 1);\n        t ^= t + Math.imul(t ^ t >>> 7, t | 61);\n        return ((t ^ t >>> 14) >>> 0) / 4294967296;\n    }\n\n    generateHashTable(seed) {\n        const permutation = [];\n        for (let n = 0; n < 256; n++) {\n            seed = this.mulberry32(seed*0xFFFFFFFF);\n            permutation.push({key: seed, value: n});\n        }\n        permutation.sort((a, b) => a.key - b.key);\n        const table = permutation.map(a => a.value);\n        const table2 = table.concat(table);\n        return table2;\n    }\n\n    signedNoise2D(x,y) {\n        return this.noise2D(x,y) - 0.5;\n    }\n\n    noise2D(x,y) {\n        const table = this.hashTable;\n        const xInt = Math.floor(x);\n        const yInt = Math.floor(y);\n        const xf = x - xInt;\n        const yf = y - yInt;\n        const u = this.fade(xf);\n        const v = this.fade(yf);\n        const xi = xInt & 0xff;\n        const yi = yInt & 0xff;\n\n        const aa = table[table[xi   ] + yi];\n        const ab = table[table[xi+1 ] + yi];\n        const ba = table[table[xi   ] + yi+1];\n        const bb = table[table[xi+1 ] + yi+1];\n\n        const aaGrad = this.grad(aa, xf, yf);\n        const abGrad = this.grad(ab, xf-1, yf);\n        const baGrad = this.grad(ba, xf, yf-1);\n        const bbGrad = this.grad(bb, xf-1, yf-1);\n\n        const lerp0 = this.lerp(aaGrad, abGrad, u);\n        const lerp1 = this.lerp(baGrad, bbGrad, u);\n\n        return (this.lerp(lerp0, lerp1, v) + 1) / 2;\n    }\n\n    lerp(a, b, t) {\n        return a + t * (b - a);\n    }\n\n    fade(t) {\n        return t * t * t * (t * (t * 6 - 15) + 10);\n    }\n\n    grad(hash, x, y) {\n        switch (hash&0x3) {\n            case 0: return  x + y;\n            case 1: return -x + y;\n            case 2: return  x - y;\n            case 3: return -x - y;\n            default: return 0;\n        }\n    }\n\n}\n\n\n//------------------------------------------------------------------------------------------\n//-- TwoWayMap -----------------------------------------------------------------------------\n//------------------------------------------------------------------------------------------\n\n// Holds a reverse map that maps values back onto keys\n\nclass TwoWayMap {\n    constructor(map = new Map()) {\n        this.map = map;\n        this.rev = new Map();\n        this.map.forEach((value, key) => { this.rev.set(value, key)});\n    }\n\n    clear() {\n        this.map.clear();\n        this.rev.clear();\n    }\n\n    set(key, value) {\n        this.map.set(key, value);\n        this.rev.set(value, key);\n    }\n\n    delete(key) {\n        if (!this.map.has(key)) return;\n        const value = this.map.get(key);\n        this.map.delete(key);\n        this.rev.delete(value);\n    }\n\n    get(key) { return this.map.get(key)}\n    revGet(value) { return this.rev.get(value)}\n    has(key) {return this.map.has(key)}\n    revHas(value) {return this.rev.has(value)}\n\n    forEach(callback) {this.map.forEach(callback)}\n    revForEach(callback) {this.rev.forEach(callback)}\n}\n\n//------------------------------------------------------------------------------------------\n//-- Shuffle -------------------------------------------------------------------------------\n//------------------------------------------------------------------------------------------\n\n// Returns an array of the specified length filled with random indices from 0 to length-1.\n// Each index appears only once.\n\nfunction Shuffle(length) {\n    const out = new Array(length);\n    for (let n = 0; n < length; n++) out[n] = n;\n    let n = length;\n    while (n) {\n        const pick = Math.floor(Math.random() * n--);\n        const swap = out[n];\n        out[n] = out[pick];\n        out[pick] = swap;\n    }\n    return out;\n}\n\n\n\n\n//# sourceURL=webpack:///../node_modules/@croquet/worldcore-kernel/src/Utilities.js?");

/***/ }),

/***/ "../node_modules/@croquet/worldcore-kernel/src/Vector.js":
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   TAU: () => (/* binding */ TAU),\n/* harmony export */   TO_DEG: () => (/* binding */ TO_DEG),\n/* harmony export */   TO_RAD: () => (/* binding */ TO_RAD),\n/* harmony export */   clampRad: () => (/* binding */ clampRad),\n/* harmony export */   gaussian: () => (/* binding */ gaussian),\n/* harmony export */   m2_identity: () => (/* binding */ m2_identity),\n/* harmony export */   m2_rotation: () => (/* binding */ m2_rotation),\n/* harmony export */   m2_zero: () => (/* binding */ m2_zero),\n/* harmony export */   m4_determinant: () => (/* binding */ m4_determinant),\n/* harmony export */   m4_getRotation: () => (/* binding */ m4_getRotation),\n/* harmony export */   m4_getScale: () => (/* binding */ m4_getScale),\n/* harmony export */   m4_getScaleRotationTranslation: () => (/* binding */ m4_getScaleRotationTranslation),\n/* harmony export */   m4_getTranslation: () => (/* binding */ m4_getTranslation),\n/* harmony export */   m4_identity: () => (/* binding */ m4_identity),\n/* harmony export */   m4_invert: () => (/* binding */ m4_invert),\n/* harmony export */   m4_multiply: () => (/* binding */ m4_multiply),\n/* harmony export */   m4_perspective: () => (/* binding */ m4_perspective),\n/* harmony export */   m4_rotation: () => (/* binding */ m4_rotation),\n/* harmony export */   m4_rotationQ: () => (/* binding */ m4_rotationQ),\n/* harmony export */   m4_rotationX: () => (/* binding */ m4_rotationX),\n/* harmony export */   m4_rotationY: () => (/* binding */ m4_rotationY),\n/* harmony export */   m4_rotationZ: () => (/* binding */ m4_rotationZ),\n/* harmony export */   m4_scale: () => (/* binding */ m4_scale),\n/* harmony export */   m4_scaleRotationTranslation: () => (/* binding */ m4_scaleRotationTranslation),\n/* harmony export */   m4_toNormal4: () => (/* binding */ m4_toNormal4),\n/* harmony export */   m4_translation: () => (/* binding */ m4_translation),\n/* harmony export */   m4_transpose: () => (/* binding */ m4_transpose),\n/* harmony export */   m4_zero: () => (/* binding */ m4_zero),\n/* harmony export */   q_axisAngle: () => (/* binding */ q_axisAngle),\n/* harmony export */   q_conjugate: () => (/* binding */ q_conjugate),\n/* harmony export */   q_dot: () => (/* binding */ q_dot),\n/* harmony export */   q_equals: () => (/* binding */ q_equals),\n/* harmony export */   q_euler: () => (/* binding */ q_euler),\n/* harmony export */   q_eulerYXZ: () => (/* binding */ q_eulerYXZ),\n/* harmony export */   q_identity: () => (/* binding */ q_identity),\n/* harmony export */   q_invert: () => (/* binding */ q_invert),\n/* harmony export */   q_isZero: () => (/* binding */ q_isZero),\n/* harmony export */   q_lookAt: () => (/* binding */ q_lookAt),\n/* harmony export */   q_magnitude: () => (/* binding */ q_magnitude),\n/* harmony export */   q_multiply: () => (/* binding */ q_multiply),\n/* harmony export */   q_normalize: () => (/* binding */ q_normalize),\n/* harmony export */   q_pitch: () => (/* binding */ q_pitch),\n/* harmony export */   q_roll: () => (/* binding */ q_roll),\n/* harmony export */   q_slerp: () => (/* binding */ q_slerp),\n/* harmony export */   q_toAxisAngle: () => (/* binding */ q_toAxisAngle),\n/* harmony export */   q_yaw: () => (/* binding */ q_yaw),\n/* harmony export */   rayTriangleIntersect: () => (/* binding */ rayTriangleIntersect),\n/* harmony export */   slerp: () => (/* binding */ slerp),\n/* harmony export */   sphericalRandom: () => (/* binding */ sphericalRandom),\n/* harmony export */   toDeg: () => (/* binding */ toDeg),\n/* harmony export */   toRad: () => (/* binding */ toRad),\n/* harmony export */   v2_abs: () => (/* binding */ v2_abs),\n/* harmony export */   v2_add: () => (/* binding */ v2_add),\n/* harmony export */   v2_angle: () => (/* binding */ v2_angle),\n/* harmony export */   v2_ceil: () => (/* binding */ v2_ceil),\n/* harmony export */   v2_closest: () => (/* binding */ v2_closest),\n/* harmony export */   v2_distance: () => (/* binding */ v2_distance),\n/* harmony export */   v2_distanceSqr: () => (/* binding */ v2_distanceSqr),\n/* harmony export */   v2_divide: () => (/* binding */ v2_divide),\n/* harmony export */   v2_dot: () => (/* binding */ v2_dot),\n/* harmony export */   v2_equals: () => (/* binding */ v2_equals),\n/* harmony export */   v2_floor: () => (/* binding */ v2_floor),\n/* harmony export */   v2_inverse: () => (/* binding */ v2_inverse),\n/* harmony export */   v2_isZero: () => (/* binding */ v2_isZero),\n/* harmony export */   v2_lerp: () => (/* binding */ v2_lerp),\n/* harmony export */   v2_magnitude: () => (/* binding */ v2_magnitude),\n/* harmony export */   v2_manhattan: () => (/* binding */ v2_manhattan),\n/* harmony export */   v2_max: () => (/* binding */ v2_max),\n/* harmony export */   v2_min: () => (/* binding */ v2_min),\n/* harmony export */   v2_multiply: () => (/* binding */ v2_multiply),\n/* harmony export */   v2_normalize: () => (/* binding */ v2_normalize),\n/* harmony export */   v2_perpendicular: () => (/* binding */ v2_perpendicular),\n/* harmony export */   v2_random: () => (/* binding */ v2_random),\n/* harmony export */   v2_rotate: () => (/* binding */ v2_rotate),\n/* harmony export */   v2_scale: () => (/* binding */ v2_scale),\n/* harmony export */   v2_signedAngle: () => (/* binding */ v2_signedAngle),\n/* harmony export */   v2_sqrMag: () => (/* binding */ v2_sqrMag),\n/* harmony export */   v2_sub: () => (/* binding */ v2_sub),\n/* harmony export */   v2_transform: () => (/* binding */ v2_transform),\n/* harmony export */   v2_zero: () => (/* binding */ v2_zero),\n/* harmony export */   v3_abs: () => (/* binding */ v3_abs),\n/* harmony export */   v3_add: () => (/* binding */ v3_add),\n/* harmony export */   v3_angle: () => (/* binding */ v3_angle),\n/* harmony export */   v3_ceil: () => (/* binding */ v3_ceil),\n/* harmony export */   v3_cross: () => (/* binding */ v3_cross),\n/* harmony export */   v3_distance: () => (/* binding */ v3_distance),\n/* harmony export */   v3_distanceSqr: () => (/* binding */ v3_distanceSqr),\n/* harmony export */   v3_divide: () => (/* binding */ v3_divide),\n/* harmony export */   v3_dot: () => (/* binding */ v3_dot),\n/* harmony export */   v3_equals: () => (/* binding */ v3_equals),\n/* harmony export */   v3_floor: () => (/* binding */ v3_floor),\n/* harmony export */   v3_inverse: () => (/* binding */ v3_inverse),\n/* harmony export */   v3_isZero: () => (/* binding */ v3_isZero),\n/* harmony export */   v3_lerp: () => (/* binding */ v3_lerp),\n/* harmony export */   v3_magnitude: () => (/* binding */ v3_magnitude),\n/* harmony export */   v3_manhattan: () => (/* binding */ v3_manhattan),\n/* harmony export */   v3_max: () => (/* binding */ v3_max),\n/* harmony export */   v3_min: () => (/* binding */ v3_min),\n/* harmony export */   v3_multiply: () => (/* binding */ v3_multiply),\n/* harmony export */   v3_normalize: () => (/* binding */ v3_normalize),\n/* harmony export */   v3_random: () => (/* binding */ v3_random),\n/* harmony export */   v3_rotate: () => (/* binding */ v3_rotate),\n/* harmony export */   v3_rotateX: () => (/* binding */ v3_rotateX),\n/* harmony export */   v3_rotateY: () => (/* binding */ v3_rotateY),\n/* harmony export */   v3_rotateZ: () => (/* binding */ v3_rotateZ),\n/* harmony export */   v3_scale: () => (/* binding */ v3_scale),\n/* harmony export */   v3_sqrMag: () => (/* binding */ v3_sqrMag),\n/* harmony export */   v3_sub: () => (/* binding */ v3_sub),\n/* harmony export */   v3_transform: () => (/* binding */ v3_transform),\n/* harmony export */   v3_zero: () => (/* binding */ v3_zero)\n/* harmony export */ });\n// import * as THREE from 'three';\n\n// Vector and matrix math\n\n//--------------------------------------------------------------------------------\n//-- THREE.js Utilities ----------------------------------------------------------\n//--------------------------------------------------------------------------------\n\n// export function v2_THREE(x=0,y=0) { return new THREE.Vector2(x,y) }\n// export function v3_THREE(x=0,y=0,z=0) { return new THREE.Vector3(x,y,z) }\n// export function v4_THREE(x=0,y=0,z=0,w=1) { return new THREE.Vector4(x,y,z,w) }\n// export function q_THREE(x=0,y=0,z=0,w=1) { return new THREE.Quaternion(x,y,z,w) }\n// export function m4_THREE(m) { return m?(new THREE.Matrix4()).fromArray(m):new THREE.Matrix4() }\n\n//--------------------------------------------------------------------------------\n//-- Math Utilities --------------------------------------------------------------\n//--------------------------------------------------------------------------------\n\nconst TO_RAD = Math.PI / 180;\nconst TO_DEG = 1 / TO_RAD;\nconst TAU = Math.PI * 2;\n\nfunction toRad(x) { return x * TO_RAD }\nfunction toDeg(x) { return x * TO_DEG }\n\nfunction clampRad(x) {\n    while (x < 0) x += TAU;\n    return x % TAU;\n}\n\nfunction slerp(a,b,t) {\n    const cc = (1-t)*Math.cos(a) + t*Math.cos(b);\n    const ss = (1-t)*Math.sin(a) + t*Math.sin(b);\n    return Math.atan2(ss,cc);\n}\n\n\nfunction gaussian(count, step = 1, standardDeviation = 1) {\n    const sd = 2 * standardDeviation * standardDeviation;\n    const a = 1/Math.sqrt(Math.PI * sd);\n    const b = 1/sd;\n    const out = [a];\n    for (let i = 1; i < count; i++) {\n        const x = step * i;\n        out.push(a * Math.E ** -(b * x * x));\n    }\n    return out;\n}\n\nfunction rayTriangleIntersect(start, aim, triangle) {\n    const epsilon = 0.00001;\n    const v0 = triangle[0];\n    const v1 = triangle[1];\n    const v2 = triangle[2];\n    const edge1 = v3_sub(v1,v0);\n    const edge2 = v3_sub(v2,v0);\n    const h = v3_cross(aim, edge2);\n    const a = v3_dot(edge1, h);\n    if (a > -epsilon && a < epsilon) return null; // Aim is parallel to triangle\n    const f = 1/a;\n    const s = v3_sub(start,v0);\n    const u = f * v3_dot(s,h);\n    if (u < 0 || u > 1) return null;\n    const q = v3_cross(s, edge1);\n    const v = f * v3_dot(aim, q);\n    if (v < 0 || u+v > 1) return null;\n    const t = f * v3_dot(edge2, q);\n    if (t < epsilon || t > 1/epsilon) return null;\n    return v3_add(start, v3_scale(aim, t));\n}\n\n// returns [xyz] on surface of sphere with values -1 > p > 1\nfunction sphericalRandom() {\n    const u = Math.random();\n    const v = Math.random();\n    const root = 2 * Math.sqrt(u - u * u);\n    const angle = TAU * v;\n    return [root * Math.cos(angle), root * Math.sin(angle), 1-2*u];\n}\n\n//--------------------------------------------------------------------------------\n//-- 2 Vectors -------------------------------------------------------------------\n//--------------------------------------------------------------------------------\n\nfunction v2_zero() {\n    return [0,0];\n}\n\n// export function v2_unit() {\n//     return [1,0];\n// }\n\nfunction v2_random() {\n    const a = Math.random() * 2 * Math.PI;\n    return [Math.cos(a), Math.sin(a)];\n}\n\nfunction v2_magnitude(v) {\n    return Math.sqrt(v[0] * v[0] + v[1] * v[1]);\n}\n\nfunction v2_sqrMag(v) { // Squared magnitude\n    return (v[0] * v[0] + v[1] * v[1]);\n}\n\nfunction v2_normalize(v) {\n    const m = 1/v2_magnitude(v);\n    return [v[0]*m, v[1]*m];\n}\n\nfunction v2_abs(v) {\n    return [Math.abs(v[0]), Math.abs(v[1])];\n}\n\nfunction v2_ceil(v) {\n    return [Math.ceil(v[0]), Math.ceil(v[1])];\n}\n\nfunction v2_floor(v) {\n    return [Math.floor(v[0]), Math.floor(v[1])];\n}\n\nfunction v2_inverse(v) {\n    return [1/v[0], 1/v[1]];\n}\n\nfunction v2_scale(v,s) {\n    return [v[0] * s, v[1] * s];\n}\n\nfunction v2_multiply(a,b) {\n    return [a[0] * b[0], a[1] * b[1]];\n}\n\nfunction v2_divide(a,b) {\n    return [a[0] / b[0], a[1] / b[1]];\n}\n\nfunction v2_rotate(v,a) {\n    const sinA = Math.sin(a);\n    const cosA = Math.cos(a);\n    return [cosA*v[0] - sinA*v[1], sinA*v[0] + cosA*v[1]];\n}\n\nfunction v2_add(a,b) {\n    return [a[0] + b[0], a[1] + b[1]];\n}\n\nfunction v2_sub(a,b) {\n    return [a[0] - b[0], a[1] - b[1]];\n}\n\nfunction v2_dot(a,b) {\n    return a[0] * b[0] + a[1] * b[1];\n}\n\nfunction v2_min(a,b) {\n    return [Math.min(a[0], b[0]), Math.min(a[1], b[1])];\n}\n\nfunction v2_max(a,b) {\n    return [Math.max(a[0], b[0]), Math.max(a[1], b[1])];\n}\n\nfunction v2_angle(a,b) {\n    return Math.acos(Math.min(1,(Math.max(-1, v2_dot(v2_normalize(a), v2_normalize(b))))));\n}\n\nfunction v2_signedAngle(a,b) {\n    return Math.atan2(a[0]* b[1]-a[1]*b[0], a[0]*b[0]+a[1]*b[1]);\n}\n\nfunction v2_lerp(a,b,t) {\n    return [a[0] + (b[0] - a[0]) * t, a[1] + (b[1] - a[1]) * t];\n}\n\nfunction v2_equals(a,b,e = 0) { // e is an epsilon\n    if (e) return (e > Math.abs(a[0]-b[0]) && e > Math.abs(a[1]-b[1]));\n    return (a[0] === b[0] && a[1] === b[1]);\n}\n\nfunction v2_isZero(v) {\n    return v[0] === 0 && v[1] === 0;\n}\n\nfunction v2_distance(a,b) {\n    const dx = a[0] - b[0];\n    const dy = a[1] - b[1];\n    return Math.sqrt(dx*dx+dy*dy);\n}\n\nfunction v2_distanceSqr(a,b) {\n    const dx = a[0] - b[0];\n    const dy = a[1] - b[1];\n    return dx*dx+dy*dy;\n}\n\nfunction v2_manhattan(a, b) {\n    return Math.abs(a[0]-b[0]) + Math.abs(a[1]-b[1]);\n}\n\nfunction v2_transform(v, m) {\n    const x = v[0], y = v[1];\n    return ([\n        m[0] * x + m[2] * y,\n        m[1] * x + m[3] * y\n    ]);\n}\n\nfunction v2_perpendicular(v) {\n    return[v[1], v[0]];\n}\n\nfunction v2_closest(v,p) { // The closest point on vector v from point p, assumes v is normalized\n    return v2_scale(v,v2_dot(v,p));\n}\n\n//--------------------------------------------------------------------------------\n//-- 3 Vectors -------------------------------------------------------------------\n//--------------------------------------------------------------------------------\n\nfunction v3_zero() {\n    return [0,0,0];\n}\n\n// export function v3_unit() {\n//     return [1,1,1];\n// }\n\n// export function v3_random() {\n//     const a = Math.random() * 2 * Math.PI;\n//     const b = Math.acos(2 * Math.random() - 1);\n//     return v3_rotateZ(v3_rotateY(v3_unit(),b),a);\n// }\n\nfunction v3_random() {\n    const u = Math.random();\n    const v = Math.random();\n    const root = 2 * Math.sqrt(u - u * u);\n    const angle = TAU * v;\n    return [root * Math.cos(angle), root * Math.sin(angle), 1-2*u];\n}\n\nfunction v3_magnitude(v) {\n    return Math.sqrt(v[0] * v[0] + v[1] * v[1] + v[2] * v[2]);\n}\n\nfunction v3_sqrMag(v) { // Squared magnitude\n    return (v[0] * v[0] + v[1] * v[1] + v[2] * v[2]);\n}\n\nfunction v3_normalize(v) {\n    const m = 1/v3_magnitude(v);\n    return [v[0]*m, v[1]*m, v[2]*m];\n}\n\nfunction v3_inverse(v) {\n    return [1/v[0], 1/v[1], 1/v[2]];\n}\n\nfunction v3_abs(v) {\n    return [Math.abs(v[0]), Math.abs(v[1]), Math.abs(v[2])];\n}\n\nfunction v3_ceil(v) {\n    return [Math.ceil(v[0]), Math.v3_ceil(v[1]), Math.ceil(v[2])];\n}\n\nfunction v3_floor(v) {\n    return [Math.floor(v[0]), Math.floor(v[1]), Math.floor(v[2])];\n}\n\nfunction v3_scale(v,s) {\n    return [v[0] * s, v[1] * s, v[2] * s];\n}\n\n// export function v3_opposite(v) {\n//     return [v[0] * -1, v[1] * -1, v[2] * -1];\n// }\n\nfunction v3_multiply(a,b) {\n    return [a[0] * b[0], a[1] * b[1], a[2] * b[2]];\n}\n\nfunction v3_divide(a,b) {\n    return [a[0] / b[0], a[1] / b[1], a[2] / b[2]];\n}\n\n// Clockwise in radians looking along axis.\nfunction v3_rotateX(v,a) {\n    const sinA = Math.sin(a);\n    const cosA = Math.cos(a);\n    return [v[0], cosA*v[1] - sinA*v[2], sinA*v[1] + cosA*v[2]];\n}\n\nfunction v3_rotateY(v,a) {\n    const sinA = Math.sin(a);\n    const cosA = Math.cos(a);\n    return [sinA*v[2] + cosA*v[0], v[1], cosA*v[2] - sinA*v[0]];\n}\n\nfunction v3_rotateZ(v,a) {\n    const sinA = Math.sin(a);\n    const cosA = Math.cos(a);\n    return [cosA*v[0] - sinA*v[1], sinA*v[0] + cosA*v[1], v[2]];\n}\n\nfunction v3_add(a,b) {\n    return [a[0] + b[0], a[1] + b[1], a[2] + b[2]];\n}\n\nfunction v3_sub(a,b) {\n    return [a[0] - b[0], a[1] - b[1], a[2] - b[2]];\n}\n\nfunction v3_dot(a,b) {\n    return a[0] * b[0] + a[1] * b[1] + a[2] * b[2];\n}\n\nfunction v3_cross(a,b) {\n    const a0 = a[0], a1 = a[1], a2 = a[2];\n    const b0 = b[0], b1 = b[1], b2 = b[2];\n    return [\n        a1 * b2 - a2 * b1,\n        a2 * b0 - a0 * b2,\n        a0 * b1 - a1 * b0];\n}\n\nfunction v3_min(a,b) {\n    return [Math.min(a[0], b[0]), Math.min(a[1], b[1]), Math.min(a[2], b[2])];\n}\n\nfunction v3_max(a,b) {\n    return [Math.max(a[0], b[0]), Math.max(a[1], b[1]), Math.max(a[2], b[2])];\n}\n\n// Returns manhattan disances between a and b\nfunction v3_manhattan(a, b) {\n    return Math.abs(a[0]-b[0]) + Math.abs(a[1]-b[1]) + Math.abs(a[2]-b[2]);\n}\n\nfunction v3_angle(a,b) {\n    return Math.acos(Math.min(1,(Math.max(-1, v3_dot(v3_normalize(a), v3_normalize(b))))));\n}\n\nfunction v3_lerp(a,b,t) {\n    return [a[0] + (b[0] - a[0]) * t, a[1] + (b[1] - a[1]) * t, a[2] + (b[2] - a[2]) * t];\n}\n\nfunction v3_transform(v, m) {\n    const x = v[0], y = v[1], z = v[2];\n    const w = m[3] * x + m[7] * y + m[11] * z + m[15];\n    return [\n        (m[0] * x + m[4] * y + m[8] * z + m[12]) / w,\n        (m[1] * x + m[5] * y + m[9] * z + m[13]) / w,\n        (m[2] * x + m[6] * y + m[10] * z + m[14]) / w\n    ];\n}\n\nfunction v3_rotate(v, q) {\n    const qx = q[0], qy = q[1], qz = q[2], qw = q[3];\n    const x = v[0], y = v[1], z = v[2];\n    let uvx = qy * z - qz * y, uvy = qz * x - qx * z, uvz = qx * y - qy * x;\n    let uuvx = qy * uvz - qz * uvy, uuvy = qz * uvx - qx * uvz, uuvz = qx * uvy - qy * uvx;\n    let w2 = qw * 2;\n    uvx *= w2;\n    uvy *= w2;\n    uvz *= w2;\n    uuvx *= 2;\n    uuvy *= 2;\n    uuvz *= 2;\n    return [x + uvx + uuvx, y + uvy + uuvy, z + uvz + uuvz];\n}\n\nfunction v3_equals(a,b,e = 0) { // e is an epsilon\n    if (e) return (e > Math.abs(a[0]-b[0]) && e > Math.abs(a[1]-b[1]) && e > Math.abs(a[2]-b[2]));\n    return (a[0] === b[0] && a[1] === b[1] && a[2] === b[2]);\n}\n\nfunction v3_isZero(v) {\n    return v[0] === 0 && v[1] === 0 && v[2] === 0;\n}\n\nfunction v3_distance(a,b) {\n    const dx = a[0] - b[0];\n    const dy = a[1] - b[1];\n    const dz = a[2] - b[2];\n    return Math.sqrt(dx*dx+dy*dy+dz*dz);\n}\n\nfunction v3_distanceSqr(a,b) {\n    const dx = a[0] - b[0];\n    const dy = a[1] - b[1];\n    const dz = a[2] - b[2];\n    return dx*dx+dy*dy+dz*dz;\n}\n//--------------------------------------------------------------------------------\n//-- 4 Vectors -------------------------------------------------------------------\n//--------------------------------------------------------------------------------\n\n// export function v4_zero() {\n//     return [0,0,0,0];\n// }\n\n// // export function v4_unit() {\n// //     return [1,0,0,0];\n// // }\n\n// export function v4_magnitude(v) {\n//     return Math.sqrt(v[0] * v[0] + v[1] * v[1] + v[2] * v[2] + v[3] * v[3]);\n// }\n\n// export function v4_sqrMag(v) { // Squared magnitude\n//     return (v[0] * v[0] + v[1] * v[1] + v[2] * v[2] + v[3] * v[3]);\n// }\n\n// export function v4_normalize(v) {\n//     const m = 1/v4_magnitude(v);\n//     return [v[0]*m, v[1]*m, v[2]*m, v[3]*m];\n// }\n\n// export function v4_inverse(v) {\n//     return [1/v[0], 1/v[1], 1/v[2], 1/v[3]];\n// }\n\n// export function v4_ceil(v) {\n//     return [Math.ceil(v[0]), Math.v3_ceil(v[1]), Math.v3_ceil(v[2]), Math.v3_ceil(v[3])];\n// }\n\n// export function v4_floor(v) {\n//     return [Math.floor(v[0]), Math.floor(v[1]), Math.floor(v[2]), Math.floor(v[3])];\n// }\n\n// export function v4_scale(v,s) {\n//     return [v[0] * s, v[1] * s, v[2] * s, v[3] * s];\n// }\n\n// export function v4_multiply(a,b) {\n//     return [a[0] * b[0], a[1] * b[1], a[2] * b[2], a[3] * b[3]];\n// }\n\n// export function v4_add(a,b) {\n//     return [a[0] + b[0], a[1] + b[1], a[2] + b[2], a[3] + b[3]];\n// }\n\n// export function v4_sub(a,b) {\n//     return [a[0] - b[0], a[1] - b[1], a[2] - b[2], a[3] - b[3]];\n// }\n\n// export function v4_dot(a,b) {\n//     return a[0] * b[0] + a[1] * b[1] + a[2] * b[2]  + a[3] * b[3];\n// }\n\n// export function v4_min(a,b) {\n//     return [Math.min(a[0], b[0]), Math.min(a[1], b[1]), Math.min(a[2], b[2]), Math.min(a[3], b[3])];\n// }\n\n// export function v4_max(a,b) {\n//     return [Math.max(a[0], b[0]), Math.max(a[1], b[1]), Math.max(a[2], b[2]), Math.max(a[3], b[3])];\n// }\n\n// export function v4_transform(v, m) {\n//         const x = v[0], y = v[1], z = v[2], w = v[3];\n//         return [\n//             m[0] * x + m[4] * y + m[8] * z + m[12] * w,\n//             m[1] * x + m[5] * y + m[9] * z + m[13] * w,\n//             m[2] * x + m[6] * y + m[10] * z + m[14] * w,\n//             m[3] * x + m[7] * y + m[11] * z + m[15] * w,\n//         ];\n//       }\n\n// export function v4_equals(a,b,e = 0) { // e is an epsilon\n//     if (e) return (e > Math.abs(a[0]-b[0]) && e > Math.abs(a[1]-b[1]) && e > Math.abs(a[2]-b[2]) && e > Math.abs(a[3]-b[3]));\n//     return (a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3]);\n// }\n\n//--------------------------------------------------------------------------------\n//-- 2x2 Matrices ----------------------------------------------------------------\n//--------------------------------------------------------------------------------\n\nfunction m2_zero() {\n    return [\n        0,0,\n        0,0\n    ];\n}\n\nfunction m2_identity() {\n    return [\n        1,0,\n        0,1\n    ];\n}\n\n// Clockwise in radians\nfunction m2_rotation(angle) {\n    const sinA = Math.sin(angle);\n    const cosA = Math.cos(angle);\n    return [\n        cosA, -sinA,\n        sinA,cosA\n    ];\n}\n\n//--------------------------------------------------------------------------------\n//-- 3x3 Matrices ----------------------------------------------------------------\n//--------------------------------------------------------------------------------\n\n// export function m3_zero() {\n//     return [\n//         0,0,0,\n//         0,0,0,\n//         0,0,0\n//     ];\n// }\n\n// export function m3_identity() {\n//     return [\n//         1,0,0,\n//         0,1,0,\n//         0,0,1\n//     ];\n// }\n\n// export function m3_transpose(m) {\n//     return [\n//         m[0], m[3], m[6],\n//         m[1], m[4], m[7],\n//         m[2], m[5], m[8]\n//     ];\n// }\n\n// export function m3_invert(m) {\n//     const a00 = m[0], a01 = m[1], a02 = m[2];\n//     const a10 = m[3], a11 = m[4], a12 = m[5];\n//     const a20 = m[6], a21 = m[7], a22 = m[8];\n\n//     const b00 = a11 * a22 - a21 * a12;\n//     const b10 = a01 * a22 - a21 * a02;\n//     const b20 = a01 * a12 - a11 * a02;\n\n//     const b01 = a10 * a22 - a20 * a12;\n//     const b11 = a00 * a22 - a20 * a02;\n//     const b21 = a00 * a12 - a10 * a02;\n\n//     const b02 = a10 * a21 - a20 * a11;\n//     const b12 = a00 * a21 - a20 * a01;\n//     const b22 = a00 * a11 - a10 * a01;\n\n//     // // Calculate the determinant\n//     const d = a00 * b00 + a01 * -b01 + a02 * b02;\n\n//     return [\n//         b00/d, -b10/d, b20/d,\n//         -b01/d, b11/d, -b21/d,\n//         b02/d, -b12/d, b22/d\n//     ];\n// }\n\n// export function m3_multiply(a, b) {\n//     const a00 = a[0], a01 = a[1], a02 = a[2];\n//     const a10 = a[3], a11 = a[4], a12 = a[5];\n//     const a20 = a[6], a21 = a[7], a22 = a[8];\n\n//     const b00 = b[0], b01 = b[1], b02 = b[2];\n//     const b10 = b[3], b11 = b[4], b12 = b[5];\n//     const b20 = b[6], b21 = b[7], b22 = b[8];\n\n//     return [\n//         b00 * a00 + b01 * a10 + b02 * a20,\n//         b00 * a01 + b01 * a11 + b02 * a21,\n//         b00 * a02 + b01 * a12 + b02 * a22,\n\n//         b10 * a00 + b11 * a10 + b12 * a20,\n//         b10 * a01 + b11 * a11 + b12 * a21,\n//         b10 * a02 + b11 * a12 + b12 * a22,\n\n//         b20 * a00 + b21 * a10 + b22 * a20,\n//         b20 * a01 + b21 * a11 + b22 * a21,\n//         b20 * a02 + b21 * a12 + b22 * a22\n//     ];\n//   }\n\n\n\n// export function m3_normalFromMat4(out, a) {\n//     let a00 = a[0], a01 = a[1], a02 = a[2], a03 = a[3];\n//     let a10 = a[4], a11 = a[5], a12 = a[6], a13 = a[7];\n//     let a20 = a[8], a21 = a[9], a22 = a[10], a23 = a[11];\n//     let a30 = a[12], a31 = a[13], a32 = a[14], a33 = a[15];\n\n//     let b00 = a00 * a11 - a01 * a10;\n//     let b01 = a00 * a12 - a02 * a10;\n//     let b02 = a00 * a13 - a03 * a10;\n//     let b03 = a01 * a12 - a02 * a11;\n//     let b04 = a01 * a13 - a03 * a11;\n//     let b05 = a02 * a13 - a03 * a12;\n//     let b06 = a20 * a31 - a21 * a30;\n//     let b07 = a20 * a32 - a22 * a30;\n//     let b08 = a20 * a33 - a23 * a30;\n//     let b09 = a21 * a32 - a22 * a31;\n//     let b10 = a21 * a33 - a23 * a31;\n//     let b11 = a22 * a33 - a23 * a32;\n\n//     // Calculate the determinant\n//     let det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n//     if (!det) {\n//       return null;\n//     }\n//     det = 1.0 / det;\n\n//     out[0] = (a11 * b11 - a12 * b10 + a13 * b09) * det;\n//     out[1] = (a12 * b08 - a10 * b11 - a13 * b07) * det;\n//     out[2] = (a10 * b10 - a11 * b08 + a13 * b06) * det;\n\n//     out[3] = (a02 * b10 - a01 * b11 - a03 * b09) * det;\n//     out[4] = (a00 * b11 - a02 * b08 + a03 * b07) * det;\n//     out[5] = (a01 * b08 - a00 * b10 - a03 * b06) * det;\n\n//     out[6] = (a31 * b05 - a32 * b04 + a33 * b03) * det;\n//     out[7] = (a32 * b02 - a30 * b05 - a33 * b01) * det;\n//     out[8] = (a30 * b04 - a31 * b02 + a33 * b00) * det;\n\n//     return out;\n//   }\n\n\n//--------------------------------------------------------------------------------\n//-- 4x4 Matrices ----------------------------------------------------------------\n//--------------------------------------------------------------------------------\n\nfunction m4_zero() {\n    return [\n        0,0,0,0,\n        0,0,0,0,\n        0,0,0,0,\n        0,0,0,0\n    ];\n}\n\nfunction m4_identity() {\n    return [\n        1,0,0,0,\n        0,1,0,0,\n        0,0,1,0,\n        0,0,0,1\n    ];\n}\n\nfunction m4_translation(v) {\n    return [\n        1,0,0,0,\n        0,1,0,0,\n        0,0,1,0,\n        v[0],v[1],v[2],1\n    ];\n}\n\nfunction m4_getTranslation(m) {\n    return [m[12], m[13], m[14]];\n}\n\n// export function m4_getTranslation(m) {\n//     return [m[12]/m[15], m[13]/m[15], m[14]/m[15]];\n// }\n\n// Accepts a scalar or a 3 vector\nfunction m4_scale(s) {\n    if (s instanceof Array) {\n        return [\n            s[0],0,0,0,\n            0,s[1],0,0,\n            0,0,s[2],0,\n            0,0,0,1\n        ];\n    }\n    return [\n        s,0,0,0,\n        0,s,0,0,\n        0,0,s,0,\n        0,0,0,1\n    ];\n}\n\nfunction m4_getScale(m) {\n    return [\n        v3_magnitude([m[0], m[4], m[8]]),\n        v3_magnitude([m[1], m[5], m[9]]),\n        v3_magnitude([m[2], m[6], m[10]])\n    ];\n}\n\n// Clockwise in radians looking along axis.\nfunction m4_rotation(axis, angle) {\n    const n = v3_normalize(axis);\n    const sinA = Math.sin(angle);\n    const cosA = Math.cos(angle);\n    const minusCosA = 1-cosA;\n    return [\n        n[0] * n[0] * minusCosA + cosA,\n        n[1] * n[0] * minusCosA + n[2] * sinA,\n        n[2] * n[0] * minusCosA - n[1] * sinA,\n        0,\n\n        n[0] * n[1] * minusCosA - n[2] * sinA,\n        n[1] * n[1] * minusCosA + cosA,\n        n[2] * n[1] * minusCosA + n[0] * sinA,\n        0,\n\n        n[0] * n[2] * minusCosA + n[1] * sinA,\n        n[1] * n[2] * minusCosA - n[0] * sinA,\n        n[2] * n[2] * minusCosA + cosA,\n        0,\n\n        0,\n        0,\n        0,\n        1\n    ];\n}\n\nfunction m4_rotationX(a) {\n    const sinA = Math.sin(a);\n    const cosA = Math.cos(a);\n    return [\n        1,0,0,0,\n        0,cosA,sinA,0,\n        0,-sinA,cosA,0,\n        0,0,0,1\n    ];\n}\n\nfunction m4_rotationY(a) {\n    const sinA = Math.sin(a);\n    const cosA = Math.cos(a);\n    return [\n        cosA,0,-sinA,0,\n        0,1,0,0,\n        sinA,0,cosA,0,\n        0,0,0,1\n    ];\n}\n\nfunction m4_rotationZ(a) {\n    const sinA = Math.sin(a);\n    const cosA = Math.cos(a);\n    return [\n        cosA,sinA,0,0,\n        -sinA,cosA,0,0,\n        0,0,1,0,\n        0,0,0,1\n    ];\n}\n\n// Creates a rotation matrix from a quaternion\nfunction m4_rotationQ(q) {\n    const x = q[0], y = q[1], z = q[2], w = q[3];\n    const x2 = x + x;\n    const y2 = y + y;\n    const z2 = z + z;\n\n    const xx = x * x2;\n    const yx = y * x2;\n    const yy = y * y2;\n    const zx = z * x2;\n    const zy = z * y2;\n    const zz = z * z2;\n    const wx = w * x2;\n    const wy = w * y2;\n    const wz = w * z2;\n\n    return [\n        1 - yy - zz,\n        yx + wz,\n        zx - wy,\n        0,\n\n        yx - wz,\n        1 - xx - zz,\n        zy + wx,\n        0,\n\n        zx + wy,\n        zy - wx,\n        1 - xx - yy,\n        0,\n\n        0,\n        0,\n        0,\n        1\n    ];\n}\n\n// Extracts the rotation component and returns it as a quaternion\n// ignores scale, result is normalized\n\nfunction m4_getRotation(m) {\n    const s0 = v3_magnitude([m[0], m[4], m[8]]);\n    const s1 = v3_magnitude([m[1], m[5], m[9]]);\n    const s2 = v3_magnitude([m[2], m[6], m[10]]);\n\n    const m00 = m[0] / s0;\n    const m01 = m[1] / s1;\n    const m02 = m[2] / s2;\n\n    const m10 = m[4] / s0;\n    const m11 = m[5] / s1;\n    const m12 = m[6] / s2;\n\n    const m20 = m[8] / s0;\n    const m21 = m[9] / s1;\n    const m22 = m[10] / s2;\n\n    let t;\n    let x;\n    let y;\n    let z;\n    let w;\n\n    if (m22 < 0) {\n        if (m00 > m11) {\n            t = 1 + m00 - m11 - m22;\n            x = t;\n            y = m01+m10;\n            z = m20+m02;\n            w = m12-m21;\n        } else {\n            t = 1 - m00 + m11 - m22;\n            x = m01+m10;\n            y = t;\n            z = m12+m21;\n            w = m20-m02;\n        }\n    } else {\n        if (m00 < -m11) {\n            t = 1 - m00 - m11 + m22;\n            x = m20+m02;\n            y = m12+m21;\n            z = t;\n            w = m01-m10;\n        } else {\n            t = 1 + m00 + m11 + m22;\n            x = m12-m21;\n            y = m20-m02;\n            z = m01-m10;\n            w = t;\n        }\n    }\n\n    const f = 0.5 / Math.sqrt(t);\n    return [f*x, f*y, f*z, f*w];\n\n}\n\n// export function m4_getRotation(m) {\n//     const trace = m[0] + m[5] + m[10];\n//     let s = 0;\n//     const q = [0,0,0,0];\n\n//     if (trace > 0) {\n//       s = Math.sqrt(trace + 1.0) * 2;\n//       q[3] = 0.25 * s;\n//       q[0] = (m[6] - m[9]) / s;\n//       q[1] = (m[8] - m[2]) / s;\n//       q[2] = (m[1] - m[4]) / s;\n//     } else if ((m[0] > m[5]) && (m[0] > m[10])) {\n//       s = Math.sqrt(1.0 + m[0] - m[5] - m[10]) * 2;\n//       q[3] = (m[6] - m[9]) / s;\n//       q[0] = 0.25 * s;\n//       q[1] = (m[1] + m[4]) / s;\n//       q[2] = (m[8] + m[2]) / s;\n//     } else if (m[5] > m[10]) {\n//       s = Math.sqrt(1.0 + m[5] - m[0] - m[10]) * 2;\n//       q[3] = (m[8] - m[2]) / s;\n//       q[0] = (m[1] + m[4]) / s;\n//       q[1] = 0.25 * s;\n//       q[2] = (m[6] + m[9]) / s;\n//     } else {\n//       s = Math.sqrt(1.0 + m[10] - m[0] - m[5]) * 2;\n//       q[3] = (m[1] - m[4]) / s;\n//       q[0] = (m[8] + m[2]) / s;\n//       q[1] = (m[6] + m[9]) / s;\n//       q[2] = 0.25 * s;\n//     }\n\n//     return q;\n//   }\n\n// Applied in that order. Scale can be either a 3-vector or a scaler. Rotation is a quaternion.\nfunction m4_scaleRotationTranslation(s, q, v) {\n\n  const x = q[0], y = q[1], z = q[2], w = q[3];\n  const x2 = x + x, y2 = y + y, z2 = z + z;\n  const xx = x * x2, xy = x * y2, xz = x * z2;\n  const yy = y * y2, yz = y * z2, zz = z * z2;\n  const wx = w * x2, wy = w * y2, wz = w * z2;\n  let sx = 1, sy = 1, sz = 1;\n  if (s instanceof Array) {\n    sx = s[0]; sy = s[1]; sz = s[2];\n  } else {\n    sx = s; sy = s; sz = s;\n  }\n  return [\n    (1 - (yy + zz)) * sx,\n    (xy + wz) * sx,\n    (xz - wy) * sx,\n    0,\n\n    (xy - wz) * sy,\n    (1 - (xx + zz)) * sy,\n    (yz + wx) * sy,\n    0,\n\n    (xz + wy) * sz,\n    (yz - wx) * sz,\n    (1 - (xx + yy)) * sz,\n    0,\n\n    v[0],\n    v[1],\n    v[2],\n    1\n  ];\n\n\n}\n\nfunction m4_getScaleRotationTranslation(m) {\n    const s0 = v3_magnitude([m[0], m[4], m[8]]);\n    const s1 = v3_magnitude([m[1], m[5], m[9]]);\n    const s2 = v3_magnitude([m[2], m[6], m[10]]);\n\n    const m00 = m[0] / s0;\n    const m01 = m[1] / s1;\n    const m02 = m[2] / s2;\n\n    const m10 = m[4] / s0;\n    const m11 = m[5] / s1;\n    const m12 = m[6] / s2;\n\n    const m20 = m[8] / s0;\n    const m21 = m[9] / s1;\n    const m22 = m[10] / s2;\n\n    let t;\n    let x;\n    let y;\n    let z;\n    let w;\n\n    if (m22 < 0) {\n        if (m00 > m11) {\n            t = 1 + m00 - m11 - m22;\n            x = t;\n            y = m01+m10;\n            z = m20+m02;\n            w = m12-m21;\n        } else {\n            t = 1 - m00 + m11 - m22;\n            x = m01+m10;\n            y = t;\n            z = m12+m21;\n            w = m20-m02;\n        }\n    } else {\n        if (m00 < -m11) {\n            t = 1 - m00 - m11 + m22;\n            x = m20+m02;\n            y = m12+m21;\n            z = t;\n            w = m01-m10;\n        } else {\n            t = 1 + m00 + m11 + m22;\n            x = m12-m21;\n            y = m20-m02;\n            z = m01-m10;\n            w = t;\n        }\n    }\n\n    const f = 0.5 / Math.sqrt(t);\n    return [[s0, s1, s2], [f*x, f*y, f*z, f*w], [m[12], m[13], m[14]]];\n}\n\n// FOV is vertical field of view in radians\nfunction m4_perspective(fov, aspect, near, far) {\n    const f = 1.0 / Math.tan(fov / 2);\n    const nf = 1 / (near - far);\n    return [\n        f / aspect, 0, 0, 0,\n        0, f, 0, 0,\n        0, 0, (far + near) * nf, -1,\n        0, 0, (2 * far * near) * nf, 0\n    ];\n\n  }\n\nfunction m4_transpose(m) {\n    return [\n        m[0], m[4], m[8], m[12],\n        m[1], m[5], m[9], m[13],\n        m[2], m[6], m[10], m[14],\n        m[3], m[7], m[11], m[15]\n    ];\n}\n\nfunction m4_determinant(m) {\n\n    const a00 = m[0], a01 = m[1], a02 = m[2], a03 = m[3];\n    const a10 = m[4], a11 = m[5], a12 = m[6], a13 = m[7];\n    const a20 = m[8], a21 = m[9], a22 = m[10], a23 = m[11];\n    const a30 = m[12], a31 = m[13], a32 = m[14], a33 = m[15];\n\n    const b00 = a00 * a11 - a01 * a10;\n    const b01 = a00 * a12 - a02 * a10;\n    const b02 = a00 * a13 - a03 * a10;\n    const b03 = a01 * a12 - a02 * a11;\n    const b04 = a01 * a13 - a03 * a11;\n    const b05 = a02 * a13 - a03 * a12;\n    const b06 = a20 * a31 - a21 * a30;\n    const b07 = a20 * a32 - a22 * a30;\n    const b08 = a20 * a33 - a23 * a30;\n    const b09 = a21 * a32 - a22 * a31;\n    const b10 = a21 * a33 - a23 * a31;\n    const b11 = a22 * a33 - a23 * a32;\n\n    return b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n}\n\nfunction m4_invert(m) {\n\n    const a00 = m[0], a01 = m[1], a02 = m[2], a03 = m[3];\n    const a10 = m[4], a11 = m[5], a12 = m[6], a13 = m[7];\n    const a20 = m[8], a21 = m[9], a22 = m[10], a23 = m[11];\n    const a30 = m[12], a31 = m[13], a32 = m[14], a33 = m[15];\n\n    const b00 = a00 * a11 - a01 * a10;\n    const b01 = a00 * a12 - a02 * a10;\n    const b02 = a00 * a13 - a03 * a10;\n    const b03 = a01 * a12 - a02 * a11;\n    const b04 = a01 * a13 - a03 * a11;\n    const b05 = a02 * a13 - a03 * a12;\n    const b06 = a20 * a31 - a21 * a30;\n    const b07 = a20 * a32 - a22 * a30;\n    const b08 = a20 * a33 - a23 * a30;\n    const b09 = a21 * a32 - a22 * a31;\n    const b10 = a21 * a33 - a23 * a31;\n    const b11 = a22 * a33 - a23 * a32;\n\n    const d =  b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n\n    return [\n        (a11 * b11 - a12 * b10 + a13 * b09) / d,\n        (a02 * b10 - a01 * b11 - a03 * b09) / d,\n        (a31 * b05 - a32 * b04 + a33 * b03) / d,\n        (a22 * b04 - a21 * b05 - a23 * b03) / d,\n\n        (a12 * b08 - a10 * b11 - a13 * b07) / d,\n        (a00 * b11 - a02 * b08 + a03 * b07) / d,\n        (a32 * b02 - a30 * b05 - a33 * b01) / d,\n        (a20 * b05 - a22 * b02 + a23 * b01) / d,\n\n        (a10 * b10 - a11 * b08 + a13 * b06) / d,\n        (a01 * b08 - a00 * b10 - a03 * b06) / d,\n        (a30 * b04 - a31 * b02 + a33 * b00) / d,\n        (a21 * b02 - a20 * b04 - a23 * b00) / d,\n\n        (a11 * b07 - a10 * b09 - a12 * b06) / d,\n        (a00 * b09 - a01 * b07 + a02 * b06) / d,\n        (a31 * b01 - a30 * b03 - a32 * b00) / d,\n        (a20 * b03 - a21 * b01 + a22 * b00) / d\n    ];\n}\n\n// A is applied before b\nfunction m4_multiply(a,b) {\n    const a00 = a[0], a01 = a[1], a02 = a[2], a03 = a[3];\n    const a10 = a[4], a11 = a[5], a12 = a[6], a13 = a[7];\n    const a20 = a[8], a21 = a[9], a22 = a[10], a23 = a[11];\n    const a30 = a[12], a31 = a[13], a32 = a[14], a33 = a[15];\n\n    const b00 = b[0], b01 = b[1], b02 = b[2], b03 = b[3];\n    const b10 = b[4], b11 = b[5], b12 = b[6], b13 = b[7];\n    const b20 = b[8], b21 = b[9], b22 = b[10], b23 = b[11];\n    const b30 = b[12], b31 = b[13], b32 = b[14], b33 = b[15];\n\n    // Cache only the current line of the second matrix\n\n    return [\n        a00*b00 + a01*b10 + a02*b20 + a03*b30,\n        a00*b01 + a01*b11 + a02*b21 + a03*b31,\n        a00*b02 + a01*b12 + a02*b22 + a03*b32,\n        a00*b03 + a01*b13 + a02*b23 + a03*b33,\n\n        a10*b00 + a11*b10 + a12*b20 + a13*b30,\n        a10*b01 + a11*b11 + a12*b21 + a13*b31,\n        a10*b02 + a11*b12 + a12*b22 + a13*b32,\n        a10*b03 + a11*b13 + a12*b23 + a13*b33,\n\n        a20*b00 + a21*b10 + a22*b20 + a23*b30,\n        a20*b01 + a21*b11 + a22*b21 + a23*b31,\n        a20*b02 + a21*b12 + a22*b22 + a23*b32,\n        a20*b03 + a21*b13 + a22*b23 + a23*b33,\n\n        a30*b00 + a31*b10 + a32*b20 + a33*b30,\n        a30*b01 + a31*b11 + a32*b21 + a33*b31,\n        a30*b02 + a31*b12 + a32*b22 + a33*b32,\n        a30*b03 + a31*b13 + a32*b23 + a33*b33,\n\n    ];\n}\n\n// Extracts the scaling/rotation components and performs an inverse/transpose operation to generate a 4x4 normal transform matrix.\nfunction m4_toNormal4(m) {\n    let q = m4_getRotation(m);\n    return m4_rotationQ(q);\n\n    /*\n    const a00 = m[0], a01 = m[1], a02 = m[2];\n    const a10 = m[4], a11 = m[5], a12 = m[6];\n    const a20 = m[8], a21 = m[9], a22 = m[10];\n\n    const b00 = a11 * a22 - a21 * a12;\n    const b10 = a01 * a22 - a21 * a02;\n    const b20 = a01 * a12 - a11 * a02;\n\n    const b01 = a10 * a22 - a20 * a12;\n    const b11 = a00 * a22 - a20 * a02;\n    const b21 = a00 * a12 - a10 * a02;\n\n    const b02 = a10 * a21 - a20 * a11;\n    const b12 = a00 * a21 - a20 * a01;\n    const b22 = a00 * a11 - a10 * a01;\n\n    // // Calculate the determinant\n    const d = a00 * b00 + a01 * -b01 + a02 * b02;\n\n    return [\n        b00/d, -b01/d, b02/d, 0,\n        -b10/d, b11/d, -b12/d, 0,\n        b20/d, -b21/d, b22/d, 0,\n        0, 0, 0, 1\n    ];\n    */\n}\n\n// Extracts the scaling/rotation components and performs an inverse/transpose operation to generate a 3x3 normal transform matrix.\n// export function m4_toNormal3(m) {\n//     const a00 = m[0], a01 = m[1], a02 = m[2];\n//     const a10 = m[4], a11 = m[5], a12 = m[6];\n//     const a20 = m[8], a21 = m[9], a22 = m[10];\n\n//     const b00 = a11 * a22 - a21 * a12;\n//     const b10 = a01 * a22 - a21 * a02;\n//     const b20 = a01 * a12 - a11 * a02;\n\n//     const b01 = a10 * a22 - a20 * a12;\n//     const b11 = a00 * a22 - a20 * a02;\n//     const b21 = a00 * a12 - a10 * a02;\n\n//     const b02 = a10 * a21 - a20 * a11;\n//     const b12 = a00 * a21 - a20 * a01;\n//     const b22 = a00 * a11 - a10 * a01;\n\n//     // // Calculate the determinant\n//     const d = a00 * b00 + a01 * -b01 + a02 * b02;\n\n//     return [\n//         b00/d, -b01/d, b02/d,\n//         -b10/d, b11/d, -b12/d,\n//         b20/d, -b21/d, b22/d\n//     ];\n// }\n\n// generate ground plane matrix - no rotation out of the x/z plane\n// export function m4_grounded(m) {\n//     const g = [0,1,0] // the up vector\n//     var x = [m[0], m[1], m[2]];\n//     var z = v3_cross(x, g);\n//     z[1] = 0;\n//     z = v3_normalize(z);\n//     x = v3_cross(g, z);\n//     x[1] = 0;\n//     x = v3_normalize(x)\n//     return [x[0], x[1], x[2], 0,\n//             0, 1, 0, 0,\n//             z[0], z[1], z[2],0,\n//             0, 0, 0, 1];\n\n// }\n\n// // this is faster if we can assume that x and z projections in y-plane are perpendicular\n// export function m4_fastGrounded(m) {\n//     var x = v3_normalize([m[0], 0, m[2]]);\n//     var z = v3_normalize([m[8], 0, m[10]]);\n//     return [x[0], x[1], x[2], 0,\n//             0, 1, 0, 0,\n//             z[0], z[1], z[2], 0,\n//             0, 0, 0, 1];\n// }\n//--------------------------------------------------------------------------------\n//-- Quaternions -----------------------------------------------------------------\n//--------------------------------------------------------------------------------\n\nfunction q_identity() {\n    return [0,0,0,1];\n}\n\nfunction q_magnitude(q) {\n    return Math.sqrt(q[0] * q[0] + q[1] * q[1] + q[2] * q[2] + q[3] * q[3]);\n}\n\nfunction q_normalize(q) {\n    const m = 1/q_magnitude(q);\n    return [q[0]*m, q[1]*m, q[2]*m, q[3]*m];\n}\n\n// If the quaternion is normalized, this is also its inverse.\nfunction q_conjugate(q) {\n    return [-q[0], -q[1], -q[2], q[3]];\n}\n\nfunction q_invert(q) { return q_conjugate(q) }\n\n// Clockwise in radians looking along axis.\n// Axis should be normalized\nfunction q_axisAngle(axis, angle) {\n    const half = angle * 0.5;\n    const sinH = Math.sin(half);\n    const cosH = Math.cos(half);\n    return [sinH * axis[0], sinH * axis[1], sinH * axis[2], cosH];\n}\n\nfunction q_toAxisAngle(quat) {\n    let q = q_normalize(quat);\n    let angle = 2 * Math.acos(q[3]);\n    let axis;\n    let s = Math.sqrt( 1 - q[3] * q[3]);\n    // assuming quaternion normalised then w is less than 1, so term always positive.\n    if (s < 0.001) { // test to avoid divide by zero, s is always positive due to sqrt\n        // if s is close to zero then direction of axis not important\n        axis = [0, 1, 0];\n    } else {\n        axis = [q[0] / s, q[1] / s, q[2] / s]; // normalize vector\n    }\n    return {axis, angle};\n}\n\n// Given a forward vector and an up vector, generates the quaternion that will rotate\n// the forward vector to look at the target.\nfunction q_lookAt(f, u, t) {\n    const epsilon = 0.00001;\n    const dot = v3_dot(f,t);\n    if (Math.abs(dot+1) < epsilon) return q_axisAngle(u, Math.PI);\n    if (Math.abs(dot-1) < epsilon) return q_identity();\n    const angle = Math.acos(dot);\n    const axis = v3_normalize(v3_cross(f,t));\n    return q_axisAngle(axis, angle);\n}\n\n// Creates a quaternion from the given Euler angles.\nfunction q_euler(x, y ,z) {\n    x *= 0.5;\n    y *= 0.5;\n    z *= 0.5;\n    const sinX = Math.sin(x);\n    const cosX = Math.cos(x);\n    const sinY = Math.sin(y);\n    const cosY = Math.cos(y);\n    const sinZ = Math.sin(z);\n    const cosZ = Math.cos(z);\n\n    return [\n        sinX * cosY * cosZ - cosX * sinY * sinZ,\n        cosX * sinY * cosZ + sinX * cosY * sinZ,\n        cosX * cosY * sinZ - sinX * sinY * cosZ,\n        cosX * cosY * cosZ + sinX * sinY * sinZ\n    ];\n\n}\n\nfunction q_eulerYXZ(x, y, z){\n    const cos = Math.cos;\n    const sin = Math.sin;\n\n    const c1 = cos( x / 2 );\n    const c2 = cos( y / 2 );\n    const c3 = cos( z / 2 );\n\n    const s1 = sin( x / 2 );\n    const s2 = sin( y / 2 );\n    const s3 = sin( z / 2 );\n\n    return [\n        s1 * c2 * c3 + c1 * s2 * s3,\n        c1 * s2 * c3 - s1 * c2 * s3,\n        c1 * c2 * s3 - s1 * s2 * c3,\n        c1 * c2 * c3 + s1 * s2 * s3,\n    ];\n}\n\n// Returns the equivalent Euler angle around the x axis\nfunction q_pitch(q) {\n    const x = q[0], y = q[1], z = q[2], w = q[3];\n    return Math.atan2(2*x*w - 2*y*z, 1 - 2*x*x - 2*z*z);\n}\n\n// Returns the equivalent Euler angle around the y axis\nfunction q_yaw(q) {\n    const x = q[0], y = q[1], z = q[2], w = q[3];\n    return Math.atan2(2*y*w - 2*x*z, 1 - 2*y*y - 2*z*z);\n}\n\n// Returns the equivalent Euler angle around the z axis\nfunction q_roll(q) {\n    const x = q[0], y = q[1], z = q[2], w = q[3];\n    return Math.asin(2*x*y + 2*z*w);\n}\n\n// export function q_scale(q,s) {\n//     return [q[0] * s, q[1] * s, q[2] * s, q[3] * s, q[4] * s];\n// }\n\n// export function q_add(a,b) {\n//     return [a[0] + b[0], a[1] + b[1], a[2] + b[2], a[3] + b[3]];\n// }\n\nfunction q_dot(a,b) {\n    return a[0] * b[0] + a[1] * b[1] + a[2] * b[2]  + a[3] * b[3];\n}\n\n// A is applied before b\nfunction q_multiply(a, b) {\n    const ax = a[0], ay = a[1], az = a[2], aw = a[3];\n    const bx = b[0], by = b[1], bz = b[2], bw = b[3];\n    return [\n        bx * aw + by * az - bz * ay + bw * ax,\n        by * aw - bx * az + bw * ay + bz * ax,\n        bz * aw + bw * az + bx * ay - by * ax,\n        bw * aw - bz * az - by * ay - bx * ax\n    ];\n}\n\nfunction q_slerp(a,b,t) {\n    const ax = a[0], ay = a[1], az = a[2], aw = a[3];\n    let bx = b[0], by = b[1], bz = b[2], bw = b[3];\n\n    let omega, cosom, sinom, scale0, scale1;\n\n    cosom = ax * bx + ay * by + az * bz + aw * bw;\n    if ( cosom < 0.0 ) {\n        cosom = -cosom;\n        bx = -bx;\n        by = -by;\n        bz = -bz;\n        bw = -bw;\n    }\n\n    if ( (1.0 - cosom) > 0.00001 ) {\n        omega  = Math.acos(cosom);\n        sinom  = Math.sin(omega);\n        scale0 = Math.sin((1.0 - t) * omega) / sinom;\n        scale1 = Math.sin(t * omega) / sinom;\n    } else {\n        scale0 = 1.0 - t;\n        scale1 = t;\n    }\n\n    const c0 = scale0 * ax + scale1 * bx;\n    const c1 = scale0 * ay + scale1 * by;\n    const c2 = scale0 * az + scale1 * bz;\n    const c3 = scale0 * aw + scale1 * bw;\n\n    return [c0,c1,c2,c3];\n}\n\nfunction q_equals(a,b,e = 0) { // e is an epsilon\n    if (e) return Math.abs(q_dot(a,b)) + e >= 1;\n    return (a[0] === b[0] && a[1] === b[1] && a[2] === b[2] && a[3] === b[3]);\n}\n\nfunction q_isZero(q) {\n    return q[0] === 0 && q[1] === 0 && q[2] === 0;\n}\n\n\n\n\n//--------------------------------------------------------------------------------\n//-- Dual Quaternions ------------------------------------------------------------\n//--------------------------------------------------------------------------------\n\n// export function q2_identity() {\n//     return [0,0,0,1,0,0,0,0];\n// }\n\n// export function q2_magnitude(q) {\n//     return Math.sqrt(q[0] * q[0] + q[1] * q[1] + q[2] * q[2] + q[3] * q[3]);\n// }\n\n// export function q2_rotation(q) {\n//     return [...q,0,0,0,0];\n// }\n\n// export function q2_translation(t) {\n//     return [0,0,0,1,...v3_scale(t,0.5),0];\n// }\n\n// export function q2_axisAngle(axis, angle) {\n//     return q2_rotation(q_axisAngle(axis,angle));\n// }\n\n// export function q2_rotationTranslation(q,t) {\n//     const ax = t[0] * 0.5, ay = t[1] * 0.5, az = t[2] * 0.5;\n//     const bx = q[0], by = q[1], bz = q[2], bw = q[3];\n//     return [bx,by,bz,bw, ax*bw+ay*bz-az*by, ay*bw+az*bx-ax*bz, az*bw+ax*by-ay*bx, -ax*bx-ay*by-az*bz];\n// }\n\n// export function q2_axisAngleTranslation(axis, angle, t) {\n//     return q2_rotationTranslation(q_axisAngle(axis,angle), t);\n// }\n\n// export function q2_normalize(q2) {\n//     const m = 1/q2_magnitude(q2);\n//     const a0 = q2[0] * m, a1 = q2[1] * m, a2 = q2[2] * m, a3 = q2[3] * m;\n//     const b0 = q2[4],  b1 = q2[5], b2 = q2[6], b3 = q2[7];\n//     const dot = (a0 * b0) + (a1 * b1) + (a2 * b2) + (a3 * b3);\n//     return [a0, a1, a2, a3, (b0-(a0*dot))*m, (b1-(a1*dot))*m, (b2-(a2*dot))*m, (b3-(a3*dot))*m];\n\n// }\n\n\n// export function q2_multiply(a, b) {\n//     const ax0 = a[0], ay0 = a[1], az0 = a[2], aw0 = a[3];\n//     const ax1 = a[4], ay1 = a[5], az1 = a[6], aw1 = a[7];\n//     const bx0 = b[0], by0 = b[1], bz0 = b[2], bw0 = b[3];\n//     const bx1 = b[4], by1 = b[5], bz1 = b[6], bw1 = b[7];\n//     return [\n//         bx0 * aw0 + bw0 * ax0 + by0 * az0 - bz0 * ay0,\n//         by0 * aw0 + bw0 * ay0 + bz0 * ax0 - bx0 * az0,\n//         bz0 * aw0 + bw0 * az0 + bx0 * ay0 - by0 * ax0,\n//         bw0 * aw0 - bx0 * ax0 - by0 * ay0 - bz0 * az0,\n\n//         bx0 * aw1 + bw0 * ax1 + by0 * az1 - bz0 * ay1 + bx1 * aw0 + bw1 * ax0 + by1 * az0 - bz1 * ay0,\n//         by0 * aw1 + bw0 * ay1 + bz0 * ax1 - bx0 * az1 + by1 * aw0 + bw1 * ay0 + bz1 * ax0 - bx1 * az0,\n//         bz0 * aw1 + bw0 * az1 + bx0 * ay1 - by0 * ax1 + bz1 * aw0 + bw1 * az0 + bx1 * ay0 - by1 * ax0,\n//         bw0 * aw1 - bx0 * ax1 - by0 * ay1 - bz0 * az1 + bw1 * aw0 - bx1 * ax0 - by1 * ay0 - bz1 * az0\n//     ];\n//   }\n\n\n//# sourceURL=webpack:///../node_modules/@croquet/worldcore-kernel/src/Vector.js?");

/***/ }),

/***/ "../node_modules/@croquet/worldcore-kernel/src/Widget.js":
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   Widget: () => (/* binding */ Widget)\n/* harmony export */ });\n/* harmony import */ var _Root__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(\"../node_modules/@croquet/worldcore-kernel/src/Root.js\");\n/* harmony import */ var _Vector__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(\"../node_modules/@croquet/worldcore-kernel/src/Vector.js\");\n\n\n\n//------------------------------------------------------------------------------------------\n//-- Widget -------------------------------------------------------------------------------\n//------------------------------------------------------------------------------------------\n\nclass Widget extends _Root__WEBPACK_IMPORTED_MODULE_0__.WorldcoreView {\n\n    constructor(options) {\n        super(_Root__WEBPACK_IMPORTED_MODULE_0__.viewRoot.model);\n        this._opacity = 1;\n        this.set(options);\n        this.build();\n    }\n\n    build() {} // Use for created child widgets\n\n    destroy() {\n        super.destroy();\n        this.destroyChildren();\n        if (this.parent) this.parent.removeChild(this);\n    }\n\n    get name() { return this._name }\n    get parent() { return this._parent }\n    get size() { return this._size || [0,0] }\n    get autoSize() { return this._autoSize || [0,0]}\n    get border() { return this._border || [0,0,0,0]}\n    get height() { return this._height || 0}\n    get width() { return this._width || 0}\n    get translation() { return this._translation || [0,0] }\n    get anchor() { return this._anchor || [0,0]}\n    get pivot() { return this._pivot || [0,0]}\n    get color() { return this._color || [0,0,0]}\n    get opacity() {return this._opacity}\n    get visible() { return this._visible === undefined || this._visible }\n    get depth() {return this._depth || 0}\n    get isVisible() { // includes parent visibility\n        if (this.parent) return this.parent.isVisible && this.visible;\n        return this.visible;\n    }\n\n    show() { this.set({visible: true})}\n    hide() { this.set({visible: false})}\n\n    get trueDepth() {\n        if (this.parent) return this.parent.trueDepth + this.depth;\n        return this.depth;\n    }\n\n    get trueSize() {\n        const out = [...this.size];\n        if (this.parent) {\n            if (this.autoSize[0]) { out[0] = this.parent.trueSize[0] * this.autoSize[0] }\n            if (this.autoSize[1]) { out[1] = this.parent.trueSize[1] * this.autoSize[1] }\n        }\n\n        out[0] -= (this.border[0] + this.border[2]);\n        out[1] -= (this.border[1] + this.border[3]);\n        return out;\n    }\n\n    get local() {\n        let parentSize = [0,0];\n        if (this.parent) parentSize = this.parent.trueSize;\n        const aX = parentSize[0]*this.anchor[0];\n        const aY = parentSize[1]*this.anchor[1];\n        const pX = this.trueSize[0]*this.pivot[0];\n        const pY = this.trueSize[1]*this.pivot[1];\n\n        const x = this.translation[0];\n        const y = this.translation[1];\n\n        const bx = this.border[0];\n        const by = this.border[1];\n\n        return [bx+x+aX-pX, by+y+aY-pY];\n    }\n\n    get global() {\n        if (this.parent) {\n            return (0,_Vector__WEBPACK_IMPORTED_MODULE_1__.v2_add)(this.parent.global, this.local);\n        }\n        return this.local;\n    }\n\n    set(options) {\n        options = options || {};\n        const sorted = Object.entries(options).sort((a,b) => { return b[0] < a[0] ? 1 : -1 } );\n        for (const option of sorted) {\n            const name = option[0];\n            const value = option[1];\n            const ul = \"_\" + name;\n            const nameSet = name+'Set';\n            const old = this[ul];\n            this[ul] = value;\n            if (this[nameSet]) this[nameSet](value,old);\n        }\n    }\n\n    parentSet(value, old) {\n        if (old) old.removeChild(this);\n        if (value) value.addChild(this);\n    }\n\n    addChild(child) {\n        if (!this.children) this.children = new Set();\n        this.children.add(child);\n    }\n\n    removeChild(child) {\n        if (this.children) this.children.delete(child);\n    }\n\n    destroyChildren() {\n        new Set(this.children).forEach(child => child.destroy());\n    }\n\n    get sortedChildren() {\n        if (!this.children) return [];\n        const out = Array.from(this.children);\n        out.sort((a,b) => b.depth-a.depth);\n        return out;\n    }\n\n}\n\n\n\n//# sourceURL=webpack:///../node_modules/@croquet/worldcore-kernel/src/Widget.js?");

/***/ }),

/***/ "../../APIDemo/Models.js":
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   MyModelRoot: () => (/* binding */ MyModelRoot)\n/* harmony export */ });\n/* harmony import */ var _croquet_worldcore_kernel__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(\"../node_modules/@croquet/worldcore-kernel/index.js\");\n/* harmony import */ var _croquet_game_models__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(\"./sources/game-support-models.js\");\n\r\n\r\n\r\nclass TestActor extends (0,_croquet_worldcore_kernel__WEBPACK_IMPORTED_MODULE_0__.mix)(_croquet_worldcore_kernel__WEBPACK_IMPORTED_MODULE_0__.Actor).with(_croquet_worldcore_kernel__WEBPACK_IMPORTED_MODULE_0__.AM_Spatial) {\r\n  get gamePawnType() {\r\n    return \"basicSphere\";\r\n  }\r\n\r\n  init(options) {\r\n    super.init(options);\r\n    this.subscribe(\"input\", \"zDown\", this.moveLeft);\r\n    this.subscribe(\"input\", \"xDown\", this.moveRight);\r\n  }\r\n\r\n  moveLeft() {\r\n    const translation = this.translation;\r\n    translation[0] += -0.1;\r\n    this.set({ translation });\r\n  }\r\n\r\n  moveRight() {\r\n    const translation = this.translation;\r\n    translation[0] += 0.1;\r\n    this.set({ translation });\r\n  }\r\n}\r\nTestActor.register(\"TestActor\");\r\n\r\nclass MyModelRoot extends _croquet_game_models__WEBPACK_IMPORTED_MODULE_1__.GameModelRoot {\r\n  init(options) {\r\n    super.init(options);\r\n    console.log(\"Start model root!\");\r\n    this.test = TestActor.create({ translation: [3.25, 2.5, 0.5] });\r\n  }\r\n}\r\nMyModelRoot.register(\"MyModelRoot\");\r\n\n\n//# sourceURL=webpack:///../../APIDemo/Models.js?");

/***/ }),

/***/ "../../APIDemo/index.js":
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _croquet_unity_bridge__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(\"./sources/unity-bridge.js\");\n/* harmony import */ var _Models__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(\"../../APIDemo/Models.js\");\n\r\n\r\n\r\n(0,_croquet_unity_bridge__WEBPACK_IMPORTED_MODULE_0__.StartSession)(_Models__WEBPACK_IMPORTED_MODULE_1__.MyModelRoot, _croquet_unity_bridge__WEBPACK_IMPORTED_MODULE_0__.GameViewRoot);\r\n\n\n//# sourceURL=webpack:///../../APIDemo/index.js?");

/***/ }),

/***/ "bufferutil":
/***/ ((module) => {

module.exports = require("bufferutil");

/***/ }),

/***/ "utf-8-validate":
/***/ ((module) => {

module.exports = require("utf-8-validate");

/***/ }),

/***/ "buffer":
/***/ ((module) => {

module.exports = require("buffer");

/***/ }),

/***/ "crypto":
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "events":
/***/ ((module) => {

module.exports = require("events");

/***/ }),

/***/ "http":
/***/ ((module) => {

module.exports = require("http");

/***/ }),

/***/ "https":
/***/ ((module) => {

module.exports = require("https");

/***/ }),

/***/ "net":
/***/ ((module) => {

module.exports = require("net");

/***/ }),

/***/ "node:buffer":
/***/ ((module) => {

module.exports = require("node:buffer");

/***/ }),

/***/ "node:fs":
/***/ ((module) => {

module.exports = require("node:fs");

/***/ }),

/***/ "node:http":
/***/ ((module) => {

module.exports = require("node:http");

/***/ }),

/***/ "node:https":
/***/ ((module) => {

module.exports = require("node:https");

/***/ }),

/***/ "node:net":
/***/ ((module) => {

module.exports = require("node:net");

/***/ }),

/***/ "node:path":
/***/ ((module) => {

module.exports = require("node:path");

/***/ }),

/***/ "node:process":
/***/ ((module) => {

module.exports = require("node:process");

/***/ }),

/***/ "node:stream":
/***/ ((module) => {

module.exports = require("node:stream");

/***/ }),

/***/ "node:stream/web":
/***/ ((module) => {

module.exports = require("node:stream/web");

/***/ }),

/***/ "node:url":
/***/ ((module) => {

module.exports = require("node:url");

/***/ }),

/***/ "node:util":
/***/ ((module) => {

module.exports = require("node:util");

/***/ }),

/***/ "node:zlib":
/***/ ((module) => {

module.exports = require("node:zlib");

/***/ }),

/***/ "stream":
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "tls":
/***/ ((module) => {

module.exports = require("tls");

/***/ }),

/***/ "url":
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "worker_threads":
/***/ ((module) => {

module.exports = require("worker_threads");

/***/ }),

/***/ "zlib":
/***/ ((module) => {

module.exports = require("zlib");

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			id: moduleId,
/******/ 			loaded: false,
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId](module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Flag the module as loaded
/******/ 		module.loaded = true;
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/compat get default export */
/******/ 	(() => {
/******/ 		// getDefaultExport function for compatibility with non-harmony modules
/******/ 		__webpack_require__.n = (module) => {
/******/ 			var getter = module && module.__esModule ?
/******/ 				() => (module['default']) :
/******/ 				() => (module);
/******/ 			__webpack_require__.d(getter, { a: getter });
/******/ 			return getter;
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/define property getters */
/******/ 	(() => {
/******/ 		// define getter functions for harmony exports
/******/ 		__webpack_require__.d = (exports, definition) => {
/******/ 			for(var key in definition) {
/******/ 				if(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {
/******/ 					Object.defineProperty(exports, key, { enumerable: true, get: definition[key] });
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/hasOwnProperty shorthand */
/******/ 	(() => {
/******/ 		__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/make namespace object */
/******/ 	(() => {
/******/ 		// define __esModule on exports
/******/ 		__webpack_require__.r = (exports) => {
/******/ 			if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 				Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 			}
/******/ 			Object.defineProperty(exports, '__esModule', { value: true });
/******/ 		};
/******/ 	})();
/******/ 	
/******/ 	/* webpack/runtime/node module decorator */
/******/ 	(() => {
/******/ 		__webpack_require__.nmd = (module) => {
/******/ 			module.paths = [];
/******/ 			if (!module.children) module.children = [];
/******/ 			return module;
/******/ 		};
/******/ 	})();
/******/ 	
/************************************************************************/
/******/ 	
/******/ 	// startup
/******/ 	// Load entry module and return exports
/******/ 	// This entry module can't be inlined because the eval devtool is used.
/******/ 	var __webpack_exports__ = __webpack_require__("../../APIDemo/index.js");
/******/ 	
/******/ })()
;